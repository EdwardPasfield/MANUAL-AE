[0m22:08:04.011945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058cc800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c2eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c2e7b0>]}


============================== 22:08:04.014718 | 443b40ff-4d8b-4c6d-bbff-6ad4b8c0206c ==============================
[0m22:08:04.014718 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:08:04.015026 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m22:08:04.022647 [info ] [MainThread]: dbt version: 1.8.5
[0m22:08:04.022974 [info ] [MainThread]: python version: 3.12.5
[0m22:08:04.023155 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:08:04.023323 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:08:06.547001 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:08:06.547276 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:08:06.547431 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:08:06.547563 [info ] [MainThread]: adapter type: bigquery
[0m22:08:06.547693 [info ] [MainThread]: adapter version: 1.8.2
[0m22:08:06.592228 [info ] [MainThread]: Configuration:
[0m22:08:06.592506 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:08:06.592652 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:08:06.592786 [info ] [MainThread]: Required dependencies:
[0m22:08:06.592990 [debug] [MainThread]: Executing "git --help"
[0m22:08:06.607381 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:08:06.607953 [debug] [MainThread]: STDERR: "b''"
[0m22:08:06.608133 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:08:06.608296 [info ] [MainThread]: Connection:
[0m22:08:06.608488 [info ] [MainThread]:   method: oauth
[0m22:08:06.608614 [info ] [MainThread]:   database: manual-pasfield
[0m22:08:06.608734 [info ] [MainThread]:   execution_project: manual-pasfield
[0m22:08:06.608849 [info ] [MainThread]:   schema: dwh
[0m22:08:06.608962 [info ] [MainThread]:   location: EU
[0m22:08:06.609074 [info ] [MainThread]:   priority: None
[0m22:08:06.609188 [info ] [MainThread]:   maximum_bytes_billed: None
[0m22:08:06.609297 [info ] [MainThread]:   impersonate_service_account: None
[0m22:08:06.609408 [info ] [MainThread]:   job_retry_deadline_seconds: 4800
[0m22:08:06.609514 [info ] [MainThread]:   job_retries: 1
[0m22:08:06.609621 [info ] [MainThread]:   job_creation_timeout_seconds: 30
[0m22:08:06.609733 [info ] [MainThread]:   job_execution_timeout_seconds: 3600
[0m22:08:06.609842 [info ] [MainThread]:   timeout_seconds: 3600
[0m22:08:06.609952 [info ] [MainThread]:   client_id: None
[0m22:08:06.610059 [info ] [MainThread]:   token_uri: None
[0m22:08:06.610165 [info ] [MainThread]:   dataproc_region: None
[0m22:08:06.610274 [info ] [MainThread]:   dataproc_cluster_name: None
[0m22:08:06.610380 [info ] [MainThread]:   gcs_bucket: None
[0m22:08:06.610485 [info ] [MainThread]:   dataproc_batch: None
[0m22:08:06.610831 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:08:06.643697 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m22:08:06.644930 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:08:07.819095 [debug] [MainThread]: On debug: select 1 as id
[0m22:08:08.297578 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:aab2b0fb-65a5-4cef-a3f0-1de366874559&page=queryresults
[0m22:08:08.299349 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:08:08.300012 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:08:08.300479 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project manual-pasfield: User does not have bigquery.jobs.create permission in project manual-pasfield.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:08:08.306828 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 4.328291, "process_user_time": 2.84563, "process_kernel_time": 0.341155, "process_mem_max_rss": "193036288", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:08:08.308076 [debug] [MainThread]: Command `dbt debug` failed at 22:08:08.307905 after 4.33 seconds
[0m22:08:08.308683 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m22:08:08.309201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa4c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137920da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d92480>]}
[0m22:08:08.309769 [debug] [MainThread]: Flushing usage events
[0m22:10:53.270351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065dc890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3e8d0>]}


============================== 22:10:53.273149 | e4fcd5b0-3457-49f8-a3b5-28e6775133bc ==============================
[0m22:10:53.273149 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:10:53.273459 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:10:53.280907 [info ] [MainThread]: dbt version: 1.8.5
[0m22:10:53.281162 [info ] [MainThread]: python version: 3.12.5
[0m22:10:53.281309 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:10:53.281438 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:10:54.052990 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:10:54.053259 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:10:54.053464 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:10:54.053623 [info ] [MainThread]: adapter type: bigquery
[0m22:10:54.053777 [info ] [MainThread]: adapter version: 1.8.2
[0m22:10:54.096992 [info ] [MainThread]: Configuration:
[0m22:10:54.097251 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:10:54.097397 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:10:54.097525 [info ] [MainThread]: Required dependencies:
[0m22:10:54.097723 [debug] [MainThread]: Executing "git --help"
[0m22:10:54.114144 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:10:54.114659 [debug] [MainThread]: STDERR: "b''"
[0m22:10:54.114861 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:10:54.115022 [info ] [MainThread]: Connection:
[0m22:10:54.115191 [info ] [MainThread]:   method: oauth
[0m22:10:54.115324 [info ] [MainThread]:   database: manual-pasfield
[0m22:10:54.115441 [info ] [MainThread]:   execution_project: manual-pasfield
[0m22:10:54.115555 [info ] [MainThread]:   schema: dwh
[0m22:10:54.115665 [info ] [MainThread]:   location: EU
[0m22:10:54.115774 [info ] [MainThread]:   priority: None
[0m22:10:54.115886 [info ] [MainThread]:   maximum_bytes_billed: None
[0m22:10:54.115994 [info ] [MainThread]:   impersonate_service_account: None
[0m22:10:54.116102 [info ] [MainThread]:   job_retry_deadline_seconds: 4800
[0m22:10:54.116210 [info ] [MainThread]:   job_retries: 1
[0m22:10:54.116318 [info ] [MainThread]:   job_creation_timeout_seconds: 30
[0m22:10:54.116426 [info ] [MainThread]:   job_execution_timeout_seconds: 3600
[0m22:10:54.116534 [info ] [MainThread]:   timeout_seconds: 3600
[0m22:10:54.116641 [info ] [MainThread]:   client_id: None
[0m22:10:54.116745 [info ] [MainThread]:   token_uri: None
[0m22:10:54.116852 [info ] [MainThread]:   dataproc_region: None
[0m22:10:54.116955 [info ] [MainThread]:   dataproc_cluster_name: None
[0m22:10:54.117059 [info ] [MainThread]:   gcs_bucket: None
[0m22:10:54.117167 [info ] [MainThread]:   dataproc_batch: None
[0m22:10:54.117507 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:10:54.122838 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m22:10:54.124027 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:10:54.428169 [debug] [MainThread]: On debug: select 1 as id
[0m22:10:54.979368 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:40cf45cb-1596-4d3a-90fe-69b0800b1341&page=queryresults
[0m22:10:54.980017 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:10:54.980310 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:10:54.980544 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project manual-pasfield: User does not have bigquery.jobs.create permission in project manual-pasfield.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:10:54.983105 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.7441932, "process_user_time": 2.704923, "process_kernel_time": 0.297183, "process_mem_max_rss": "193429504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:10:54.983753 [debug] [MainThread]: Command `dbt debug` failed at 22:10:54.983647 after 1.74 seconds
[0m22:10:54.984118 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m22:10:54.984430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c8228d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059fcda0>]}
[0m22:10:54.984778 [debug] [MainThread]: Flushing usage events
[0m22:11:21.396197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062d5190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106876e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106876b70>]}


============================== 22:11:21.398740 | c567ce47-f448-4576-a05d-01a1fefc73d8 ==============================
[0m22:11:21.398740 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:11:21.399060 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '../profiles.yml', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug --profiles-dir ../profiles.yml', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:11:21.404892 [info ] [MainThread]: dbt version: 1.8.5
[0m22:11:21.405084 [info ] [MainThread]: python version: 3.12.5
[0m22:11:21.405449 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:11:21.405673 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:11:21.405871 [info ] [MainThread]: Using profiles dir at ../profiles.yml
[0m22:11:21.406005 [info ] [MainThread]: Using profiles.yml file at ../profiles.yml/profiles.yml
[0m22:11:21.406135 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:11:21.413313 [error] [MainThread]: Encountered an error:
Compilation Error
  Could not render {{ target.name == 'prod' }}: 'target' is undefined
[0m22:11:21.414166 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.04681254, "process_user_time": 0.585595, "process_kernel_time": 0.085776, "process_mem_max_rss": "92553216", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:11:21.414468 [debug] [MainThread]: Command `dbt debug` failed at 22:11:21.414419 after 0.05 seconds
[0m22:11:21.414639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106876de0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059c04a0>]}
[0m22:11:21.414835 [debug] [MainThread]: Flushing usage events
[0m22:12:02.886110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101d3f890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10552eb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10552e900>]}


============================== 22:12:02.888751 | 04b15ea8-18b0-458a-aa8e-07a3349a0af4 ==============================
[0m22:12:02.888751 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:12:02.889061 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'profiles.yml', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug --profiles-dir profiles.yml', 'send_anonymous_usage_stats': 'True'}
[0m22:12:02.895185 [info ] [MainThread]: dbt version: 1.8.5
[0m22:12:02.895382 [info ] [MainThread]: python version: 3.12.5
[0m22:12:02.895892 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:12:02.896083 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:12:02.896243 [info ] [MainThread]: Using profiles dir at profiles.yml
[0m22:12:02.896374 [info ] [MainThread]: Using profiles.yml file at profiles.yml/profiles.yml
[0m22:12:02.896492 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:12:02.903531 [error] [MainThread]: Encountered an error:
Compilation Error
  Could not render {{ target.name == 'prod' }}: 'target' is undefined
[0m22:12:02.905070 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.05173796, "process_user_time": 0.584021, "process_kernel_time": 0.105743, "process_mem_max_rss": "92569600", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:12:02.905412 [debug] [MainThread]: Command `dbt debug` failed at 22:12:02.905358 after 0.05 seconds
[0m22:12:02.905602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105038320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055080b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10535fd70>]}
[0m22:12:02.905779 [debug] [MainThread]: Flushing usage events
[0m22:13:37.314162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10803a720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082aad20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082aa9c0>]}


============================== 22:13:37.316910 | f5d08740-139a-4bb9-8b20-c8cc53e465fd ==============================
[0m22:13:37.316910 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:13:37.317273 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'profiles.yml', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug --profiles-dir profiles.yml', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:13:37.325026 [info ] [MainThread]: dbt version: 1.8.5
[0m22:13:37.325270 [info ] [MainThread]: python version: 3.12.5
[0m22:13:37.325414 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:13:37.325541 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:13:37.325683 [info ] [MainThread]: Using profiles dir at profiles.yml
[0m22:13:37.325801 [info ] [MainThread]: Using profiles.yml file at profiles.yml/profiles.yml
[0m22:13:37.325988 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:13:37.332894 [error] [MainThread]: Encountered an error:
Compilation Error
  Could not render {{ target.name == 'prod' }}: 'target' is undefined
[0m22:13:37.334378 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.05217254, "process_user_time": 0.5844, "process_kernel_time": 0.112979, "process_mem_max_rss": "92454912", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:13:37.334685 [debug] [MainThread]: Command `dbt debug` failed at 22:13:37.334635 after 0.05 seconds
[0m22:13:37.334855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c2b9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073ba030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dc0800>]}
[0m22:13:37.335026 [debug] [MainThread]: Flushing usage events
[0m22:13:56.966566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031bc7a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108eac60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108ea8d0>]}


============================== 22:13:56.969173 | 9ece102b-18bf-4b4d-b12a-8e42a7360a23 ==============================
[0m22:13:56.969173 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:13:56.969493 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:13:56.975593 [info ] [MainThread]: dbt version: 1.8.5
[0m22:13:56.975785 [info ] [MainThread]: python version: 3.12.5
[0m22:13:56.976201 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:13:56.976409 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:13:57.768664 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:13:57.768919 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:13:57.769069 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:13:57.771040 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:13:57.771251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9ece102b-18bf-4b4d-b12a-8e42a7360a23', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108c8ad0>]}
[0m22:13:57.796029 [info ] [MainThread]: Configuration:
[0m22:13:57.796301 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:13:57.796449 [info ] [MainThread]:   dbt_project.yml file [[31mERROR invalid[0m]
[0m22:13:57.796582 [info ] [MainThread]: Required dependencies:
[0m22:13:57.796786 [debug] [MainThread]: Executing "git --help"
[0m22:13:57.815945 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:13:57.816640 [debug] [MainThread]: STDERR: "b''"
[0m22:13:57.816826 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:13:57.816995 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:13:57.817256 [info ] [MainThread]: [31m2 checks failed:[0m
[0m22:13:57.817395 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify authentication method


[0m22:13:57.817529 [info ] [MainThread]: Project loading failed for the following reason:
Runtime Error
  at path ['name']: 'manual-test-platform' does not match '^[^\\d\\W]\\w*$'

Error encountered in /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml


[0m22:13:57.819229 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.8828739, "process_user_time": 2.663012, "process_kernel_time": 0.285219, "process_mem_max_rss": "190496768", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:13:57.819644 [debug] [MainThread]: Command `dbt debug` failed at 22:13:57.819567 after 0.88 seconds
[0m22:13:57.819911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107365cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1537dbe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a4c620>]}
[0m22:13:57.820135 [debug] [MainThread]: Flushing usage events
[0m22:14:33.124075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041d4380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047a6db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047a6a20>]}


============================== 22:14:33.126737 | 862e691e-d07b-45f3-b907-c9afa620b8dd ==============================
[0m22:14:33.126737 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:14:33.127063 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m22:14:33.134679 [info ] [MainThread]: dbt version: 1.8.5
[0m22:14:33.134929 [info ] [MainThread]: python version: 3.12.5
[0m22:14:33.135076 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:14:33.135209 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:14:33.914286 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:14:33.914545 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:14:33.914693 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:14:33.916757 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:14:33.916945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '862e691e-d07b-45f3-b907-c9afa620b8dd', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120b2fec0>]}
[0m22:14:33.955473 [info ] [MainThread]: Configuration:
[0m22:14:33.955736 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:14:33.955952 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:14:33.956101 [info ] [MainThread]: Required dependencies:
[0m22:14:33.956297 [debug] [MainThread]: Executing "git --help"
[0m22:14:33.971758 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:14:33.972379 [debug] [MainThread]: STDERR: "b''"
[0m22:14:33.972579 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:14:33.972747 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:14:33.972907 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:14:33.973032 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify authentication method


[0m22:14:33.975147 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.8824134, "process_user_time": 2.671536, "process_kernel_time": 0.280946, "process_mem_max_rss": "191430656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:14:33.975542 [debug] [MainThread]: Command `dbt debug` failed at 22:14:33.975480 after 0.88 seconds
[0m22:14:33.975833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10475a2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047c8e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c79c860>]}
[0m22:14:33.976049 [debug] [MainThread]: Flushing usage events
[0m22:15:46.909297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10564aea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106726b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106726870>]}


============================== 22:15:46.911885 | f040c398-8463-4ea7-8ef2-3d36bc75b20e ==============================
[0m22:15:46.911885 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:15:46.912207 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:15:46.924631 [info ] [MainThread]: dbt version: 1.8.5
[0m22:15:46.924874 [info ] [MainThread]: python version: 3.12.5
[0m22:15:46.925018 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:15:46.925158 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:15:47.750230 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:15:47.750495 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:15:47.750643 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:15:47.750774 [info ] [MainThread]: adapter type: bigquery
[0m22:15:47.750897 [info ] [MainThread]: adapter version: 1.8.2
[0m22:15:47.752828 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:15:47.753007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f040c398-8463-4ea7-8ef2-3d36bc75b20e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de9e0f0>]}
[0m22:15:47.790895 [info ] [MainThread]: Configuration:
[0m22:15:47.791155 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:15:47.791312 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:15:47.791442 [info ] [MainThread]: Required dependencies:
[0m22:15:47.791634 [debug] [MainThread]: Executing "git --help"
[0m22:15:47.805436 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:15:47.805910 [debug] [MainThread]: STDERR: "b''"
[0m22:15:47.806069 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:15:47.806217 [info ] [MainThread]: Connection:
[0m22:15:47.806374 [info ] [MainThread]:   method: oauth
[0m22:15:47.806494 [info ] [MainThread]:   database: manual-pasfield
[0m22:15:47.806619 [info ] [MainThread]:   execution_project: manual-pasfield
[0m22:15:47.806731 [info ] [MainThread]:   schema: test
[0m22:15:47.806846 [info ] [MainThread]:   location: None
[0m22:15:47.806956 [info ] [MainThread]:   priority: None
[0m22:15:47.807065 [info ] [MainThread]:   maximum_bytes_billed: None
[0m22:15:47.807175 [info ] [MainThread]:   impersonate_service_account: None
[0m22:15:47.807281 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m22:15:47.807390 [info ] [MainThread]:   job_retries: 1
[0m22:15:47.807499 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m22:15:47.807609 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m22:15:47.807716 [info ] [MainThread]:   timeout_seconds: None
[0m22:15:47.807822 [info ] [MainThread]:   client_id: None
[0m22:15:47.807930 [info ] [MainThread]:   token_uri: None
[0m22:15:47.808035 [info ] [MainThread]:   dataproc_region: None
[0m22:15:47.808141 [info ] [MainThread]:   dataproc_cluster_name: None
[0m22:15:47.808249 [info ] [MainThread]:   gcs_bucket: None
[0m22:15:47.808354 [info ] [MainThread]:   dataproc_batch: None
[0m22:15:47.808680 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:15:47.813724 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m22:15:47.814651 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:15:48.212113 [debug] [MainThread]: On debug: select 1 as id
[0m22:15:48.771646 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:None:59e2e069-58ee-4708-9177-edb699d8ede8&page=queryresults
[0m22:15:48.773540 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m22:15:48.774095 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:15:48.774595 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project manual-pasfield: User does not have bigquery.jobs.create permission in project manual-pasfield.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m22:15:48.780943 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.900851, "process_user_time": 2.558458, "process_kernel_time": 0.494022, "process_mem_max_rss": "193265664", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:15:48.782802 [debug] [MainThread]: Command `dbt debug` failed at 22:15:48.782339 after 1.90 seconds
[0m22:15:48.783554 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m22:15:48.784108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106726900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de9d430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11de02bd0>]}
[0m22:15:48.784668 [debug] [MainThread]: Flushing usage events
[0m22:32:52.540438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601c740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10667eb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10667e7b0>]}


============================== 22:32:52.543166 | f94eab23-0c6d-4b29-82e5-a1350270bae1 ==============================
[0m22:32:52.543166 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:32:52.543520 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:32:52.551155 [info ] [MainThread]: dbt version: 1.8.5
[0m22:32:52.551354 [info ] [MainThread]: python version: 3.12.5
[0m22:32:52.551494 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:32:52.551622 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:32:53.336326 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:32:53.336575 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:32:53.336727 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:32:53.338697 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:32:53.338887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f94eab23-0c6d-4b29-82e5-a1350270bae1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1362d5e50>]}
[0m22:32:53.362593 [info ] [MainThread]: Configuration:
[0m22:32:53.362846 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:32:53.362991 [info ] [MainThread]:   dbt_project.yml file [[31mERROR invalid[0m]
[0m22:32:53.363121 [info ] [MainThread]: Required dependencies:
[0m22:32:53.363321 [debug] [MainThread]: Executing "git --help"
[0m22:32:53.377469 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:32:53.378145 [debug] [MainThread]: STDERR: "b''"
[0m22:32:53.378357 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:32:53.378525 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:32:53.378771 [info ] [MainThread]: [31m2 checks failed:[0m
[0m22:32:53.379135 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify authentication method


[0m22:32:53.379272 [info ] [MainThread]: Project loading failed for the following reason:
Runtime Error
  at path ['name']: 'manual-pasfield' does not match '^[^\\d\\W]\\w*$'

Error encountered in /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml


[0m22:32:53.381912 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.874104, "process_user_time": 2.577772, "process_kernel_time": 0.381738, "process_mem_max_rss": "190595072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:32:53.382454 [debug] [MainThread]: Command `dbt debug` failed at 22:32:53.382395 after 0.87 seconds
[0m22:32:53.382718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063c54c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126979520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067442c0>]}
[0m22:32:53.382932 [debug] [MainThread]: Flushing usage events
[0m22:34:40.646278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131d2750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135f2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135f2930>]}


============================== 22:34:40.649119 | c80a2922-eaf0-4b2f-9880-ec38b4a1bd19 ==============================
[0m22:34:40.649119 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:34:40.649480 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:34:40.657038 [info ] [MainThread]: dbt version: 1.8.5
[0m22:34:40.657294 [info ] [MainThread]: python version: 3.12.5
[0m22:34:40.657447 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:34:40.657580 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:34:41.426860 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:34:41.427116 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:34:41.427266 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:34:41.429352 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:34:41.429549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c80a2922-eaf0-4b2f-9880-ec38b4a1bd19', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135f0440>]}
[0m22:34:41.468780 [info ] [MainThread]: Configuration:
[0m22:34:41.469040 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:34:41.469242 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:34:41.469395 [info ] [MainThread]: Required dependencies:
[0m22:34:41.469614 [debug] [MainThread]: Executing "git --help"
[0m22:34:41.484908 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:34:41.485433 [debug] [MainThread]: STDERR: "b''"
[0m22:34:41.485618 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:34:41.485776 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:34:41.485917 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:34:41.486041 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify authentication method


[0m22:34:41.488015 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.8733742, "process_user_time": 2.516503, "process_kernel_time": 0.445304, "process_mem_max_rss": "192020480", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:34:41.488464 [debug] [MainThread]: Command `dbt debug` failed at 22:34:41.488398 after 0.87 seconds
[0m22:34:41.488758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131d2750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125e19d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113189790>]}
[0m22:34:41.489003 [debug] [MainThread]: Flushing usage events
[0m22:35:04.631265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103579d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103feec60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fee9f0>]}


============================== 22:35:04.633915 | dd1d5f1e-2ad1-474b-b09f-be96743f84af ==============================
[0m22:35:04.633915 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:35:04.634274 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m22:35:04.640608 [info ] [MainThread]: dbt version: 1.8.5
[0m22:35:04.640991 [info ] [MainThread]: python version: 3.12.5
[0m22:35:04.641140 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:35:04.641272 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:35:05.431228 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:35:05.431528 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:35:05.431685 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:35:05.433877 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:35:05.434093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'dd1d5f1e-2ad1-474b-b09f-be96743f84af', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e774b30>]}
[0m22:35:05.475732 [info ] [MainThread]: Configuration:
[0m22:35:05.475999 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m22:35:05.476146 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:35:05.476276 [info ] [MainThread]: Required dependencies:
[0m22:35:05.476481 [debug] [MainThread]: Executing "git --help"
[0m22:35:05.484010 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:35:05.484639 [debug] [MainThread]: STDERR: "b''"
[0m22:35:05.484847 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:35:05.485092 [info ] [MainThread]: Connection test skipped since no profile was found
[0m22:35:05.485264 [info ] [MainThread]: [31m1 check failed:[0m
[0m22:35:05.485399 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify authentication method


[0m22:35:05.487770 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.8867208, "process_user_time": 2.439044, "process_kernel_time": 0.410353, "process_mem_max_rss": "192217088", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:35:05.488247 [debug] [MainThread]: Command `dbt debug` failed at 22:35:05.488181 after 0.89 seconds
[0m22:35:05.488604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d6789b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d655460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10295bb30>]}
[0m22:35:05.488909 [debug] [MainThread]: Flushing usage events
[0m22:38:38.148292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601e3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106466a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106466750>]}


============================== 22:38:38.151333 | a83f2a86-5b4e-4d96-a35c-e579d33d2c36 ==============================
[0m22:38:38.151333 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:38:38.151659 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:38:38.159464 [info ] [MainThread]: dbt version: 1.8.5
[0m22:38:38.159718 [info ] [MainThread]: python version: 3.12.5
[0m22:38:38.159859 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m22:38:38.159985 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m22:38:38.963708 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m22:38:38.963963 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m22:38:38.964112 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m22:38:38.964254 [info ] [MainThread]: adapter type: bigquery
[0m22:38:38.964375 [info ] [MainThread]: adapter version: 1.8.2
[0m22:38:38.966304 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m22:38:38.966483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a83f2a86-5b4e-4d96-a35c-e579d33d2c36', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fd44860>]}
[0m22:38:39.004554 [info ] [MainThread]: Configuration:
[0m22:38:39.004820 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m22:38:39.005099 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m22:38:39.005284 [info ] [MainThread]: Required dependencies:
[0m22:38:39.005527 [debug] [MainThread]: Executing "git --help"
[0m22:38:39.019712 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m22:38:39.020228 [debug] [MainThread]: STDERR: "b''"
[0m22:38:39.020409 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m22:38:39.020576 [info ] [MainThread]: Connection:
[0m22:38:39.020762 [info ] [MainThread]:   method: service-account
[0m22:38:39.020892 [info ] [MainThread]:   database: manual-pasfield
[0m22:38:39.021010 [info ] [MainThread]:   execution_project: manual-pasfield
[0m22:38:39.021125 [info ] [MainThread]:   schema: your_dataset_name
[0m22:38:39.021238 [info ] [MainThread]:   location: EU
[0m22:38:39.021355 [info ] [MainThread]:   priority: None
[0m22:38:39.021465 [info ] [MainThread]:   maximum_bytes_billed: None
[0m22:38:39.021579 [info ] [MainThread]:   impersonate_service_account: None
[0m22:38:39.021687 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m22:38:39.021804 [info ] [MainThread]:   job_retries: 1
[0m22:38:39.021915 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m22:38:39.022022 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m22:38:39.022128 [info ] [MainThread]:   timeout_seconds: None
[0m22:38:39.022234 [info ] [MainThread]:   client_id: None
[0m22:38:39.022339 [info ] [MainThread]:   token_uri: None
[0m22:38:39.022446 [info ] [MainThread]:   dataproc_region: None
[0m22:38:39.022554 [info ] [MainThread]:   dataproc_cluster_name: None
[0m22:38:39.022660 [info ] [MainThread]:   gcs_bucket: None
[0m22:38:39.022825 [info ] [MainThread]:   dataproc_batch: None
[0m22:38:39.023467 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:38:39.028438 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m22:38:39.029452 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:38:39.105431 [debug] [MainThread]: On debug: select 1 as id
[0m22:38:43.505253 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c9c1d11d-26ce-41bc-8afe-4a067674eb70&page=queryresults
[0m22:38:43.811621 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m22:38:43.812175 [info ] [MainThread]: [32mAll checks passed![0m
[0m22:38:43.816358 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.7008586, "process_user_time": 2.775645, "process_kernel_time": 0.288688, "process_mem_max_rss": "193691648", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:38:43.817137 [debug] [MainThread]: Command `dbt debug` succeeded at 22:38:43.817015 after 5.70 seconds
[0m22:38:43.817552 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m22:38:43.817929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105323110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13abfd520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ab697c0>]}
[0m22:38:43.818333 [debug] [MainThread]: Flushing usage events
[0m23:04:33.356540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1014530b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10439f140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10439ede0>]}


============================== 23:04:33.359549 | 967c9e2d-0f26-4d41-858b-6219fff789dc ==============================
[0m23:04:33.359549 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:04:33.359875 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select ref_activity', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:04:34.154672 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:04:34.154958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '967c9e2d-0f26-4d41-858b-6219fff789dc', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10807c920>]}
[0m23:04:34.210851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '967c9e2d-0f26-4d41-858b-6219fff789dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117e4a690>]}
[0m23:04:34.235316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '967c9e2d-0f26-4d41-858b-6219fff789dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1277a5970>]}
[0m23:04:34.235676 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:04:34.241108 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 2 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m23:04:34.244226 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.92032444, "process_user_time": 2.660289, "process_kernel_time": 0.258362, "process_mem_max_rss": "191447040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:04:34.245124 [debug] [MainThread]: Command `dbt run` failed at 23:04:34.245001 after 0.92 seconds
[0m23:04:34.245525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043579b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1341d3a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13441e810>]}
[0m23:04:34.245811 [debug] [MainThread]: Flushing usage events
[0m23:04:40.842907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff5490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106126d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106126b10>]}


============================== 23:04:40.844972 | 9537d0f4-237a-4766-9657-9006ea9f8dae ==============================
[0m23:04:40.844972 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:04:40.845284 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m23:04:40.848386 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:04:40.848588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9537d0f4-237a-4766-9657-9006ea9f8dae', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10566f770>]}
[0m23:04:40.915625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9537d0f4-237a-4766-9657-9006ea9f8dae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106126ea0>]}
[0m23:04:40.927281 [debug] [MainThread]: Set downloads directory='/var/folders/_5/58zpwrld087_7wj2dt63wf0c0000gp/T/dbt-downloads-p8l3lxr5'
[0m23:04:40.927544 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m23:04:41.039824 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m23:04:41.040502 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json
[0m23:04:41.109404 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json 200
[0m23:04:41.117993 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m23:04:41.172382 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m23:04:41.178277 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json
[0m23:04:41.229537 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json 200
[0m23:04:41.240771 [info ] [MainThread]: Updating lock file in file path: /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/package-lock.yml
[0m23:04:41.243112 [debug] [MainThread]: Set downloads directory='/var/folders/_5/58zpwrld087_7wj2dt63wf0c0000gp/T/dbt-downloads-zjlvmn6z'
[0m23:04:41.248409 [info ] [MainThread]: Installing calogica/dbt_expectations
[0m23:04:41.653847 [info ] [MainThread]: Installed from version 0.10.3
[0m23:04:41.654127 [info ] [MainThread]: Updated version available: 0.10.4
[0m23:04:41.654336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '9537d0f4-237a-4766-9657-9006ea9f8dae', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063121b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106311e50>]}
[0m23:04:41.654539 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m23:04:41.905396 [info ] [MainThread]: Installed from version 1.1.1
[0m23:04:41.905692 [info ] [MainThread]: Updated version available: 1.3.0
[0m23:04:41.905892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '9537d0f4-237a-4766-9657-9006ea9f8dae', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106152060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b01640>]}
[0m23:04:41.906091 [info ] [MainThread]: Installing calogica/dbt_date
[0m23:04:42.080185 [info ] [MainThread]: Installed from version 0.10.1
[0m23:04:42.080591 [info ] [MainThread]: Up to date!
[0m23:04:42.080885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '9537d0f4-237a-4766-9657-9006ea9f8dae', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a74da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b01640>]}
[0m23:04:42.081180 [info ] [MainThread]: 
[0m23:04:42.081423 [info ] [MainThread]: Updates available for packages: ['calogica/dbt_expectations', 'dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m23:04:42.083449 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.268005, "process_user_time": 0.79591, "process_kernel_time": 0.206207, "process_mem_max_rss": "106971136", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:04:42.083861 [debug] [MainThread]: Command `dbt deps` succeeded at 23:04:42.083789 after 1.27 seconds
[0m23:04:42.084110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff5490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106153500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106152060>]}
[0m23:04:42.084329 [debug] [MainThread]: Flushing usage events
[0m23:04:45.919918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d00260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bbae10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bbab10>]}


============================== 23:04:45.922485 | ce042524-7888-40cb-9017-5d348a0742e3 ==============================
[0m23:04:45.922485 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:04:45.922842 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select ref_activity', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:04:46.681421 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:04:46.681910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'ce042524-7888-40cb-9017-5d348a0742e3', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125f24ce0>]}
[0m23:04:46.757144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce042524-7888-40cb-9017-5d348a0742e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126521730>]}
[0m23:04:46.781129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce042524-7888-40cb-9017-5d348a0742e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a47cb0>]}
[0m23:04:46.781483 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:04:46.827522 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:04:46.828164 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:04:46.828376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ce042524-7888-40cb-9017-5d348a0742e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12733b4d0>]}
[0m23:04:47.544822 [error] [MainThread]: Encountered an error:
Compilation Error in model ref_activity (models/referential/ref_activity.sql)
  source() takes exactly two arguments (1 given)
[0m23:04:47.546040 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.6568582, "process_user_time": 3.410745, "process_kernel_time": 0.297014, "process_mem_max_rss": "198852608", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:04:47.546344 [debug] [MainThread]: Command `dbt run` failed at 23:04:47.546295 after 1.66 seconds
[0m23:04:47.546542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b739b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1273a5940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127723aa0>]}
[0m23:04:47.546703 [debug] [MainThread]: Flushing usage events
[0m23:05:34.927485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f9910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079eafc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079eac30>]}


============================== 23:05:34.930260 | 9b6b93f0-d288-48f1-8bca-47703fa3fcd2 ==============================
[0m23:05:34.930260 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:05:34.930632 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select ref_activity', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:05:35.700198 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:05:35.700484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a0b9b0>]}
[0m23:05:35.754723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1225e9730>]}
[0m23:05:35.779452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054017f0>]}
[0m23:05:35.779871 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:05:35.802341 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:05:35.803002 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m23:05:35.803215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1245cd190>]}
[0m23:05:36.669346 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:05:36.674680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b8c920>]}
[0m23:05:36.727203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b675f0>]}
[0m23:05:36.727486 [info ] [MainThread]: Found 1 model, 3 sources, 854 macros
[0m23:05:36.727659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127be80b0>]}
[0m23:05:36.728352 [info ] [MainThread]: 
[0m23:05:36.728645 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:05:36.729069 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:05:36.729250 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:05:37.107458 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now create_manual-pasfield_your_dataset_name)
[0m23:05:37.109097 [debug] [ThreadPool]: Creating schema "database: "manual-pasfield"
schema: "your_dataset_name"
"
[0m23:05:37.126767 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:05:37.218587 [debug] [ThreadPool]: On create_manual-pasfield_your_dataset_name: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "connection_name": "create_manual-pasfield_your_dataset_name"} */
create schema if not exists `manual-pasfield`.`your_dataset_name`
  
[0m23:05:37.699471 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8307b54d-6d7f-4c62-9008-7d780fa69a6a&page=queryresults
[0m23:05:39.392229 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_manual-pasfield_your_dataset_name, now list_manual-pasfield_your_dataset_name)
[0m23:05:39.393253 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:05:39.997545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279314f0>]}
[0m23:05:39.999352 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:05:39.999910 [info ] [MainThread]: 
[0m23:05:40.006204 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:05:40.007081 [info ] [Thread-1 (]: 1 of 1 START sql view model your_dataset_name.ref_activity ..................... [RUN]
[0m23:05:40.007767 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_activity)
[0m23:05:40.008265 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:05:40.020280 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:05:40.021684 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:05:40.043503 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:05:40.044179 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:40.122213 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual_pasfield`.`manual`.`activity`;


[0m23:05:40.400535 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f8965d98-b174-40fa-a75d-9b8b2feda5f2&page=queryresults
[0m23:05:40.402394 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest("Invalid project ID 'manual_pasfield'. Project IDs must contain 6-63 lowercase letters, digits, or dashes. Some project IDs also include domain name separated by a colon. IDs must start with a letter and may not end with a dash.; reason: invalid, location: manual_pasfield.manual.activity, message: Invalid project ID 'manual_pasfield'. Project IDs must contain 6-63 lowercase letters, digits, or dashes. Some project IDs also include domain name separated by a colon. IDs must start with a letter and may not end with a dash.")
[0m23:05:41.484503 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5306e6aa-2e28-45ab-8c0a-8f877fcfd6fd&page=queryresults
[0m23:05:41.485857 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5306e6aa-2e28-45ab-8c0a-8f877fcfd6fd&page=queryresults
[0m23:05:41.501158 [debug] [Thread-1 (]: Database Error in model ref_activity (models/referential/ref_activity.sql)
  Invalid project ID 'manual_pasfield'. Project IDs must contain 6-63 lowercase letters, digits, or dashes. Some project IDs also include domain name separated by a colon. IDs must start with a letter and may not end with a dash.
  compiled Code at target/run/manual_pasfield/models/referential/ref_activity.sql
[0m23:05:41.503620 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9b6b93f0-d288-48f1-8bca-47703fa3fcd2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b77440>]}
[0m23:05:41.504418 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model your_dataset_name.ref_activity ............ [[31mERROR[0m in 1.49s]
[0m23:05:41.505123 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:05:41.507047 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:05:41.507443 [debug] [MainThread]: Connection 'model.manual_pasfield.ref_activity' was properly closed.
[0m23:05:41.507783 [info ] [MainThread]: 
[0m23:05:41.508123 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m23:05:41.508818 [debug] [MainThread]: Command end result
[0m23:05:41.547000 [info ] [MainThread]: 
[0m23:05:41.547342 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:05:41.547547 [info ] [MainThread]: 
[0m23:05:41.547843 [error] [MainThread]:   Database Error in model ref_activity (models/referential/ref_activity.sql)
  Invalid project ID 'manual_pasfield'. Project IDs must contain 6-63 lowercase letters, digits, or dashes. Some project IDs also include domain name separated by a colon. IDs must start with a letter and may not end with a dash.
  compiled Code at target/run/manual_pasfield/models/referential/ref_activity.sql
[0m23:05:41.548121 [info ] [MainThread]: 
[0m23:05:41.548327 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m23:05:41.550529 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.6633973, "process_user_time": 4.137289, "process_kernel_time": 0.361222, "process_mem_max_rss": "208830464", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:05:41.550887 [debug] [MainThread]: Command `dbt run` failed at 23:05:41.550827 after 6.66 seconds
[0m23:05:41.551132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079eafc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a84d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12796cc80>]}
[0m23:05:41.551357 [debug] [MainThread]: Flushing usage events
[0m23:06:26.206348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089d65a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e6b080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e6ad20>]}


============================== 23:06:26.209042 | 3ef286f1-3ef6-4dff-8782-3a999c273762 ==============================
[0m23:06:26.209042 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:06:26.209353 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select ref_activity', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:06:27.059959 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:06:27.060250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f2b8380>]}
[0m23:06:27.114123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e442930>]}
[0m23:06:27.139448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e4419a0>]}
[0m23:06:27.139867 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:06:27.161780 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:06:27.273824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:06:27.274255 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/source/application.yml
[0m23:06:27.420147 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:06:27.425805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f2978f0>]}
[0m23:06:27.538477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11da7faa0>]}
[0m23:06:27.538779 [info ] [MainThread]: Found 1 model, 3 sources, 854 macros
[0m23:06:27.538954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107808620>]}
[0m23:06:27.539716 [info ] [MainThread]: 
[0m23:06:27.540002 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:06:27.540423 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:06:27.540569 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:06:27.864674 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:06:27.865568 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:06:28.424243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f282fc0>]}
[0m23:06:28.426087 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:06:28.426780 [info ] [MainThread]: 
[0m23:06:28.431949 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:06:28.436469 [info ] [Thread-1 (]: 1 of 1 START sql view model your_dataset_name.ref_activity ..................... [RUN]
[0m23:06:28.437256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_activity)
[0m23:06:28.437763 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:06:28.444176 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:06:28.444784 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:06:28.476118 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:06:28.476994 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:06:28.553388 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m23:06:29.491629 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:11978f1a-445a-4cef-8817-a5c769d33fc0&page=queryresults
[0m23:06:30.040086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3ef286f1-3ef6-4dff-8782-3a999c273762', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f2228a0>]}
[0m23:06:30.040913 [info ] [Thread-1 (]: 1 of 1 OK created sql view model your_dataset_name.ref_activity ................ [[32mCREATE VIEW (0 processed)[0m in 1.60s]
[0m23:06:30.041571 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:06:30.042722 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:06:30.043029 [debug] [MainThread]: Connection 'model.manual_pasfield.ref_activity' was properly closed.
[0m23:06:30.043300 [info ] [MainThread]: 
[0m23:06:30.043582 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.50 seconds (2.50s).
[0m23:06:30.044172 [debug] [MainThread]: Command end result
[0m23:06:30.086024 [info ] [MainThread]: 
[0m23:06:30.086407 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:06:30.086630 [info ] [MainThread]: 
[0m23:06:30.086841 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m23:06:30.089928 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.9185367, "process_user_time": 3.159056, "process_kernel_time": 0.33763, "process_mem_max_rss": "209747968", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:06:30.090378 [debug] [MainThread]: Command `dbt run` succeeded at 23:06:30.090312 after 3.92 seconds
[0m23:06:30.090623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e175310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c035f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f05a450>]}
[0m23:06:30.090846 [debug] [MainThread]: Flushing usage events
[0m23:07:16.127960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058daa20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059271d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105926f60>]}


============================== 23:07:16.131001 | 034b10a9-d53f-4f75-85b3-f4069a4c276d ==============================
[0m23:07:16.131001 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:07:16.131329 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:07:16.907243 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:07:16.907528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ffbf020>]}
[0m23:07:16.962217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b41bbc0>]}
[0m23:07:16.986611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9ffda0>]}
[0m23:07:16.986978 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:07:17.009979 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:07:17.089158 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m23:07:17.089470 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/referential/ref_customers.sql
[0m23:07:17.089637 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/referential/ref_acq_orders.sql
[0m23:07:17.188099 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:07:17.194093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036d9130>]}
[0m23:07:17.243616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b75d1f0>]}
[0m23:07:17.243895 [info ] [MainThread]: Found 3 models, 3 sources, 854 macros
[0m23:07:17.244061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b81c2f0>]}
[0m23:07:17.244922 [info ] [MainThread]: 
[0m23:07:17.245213 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:07:17.247042 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:07:17.247276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:07:17.617694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:07:17.618986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:07:17.991080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baed6d0>]}
[0m23:07:17.993097 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:07:17.993681 [info ] [MainThread]: 
[0m23:07:17.999145 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:07:18.000389 [info ] [Thread-1 (]: 1 of 3 START sql view model your_dataset_name.ref_acq_orders ................... [RUN]
[0m23:07:18.001267 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_acq_orders)
[0m23:07:18.001795 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:07:18.010205 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:07:18.010831 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:07:18.034721 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:07:18.035554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:07:18.114397 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:07:18.673276 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c2cd7fad-0c4b-4117-86e0-5fb89c0e0c52&page=queryresults
[0m23:07:18.981835 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a41f260>]}
[0m23:07:18.982744 [info ] [Thread-1 (]: 1 of 3 OK created sql view model your_dataset_name.ref_acq_orders .............. [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m23:07:18.983383 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:07:18.983798 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:07:18.984342 [info ] [Thread-1 (]: 2 of 3 START sql view model your_dataset_name.ref_activity ..................... [RUN]
[0m23:07:18.984842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:07:18.985207 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:07:18.989121 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:07:18.990050 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:07:18.993209 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:07:18.993745 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:07:19.073173 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m23:07:19.619805 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:49d6badf-bf95-4300-afc3-2917b753a89a&page=queryresults
[0m23:07:19.952750 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb2bbc0>]}
[0m23:07:19.953816 [info ] [Thread-1 (]: 2 of 3 OK created sql view model your_dataset_name.ref_activity ................ [[32mCREATE VIEW (0 processed)[0m in 0.97s]
[0m23:07:19.954634 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:07:19.955199 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:07:19.955925 [info ] [Thread-1 (]: 3 of 3 START sql view model your_dataset_name.ref_customers .................... [RUN]
[0m23:07:19.956616 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:07:19.957151 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:07:19.965554 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:07:19.966602 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:07:20.023944 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:07:20.024560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:07:20.091724 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:07:20.759794 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e9d68832-6dd1-4a92-936e-2bc50bbebffb&page=queryresults
[0m23:07:21.004364 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '034b10a9-d53f-4f75-85b3-f4069a4c276d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb9d700>]}
[0m23:07:21.006054 [info ] [Thread-1 (]: 3 of 3 OK created sql view model your_dataset_name.ref_customers ............... [[32mCREATE VIEW (0 processed)[0m in 1.05s]
[0m23:07:21.007142 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:07:21.008877 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:07:21.009382 [debug] [MainThread]: Connection 'model.manual_pasfield.ref_customers' was properly closed.
[0m23:07:21.009908 [info ] [MainThread]: 
[0m23:07:21.010358 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.76 seconds (3.76s).
[0m23:07:21.012107 [debug] [MainThread]: Command end result
[0m23:07:21.051634 [info ] [MainThread]: 
[0m23:07:21.052055 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:07:21.052359 [info ] [MainThread]: 
[0m23:07:21.052614 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m23:07:21.055142 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.964118, "process_user_time": 3.57642, "process_kernel_time": 0.354701, "process_mem_max_rss": "207437824", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:07:21.055576 [debug] [MainThread]: Command `dbt run` succeeded at 23:07:21.055502 after 4.96 seconds
[0m23:07:21.055877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baaa4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105924080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105924aa0>]}
[0m23:07:21.056150 [debug] [MainThread]: Flushing usage events
[0m23:23:41.450738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104516f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104adb1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104adaf00>]}


============================== 23:23:41.453409 | 11e95477-33e5-406e-a81d-80ab977c09ac ==============================
[0m23:23:41.453409 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:23:41.453724 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select +prep_customer', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:23:42.257333 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:23:42.257618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124410bc0>]}
[0m23:23:42.312303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ee67e0>]}
[0m23:23:42.336810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b7c140>]}
[0m23:23:42.337144 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:23:42.360447 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:23:42.441608 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m23:23:42.441936 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:23:42.539497 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:23:42.545493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279f3050>]}
[0m23:23:42.595692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12755d070>]}
[0m23:23:42.595979 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:23:42.596150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039196d0>]}
[0m23:23:42.597118 [info ] [MainThread]: 
[0m23:23:42.597409 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:23:42.599222 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:23:42.599424 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:23:42.978936 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:23:42.980150 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:23:43.405628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033e5be0>]}
[0m23:23:43.406723 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:23:43.407237 [info ] [MainThread]: 
[0m23:23:43.411335 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:23:43.412245 [info ] [Thread-1 (]: 1 of 3 START sql view model your_dataset_name.ref_acq_orders ................... [RUN]
[0m23:23:43.412981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_acq_orders)
[0m23:23:43.413795 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:23:43.425561 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:23:43.427074 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:23:43.456431 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:23:43.457510 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:23:43.532589 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:23:44.155299 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:73da9e13-cb7d-41a2-a2f9-99b621ed182a&page=queryresults
[0m23:23:44.446628 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124122de0>]}
[0m23:23:44.447440 [info ] [Thread-1 (]: 1 of 3 OK created sql view model your_dataset_name.ref_acq_orders .............. [[32mCREATE VIEW (0 processed)[0m in 1.03s]
[0m23:23:44.448054 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:23:44.448471 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:23:44.449002 [info ] [Thread-1 (]: 2 of 3 START sql view model your_dataset_name.ref_customers .................... [RUN]
[0m23:23:44.449488 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_customers)
[0m23:23:44.449838 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:23:44.453290 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:23:44.454510 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:23:44.457576 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:23:44.458130 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:23:44.538212 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:23:45.056377 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b81b71f2-3db0-4da4-8623-518ac01c2919&page=queryresults
[0m23:23:45.372223 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10406a510>]}
[0m23:23:45.372978 [info ] [Thread-1 (]: 2 of 3 OK created sql view model your_dataset_name.ref_customers ............... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m23:23:45.373650 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:23:45.374361 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:23:45.375031 [info ] [Thread-1 (]: 3 of 3 START sql view model your_dataset_name.prep_customer .................... [RUN]
[0m23:23:45.375652 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:23:45.376060 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:23:45.383160 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:23:45.384228 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:23:45.435559 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:23:45.436187 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:23:45.502823 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`your_dataset_name`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    *
from customers c 
left join ref_acq_orders rao on rao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:23:45.771477 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7fdde6a8-2b6d-4e07-ad6f-1539e12f5f40&page=queryresults
[0m23:23:45.773299 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Table "ref_acq_orders" must be qualified with a dataset (e.g. dataset.table).; reason: invalid, location: ref_acq_orders, message: Table "ref_acq_orders" must be qualified with a dataset (e.g. dataset.table).')
[0m23:23:46.630562 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:72c0409d-4d6a-4c05-b0d1-7c64030bab8a&page=queryresults
[0m23:23:46.632799 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:72c0409d-4d6a-4c05-b0d1-7c64030bab8a&page=queryresults
[0m23:23:46.648916 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Table "ref_acq_orders" must be qualified with a dataset (e.g. dataset.table).
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:23:46.649738 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '11e95477-33e5-406e-a81d-80ab977c09ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12785d5e0>]}
[0m23:23:46.650487 [error] [Thread-1 (]: 3 of 3 ERROR creating sql view model your_dataset_name.prep_customer ........... [[31mERROR[0m in 1.27s]
[0m23:23:46.651143 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:23:46.652776 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:23:46.653250 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:23:46.653824 [info ] [MainThread]: 
[0m23:23:46.654247 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 4.06 seconds (4.06s).
[0m23:23:46.655280 [debug] [MainThread]: Command end result
[0m23:23:46.693744 [info ] [MainThread]: 
[0m23:23:46.694083 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:23:46.694282 [info ] [MainThread]: 
[0m23:23:46.694525 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Table "ref_acq_orders" must be qualified with a dataset (e.g. dataset.table).
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:23:46.694716 [info ] [MainThread]: 
[0m23:23:46.694905 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m23:23:46.697141 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.2785025, "process_user_time": 3.547298, "process_kernel_time": 0.382437, "process_mem_max_rss": "208814080", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:23:46.697508 [debug] [MainThread]: Command `dbt run` failed at 23:23:46.697447 after 5.28 seconds
[0m23:23:46.697769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104516f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279760c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127976810>]}
[0m23:23:46.697987 [debug] [MainThread]: Flushing usage events
[0m23:24:13.936047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084e1430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10879b020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10879ad50>]}


============================== 23:24:13.938689 | 3127a9f2-0b39-4025-87bc-2149f3f2e706 ==============================
[0m23:24:13.938689 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:24:13.939014 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +prep_customer', 'send_anonymous_usage_stats': 'True'}
[0m23:24:14.693904 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:24:14.694189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108776a50>]}
[0m23:24:14.740341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147341730>]}
[0m23:24:14.764756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115094e30>]}
[0m23:24:14.765119 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:24:14.787101 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:24:14.874818 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:24:14.875178 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:24:14.974433 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:24:14.980432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479f2f60>]}
[0m23:24:15.029251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147651bb0>]}
[0m23:24:15.029559 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:24:15.029731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479f3950>]}
[0m23:24:15.030738 [info ] [MainThread]: 
[0m23:24:15.031036 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:24:15.032817 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:24:15.033031 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:24:15.395243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:24:15.396559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:24:15.751985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10743f380>]}
[0m23:24:15.753109 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:24:15.753543 [info ] [MainThread]: 
[0m23:24:15.758065 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:24:15.759014 [info ] [Thread-1 (]: 1 of 3 START sql view model your_dataset_name.ref_acq_orders ................... [RUN]
[0m23:24:15.760160 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_acq_orders)
[0m23:24:15.760769 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:24:15.770035 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:24:15.770818 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:24:15.802804 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:24:15.803885 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:24:15.883204 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:24:16.472682 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:08725c6a-a20f-4d51-a360-2287d716ef9e&page=queryresults
[0m23:24:16.738568 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14621e510>]}
[0m23:24:16.739407 [info ] [Thread-1 (]: 1 of 3 OK created sql view model your_dataset_name.ref_acq_orders .............. [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m23:24:16.740031 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:24:16.740451 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:24:16.741008 [info ] [Thread-1 (]: 2 of 3 START sql view model your_dataset_name.ref_customers .................... [RUN]
[0m23:24:16.741514 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_customers)
[0m23:24:16.741885 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:24:16.745720 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:24:16.746555 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:24:16.749900 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:24:16.750675 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:24:16.825812 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:24:17.390532 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a70a2d63-8ad6-4ab5-9525-2951f96ed6c0&page=queryresults
[0m23:24:17.624330 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147a999d0>]}
[0m23:24:17.625987 [info ] [Thread-1 (]: 2 of 3 OK created sql view model your_dataset_name.ref_customers ............... [[32mCREATE VIEW (0 processed)[0m in 0.88s]
[0m23:24:17.627175 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:24:17.628403 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:24:17.629140 [info ] [Thread-1 (]: 3 of 3 START sql view model your_dataset_name.prep_customer .................... [RUN]
[0m23:24:17.629821 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:24:17.630325 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:24:17.639815 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:24:17.640909 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:24:17.702394 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:24:17.702989 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:24:17.770081 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`your_dataset_name`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    *
from customers c 
left join acq_orders ao on rao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:24:18.437422 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ba060bd8-63db-4093-8d34-9b9728efd572&page=queryresults
[0m23:24:18.542753 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: rao; Did you mean ao? at [25:28]; reason: invalidQuery, location: query, message: Unrecognized name: rao; Did you mean ao? at [25:28]')
[0m23:24:19.850558 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ed345c0b-7cb9-4a12-af87-b2afa3e24349&page=queryresults
[0m23:24:19.951692 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ed345c0b-7cb9-4a12-af87-b2afa3e24349&page=queryresults
[0m23:24:19.964507 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: rao; Did you mean ao? at [25:28]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:24:19.964851 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3127a9f2-0b39-4025-87bc-2149f3f2e706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147859be0>]}
[0m23:24:19.965169 [error] [Thread-1 (]: 3 of 3 ERROR creating sql view model your_dataset_name.prep_customer ........... [[31mERROR[0m in 2.34s]
[0m23:24:19.965456 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:24:19.966797 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:24:19.967203 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:24:19.967606 [info ] [MainThread]: 
[0m23:24:19.967983 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 4.94 seconds (4.94s).
[0m23:24:19.968974 [debug] [MainThread]: Command end result
[0m23:24:20.006416 [info ] [MainThread]: 
[0m23:24:20.006756 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:24:20.006957 [info ] [MainThread]: 
[0m23:24:20.007200 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: rao; Did you mean ao? at [25:28]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:24:20.007392 [info ] [MainThread]: 
[0m23:24:20.007581 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m23:24:20.009646 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.103729, "process_user_time": 3.588951, "process_kernel_time": 0.363008, "process_mem_max_rss": "206618624", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:24:20.010058 [debug] [MainThread]: Command `dbt run` failed at 23:24:20.009987 after 6.10 seconds
[0m23:24:20.010312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080d4c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082b35f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147313dd0>]}
[0m23:24:20.010535 [debug] [MainThread]: Flushing usage events
[0m23:24:26.853258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107de1700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080931a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108092e10>]}


============================== 23:24:26.855860 | 391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d ==============================
[0m23:24:26.855860 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:24:26.856171 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +prep_customer', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:24:27.365520 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:24:27.365804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eebde20>]}
[0m23:24:27.412564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080bd100>]}
[0m23:24:27.436530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10699da90>]}
[0m23:24:27.436883 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:24:27.458934 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:24:27.533214 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:24:27.533574 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:24:27.630167 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:24:27.636290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1206e9310>]}
[0m23:24:27.686175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1203db740>]}
[0m23:24:27.686490 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:24:27.686662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201e8b60>]}
[0m23:24:27.687691 [info ] [MainThread]: 
[0m23:24:27.687998 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:24:27.689816 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:24:27.690046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:24:28.040497 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:24:28.041037 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:24:28.414883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10699ddc0>]}
[0m23:24:28.416316 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:24:28.416795 [info ] [MainThread]: 
[0m23:24:28.422164 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:24:28.423342 [info ] [Thread-1 (]: 1 of 3 START sql view model your_dataset_name.ref_acq_orders ................... [RUN]
[0m23:24:28.424208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_acq_orders)
[0m23:24:28.424760 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:24:28.433662 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:24:28.434351 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:24:28.462121 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:24:28.462828 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:24:28.540013 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:24:29.165868 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:14814454-2e70-4c09-837e-19647570382c&page=queryresults
[0m23:24:29.417229 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fb0e8a0>]}
[0m23:24:29.418173 [info ] [Thread-1 (]: 1 of 3 OK created sql view model your_dataset_name.ref_acq_orders .............. [[32mCREATE VIEW (0 processed)[0m in 0.99s]
[0m23:24:29.418838 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:24:29.419271 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:24:29.419839 [info ] [Thread-1 (]: 2 of 3 START sql view model your_dataset_name.ref_customers .................... [RUN]
[0m23:24:29.420353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_customers)
[0m23:24:29.420735 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:24:29.424225 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:24:29.426715 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:24:29.429543 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:24:29.430043 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:24:29.507573 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:24:30.545030 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d5cb3a4b-146d-441d-b785-241b6af5bb6b&page=queryresults
[0m23:24:31.043881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120730bc0>]}
[0m23:24:31.045538 [info ] [Thread-1 (]: 2 of 3 OK created sql view model your_dataset_name.ref_customers ............... [[32mCREATE VIEW (0 processed)[0m in 1.62s]
[0m23:24:31.047005 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:24:31.047985 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:24:31.048836 [info ] [Thread-1 (]: 3 of 3 START sql view model your_dataset_name.prep_customer .................... [RUN]
[0m23:24:31.049589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:24:31.050216 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:24:31.058993 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:24:31.059886 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:24:31.121711 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:24:31.122250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:24:31.189718 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`your_dataset_name`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    *
from customers c 
left join acq_orders ao on ao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:24:32.386173 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0804104e-9644-4a8c-9cf3-531f413fa4b1&page=queryresults
[0m23:24:32.493970 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('CREATE VIEW has columns with duplicate name customer_id at [7:1]; reason: invalidQuery, location: query, message: CREATE VIEW has columns with duplicate name customer_id at [7:1]')
[0m23:24:33.878251 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7ca12860-b7cb-4925-b812-04a32a0f79d6&page=queryresults
[0m23:24:33.971883 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7ca12860-b7cb-4925-b812-04a32a0f79d6&page=queryresults
[0m23:24:33.983092 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  CREATE VIEW has columns with duplicate name customer_id at [7:1]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:24:33.983557 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '391d3626-0213-4ae6-bb2e-cb6ef9a7ad0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1206ec830>]}
[0m23:24:33.983923 [error] [Thread-1 (]: 3 of 3 ERROR creating sql view model your_dataset_name.prep_customer ........... [[31mERROR[0m in 2.93s]
[0m23:24:33.984252 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:24:33.985126 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:24:33.985285 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:24:33.985481 [info ] [MainThread]: 
[0m23:24:33.985644 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 6.30 seconds (6.30s).
[0m23:24:33.986136 [debug] [MainThread]: Command end result
[0m23:24:34.015662 [info ] [MainThread]: 
[0m23:24:34.015971 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:24:34.016142 [info ] [MainThread]: 
[0m23:24:34.016351 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  CREATE VIEW has columns with duplicate name customer_id at [7:1]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:24:34.016513 [info ] [MainThread]: 
[0m23:24:34.016672 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m23:24:34.018494 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.1950626, "process_user_time": 3.525477, "process_kernel_time": 0.266794, "process_mem_max_rss": "207765504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:24:34.018827 [debug] [MainThread]: Command `dbt run` failed at 23:24:34.018775 after 7.20 seconds
[0m23:24:34.019039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bb3680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120668d40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12066b9e0>]}
[0m23:24:34.019238 [debug] [MainThread]: Flushing usage events
[0m23:25:33.621363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107354170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10820b110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10820ad80>]}


============================== 23:25:33.624114 | c5ae59ee-9918-4f87-a5bd-84b36bc0c076 ==============================
[0m23:25:33.624114 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:25:33.624466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +prep_customer', 'send_anonymous_usage_stats': 'True'}
[0m23:25:34.423190 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:25:34.423471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c8d7b90>]}
[0m23:25:34.478439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107121580>]}
[0m23:25:34.503141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b15af0>]}
[0m23:25:34.503544 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:25:34.526443 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:25:34.608712 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:25:34.609079 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:25:34.706692 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:25:34.712860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cafc800>]}
[0m23:25:34.762736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cc526c0>]}
[0m23:25:34.763027 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:25:34.763198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cec97f0>]}
[0m23:25:34.764169 [info ] [MainThread]: 
[0m23:25:34.764452 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:25:34.766264 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:25:34.766481 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:25:35.120919 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:25:35.121981 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:25:35.481611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b15dc0>]}
[0m23:25:35.482978 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:25:35.483858 [info ] [MainThread]: 
[0m23:25:35.488915 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:25:35.489743 [info ] [Thread-1 (]: 1 of 3 START sql view model your_dataset_name.ref_acq_orders ................... [RUN]
[0m23:25:35.490564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_acq_orders)
[0m23:25:35.491540 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:25:35.500136 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:25:35.501528 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:25:35.531453 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:25:35.532191 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:25:35.607640 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:25:36.178341 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:192a7149-4ce4-4392-a987-283118bf7060&page=queryresults
[0m23:25:36.521720 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128a22c30>]}
[0m23:25:36.522654 [info ] [Thread-1 (]: 1 of 3 OK created sql view model your_dataset_name.ref_acq_orders .............. [[32mCREATE VIEW (0 processed)[0m in 1.03s]
[0m23:25:36.523368 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:25:36.523798 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:25:36.524322 [info ] [Thread-1 (]: 2 of 3 START sql view model your_dataset_name.ref_customers .................... [RUN]
[0m23:25:36.524790 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_customers)
[0m23:25:36.525135 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:25:36.528529 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:25:36.529347 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:25:36.533237 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:25:36.534067 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:25:36.612286 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:25:37.125993 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:10bbefae-af3f-4acc-9734-463865c89645&page=queryresults
[0m23:25:37.427533 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d09d9a0>]}
[0m23:25:37.429154 [info ] [Thread-1 (]: 2 of 3 OK created sql view model your_dataset_name.ref_customers ............... [[32mCREATE VIEW (0 processed)[0m in 0.90s]
[0m23:25:37.430431 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:25:37.431375 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:25:37.432236 [info ] [Thread-1 (]: 3 of 3 START sql view model your_dataset_name.prep_customer .................... [RUN]
[0m23:25:37.432975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:25:37.433456 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:25:37.442537 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:25:37.443555 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:25:37.505356 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:25:37.505913 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:25:37.572816 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`your_dataset_name`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    c.*,
    acq.taxonomy_business_category_group
from customers c 
left join acq_orders ao on ao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:25:38.391477 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:573e090f-276d-4257-9fc7-c72ba0e53a6d&page=queryresults
[0m23:25:38.499745 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: acq at [24:5]; reason: invalidQuery, location: query, message: Unrecognized name: acq at [24:5]')
[0m23:25:39.928645 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cebeebcd-512d-4b7e-bae6-3fbeb746ee27&page=queryresults
[0m23:25:40.030375 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cebeebcd-512d-4b7e-bae6-3fbeb746ee27&page=queryresults
[0m23:25:40.046612 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: acq at [24:5]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:25:40.047363 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5ae59ee-9918-4f87-a5bd-84b36bc0c076', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ce638f0>]}
[0m23:25:40.048213 [error] [Thread-1 (]: 3 of 3 ERROR creating sql view model your_dataset_name.prep_customer ........... [[31mERROR[0m in 2.61s]
[0m23:25:40.048974 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:25:40.050545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:25:40.050855 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:25:40.051211 [info ] [MainThread]: 
[0m23:25:40.051541 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 5.29 seconds (5.29s).
[0m23:25:40.052491 [debug] [MainThread]: Command end result
[0m23:25:40.091646 [info ] [MainThread]: 
[0m23:25:40.091981 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:25:40.092188 [info ] [MainThread]: 
[0m23:25:40.092431 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: acq at [24:5]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:25:40.092619 [info ] [MainThread]: 
[0m23:25:40.092808 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m23:25:40.094830 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.5056887, "process_user_time": 3.59089, "process_kernel_time": 0.349964, "process_mem_max_rss": "207519744", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:25:40.095228 [debug] [MainThread]: Command `dbt run` failed at 23:25:40.095163 after 6.51 seconds
[0m23:25:40.095483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bb3ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cf7eff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cf7f560>]}
[0m23:25:40.095709 [debug] [MainThread]: Flushing usage events
[0m23:25:52.432581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030670b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fb2fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fb2cf0>]}


============================== 23:25:52.435078 | dc0a6723-eb43-47de-87d3-523035db3afe ==============================
[0m23:25:52.435078 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:25:52.435387 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select +prep_customer', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:25:53.160802 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:25:53.161094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a1b9af0>]}
[0m23:25:53.212179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cc0170>]}
[0m23:25:53.236358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a7312e0>]}
[0m23:25:53.236699 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:25:53.259257 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:25:53.334141 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:25:53.334497 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:25:53.429582 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual-pasfield
[0m23:25:53.439032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12affd2b0>]}
[0m23:25:53.489482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab618b0>]}
[0m23:25:53.489766 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:25:53.489935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c18650>]}
[0m23:25:53.490870 [info ] [MainThread]: 
[0m23:25:53.491151 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:25:53.492963 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:25:53.493164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:25:53.855386 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_your_dataset_name)
[0m23:25:53.856569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:25:54.182358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ae831d0>]}
[0m23:25:54.183670 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:25:54.184149 [info ] [MainThread]: 
[0m23:25:54.188981 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:25:54.189930 [info ] [Thread-1 (]: 1 of 3 START sql view model your_dataset_name.ref_acq_orders ................... [RUN]
[0m23:25:54.190630 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_dataset_name, now model.manual_pasfield.ref_acq_orders)
[0m23:25:54.191560 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:25:54.200790 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:25:54.201434 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:25:54.228950 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:25:54.229652 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:25:54.305867 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:25:54.894581 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:866ccfdd-af5c-4abb-bc5f-1f44f7f6e6bb&page=queryresults
[0m23:25:55.229519 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a01ecf0>]}
[0m23:25:55.230413 [info ] [Thread-1 (]: 1 of 3 OK created sql view model your_dataset_name.ref_acq_orders .............. [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m23:25:55.231038 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:25:55.231472 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:25:55.232023 [info ] [Thread-1 (]: 2 of 3 START sql view model your_dataset_name.ref_customers .................... [RUN]
[0m23:25:55.232531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_customers)
[0m23:25:55.232899 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:25:55.236356 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:25:55.237232 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:25:55.241063 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:25:55.241864 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:25:55.318566 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:25:55.814000 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5b5c59ac-2b89-4172-9782-450ce900208d&page=queryresults
[0m23:25:56.127185 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b09db80>]}
[0m23:25:56.128492 [info ] [Thread-1 (]: 2 of 3 OK created sql view model your_dataset_name.ref_customers ............... [[32mCREATE VIEW (0 processed)[0m in 0.89s]
[0m23:25:56.129779 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:25:56.130810 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:25:56.131677 [info ] [Thread-1 (]: 3 of 3 START sql view model your_dataset_name.prep_customer .................... [RUN]
[0m23:25:56.132467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:25:56.132937 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:25:56.142340 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:25:56.144159 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:25:56.204966 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:25:56.205540 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:25:56.272472 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`your_dataset_name`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`your_dataset_name`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`your_dataset_name`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    c.*,
    ao.taxonomy_business_category_group
from customers c 
left join acq_orders ao on ao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:25:57.045930 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7f69c9b4-79b1-4fc8-8395-30f71bd268f0&page=queryresults
[0m23:25:57.382629 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc0a6723-eb43-47de-87d3-523035db3afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ae5b9b0>]}
[0m23:25:57.384046 [info ] [Thread-1 (]: 3 of 3 OK created sql view model your_dataset_name.prep_customer ............... [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m23:25:57.385226 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:25:57.387348 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:25:57.387798 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:25:57.388299 [info ] [MainThread]: 
[0m23:25:57.388741 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.90 seconds (3.90s).
[0m23:25:57.390507 [debug] [MainThread]: Command end result
[0m23:25:57.431827 [info ] [MainThread]: 
[0m23:25:57.432204 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:25:57.432442 [info ] [MainThread]: 
[0m23:25:57.432672 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m23:25:57.435038 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.0316124, "process_user_time": 3.652397, "process_kernel_time": 0.305671, "process_mem_max_rss": "207306752", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:25:57.435463 [debug] [MainThread]: Command `dbt run` succeeded at 23:25:57.435395 after 5.03 seconds
[0m23:25:57.435727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a5af8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a108c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a8780e0>]}
[0m23:25:57.435978 [debug] [MainThread]: Flushing usage events
[0m23:29:53.740221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c670b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bbafc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bbac30>]}


============================== 23:29:53.742903 | cbd6f7d1-7246-474d-ace7-0231f6b6c7b1 ==============================
[0m23:29:53.742903 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:29:53.743224 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m23:29:54.528553 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify schema
[0m23:29:54.530425 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.82292867, "process_user_time": 2.568931, "process_kernel_time": 0.335335, "process_mem_max_rss": "188923904", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:29:54.530724 [debug] [MainThread]: Command `dbt run` failed at 23:29:54.530674 after 0.82 seconds
[0m23:29:54.530902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10694a510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1367fa3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1370d3200>]}
[0m23:29:54.531081 [debug] [MainThread]: Flushing usage events
[0m23:32:58.902958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104239850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104caf0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104caed50>]}


============================== 23:32:58.905630 | de0d190a-763c-4055-9a7c-693823a51a74 ==============================
[0m23:32:58.905630 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:32:58.905969 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m23:32:59.726238 [error] [MainThread]: Encountered an error:
Runtime Error
  Credentials in profile "manual-test-platform", target "dev" invalid: Runtime Error
    Must specify schema
[0m23:32:59.728175 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8557814, "process_user_time": 2.615539, "process_kernel_time": 0.267823, "process_mem_max_rss": "188432384", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:32:59.728465 [debug] [MainThread]: Command `dbt run` failed at 23:32:59.728416 after 0.86 seconds
[0m23:32:59.728645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115ad2f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089847a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1157b41d0>]}
[0m23:32:59.728813 [debug] [MainThread]: Flushing usage events
[0m23:34:26.676097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c7bb60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c96ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c96b70>]}


============================== 23:34:26.678669 | d97d29b8-1f2f-4004-93fe-7a99390cceb9 ==============================
[0m23:34:26.678669 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:34:26.678984 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m23:34:27.506833 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `source-paths` config has been renamed to `model-paths`. Please update your
`dbt_project.yml` configuration to reflect this change.
[0m23:34:27.507123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fdc1a0>]}
[0m23:34:27.560921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d575730>]}
[0m23:34:27.585655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb9ed20>]}
[0m23:34:27.586186 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:34:27.608368 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:34:27.649899 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m23:34:27.650170 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m23:34:27.650344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d51f410>]}
[0m23:34:28.517178 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
[0m23:34:28.522722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c53ec0>]}
[0m23:34:28.582502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cceba0>]}
[0m23:34:28.582841 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:34:28.583102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d839520>]}
[0m23:34:28.584180 [info ] [MainThread]: 
[0m23:34:28.584714 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:34:28.587182 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:34:28.587478 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:34:28.959760 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now create_manual-pasfield_your_schema_name)
[0m23:34:28.960335 [debug] [ThreadPool]: Creating schema "database: "manual-pasfield"
schema: "your_schema_name"
"
[0m23:34:28.970138 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:34:29.053787 [debug] [ThreadPool]: On create_manual-pasfield_your_schema_name: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "connection_name": "create_manual-pasfield_your_schema_name"} */
create schema if not exists `manual-pasfield`.`your_schema_name`
  
[0m23:34:29.640849 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7edc1da5-c19f-4beb-8dcf-ed6399ef267d&page=queryresults
[0m23:34:31.283125 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_manual-pasfield_your_schema_name, now list_manual-pasfield_your_schema_name)
[0m23:34:31.283704 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:34:31.827626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d9e6a20>]}
[0m23:34:31.829482 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:34:31.830107 [info ] [MainThread]: 
[0m23:34:31.835509 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:34:31.836474 [info ] [Thread-1 (]: 1 of 4 START sql view model your_schema_name.ref_acq_orders .................... [RUN]
[0m23:34:31.837423 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_your_schema_name, now model.manual_pasfield.ref_acq_orders)
[0m23:34:31.838134 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:34:31.849695 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:34:31.851841 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:34:31.882618 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:34:31.883431 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:31.957823 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`your_schema_name`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:34:33.021472 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9b6e2c03-d42e-45e7-9c9c-1066eefb1bf5&page=queryresults
[0m23:34:33.647055 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb9e270>]}
[0m23:34:33.647999 [info ] [Thread-1 (]: 1 of 4 OK created sql view model your_schema_name.ref_acq_orders ............... [[32mCREATE VIEW (0 processed)[0m in 1.81s]
[0m23:34:33.648725 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:34:33.649215 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:34:33.649862 [info ] [Thread-1 (]: 2 of 4 START sql view model your_schema_name.ref_activity ...................... [RUN]
[0m23:34:33.650455 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:34:33.650897 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:34:33.655653 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:34:33.656623 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:34:33.662103 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:34:33.662951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:33.744674 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`your_schema_name`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m23:34:34.455901 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7e59cf18-502c-4452-9a3c-c8a4b59f1fa7&page=queryresults
[0m23:34:34.869609 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e4ab10>]}
[0m23:34:34.870994 [info ] [Thread-1 (]: 2 of 4 OK created sql view model your_schema_name.ref_activity ................. [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m23:34:34.872270 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:34:34.872954 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:34:34.873751 [info ] [Thread-1 (]: 3 of 4 START sql view model your_schema_name.ref_customers ..................... [RUN]
[0m23:34:34.874504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:34:34.875031 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:34:34.880615 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:34:34.881889 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:34:34.885976 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:34:34.886761 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:34.978162 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`your_schema_name`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:34:35.785554 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a77ceb40-2b44-4373-9548-fe6c10bd13dc&page=queryresults
[0m23:34:36.298568 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e488c0>]}
[0m23:34:36.299342 [info ] [Thread-1 (]: 3 of 4 OK created sql view model your_schema_name.ref_customers ................ [[32mCREATE VIEW (0 processed)[0m in 1.42s]
[0m23:34:36.300012 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:34:36.300759 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:34:36.301465 [info ] [Thread-1 (]: 4 of 4 START sql view model your_schema_name.prep_customer ..................... [RUN]
[0m23:34:36.302042 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:34:36.302544 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:34:36.307093 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:34:36.308438 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:34:36.312320 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:34:36.313144 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:36.396809 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "dev", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`your_schema_name`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`your_schema_name`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`your_schema_name`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    c.*,
    ao.taxonomy_business_category_group
from customers c 
left join acq_orders ao on ao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:34:37.627739 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a9f78975-1e71-44f3-b54e-35831082cd99&page=queryresults
[0m23:34:38.036690 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd97d29b8-1f2f-4004-93fe-7a99390cceb9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120eda090>]}
[0m23:34:38.037277 [info ] [Thread-1 (]: 4 of 4 OK created sql view model your_schema_name.prep_customer ................ [[32mCREATE VIEW (0 processed)[0m in 1.73s]
[0m23:34:38.037770 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:34:38.038728 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:38.039039 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:34:38.039355 [info ] [MainThread]: 
[0m23:34:38.039630 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 9.45 seconds (9.45s).
[0m23:34:38.040508 [debug] [MainThread]: Command end result
[0m23:34:38.072853 [info ] [MainThread]: 
[0m23:34:38.073147 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:34:38.073325 [info ] [MainThread]: 
[0m23:34:38.073500 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m23:34:38.075538 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.431925, "process_user_time": 4.457237, "process_kernel_time": 0.352293, "process_mem_max_rss": "209960960", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:34:38.075852 [debug] [MainThread]: Command `dbt run` succeeded at 23:34:38.075801 after 11.43 seconds
[0m23:34:38.076056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047b7a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046f5370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d97a720>]}
[0m23:34:38.076243 [debug] [MainThread]: Flushing usage events
[0m23:36:18.829088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079cdca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084ceea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084ceb40>]}


============================== 23:36:18.831790 | e30f3fee-21ff-4d57-9372-47e80e2ec0af ==============================
[0m23:36:18.831790 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:36:18.832142 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:36:18.834052 [error] [MainThread]: Encountered an error:
Runtime Error
  The profile 'manual-test-platform' does not have a target named 'prod'. The valid target names for this profile are:
   - dev
[0m23:36:18.835110 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.037843917, "process_user_time": 0.587596, "process_kernel_time": 0.117457, "process_mem_max_rss": "93290496", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:36:18.835572 [debug] [MainThread]: Command `dbt run` failed at 23:36:18.835519 after 0.04 seconds
[0m23:36:18.835759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e082c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f03230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081adbe0>]}
[0m23:36:18.835932 [debug] [MainThread]: Flushing usage events
[0m23:36:41.991044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108605370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ba6ab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ba6870>]}


============================== 23:36:41.995116 | 05ad0d96-1ad2-484e-a740-fa2e0f6457ac ==============================
[0m23:36:41.995116 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:36:41.995493 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:36:42.004499 [info ] [MainThread]: dbt version: 1.8.5
[0m23:36:42.004757 [info ] [MainThread]: python version: 3.12.5
[0m23:36:42.004901 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m23:36:42.005032 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m23:36:42.007128 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m23:36:42.007348 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m23:36:42.007524 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m23:36:42.077783 [info ] [MainThread]: Configuration:
[0m23:36:42.078073 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m23:36:42.078217 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m23:36:42.078341 [info ] [MainThread]: Required dependencies:
[0m23:36:42.078559 [debug] [MainThread]: Executing "git --help"
[0m23:36:42.085940 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m23:36:42.086659 [debug] [MainThread]: STDERR: "b''"
[0m23:36:42.086897 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m23:36:42.087114 [info ] [MainThread]: Connection test skipped since no profile was found
[0m23:36:42.087381 [info ] [MainThread]: [31m1 check failed:[0m
[0m23:36:42.087796 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  The profile 'manual-test-platform' does not have a target named 'prod'. The valid target names for this profile are:
   - dev


[0m23:36:42.090620 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.1302975, "process_user_time": 0.660749, "process_kernel_time": 0.116215, "process_mem_max_rss": "95436800", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:36:42.091181 [debug] [MainThread]: Command `dbt debug` failed at 23:36:42.091109 after 0.13 seconds
[0m23:36:42.091490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107abd460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108605370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ccc1a0>]}
[0m23:36:42.091783 [debug] [MainThread]: Flushing usage events
[0m23:36:55.438146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1013370b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10428ac30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10428a990>]}


============================== 23:36:55.440641 | bdaeee74-c420-4923-8a5c-2a143a394b52 ==============================
[0m23:36:55.440641 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:36:55.440951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:36:55.446976 [info ] [MainThread]: dbt version: 1.8.5
[0m23:36:55.447171 [info ] [MainThread]: python version: 3.12.5
[0m23:36:55.447566 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m23:36:55.447761 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m23:36:56.226726 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m23:36:56.226988 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m23:36:56.227158 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m23:36:56.269583 [info ] [MainThread]: Configuration:
[0m23:36:56.269858 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m23:36:56.270011 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m23:36:56.270141 [info ] [MainThread]: Required dependencies:
[0m23:36:56.270334 [debug] [MainThread]: Executing "git --help"
[0m23:36:56.284632 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m23:36:56.285242 [debug] [MainThread]: STDERR: "b''"
[0m23:36:56.285458 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m23:36:56.285636 [info ] [MainThread]: Connection test skipped since no profile was found
[0m23:36:56.285783 [info ] [MainThread]: [31m1 check failed:[0m
[0m23:36:56.285917 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "manual-test-platform", target "prod" invalid: Runtime Error
    Must specify schema


[0m23:36:56.288267 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.87900156, "process_user_time": 2.700339, "process_kernel_time": 0.309757, "process_mem_max_rss": "192757760", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:36:56.288703 [debug] [MainThread]: Command `dbt debug` failed at 23:36:56.288640 after 0.88 seconds
[0m23:36:56.288972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104de2ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4553d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043502c0>]}
[0m23:36:56.289198 [debug] [MainThread]: Flushing usage events
[0m23:37:30.050353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c7d820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10450e150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045526f0>]}


============================== 23:37:30.053279 | 72402ff1-a98f-46b7-a2c0-0dafcba5a718 ==============================
[0m23:37:30.053279 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:37:30.053591 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:37:30.072229 [info ] [MainThread]: dbt version: 1.8.5
[0m23:37:30.072502 [info ] [MainThread]: python version: 3.12.5
[0m23:37:30.072777 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m23:37:30.072916 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m23:37:30.844676 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt
[0m23:37:30.844950 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/profiles.yml
[0m23:37:30.845102 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/dbt_project.yml
[0m23:37:30.845240 [info ] [MainThread]: adapter type: bigquery
[0m23:37:30.845367 [info ] [MainThread]: adapter version: 1.8.2
[0m23:37:30.886792 [info ] [MainThread]: Configuration:
[0m23:37:30.887061 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m23:37:30.887205 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m23:37:30.887338 [info ] [MainThread]: Required dependencies:
[0m23:37:30.887526 [debug] [MainThread]: Executing "git --help"
[0m23:37:30.903535 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m23:37:30.904031 [debug] [MainThread]: STDERR: "b''"
[0m23:37:30.904217 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m23:37:30.904382 [info ] [MainThread]: Connection:
[0m23:37:30.904586 [info ] [MainThread]:   method: service-account
[0m23:37:30.904714 [info ] [MainThread]:   database: manual-pasfield
[0m23:37:30.904832 [info ] [MainThread]:   execution_project: manual-pasfield
[0m23:37:30.904948 [info ] [MainThread]:   schema: manual_test
[0m23:37:30.905059 [info ] [MainThread]:   location: EU
[0m23:37:30.905183 [info ] [MainThread]:   priority: None
[0m23:37:30.905300 [info ] [MainThread]:   maximum_bytes_billed: None
[0m23:37:30.905413 [info ] [MainThread]:   impersonate_service_account: None
[0m23:37:30.905524 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m23:37:30.905633 [info ] [MainThread]:   job_retries: 1
[0m23:37:30.905741 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m23:37:30.905860 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m23:37:30.905968 [info ] [MainThread]:   timeout_seconds: None
[0m23:37:30.906076 [info ] [MainThread]:   client_id: None
[0m23:37:30.906185 [info ] [MainThread]:   token_uri: None
[0m23:37:30.906292 [info ] [MainThread]:   dataproc_region: None
[0m23:37:30.906399 [info ] [MainThread]:   dataproc_cluster_name: None
[0m23:37:30.906507 [info ] [MainThread]:   gcs_bucket: None
[0m23:37:30.906613 [info ] [MainThread]:   dataproc_batch: None
[0m23:37:30.906958 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:37:30.911553 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m23:37:30.912484 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:37:30.988402 [debug] [MainThread]: On debug: select 1 as id
[0m23:37:31.552454 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:478812fa-f165-42e4-a4fa-498fec98a2bb&page=queryresults
[0m23:37:31.816179 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m23:37:31.816502 [info ] [MainThread]: [32mAll checks passed![0m
[0m23:37:31.819545 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.8012393, "process_user_time": 2.76975, "process_kernel_time": 0.308383, "process_mem_max_rss": "193609728", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:37:31.819977 [debug] [MainThread]: Command `dbt debug` succeeded at 23:37:31.819907 after 1.80 seconds
[0m23:37:31.820195 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m23:37:31.820402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041ddca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d04bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033bb830>]}
[0m23:37:31.820638 [debug] [MainThread]: Flushing usage events
[0m23:37:37.964576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107da9ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10887ef30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10858e1e0>]}


============================== 23:37:37.967076 | c29465d4-b7a0-4259-b424-801094e629cc ==============================
[0m23:37:37.967076 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:37:37.967389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:37:38.621969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a77a570>]}
[0m23:37:38.646301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a2b5d00>]}
[0m23:37:38.646678 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:37:38.675240 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:37:38.718365 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m23:37:38.718638 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m23:37:38.718822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12aa44200>]}
[0m23:37:39.647029 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m23:37:39.653165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a7abcb0>]}
[0m23:37:39.706424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a2a5ca0>]}
[0m23:37:39.706715 [info ] [MainThread]: Found 4 models, 3 sources, 854 macros
[0m23:37:39.706954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a384b30>]}
[0m23:37:39.707973 [info ] [MainThread]: 
[0m23:37:39.708277 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:37:39.710253 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:37:39.710526 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:40.083064 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now create_manual-pasfield_manual_test)
[0m23:37:40.083684 [debug] [ThreadPool]: Creating schema "database: "manual-pasfield"
schema: "manual_test"
"
[0m23:37:40.095842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:40.187151 [debug] [ThreadPool]: On create_manual-pasfield_manual_test: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "create_manual-pasfield_manual_test"} */
create schema if not exists `manual-pasfield`.`manual_test`
  
[0m23:37:40.721580 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e6ac4e7d-86e5-44ee-96ae-4d0e64f3bf76&page=queryresults
[0m23:37:42.664583 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_manual-pasfield_manual_test, now list_manual-pasfield_manual_test)
[0m23:37:42.665337 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:43.280325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a03a990>]}
[0m23:37:43.282305 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:37:43.283125 [info ] [MainThread]: 
[0m23:37:43.286499 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:37:43.287369 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m23:37:43.288094 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m23:37:43.288521 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:37:43.294839 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:37:43.295925 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:37:43.316743 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:37:43.318120 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:43.399942 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m23:37:44.406056 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b8ca9414-b1e7-4189-ba86-2ca0ac6d01e4&page=queryresults
[0m23:37:44.835658 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a11edb0>]}
[0m23:37:44.836461 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.55s]
[0m23:37:44.837087 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:37:44.837500 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:37:44.838011 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m23:37:44.838483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:37:44.838841 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:37:44.843006 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:37:44.844595 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:37:44.850071 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:37:44.851184 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:44.935268 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m23:37:45.636870 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5fadbd1a-3a3c-4992-beec-ffaf1b7b926d&page=queryresults
[0m23:37:46.072190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a40e8a0>]}
[0m23:37:46.073352 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m23:37:46.074286 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:37:46.074889 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:37:46.075570 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m23:37:46.076186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:37:46.076831 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:37:46.081436 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:37:46.082438 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:37:46.086490 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:37:46.087536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:46.182467 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m23:37:47.171830 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b231b042-cbfc-47e9-9f9d-bb5c6722c225&page=queryresults
[0m23:37:47.762894 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a429dc0>]}
[0m23:37:47.763854 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.69s]
[0m23:37:47.764640 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:37:47.765635 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:37:47.766479 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:37:47.767015 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:37:47.767342 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:37:47.770647 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:37:47.772872 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:37:47.776842 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:37:47.777657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:47.869862 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    c.*,
    ao.taxonomy_business_category_group
from customers c 
left join acq_orders ao on ao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m23:37:49.116943 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:736f782e-9cdf-472d-8e33-aece660555a7&page=queryresults
[0m23:37:49.516392 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c29465d4-b7a0-4259-b424-801094e629cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a4ae120>]}
[0m23:37:49.517565 [info ] [Thread-1 (]: 4 of 4 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.75s]
[0m23:37:49.518374 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:37:49.519865 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:37:49.520306 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:37:49.520662 [info ] [MainThread]: 
[0m23:37:49.520976 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 9.81 seconds (9.81s).
[0m23:37:49.521916 [debug] [MainThread]: Command end result
[0m23:37:49.562942 [info ] [MainThread]: 
[0m23:37:49.563338 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:37:49.563593 [info ] [MainThread]: 
[0m23:37:49.563828 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m23:37:49.566241 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.63047, "process_user_time": 4.459684, "process_kernel_time": 0.30042, "process_mem_max_rss": "208814080", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:37:49.566728 [debug] [MainThread]: Command `dbt run` succeeded at 23:37:49.566645 after 11.63 seconds
[0m23:37:49.567026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12a132c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10883a480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a4937d0>]}
[0m23:37:49.567288 [debug] [MainThread]: Flushing usage events
[0m19:48:34.380067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038212e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f47080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f46d50>]}


============================== 19:48:34.382661 | b2a87745-a651-48e8-a6eb-d1f6be04a138 ==============================
[0m19:48:34.382661 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:48:34.382966 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_active_customers', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:48:36.596178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e84d730>]}
[0m19:48:36.620587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11edd0a40>]}
[0m19:48:36.620906 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:48:36.674937 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:48:36.760973 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m19:48:36.761292 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_active_customers.sql
[0m19:48:36.864346 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.referential
- models.manual-pasfield.preparatory
[0m19:48:36.870384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122788530>]}
[0m19:48:36.921355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1223aa870>]}
[0m19:48:36.921638 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m19:48:36.921810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ef75550>]}
[0m19:48:36.922750 [info ] [MainThread]: 
[0m19:48:36.923039 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:48:36.924815 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:48:36.925020 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:48:37.343204 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m19:48:37.343810 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:48:37.772895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12240aae0>]}
[0m19:48:37.773304 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:48:37.773503 [info ] [MainThread]: 
[0m19:48:37.775791 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:48:37.776082 [info ] [Thread-1 (]: 1 of 2 START sql view model manual_test.ref_customers .......................... [RUN]
[0m19:48:37.776336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_customers)
[0m19:48:37.776514 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:48:37.781450 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:48:37.782534 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:48:37.799822 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:48:37.800608 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:48:37.867253 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m19:48:38.551971 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c419f8c4-30c9-4d1b-8039-ad864ebc85fa&page=queryresults
[0m19:48:38.833927 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e71eba0>]}
[0m19:48:38.834366 [info ] [Thread-1 (]: 1 of 2 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.06s]
[0m19:48:38.834707 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:48:38.835135 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m19:48:38.835379 [info ] [Thread-1 (]: 2 of 2 START sql view model manual_test.mart_active_customers .................. [RUN]
[0m19:48:38.835641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.mart_active_customers)
[0m19:48:38.835868 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m19:48:38.844853 [debug] [Thread-1 (]: Compilation Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Required var 'dbt_date:time_zone' not found in config:
  Vars supplied to mart_active_customers = {}
  
  > in macro convert_timezone (macros/calendar_date/convert_timezone.sql)
  > called by macro now (macros/calendar_date/now.sql)
  > called by macro today (macros/calendar_date/today.sql)
  > called by model mart_active_customers (models/marts/mart_active_customers.sql)
[0m19:48:38.845218 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2a87745-a651-48e8-a6eb-d1f6be04a138', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123090680>]}
[0m19:48:38.845548 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model manual_test.mart_active_customers ......... [[31mERROR[0m in 0.01s]
[0m19:48:38.845824 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m19:48:38.846612 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:48:38.846768 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m19:48:38.846938 [info ] [MainThread]: 
[0m19:48:38.847096 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.92 seconds (1.92s).
[0m19:48:38.847449 [debug] [MainThread]: Command end result
[0m19:48:38.918696 [info ] [MainThread]: 
[0m19:48:38.918956 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:48:38.919113 [info ] [MainThread]: 
[0m19:48:38.919304 [error] [MainThread]:   Compilation Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Required var 'dbt_date:time_zone' not found in config:
  Vars supplied to mart_active_customers = {}
  
  > in macro convert_timezone (macros/calendar_date/convert_timezone.sql)
  > called by macro now (macros/calendar_date/now.sql)
  > called by macro today (macros/calendar_date/today.sql)
  > called by model mart_active_customers (models/marts/mart_active_customers.sql)
[0m19:48:38.919443 [info ] [MainThread]: 
[0m19:48:38.919587 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m19:48:38.921610 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.5740604, "process_user_time": 3.421001, "process_kernel_time": 0.372578, "process_mem_max_rss": "205930496", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:48:38.921947 [debug] [MainThread]: Command `dbt run` failed at 19:48:38.921899 after 4.57 seconds
[0m19:48:38.922139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1225fda30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1225fdc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1225fd6a0>]}
[0m19:48:38.922309 [debug] [MainThread]: Flushing usage events
[0m19:49:12.007772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10850e540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10877edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10877ea50>]}


============================== 19:49:12.010546 | fa53b69d-b65c-495b-a88d-08347b9d39cd ==============================
[0m19:49:12.010546 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:49:12.010861 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt deps', 'send_anonymous_usage_stats': 'True'}
[0m19:49:12.089134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa53b69d-b65c-495b-a88d-08347b9d39cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10850dd30>]}
[0m19:49:12.100307 [debug] [MainThread]: Set downloads directory='/var/folders/_5/58zpwrld087_7wj2dt63wf0c0000gp/T/dbt-downloads-_277mrde'
[0m19:49:12.100594 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m19:49:12.196084 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m19:49:12.196592 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json
[0m19:49:12.250315 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_expectations.json 200
[0m19:49:12.255209 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m19:49:12.309475 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m19:49:12.313619 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json
[0m19:49:12.377633 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/calogica/dbt_date.json 200
[0m19:49:12.397286 [info ] [MainThread]: Updating lock file in file path: /Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/package-lock.yml
[0m19:49:12.436343 [debug] [MainThread]: Set downloads directory='/var/folders/_5/58zpwrld087_7wj2dt63wf0c0000gp/T/dbt-downloads-8h2w9opc'
[0m19:49:12.439787 [info ] [MainThread]: Installing calogica/dbt_expectations
[0m19:49:12.812230 [info ] [MainThread]: Installed from version 0.10.3
[0m19:49:12.812505 [info ] [MainThread]: Updated version available: 0.10.4
[0m19:49:12.812705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'fa53b69d-b65c-495b-a88d-08347b9d39cd', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108812750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108965e80>]}
[0m19:49:12.812905 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m19:49:13.037676 [info ] [MainThread]: Installed from version 1.1.1
[0m19:49:13.037979 [info ] [MainThread]: Updated version available: 1.3.0
[0m19:49:13.038206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'fa53b69d-b65c-495b-a88d-08347b9d39cd', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10892a2a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10892a450>]}
[0m19:49:13.038411 [info ] [MainThread]: Installing calogica/dbt_date
[0m19:49:13.199269 [info ] [MainThread]: Installed from version 0.10.1
[0m19:49:13.199617 [info ] [MainThread]: Up to date!
[0m19:49:13.199887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': 'fa53b69d-b65c-495b-a88d-08347b9d39cd', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108947020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108946ba0>]}
[0m19:49:13.200169 [info ] [MainThread]: 
[0m19:49:13.200406 [info ] [MainThread]: Updates available for packages: ['calogica/dbt_expectations', 'dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m19:49:13.202808 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 1.2248805, "process_user_time": 0.778519, "process_kernel_time": 0.258917, "process_mem_max_rss": "105349120", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:49:13.203196 [debug] [MainThread]: Command `dbt deps` succeeded at 19:49:13.203130 after 1.23 seconds
[0m19:49:13.203433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087322d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b40140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10850dd30>]}
[0m19:49:13.203646 [debug] [MainThread]: Flushing usage events
[0m19:49:19.652988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cb4260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b77170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b76e10>]}


============================== 19:49:19.656489 | d813c17c-0b72-4f55-b7c0-6f20780f4723 ==============================
[0m19:49:19.656489 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:49:19.656877 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_active_customers', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:49:20.484601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a506450>]}
[0m19:49:20.508709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fa65a0>]}
[0m19:49:20.509023 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:49:20.529400 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:49:20.615290 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:49:20.615580 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:49:20.618313 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m19:49:20.631707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b19d640>]}
[0m19:49:20.682045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b3f54c0>]}
[0m19:49:20.682336 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m19:49:20.682507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b4436e0>]}
[0m19:49:20.683452 [info ] [MainThread]: 
[0m19:49:20.683753 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:49:20.685548 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:49:20.685749 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:49:21.077784 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m19:49:21.078190 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:49:21.413292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a0b9910>]}
[0m19:49:21.414701 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:49:21.415261 [info ] [MainThread]: 
[0m19:49:21.420280 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:49:21.421428 [info ] [Thread-1 (]: 1 of 2 START sql view model manual_test.ref_customers .......................... [RUN]
[0m19:49:21.422283 [debug] [Thread-1 (]: Acquiring new bigquery connection 'model.manual_pasfield.ref_customers'
[0m19:49:21.422799 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:49:21.433310 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:49:21.433965 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:49:21.464242 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:49:21.465184 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m19:49:21.540162 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m19:49:22.092501 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c911e533-70cd-457d-b85c-b197087ed2a3&page=queryresults
[0m19:49:22.525102 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a01eba0>]}
[0m19:49:22.525927 [info ] [Thread-1 (]: 1 of 2 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.10s]
[0m19:49:22.526609 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:49:22.527508 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m19:49:22.528051 [info ] [Thread-1 (]: 2 of 2 START sql view model manual_test.mart_active_customers .................. [RUN]
[0m19:49:22.528449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.mart_active_customers)
[0m19:49:22.528768 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m19:49:22.545875 [debug] [Thread-1 (]: Compilation Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Required var 'dbt_date:time_zone' not found in config:
  Vars supplied to mart_active_customers = {}
  
  > in macro convert_timezone (macros/calendar_date/convert_timezone.sql)
  > called by macro now (macros/calendar_date/now.sql)
  > called by macro today (macros/calendar_date/today.sql)
  > called by model mart_active_customers (models/marts/mart_active_customers.sql)
[0m19:49:22.546228 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd813c17c-0b72-4f55-b7c0-6f20780f4723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b302090>]}
[0m19:49:22.546609 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model manual_test.mart_active_customers ......... [[31mERROR[0m in 0.02s]
[0m19:49:22.546933 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m19:49:22.548166 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:49:22.548469 [debug] [MainThread]: Connection 'list_manual-pasfield_manual_test' was properly closed.
[0m19:49:22.548672 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m19:49:22.548927 [info ] [MainThread]: 
[0m19:49:22.549171 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.87 seconds (1.87s).
[0m19:49:22.549712 [debug] [MainThread]: Command end result
[0m19:49:22.587792 [info ] [MainThread]: 
[0m19:49:22.588094 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:49:22.588265 [info ] [MainThread]: 
[0m19:49:22.588483 [error] [MainThread]:   Compilation Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Required var 'dbt_date:time_zone' not found in config:
  Vars supplied to mart_active_customers = {}
  
  > in macro convert_timezone (macros/calendar_date/convert_timezone.sql)
  > called by macro now (macros/calendar_date/now.sql)
  > called by macro today (macros/calendar_date/today.sql)
  > called by model mart_active_customers (models/marts/mart_active_customers.sql)
[0m19:49:22.588657 [info ] [MainThread]: 
[0m19:49:22.588827 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m19:49:22.590289 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.9718885, "process_user_time": 3.218773, "process_kernel_time": 0.335408, "process_mem_max_rss": "203489280", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:49:22.590628 [debug] [MainThread]: Command `dbt run` failed at 19:49:22.590576 after 2.97 seconds
[0m19:49:22.590841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cb4260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e6eb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b632d50>]}
[0m19:49:22.591026 [debug] [MainThread]: Flushing usage events
[0m19:50:26.729529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c348f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066a2f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066a2d20>]}


============================== 19:50:26.732108 | 77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f ==============================
[0m19:50:26.732108 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:50:26.732426 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select +mart_active_customers', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:50:27.565189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f4a5d0>]}
[0m19:50:27.589253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e48c2f0>]}
[0m19:50:27.589571 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:50:27.610347 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:50:27.653379 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m19:50:27.653684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10665e300>]}
[0m19:50:28.529598 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
[0m19:50:28.535092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eae47a0>]}
[0m19:50:28.584666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed73530>]}
[0m19:50:28.584946 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m19:50:28.585114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb5f6b0>]}
[0m19:50:28.586025 [info ] [MainThread]: 
[0m19:50:28.586295 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:50:28.588001 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:50:28.588195 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:50:28.949575 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m19:50:28.950333 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:50:29.359242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ea654f0>]}
[0m19:50:29.360850 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:50:29.361797 [info ] [MainThread]: 
[0m19:50:29.366417 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:50:29.367239 [info ] [Thread-1 (]: 1 of 2 START sql view model manual_test.ref_customers .......................... [RUN]
[0m19:50:29.368113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_customers)
[0m19:50:29.368713 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:50:29.377797 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:50:29.378759 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:50:29.403756 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:50:29.404568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:50:29.482213 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m19:50:30.168003 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5a44fbb2-03cf-4acd-9c56-0363d0cff86f&page=queryresults
[0m19:50:30.463643 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eacf1d0>]}
[0m19:50:30.464573 [info ] [Thread-1 (]: 1 of 2 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.09s]
[0m19:50:30.465262 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:50:30.466010 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m19:50:30.466550 [info ] [Thread-1 (]: 2 of 2 START sql view model manual_test.mart_active_customers .................. [RUN]
[0m19:50:30.467049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.mart_active_customers)
[0m19:50:30.467416 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m19:50:30.479493 [debug] [Thread-1 (]: Compilation Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Required var 'dbt_date:time_zone' not found in config:
  Vars supplied to mart_active_customers = {
      "dbt_date": {
          "time_zone": "UTC"
      }
  }
  
  > in macro convert_timezone (macros/calendar_date/convert_timezone.sql)
  > called by macro now (macros/calendar_date/now.sql)
  > called by macro today (macros/calendar_date/today.sql)
  > called by model mart_active_customers (models/marts/mart_active_customers.sql)
[0m19:50:30.479915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77ee7d9d-d87d-4e37-80f5-4be3a1c8bf1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed9e4e0>]}
[0m19:50:30.480312 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model manual_test.mart_active_customers ......... [[31mERROR[0m in 0.01s]
[0m19:50:30.480696 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m19:50:30.481822 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:50:30.482061 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m19:50:30.482345 [info ] [MainThread]: 
[0m19:50:30.482600 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.90 seconds (1.90s).
[0m19:50:30.483213 [debug] [MainThread]: Command end result
[0m19:50:30.514262 [info ] [MainThread]: 
[0m19:50:30.514565 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:50:30.514735 [info ] [MainThread]: 
[0m19:50:30.514956 [error] [MainThread]:   Compilation Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Required var 'dbt_date:time_zone' not found in config:
  Vars supplied to mart_active_customers = {
      "dbt_date": {
          "time_zone": "UTC"
      }
  }
  
  > in macro convert_timezone (macros/calendar_date/convert_timezone.sql)
  > called by macro now (macros/calendar_date/now.sql)
  > called by macro today (macros/calendar_date/today.sql)
  > called by model mart_active_customers (models/marts/mart_active_customers.sql)
[0m19:50:30.515125 [info ] [MainThread]: 
[0m19:50:30.515290 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m19:50:30.517299 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.819094, "process_user_time": 4.036721, "process_kernel_time": 0.341407, "process_mem_max_rss": "208846848", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:50:30.517646 [debug] [MainThread]: Command `dbt run` failed at 19:50:30.517589 after 3.82 seconds
[0m19:50:30.517865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053532c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066a2ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066a2ed0>]}
[0m19:50:30.518056 [debug] [MainThread]: Flushing usage events
[0m19:52:02.094202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10749e060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feed80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feeb40>]}


============================== 19:52:02.096846 | d8837c32-9c20-4148-a7e3-dd71d58b07f8 ==============================
[0m19:52:02.096846 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:52:02.097159 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_active_customers', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:52:02.899848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130e7d730>]}
[0m19:52:02.923900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068f1910>]}
[0m19:52:02.924203 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:52:02.945396 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:52:02.987994 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m19:52:02.988296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133c68f50>]}
[0m19:52:03.848630 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m19:52:03.854019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133cf1070>]}
[0m19:52:03.903387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133cf3830>]}
[0m19:52:03.903668 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m19:52:03.903843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133db9eb0>]}
[0m19:52:03.904744 [info ] [MainThread]: 
[0m19:52:03.905022 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:52:03.906730 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:52:03.906920 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:52:04.251649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m19:52:04.252874 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:52:04.659086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133ef6c30>]}
[0m19:52:04.660336 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:52:04.660822 [info ] [MainThread]: 
[0m19:52:04.664888 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:52:04.665762 [info ] [Thread-1 (]: 1 of 2 START sql view model manual_test.ref_customers .......................... [RUN]
[0m19:52:04.666551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_customers)
[0m19:52:04.667240 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:52:04.678309 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:52:04.679791 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:52:04.709076 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:52:04.709782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:52:04.784630 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m19:52:05.336875 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7e7cbdf7-5f48-4dbe-99d2-aadbc531b6f5&page=queryresults
[0m19:52:05.724152 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130a22c60>]}
[0m19:52:05.724874 [info ] [Thread-1 (]: 1 of 2 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.06s]
[0m19:52:05.725477 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:52:05.726141 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m19:52:05.726788 [info ] [Thread-1 (]: 2 of 2 START sql view model manual_test.mart_active_customers .................. [RUN]
[0m19:52:05.727327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.mart_active_customers)
[0m19:52:05.727695 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m19:52:05.731736 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_active_customers"
[0m19:52:05.733589 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_active_customers
[0m19:52:05.737315 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_active_customers"
[0m19:52:05.737818 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:52:05.815376 [debug] [Thread-1 (]: On model.manual_pasfield.mart_active_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_active_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_active_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
where from_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date);


[0m19:52:06.560204 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0137953a-56c0-4bf7-a793-72126ade1c86&page=queryresults
[0m19:52:06.673731 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: from_date at [9:7]; reason: invalidQuery, location: query, message: Unrecognized name: from_date at [9:7]')
[0m19:52:07.328936 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9ee67d89-bf03-4c26-993d-99353d6f63d7&page=queryresults
[0m19:52:07.427640 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9ee67d89-bf03-4c26-993d-99353d6f63d7&page=queryresults
[0m19:52:07.443522 [debug] [Thread-1 (]: Database Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Unrecognized name: from_date at [9:7]
  compiled Code at target/run/manual_pasfield/models/marts/mart_active_customers.sql
[0m19:52:07.444164 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8837c32-9c20-4148-a7e3-dd71d58b07f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13590ab70>]}
[0m19:52:07.444794 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model manual_test.mart_active_customers ......... [[31mERROR[0m in 1.72s]
[0m19:52:07.445451 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m19:52:07.447073 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:52:07.447392 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m19:52:07.447728 [info ] [MainThread]: 
[0m19:52:07.448028 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 3.54 seconds (3.54s).
[0m19:52:07.448862 [debug] [MainThread]: Command end result
[0m19:52:07.487975 [info ] [MainThread]: 
[0m19:52:07.488308 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:52:07.488505 [info ] [MainThread]: 
[0m19:52:07.488746 [error] [MainThread]:   Database Error in model mart_active_customers (models/marts/mart_active_customers.sql)
  Unrecognized name: from_date at [9:7]
  compiled Code at target/run/manual_pasfield/models/marts/mart_active_customers.sql
[0m19:52:07.488936 [info ] [MainThread]: 
[0m19:52:07.489123 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m19:52:07.491304 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.4291673, "process_user_time": 4.172714, "process_kernel_time": 0.336588, "process_mem_max_rss": "210567168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:52:07.491673 [debug] [MainThread]: Command `dbt run` failed at 19:52:07.491613 after 5.43 seconds
[0m19:52:07.491923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107137aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feeb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feed80>]}
[0m19:52:07.492145 [debug] [MainThread]: Flushing usage events
[0m20:00:04.111276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d2300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106926f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106926cf0>]}


============================== 20:00:04.113878 | 31fd4d66-cace-445e-a8b9-bcd16c912f80 ==============================
[0m20:00:04.113878 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:00:04.114192 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_active_customers', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:00:04.958345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2b8fb0>]}
[0m20:00:04.984257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e2e3b60>]}
[0m20:00:04.984658 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:00:05.006314 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:00:05.102725 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:00:05.103081 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.sql
[0m20:00:05.204423 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
[0m20:00:05.210355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152a2eff0>]}
[0m20:00:05.260935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e6b3470>]}
[0m20:00:05.261225 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:00:05.261391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152af38f0>]}
[0m20:00:05.262139 [info ] [MainThread]: 
[0m20:00:05.262428 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:00:05.262903 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:00:05.263121 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:00:05.717437 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:00:05.717888 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:00:06.087465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152933c80>]}
[0m20:00:06.088348 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:00:06.088736 [info ] [MainThread]: 
[0m20:00:06.092327 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m20:00:06.092986 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.mart_active_customers .................. [RUN]
[0m20:00:06.093523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.mart_active_customers)
[0m20:00:06.094215 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m20:00:06.102781 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_active_customers"
[0m20:00:06.103813 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_active_customers
[0m20:00:06.128855 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_active_customers"
[0m20:00:06.129588 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:00:06.202810 [debug] [Thread-1 (]: On model.manual_pasfield.mart_active_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_active_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_active_customers`
  OPTIONS()
  as -- IMPORT CTES

with customer as (
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        customer.*,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customer
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:00:06.970500 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:810e2553-f813-45bc-87b9-21ba862a67a5&page=queryresults
[0m20:00:07.338181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31fd4d66-cace-445e-a8b9-bcd16c912f80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a21f560>]}
[0m20:00:07.339089 [info ] [Thread-1 (]: 1 of 1 OK created sql view model manual_test.mart_active_customers ............. [[32mCREATE VIEW (0 processed)[0m in 1.24s]
[0m20:00:07.339806 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m20:00:07.341173 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:00:07.341537 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m20:00:07.341843 [info ] [MainThread]: 
[0m20:00:07.342160 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.08 seconds (2.08s).
[0m20:00:07.342797 [debug] [MainThread]: Command end result
[0m20:00:07.417100 [info ] [MainThread]: 
[0m20:00:07.417368 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:00:07.417521 [info ] [MainThread]: 
[0m20:00:07.417671 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:00:07.421897 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.342409, "process_user_time": 3.252695, "process_kernel_time": 0.368782, "process_mem_max_rss": "207470592", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:00:07.422159 [debug] [MainThread]: Command `dbt run` succeeded at 20:00:07.422116 after 3.34 seconds
[0m20:00:07.422334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10645b680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152984620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152984950>]}
[0m20:00:07.422487 [debug] [MainThread]: Flushing usage events
[0m20:05:13.780160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10186b2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dcef30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dcebd0>]}


============================== 20:05:13.783512 | d5054681-8a7e-4f09-b34e-a228694ca13f ==============================
[0m20:05:13.783512 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:05:13.783832 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select mart_active_customers', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:05:14.604563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5054681-8a7e-4f09-b34e-a228694ca13f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125144170>]}
[0m20:05:14.628555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5054681-8a7e-4f09-b34e-a228694ca13f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cb7200>]}
[0m20:05:14.628857 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:05:14.650886 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:05:14.734803 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m20:05:14.735146 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_active_customers.yml
[0m20:05:14.735343 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.sql
[0m20:05:14.847394 [error] [MainThread]: Encountered an error:
Field "type" of type ConstraintType in ModelLevelConstraint has invalid value 'customer_id'
[0m20:05:14.850959 [error] [MainThread]: Traceback (most recent call last):
  File "<string>", line 10, in __mashumaro_from_dict__
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/enum.py", line 757, in __call__
    return cls.__new__(cls, value)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/enum.py", line 1171, in __new__
    raise ve_exc
ValueError: 'customer_id' is not a valid ConstraintType

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 320, in wrapper
    ctx.obj["manifest"] = parse_manifest(
                          ^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/manifest.py", line 1898, in parse_manifest
    manifest = ManifestLoader.get_full_manifest(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/manifest.py", line 330, in get_full_manifest
    manifest = loader.load()
               ^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/manifest.py", line 452, in load
    self.parse_project(
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/manifest.py", line 729, in parse_project
    parser.parse_file(block, dct=dct)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/schemas.py", line 188, in parse_file
    model_parse_result = ModelPatchParser(self, yaml_block, "models").parse()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/schemas.py", line 475, in parse
    self.parse_patch(node_block, refs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/schemas.py", line 769, in parse_patch
    super().parse_patch(block, refs)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/schemas.py", line 712, in parse_patch
    self.patch_node_properties(node, patch)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/schemas.py", line 904, in patch_node_properties
    self.patch_constraints(node, patch.constraints)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/parser/schemas.py", line 921, in patch_constraints
    node.constraints = [ModelLevelConstraint.from_dict(c) for c in constraints]
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 4, in __mashumaro_from_dict__
  File "<string>", line 12, in __mashumaro_from_dict__
mashumaro.exceptions.InvalidFieldValue: Field "type" of type ConstraintType in ModelLevelConstraint has invalid value 'customer_id'

[0m20:05:14.853093 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1087885, "process_user_time": 2.864583, "process_kernel_time": 0.31253, "process_mem_max_rss": "202604544", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:05:14.853493 [debug] [MainThread]: Command `dbt run` failed at 20:05:14.853410 after 1.11 seconds
[0m20:05:14.853748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043cfa40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125671940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1251ff950>]}
[0m20:05:14.853941 [debug] [MainThread]: Flushing usage events
[0m20:05:28.883805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1215f2660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b2eea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b2eb40>]}


============================== 20:05:28.886483 | 55e7521d-6665-4a18-b6e3-8bf1331db228 ==============================
[0m20:05:28.886483 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:05:28.886796 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_active_customers', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:05:29.681587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146299b50>]}
[0m20:05:29.705728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122bcee70>]}
[0m20:05:29.706047 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:05:29.727524 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:05:29.803598 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m20:05:29.803950 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_active_customers.yml
[0m20:05:29.804141 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.sql
[0m20:05:29.938502 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m20:05:29.944709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c7abd0>]}
[0m20:05:30.037763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147b77bc0>]}
[0m20:05:30.038033 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:05:30.038202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c3ab70>]}
[0m20:05:30.038962 [info ] [MainThread]: 
[0m20:05:30.039224 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:05:30.039637 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:05:30.039808 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:05:30.445391 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:05:30.445786 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:05:30.801071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1207d84d0>]}
[0m20:05:30.802434 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:05:30.803040 [info ] [MainThread]: 
[0m20:05:30.807509 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m20:05:30.808283 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test.mart_active_customers ................. [RUN]
[0m20:05:30.809010 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.mart_active_customers)
[0m20:05:30.809731 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m20:05:30.821841 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_active_customers"
[0m20:05:30.824392 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_active_customers
[0m20:05:30.839897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:05:31.332861 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_active_customers"
[0m20:05:31.334084 [debug] [Thread-1 (]: On model.manual_pasfield.mart_active_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_active_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_active_customers`
      
    
    

    OPTIONS()
    as (
      -- IMPORT CTES

with customer as (
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customer.customer_id as string) as customer_id,
        customer.customer_country,
        customer.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customer
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final
    );
  
[0m20:05:32.208315 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c142706e-81c1-441c-80f1-a50b0426094d&page=queryresults
[0m20:05:40.069620 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '55e7521d-6665-4a18-b6e3-8bf1331db228', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14632ac90>]}
[0m20:05:40.070700 [info ] [Thread-1 (]: 1 of 1 OK created sql table model manual_test.mart_active_customers ............ [[32mCREATE TABLE (2.2m rows, 54.8 MiB processed)[0m in 9.26s]
[0m20:05:40.071410 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m20:05:40.072655 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:05:40.073010 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m20:05:40.073312 [info ] [MainThread]: 
[0m20:05:40.073613 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 10.03 seconds (10.03s).
[0m20:05:40.074237 [debug] [MainThread]: Command end result
[0m20:05:40.108929 [info ] [MainThread]: 
[0m20:05:40.109276 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:05:40.109479 [info ] [MainThread]: 
[0m20:05:40.109681 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:05:40.111929 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.258231, "process_user_time": 3.360282, "process_kernel_time": 0.369357, "process_mem_max_rss": "206815232", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:05:40.112267 [debug] [MainThread]: Command `dbt run` succeeded at 20:05:40.112214 after 11.26 seconds
[0m20:05:40.112482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b8eb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147578110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14757b4a0>]}
[0m20:05:40.112659 [debug] [MainThread]: Flushing usage events
[0m20:05:48.072116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d3f2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068fb0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068fae10>]}


============================== 20:05:48.074721 | b41cf958-f324-42ae-a16b-6739f2ee08e1 ==============================
[0m20:05:48.074721 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:05:48.075019 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select mart_active_customers', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:05:48.647532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129bc9730>]}
[0m20:05:48.671347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bd6000>]}
[0m20:05:48.671660 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:05:48.692224 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:05:48.769091 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:05:48.769563 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.yml
[0m20:05:48.899761 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.referential
- models.manual-pasfield.preparatory
[0m20:05:48.905793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af805f0>]}
[0m20:05:48.995600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af69fd0>]}
[0m20:05:48.995889 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:05:48.996056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af190d0>]}
[0m20:05:48.996829 [info ] [MainThread]: 
[0m20:05:48.997100 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:05:48.997505 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:05:48.997681 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:05:49.325379 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:05:49.326076 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:05:49.703700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105205bb0>]}
[0m20:05:49.704409 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:05:49.704790 [info ] [MainThread]: 
[0m20:05:49.708152 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m20:05:49.708703 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test.mart_active_customers ................. [RUN]
[0m20:05:49.709170 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.mart_active_customers)
[0m20:05:49.709537 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m20:05:49.718289 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_active_customers"
[0m20:05:49.719158 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_active_customers
[0m20:05:49.732395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:05:50.101136 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_active_customers"
[0m20:05:50.102282 [debug] [Thread-1 (]: On model.manual_pasfield.mart_active_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_active_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_active_customers`
      
    
    

    OPTIONS()
    as (
      -- IMPORT CTES

with customer as (
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customer.customer_id as string) as customer_id,
        customer.customer_country,
        customer.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customer
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final
    );
  
[0m20:05:50.944809 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f702b884-d3f6-4ecb-b3ed-c04e4d91ba47&page=queryresults
[0m20:05:57.994014 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b41cf958-f324-42ae-a16b-6739f2ee08e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12941f140>]}
[0m20:05:57.995786 [info ] [Thread-1 (]: 1 of 1 OK created sql table model manual_test.mart_active_customers ............ [[32mCREATE TABLE (2.2m rows, 54.8 MiB processed)[0m in 8.28s]
[0m20:05:57.996429 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m20:05:57.997581 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:05:57.997894 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m20:05:57.998163 [info ] [MainThread]: 
[0m20:05:57.998427 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 9.00 seconds (9.00s).
[0m20:05:57.998970 [debug] [MainThread]: Command end result
[0m20:05:58.033261 [info ] [MainThread]: 
[0m20:05:58.033582 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:05:58.033760 [info ] [MainThread]: 
[0m20:05:58.033939 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m20:05:58.035777 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.993335, "process_user_time": 3.248008, "process_kernel_time": 0.350017, "process_mem_max_rss": "208568320", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:05:58.036133 [debug] [MainThread]: Command `dbt run` succeeded at 20:05:58.036077 after 9.99 seconds
[0m20:05:58.036342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d3f2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129b68140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129c9e9c0>]}
[0m20:05:58.036537 [debug] [MainThread]: Flushing usage events
[0m20:09:27.767793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ee1910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081faf60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081fad20>]}


============================== 20:09:27.770502 | a1364914-bcd8-409a-b161-e47853986777 ==============================
[0m20:09:27.770502 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:09:27.770853 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_active_customers', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:09:28.615006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a1364914-bcd8-409a-b161-e47853986777', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd50e00>]}
[0m20:09:28.638844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a1364914-bcd8-409a-b161-e47853986777', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe7d7f0>]}
[0m20:09:28.639149 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:09:28.660350 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:09:28.747598 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
[0m20:09:28.747966 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customers.yml
[0m20:09:28.748142 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customers.sql
[0m20:09:28.748369 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.yml
[0m20:09:28.748518 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.sql
[0m20:09:28.861535 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two schema.yml entries for the same resource named mart_active_customers. Resources and their associated columns may only be described a single time. To fix this, remove the resource entry for mart_active_customers in one of these files:
   - models/marts/mart_active_customers.yml
  models/marts/mart_customers.yml
[0m20:09:28.863752 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1268365, "process_user_time": 2.848419, "process_kernel_time": 0.348023, "process_mem_max_rss": "203538432", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:09:28.864077 [debug] [MainThread]: Command `dbt run` failed at 20:09:28.864026 after 1.13 seconds
[0m20:09:28.864282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081fad20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128421b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1283ffb90>]}
[0m20:09:28.864451 [debug] [MainThread]: Flushing usage events
[0m20:09:45.759754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e55eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10692af60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10692acc0>]}


============================== 20:09:45.763216 | df3af28a-c98a-4009-915f-8c4b9ee92557 ==============================
[0m20:09:45.763216 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:09:45.763542 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_active_customers', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:09:46.555457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14012a750>]}
[0m20:09:46.579029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127595e50>]}
[0m20:09:46.579325 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:09:46.600520 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:09:46.679434 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 2 files changed.
[0m20:09:46.679757 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customers.sql
[0m20:09:46.679941 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customers.yml
[0m20:09:46.680173 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.yml
[0m20:09:46.680320 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_active_customers.sql
[0m20:09:46.818408 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.referential
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
[0m20:09:46.824394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141392c90>]}
[0m20:09:46.918954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141403e30>]}
[0m20:09:46.919231 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m20:09:46.919400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140543620>]}
[0m20:09:46.920383 [info ] [MainThread]: 
[0m20:09:46.920655 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:09:46.922602 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:09:46.922816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:09:47.325720 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:09:47.326599 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:09:47.717506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1412fe570>]}
[0m20:09:47.718678 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:09:47.719144 [info ] [MainThread]: 
[0m20:09:47.723568 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:09:47.724386 [info ] [Thread-1 (]: 1 of 6 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m20:09:47.724963 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:09:47.725804 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:09:47.734519 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:09:47.735825 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:09:47.768024 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:09:47.769383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:09:47.844320 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m20:09:48.616500 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b63b25b1-a900-4f69-89c6-1a9fcee2f191&page=queryresults
[0m20:09:48.914349 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106678200>]}
[0m20:09:48.915227 [info ] [Thread-1 (]: 1 of 6 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.19s]
[0m20:09:48.915872 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:09:48.916277 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:09:48.916816 [info ] [Thread-1 (]: 2 of 6 START sql view model manual_test.ref_activity ........................... [RUN]
[0m20:09:48.917321 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:09:48.917674 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:09:48.920941 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:09:48.922976 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:09:48.926276 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:09:48.927517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:09:49.003653 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m20:09:49.637503 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:46600c11-247c-4e4f-859e-ca90b1e257b2&page=queryresults
[0m20:09:49.926172 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140279e20>]}
[0m20:09:49.928263 [info ] [Thread-1 (]: 2 of 6 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.01s]
[0m20:09:49.929082 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:09:49.929626 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:09:49.930346 [info ] [Thread-1 (]: 3 of 6 START sql view model manual_test.ref_customers .......................... [RUN]
[0m20:09:49.931043 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:09:49.931541 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:09:49.937092 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:09:49.939704 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:09:49.943531 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:09:49.944241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:09:50.030670 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m20:09:50.868175 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:29a69deb-7e68-47f8-8bed-58e2e3739abb&page=queryresults
[0m20:09:51.132503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14139d760>]}
[0m20:09:51.134188 [info ] [Thread-1 (]: 3 of 6 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.20s]
[0m20:09:51.135685 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:09:51.136707 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:09:51.137628 [info ] [Thread-1 (]: 4 of 6 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:09:51.138419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:09:51.138906 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:09:51.146152 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:09:51.148228 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:09:51.151930 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:09:51.152726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:09:51.243177 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

-- LOGICAL CTES
final as (
select
    c.*,
    ao.taxonomy_business_category_group
from customers c 
left join acq_orders ao on ao.customer_id = c.customer_id
)

-- FINAL CTE
select * from final;


[0m20:09:52.051939 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:64b38380-ea31-45bf-a2c5-5cf6b55c9586&page=queryresults
[0m20:09:52.436184 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1414efad0>]}
[0m20:09:52.437675 [info ] [Thread-1 (]: 4 of 6 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.30s]
[0m20:09:52.438829 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:09:52.440044 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customers
[0m20:09:52.440780 [info ] [Thread-1 (]: 5 of 6 START sql table model manual_test.mart_customers ........................ [RUN]
[0m20:09:52.441395 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customers)
[0m20:09:52.441881 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customers
[0m20:09:52.448889 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customers"
[0m20:09:52.450510 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customers
[0m20:09:52.473873 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customers"
[0m20:09:52.474688 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:09:52.554228 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_customers`
      
    
    

    OPTIONS()
    as (
      -- IMPORT CTES

with customer as (
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customer.customer_id as string) as customer_id,
        customer.customer_country,
        customer.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customer
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final
    );
  
[0m20:09:53.430383 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4bc9c948-4254-4ff1-beb3-c9c43aaf435a&page=queryresults
[0m20:10:00.480918 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1402fd280>]}
[0m20:10:00.482293 [info ] [Thread-1 (]: 5 of 6 OK created sql table model manual_test.mart_customers ................... [[32mCREATE TABLE (2.2m rows, 54.8 MiB processed)[0m in 8.04s]
[0m20:10:00.483543 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customers
[0m20:10:00.484949 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_active_customers
[0m20:10:00.485896 [info ] [Thread-1 (]: 6 of 6 START sql table model manual_test.mart_active_customers ................. [RUN]
[0m20:10:00.486727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customers, now model.manual_pasfield.mart_active_customers)
[0m20:10:00.487226 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_active_customers
[0m20:10:00.493157 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_active_customers"
[0m20:10:00.494000 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_active_customers
[0m20:10:00.496330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:10:00.872072 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_active_customers"
[0m20:10:00.874631 [debug] [Thread-1 (]: On model.manual_pasfield.mart_active_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_active_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_active_customers`
      
    
    

    OPTIONS()
    as (
      -- IMPORT CTES

with customer as (
    select
        *
    from `manual-pasfield`.`manual_test`.`mart_customers`
)

-- FINAL CTE
select * from customer
where has_active_subscripton is true
    );
  
[0m20:10:01.413226 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:43da0bb1-8172-4ea5-bde6-ff45169bdaf7&page=queryresults
[0m20:10:03.300725 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df3af28a-c98a-4009-915f-8c4b9ee92557', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1413ceb70>]}
[0m20:10:03.302264 [info ] [Thread-1 (]: 6 of 6 OK created sql table model manual_test.mart_active_customers ............ [[32mCREATE TABLE (0.0 rows, 72.4 MiB processed)[0m in 2.81s]
[0m20:10:03.303500 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_active_customers
[0m20:10:03.305828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:10:03.306555 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_active_customers' was properly closed.
[0m20:10:03.307110 [info ] [MainThread]: 
[0m20:10:03.307589 [info ] [MainThread]: Finished running 4 view models, 2 table models in 0 hours 0 minutes and 16.39 seconds (16.39s).
[0m20:10:03.309816 [debug] [MainThread]: Command end result
[0m20:10:03.349763 [info ] [MainThread]: 
[0m20:10:03.350158 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:10:03.350391 [info ] [MainThread]: 
[0m20:10:03.350620 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m20:10:03.353227 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.627697, "process_user_time": 4.082864, "process_kernel_time": 0.336619, "process_mem_max_rss": "207568896", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:10:03.353690 [debug] [MainThread]: Command `dbt run` succeeded at 20:10:03.353612 after 17.63 seconds
[0m20:10:03.353991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106364200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137911b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14136b740>]}
[0m20:10:03.354247 [debug] [MainThread]: Flushing usage events
[0m20:23:48.770677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bef0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b431d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b42e70>]}


============================== 20:23:48.773310 | d5d43ab0-ec6a-49e5-9911-743a420bc720 ==============================
[0m20:23:48.773310 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:23:48.773631 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select +prep_customer', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:23:49.602899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b69730>]}
[0m20:23:49.626973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f1f4290>]}
[0m20:23:49.627281 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:23:49.648993 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:23:49.735035 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 0 files added, 1 files changed.
[0m20:23:49.735355 [debug] [MainThread]: Partial parsing: deleted file: manual_pasfield://models/marts/mart_active_customers.sql
[0m20:23:49.735570 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m20:23:49.837967 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.referential
- models.manual-pasfield.preparatory
[0m20:23:49.843943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1550f9d30>]}
[0m20:23:49.893640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154d6b890>]}
[0m20:23:49.893937 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:23:49.894108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1550fac30>]}
[0m20:23:49.895127 [info ] [MainThread]: 
[0m20:23:49.895432 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:23:49.897246 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:23:49.897454 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:23:50.304684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:23:50.305706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:23:50.683984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154e25550>]}
[0m20:23:50.684755 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:23:50.685173 [info ] [MainThread]: 
[0m20:23:50.687956 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:23:50.688559 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m20:23:50.689043 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:23:50.689418 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:23:50.698612 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:23:50.699714 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:23:50.722895 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:23:50.723648 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:23:50.796315 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m20:23:51.559061 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1315a71d-6c74-4139-be2a-683b5b388946&page=queryresults
[0m20:23:51.836565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15411e840>]}
[0m20:23:51.837359 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m20:23:51.837974 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:23:51.838406 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:23:51.838962 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m20:23:51.839457 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:23:51.839810 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:23:51.846094 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:23:51.847027 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:23:51.899407 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:23:51.899992 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:23:51.965807 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m20:23:53.095747 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ac4b68e6-3479-42ef-a002-96283c58ac88&page=queryresults
[0m20:23:53.323819 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1551a2ba0>]}
[0m20:23:53.324896 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.48s]
[0m20:23:53.325737 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:23:53.326339 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:23:53.327066 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m20:23:53.327746 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:23:53.328270 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:23:53.333746 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:23:53.335215 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:23:53.337185 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:23:53.337902 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:23:53.427876 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m20:23:54.015643 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2db9ca89-046a-4145-b7e4-60502f5c4cc0&page=queryresults
[0m20:23:54.253977 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154f7f3b0>]}
[0m20:23:54.255405 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.93s]
[0m20:23:54.256249 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:23:54.257139 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:23:54.257961 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:23:54.258704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:23:54.259197 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:23:54.266684 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:23:54.268655 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:23:54.270786 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:23:54.271356 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:23:54.357944 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customer.customer_id as string) as customer_id,
        customer.customer_country,
        customer.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customer
    left join acq_orders on acq_orders.customer_id = customers.customer_id
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:23:54.645557 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c091bcbd-8183-47b8-b3b4-abff93e1140d&page=queryresults
[0m20:23:54.646937 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Table "customer" must be qualified with a dataset (e.g. dataset.table).; reason: invalid, location: customer, message: Table "customer" must be qualified with a dataset (e.g. dataset.table).')
[0m20:23:54.969456 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ca7fb801-6c31-4115-88b0-476d255d44ac&page=queryresults
[0m20:23:54.971815 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ca7fb801-6c31-4115-88b0-476d255d44ac&page=queryresults
[0m20:23:54.985532 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Table "customer" must be qualified with a dataset (e.g. dataset.table).
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:23:54.985955 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd5d43ab0-ec6a-49e5-9911-743a420bc720', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154fea750>]}
[0m20:23:54.986395 [error] [Thread-1 (]: 4 of 4 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 0.73s]
[0m20:23:54.986796 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:23:54.987803 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:23:54.987994 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m20:23:54.988232 [info ] [MainThread]: 
[0m20:23:54.988428 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 5.09 seconds (5.09s).
[0m20:23:54.989091 [debug] [MainThread]: Command end result
[0m20:23:55.029815 [info ] [MainThread]: 
[0m20:23:55.030140 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:23:55.030337 [info ] [MainThread]: 
[0m20:23:55.030572 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Table "customer" must be qualified with a dataset (e.g. dataset.table).
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:23:55.030762 [info ] [MainThread]: 
[0m20:23:55.030952 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m20:23:55.032969 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.293368, "process_user_time": 3.704837, "process_kernel_time": 0.357796, "process_mem_max_rss": "208535552", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:23:55.033318 [debug] [MainThread]: Command `dbt run` failed at 20:23:55.033255 after 6.29 seconds
[0m20:23:55.033554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10684ba40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154e25850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154f93290>]}
[0m20:23:55.033775 [debug] [MainThread]: Flushing usage events
[0m20:24:02.715572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d26330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601ee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601ec00>]}


============================== 20:24:02.718245 | 8949ec29-631c-498f-8687-2f749471a084 ==============================
[0m20:24:02.718245 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:24:02.718563 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +prep_customer', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:24:03.325870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120194ef0>]}
[0m20:24:03.352546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130506540>]}
[0m20:24:03.353000 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:24:03.376323 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:24:03.460137 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:24:03.460560 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m20:24:03.570154 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m20:24:03.577495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137ff9fd0>]}
[0m20:24:03.630407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137c509e0>]}
[0m20:24:03.630712 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:24:03.630886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a756d0>]}
[0m20:24:03.631949 [info ] [MainThread]: 
[0m20:24:03.632252 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:24:03.634280 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:24:03.634596 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:24:03.965561 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:24:03.965868 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:24:04.340562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1301b97f0>]}
[0m20:24:04.340961 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:24:04.341147 [info ] [MainThread]: 
[0m20:24:04.343254 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:24:04.343566 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m20:24:04.343801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:24:04.343973 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:24:04.348395 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:24:04.348872 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:24:04.367176 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:24:04.367741 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:04.435219 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m20:24:04.946517 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bc3753dc-94dc-4b12-a699-3574337a8c26&page=queryresults
[0m20:24:05.192559 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1301231d0>]}
[0m20:24:05.192951 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.85s]
[0m20:24:05.193260 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:24:05.193484 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:24:05.193693 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m20:24:05.193961 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:24:05.194216 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:24:05.197498 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:24:05.198073 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:24:05.247160 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:24:05.247720 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:05.313883 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m20:24:06.313809 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9af46fc0-881e-4f66-9aba-9c635846cd7b&page=queryresults
[0m20:24:06.567184 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1301528d0>]}
[0m20:24:06.567599 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.37s]
[0m20:24:06.568130 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:24:06.568385 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:24:06.568649 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m20:24:06.568888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:24:06.569059 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:24:06.571176 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:24:06.571889 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:24:06.574047 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:24:06.574765 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:06.643015 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m20:24:07.225293 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e6c99cba-f0be-4b99-9e4c-f1ff15b58580&page=queryresults
[0m20:24:07.567988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e62f60>]}
[0m20:24:07.568593 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m20:24:07.569086 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:24:07.569843 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:24:07.570384 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:24:07.570811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:24:07.571113 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:24:07.576010 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:24:07.578692 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:24:07.581201 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:24:07.581673 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:07.658206 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customer.customer_id as string) as customer_id,
        customer.customer_country,
        customer.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on acq_orders.customer_id = customers.customer_id
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:24:08.410591 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b1f6bee5-19ff-439c-9874-ad37c2eb86e9&page=queryresults
[0m20:24:08.519752 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: customer; Did you mean customers? at [36:27]; reason: invalidQuery, location: query, message: Unrecognized name: customer; Did you mean customers? at [36:27]')
[0m20:24:09.750125 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:05a09111-1903-4957-8ecf-6f6c053e6b7a&page=queryresults
[0m20:24:09.850526 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:05a09111-1903-4957-8ecf-6f6c053e6b7a&page=queryresults
[0m20:24:09.867302 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: customer; Did you mean customers? at [36:27]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:24:09.868138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8949ec29-631c-498f-8687-2f749471a084', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137fa9250>]}
[0m20:24:09.868988 [error] [Thread-1 (]: 4 of 4 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 2.30s]
[0m20:24:09.869775 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:24:09.871381 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:24:09.871793 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m20:24:09.872211 [info ] [MainThread]: 
[0m20:24:09.872585 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 6.24 seconds (6.24s).
[0m20:24:09.873986 [debug] [MainThread]: Command end result
[0m20:24:09.911906 [info ] [MainThread]: 
[0m20:24:09.912248 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:24:09.912456 [info ] [MainThread]: 
[0m20:24:09.912705 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: customer; Did you mean customers? at [36:27]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:24:09.912898 [info ] [MainThread]: 
[0m20:24:09.913087 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m20:24:09.915044 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.2321563, "process_user_time": 3.519018, "process_kernel_time": 0.298417, "process_mem_max_rss": "208879616", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:24:09.915393 [debug] [MainThread]: Command `dbt run` failed at 20:24:09.915336 after 7.23 seconds
[0m20:24:09.915629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a74470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a749b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137978080>]}
[0m20:24:09.915848 [debug] [MainThread]: Flushing usage events
[0m20:24:13.734687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bfe540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e66ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e66c00>]}


============================== 20:24:13.736794 | c28e92c4-0224-4962-af50-910d039dc7eb ==============================
[0m20:24:13.736794 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:24:13.737119 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select +prep_customer', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:24:14.270777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10570e990>]}
[0m20:24:14.294543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fac260>]}
[0m20:24:14.294850 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:24:14.313536 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:24:14.381402 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:24:14.381760 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m20:24:14.481777 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.referential
- models.manual-pasfield.preparatory
[0m20:24:14.487774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1282226c0>]}
[0m20:24:14.534548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128363560>]}
[0m20:24:14.534844 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:24:14.535005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128259880>]}
[0m20:24:14.536009 [info ] [MainThread]: 
[0m20:24:14.536311 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:24:14.538102 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:24:14.538302 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:24:14.899166 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:24:14.900464 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:24:15.269831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f8b9ac0>]}
[0m20:24:15.271221 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:24:15.271710 [info ] [MainThread]: 
[0m20:24:15.275935 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:24:15.276896 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m20:24:15.277734 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:24:15.278368 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:24:15.287531 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:24:15.288179 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:24:15.314641 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:24:15.315452 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:15.392551 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m20:24:15.754887 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:36d6ba14-636a-461a-981e-67a458237e84&page=queryresults
[0m20:24:16.107447 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195019d0>]}
[0m20:24:16.108198 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.83s]
[0m20:24:16.108830 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:24:16.109256 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:24:16.109792 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m20:24:16.110320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:24:16.110677 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:24:16.116566 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:24:16.117439 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:24:16.165753 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:24:16.166319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:16.232391 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m20:24:16.852185 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8e174494-e754-4960-b9d4-18cca3d5330a&page=queryresults
[0m20:24:17.097221 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12879fe90>]}
[0m20:24:17.098144 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.99s]
[0m20:24:17.098970 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:24:17.099526 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:24:17.100263 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m20:24:17.101137 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:24:17.101719 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:24:17.107166 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:24:17.108308 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:24:17.110853 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:24:17.111353 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:17.198701 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m20:24:17.670950 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b452809d-c8a7-4bd9-a78a-4760c2e54a9b&page=queryresults
[0m20:24:17.898191 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12806bef0>]}
[0m20:24:17.899288 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.80s]
[0m20:24:17.900139 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:24:17.901209 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:24:17.901964 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:24:17.902518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:24:17.902985 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:24:17.910437 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:24:17.911152 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:24:17.914374 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:24:17.915084 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:18.004948 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        customers.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on acq_orders.customer_id = customers.customer_id
    left join activity on customer.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:24:19.335019 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1893b2ca-57b5-464b-b181-5654aaa5f9d2&page=queryresults
[0m20:24:19.433749 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: customer; Did you mean customers? at [36:27]; reason: invalidQuery, location: query, message: Unrecognized name: customer; Did you mean customers? at [36:27]')
[0m20:24:19.922979 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e24cdd4c-0197-4d0a-893c-3b3ee3b8d4e1&page=queryresults
[0m20:24:20.017771 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e24cdd4c-0197-4d0a-893c-3b3ee3b8d4e1&page=queryresults
[0m20:24:20.030492 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: customer; Did you mean customers? at [36:27]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:24:20.030873 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c28e92c4-0224-4962-af50-910d039dc7eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128584d70>]}
[0m20:24:20.031241 [error] [Thread-1 (]: 4 of 4 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 2.13s]
[0m20:24:20.031551 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:24:20.032465 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:24:20.032623 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m20:24:20.032810 [info ] [MainThread]: 
[0m20:24:20.032969 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 5.50 seconds (5.50s).
[0m20:24:20.033507 [debug] [MainThread]: Command end result
[0m20:24:20.071233 [info ] [MainThread]: 
[0m20:24:20.071601 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:24:20.071925 [info ] [MainThread]: 
[0m20:24:20.072285 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: customer; Did you mean customers? at [36:27]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:24:20.072688 [info ] [MainThread]: 
[0m20:24:20.072965 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m20:24:20.074765 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.3673673, "process_user_time": 3.571171, "process_kernel_time": 0.566771, "process_mem_max_rss": "211959808", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:24:20.075189 [debug] [MainThread]: Command `dbt run` failed at 20:24:20.075115 after 6.37 seconds
[0m20:24:20.075462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128636300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1280ce5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1280cf440>]}
[0m20:24:20.075707 [debug] [MainThread]: Flushing usage events
[0m20:24:48.815818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080be000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083b6db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083b6a80>]}


============================== 20:24:48.818411 | 8362e6c0-46b0-4795-aa7f-0b2452f12fac ==============================
[0m20:24:48.818411 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:24:48.818727 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select +prep_customer', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:24:49.665252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1203e9640>]}
[0m20:24:49.691925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120008ec0>]}
[0m20:24:49.692416 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:24:49.715597 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:24:49.806604 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:24:49.807027 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m20:24:49.916200 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m20:24:49.923134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107274bf0>]}
[0m20:24:49.975867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1206813a0>]}
[0m20:24:49.976249 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:24:49.976447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124494fe0>]}
[0m20:24:49.977628 [info ] [MainThread]: 
[0m20:24:49.977974 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:24:49.979837 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:24:49.980040 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:24:50.306210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:24:50.306506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:24:50.658243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124494fe0>]}
[0m20:24:50.658633 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:24:50.658812 [info ] [MainThread]: 
[0m20:24:50.660358 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:24:50.660695 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m20:24:50.660952 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:24:50.661124 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:24:50.665632 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:24:50.666183 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:24:50.717048 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:24:50.717740 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:50.787368 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m20:24:51.360090 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:723e6e27-f578-4ea5-9ed1-c4d87f194060&page=queryresults
[0m20:24:51.659390 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe3e930>]}
[0m20:24:51.660039 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m20:24:51.660536 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:24:51.660848 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:24:51.661268 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m20:24:51.661654 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:24:51.661929 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:24:51.667248 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:24:51.667947 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:24:51.715435 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:24:51.715969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:51.781097 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m20:24:52.317555 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d0254b63-fcb5-40e8-be7b-9d1884ff58c2&page=queryresults
[0m20:24:52.627385 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124409370>]}
[0m20:24:52.628434 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.97s]
[0m20:24:52.629297 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:24:52.629905 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:24:52.630656 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m20:24:52.631369 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:24:52.631884 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:24:52.637633 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:24:52.638680 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:24:52.642707 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:24:52.643193 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:52.730564 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m20:24:53.300990 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:658c2727-dbed-4b1e-84ab-f67168111e28&page=queryresults
[0m20:24:53.562099 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124408b60>]}
[0m20:24:53.562473 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.93s]
[0m20:24:53.562792 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:24:53.563124 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:24:53.563342 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:24:53.563549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:24:53.563720 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:24:53.566438 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:24:53.566933 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:24:53.568586 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:24:53.569145 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:24:53.635236 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        customers.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:24:54.410878 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a4e5d2aa-5a13-457d-9da9-a36eef748a60&page=queryresults
[0m20:24:54.518918 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name taxonomy_business_category_group not found inside customers at [32:19]; reason: invalidQuery, location: query, message: Name taxonomy_business_category_group not found inside customers at [32:19]')
[0m20:24:55.760560 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:dcdc42ae-0f82-476e-b350-af70fce6112d&page=queryresults
[0m20:24:55.853437 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:dcdc42ae-0f82-476e-b350-af70fce6112d&page=queryresults
[0m20:24:55.861657 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Name taxonomy_business_category_group not found inside customers at [32:19]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:24:55.862018 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8362e6c0-46b0-4795-aa7f-0b2452f12fac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1243b8ef0>]}
[0m20:24:55.862354 [error] [Thread-1 (]: 4 of 4 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 2.30s]
[0m20:24:55.862643 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:24:55.863398 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:24:55.863581 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m20:24:55.863765 [info ] [MainThread]: 
[0m20:24:55.863924 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 5.89 seconds (5.89s).
[0m20:24:55.864424 [debug] [MainThread]: Command end result
[0m20:24:55.926339 [info ] [MainThread]: 
[0m20:24:55.926627 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:24:55.926781 [info ] [MainThread]: 
[0m20:24:55.926977 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Name taxonomy_business_category_group not found inside customers at [32:19]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m20:24:55.927246 [info ] [MainThread]: 
[0m20:24:55.927448 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m20:24:55.929896 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.143401, "process_user_time": 3.694914, "process_kernel_time": 0.361594, "process_mem_max_rss": "208322560", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:24:55.930333 [debug] [MainThread]: Command `dbt run` failed at 20:24:55.930257 after 7.14 seconds
[0m20:24:55.930546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046aeb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e0c800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10836be60>]}
[0m20:24:55.930731 [debug] [MainThread]: Flushing usage events
[0m20:25:32.631555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e99df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105526f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105526c60>]}


============================== 20:25:32.634332 | f2eaaad3-2141-4d16-9ca4-ddcb886e225d ==============================
[0m20:25:32.634332 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:25:32.634649 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +prep_customer', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:25:33.452792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13637e960>]}
[0m20:25:33.476598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c6a780>]}
[0m20:25:33.476918 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:25:33.499119 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:25:33.583761 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:25:33.584111 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m20:25:33.686506 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.referential
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
[0m20:25:33.692633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1371bd100>]}
[0m20:25:33.743521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1373516d0>]}
[0m20:25:33.743806 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m20:25:33.743970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137252120>]}
[0m20:25:33.744994 [info ] [MainThread]: 
[0m20:25:33.745313 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:25:33.747171 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:25:33.747397 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:25:34.145283 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:25:34.146309 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:25:34.509653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13717a210>]}
[0m20:25:34.512054 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:25:34.512952 [info ] [MainThread]: 
[0m20:25:34.516840 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:25:34.517665 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m20:25:34.518435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:25:34.519135 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:25:34.529847 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:25:34.532054 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:25:34.561152 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:25:34.561882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:25:34.635881 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m20:25:35.154148 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1cb31b85-c197-4148-b05b-2551fbaddf04&page=queryresults
[0m20:25:35.482809 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1332b69c0>]}
[0m20:25:35.483571 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m20:25:35.484207 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:25:35.484642 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:25:35.485203 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m20:25:35.485695 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:25:35.486080 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:25:35.493063 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:25:35.493993 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:25:35.542389 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:25:35.543268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:25:35.609624 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m20:25:36.209857 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:75ba2f3b-49e1-436d-8559-2ce6bcb028e5&page=queryresults
[0m20:25:36.450492 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137767fb0>]}
[0m20:25:36.451781 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m20:25:36.452692 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:25:36.453318 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:25:36.454118 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m20:25:36.454832 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:25:36.455372 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:25:36.461016 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:25:36.462199 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:25:36.464219 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:25:36.464646 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:25:36.554854 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m20:25:37.235573 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:91feefbe-74fc-4ad4-979a-8bf58bbc2f44&page=queryresults
[0m20:25:37.462729 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c7cb60>]}
[0m20:25:37.464145 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.01s]
[0m20:25:37.465026 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:25:37.465986 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:25:37.466858 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:25:37.467585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:25:37.468145 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:25:37.475809 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:25:37.477769 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:25:37.481637 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:25:37.482581 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:25:37.571376 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:25:38.363534 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5f87566a-7d9b-4444-b326-9b19b10c2f36&page=queryresults
[0m20:25:38.611886 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2eaaad3-2141-4d16-9ca4-ddcb886e225d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137765220>]}
[0m20:25:38.613548 [info ] [Thread-1 (]: 4 of 4 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m20:25:38.614620 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:25:38.616206 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:25:38.616626 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m20:25:38.617102 [info ] [MainThread]: 
[0m20:25:38.617510 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 4.87 seconds (4.87s).
[0m20:25:38.618990 [debug] [MainThread]: Command end result
[0m20:25:38.659706 [info ] [MainThread]: 
[0m20:25:38.660066 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:25:38.660287 [info ] [MainThread]: 
[0m20:25:38.660507 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:25:38.663043 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.062673, "process_user_time": 3.753666, "process_kernel_time": 0.339819, "process_mem_max_rss": "206389248", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:25:38.663491 [debug] [MainThread]: Command `dbt run` succeeded at 20:25:38.663413 after 6.06 seconds
[0m20:25:38.663776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bee000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137786780>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137785f10>]}
[0m20:25:38.664032 [debug] [MainThread]: Flushing usage events
[0m21:05:23.174693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039074d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043b2e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043b2ae0>]}


============================== 21:05:23.177341 | f096a188-5ba4-47d1-bc0b-301b4df08e8e ==============================
[0m21:05:23.177341 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:05:23.177667 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:05:24.009125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046847a0>]}
[0m21:05:24.033278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f612f90>]}
[0m21:05:24.033624 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:05:24.054602 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:05:24.152747 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 2 files added, 0 files changed.
[0m21:05:24.153342 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customer_retention_metrics.sql
[0m21:05:24.153563 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m21:05:24.153755 [debug] [MainThread]: Partial parsing: deleted file: manual_pasfield://models/marts/mart_customers.sql
[0m21:05:24.259068 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m21:05:24.286497 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m21:05:24.292572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe1f830>]}
[0m21:05:24.385883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103211af0>]}
[0m21:05:24.386174 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:05:24.386343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045021e0>]}
[0m21:05:24.387361 [info ] [MainThread]: 
[0m21:05:24.387640 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:05:24.389430 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:05:24.389647 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:05:24.810633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:05:24.810990 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:05:25.215957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104093500>]}
[0m21:05:25.217317 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:05:25.218325 [info ] [MainThread]: 
[0m21:05:25.222625 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:05:25.223433 [info ] [Thread-1 (]: 1 of 4 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:05:25.224172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:05:25.224837 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:05:25.234244 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:05:25.235520 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:05:25.265064 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:05:25.265794 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:05:25.340619 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:05:25.791707 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:91afa47f-e5fd-427d-be15-afa0fc10abbf&page=queryresults
[0m21:05:26.106192 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f422cf0>]}
[0m21:05:26.107058 [info ] [Thread-1 (]: 1 of 4 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.88s]
[0m21:05:26.107736 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:05:26.108155 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:05:26.108706 [info ] [Thread-1 (]: 2 of 4 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:05:26.109192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:05:26.109551 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:05:26.113017 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:05:26.114149 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:05:26.119809 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:05:26.120481 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:05:26.197513 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:05:26.783163 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ce87ff3b-4b88-4fa0-98b2-64e51456b8d1&page=queryresults
[0m21:05:27.009438 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd0eb40>]}
[0m21:05:27.010704 [info ] [Thread-1 (]: 2 of 4 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.90s]
[0m21:05:27.011558 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:05:27.012135 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:05:27.012869 [info ] [Thread-1 (]: 3 of 4 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:05:27.013553 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:05:27.014059 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:05:27.019667 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:05:27.021222 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:05:27.025401 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:05:27.026225 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:05:27.116630 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:05:27.587031 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:40af4a2f-2885-4aee-813f-8c56ca7441b3&page=queryresults
[0m21:05:27.931221 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd0ca70>]}
[0m21:05:27.932839 [info ] [Thread-1 (]: 3 of 4 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m21:05:27.934168 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:05:27.935150 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:05:27.936019 [info ] [Thread-1 (]: 4 of 4 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:05:27.936863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:05:27.937360 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:05:27.943715 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:05:27.945346 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:05:27.947975 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:05:27.948586 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:05:28.038402 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with activity as (
    -- Selecting from the activity table (ref_activity)
    select
        customer_id,
        subscription_id,
        from_date,
        to_date
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

acq_orders as (
    -- Selecting from the acquisition orders table (ref_acq_orders)
    select
        customer_id,
        taxonomy_business_category_group
    from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

customers as (
    -- Selecting from the customers table (ref_customers)
    select
        customer_id,
        customer_country
    from `manual-pasfield`.`manual_test`.`ref_customers`
),

-- Join all three tables on customer_id
merged_data as (
    select
        a.customer_id,
        a.subscription_id,
        a.from_date,
        a.to_date,
        c.customer_country,
        o.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(a.to_date, a.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), a.to_date, day) as time_since_last_activity_days
    from activity a
    join customers c
        on a.customer_id = c.customer_id
    join acq_orders o
        on a.customer_id = o.customer_id
)

-- FINAL CTE
select *
from merged_data;


[0m21:05:29.053082 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:adcf0e02-3118-404c-9fc4-4e2f5954bc82&page=queryresults
[0m21:05:29.401741 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f096a188-5ba4-47d1-bc0b-301b4df08e8e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13826a6f0>]}
[0m21:05:29.403564 [info ] [Thread-1 (]: 4 of 4 OK created sql view model manual_test.mart_customer_retention_metrics ... [[32mCREATE VIEW (0 processed)[0m in 1.46s]
[0m21:05:29.404517 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:05:29.406126 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:05:29.406622 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:05:29.407182 [info ] [MainThread]: 
[0m21:05:29.407624 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 5.02 seconds (5.02s).
[0m21:05:29.409062 [debug] [MainThread]: Command end result
[0m21:05:29.450849 [info ] [MainThread]: 
[0m21:05:29.451231 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:05:29.451469 [info ] [MainThread]: 
[0m21:05:29.451702 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:05:29.454028 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.311441, "process_user_time": 3.69102, "process_kernel_time": 0.413346, "process_mem_max_rss": "207683584", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:05:29.454464 [debug] [MainThread]: Command `dbt run` succeeded at 21:05:29.454394 after 6.31 seconds
[0m21:05:29.454737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10359e6f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046847a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d540e0>]}
[0m21:05:29.454982 [debug] [MainThread]: Flushing usage events
[0m21:30:33.998422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044d2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a9ee70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a9ec30>]}


============================== 21:30:34.001561 | fca783ed-f70e-44b4-8989-3a6c5567e4ec ==============================
[0m21:30:34.001561 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:30:34.001912 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:30:34.835554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d94e480>]}
[0m21:30:34.859650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe16c60>]}
[0m21:30:34.859964 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:30:34.882282 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:30:34.965675 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:30:34.966030 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.sql
[0m21:30:35.063618 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
- models.manual-pasfield.marts
[0m21:30:35.069581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104029a60>]}
[0m21:30:35.120581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f9f74a0>]}
[0m21:30:35.120885 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:30:35.121052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb37da0>]}
[0m21:30:35.122137 [info ] [MainThread]: 
[0m21:30:35.122463 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:30:35.124334 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:30:35.124541 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:30:35.547706 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:30:35.548258 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:35.913372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cbb9790>]}
[0m21:30:35.914776 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:30:35.915285 [info ] [MainThread]: 
[0m21:30:35.920294 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:30:35.921223 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:30:35.922100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:30:35.922766 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:30:35.930770 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:30:35.932053 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:30:35.962120 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:30:35.962844 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:36.038325 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:30:36.657936 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fd6be962-b9ea-49aa-8771-34c817a534ee&page=queryresults
[0m21:30:37.069543 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cb22f30>]}
[0m21:30:37.070345 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m21:30:37.070976 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:30:37.071407 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:30:37.071938 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:30:37.072415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:30:37.072759 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:30:37.075788 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:30:37.076831 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:30:37.081646 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:30:37.082273 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:37.159104 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:30:37.712350 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:403e24f6-3429-4ff1-8322-011b46c0e228&page=queryresults
[0m21:30:37.975148 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd15d00>]}
[0m21:30:37.976769 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.90s]
[0m21:30:37.978135 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:30:37.978783 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:30:37.979620 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:30:37.980385 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:30:37.980906 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:30:38.047269 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:30:38.047865 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:30:38.049638 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:30:38.050012 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:38.117578 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:30:38.735765 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:edbf56a5-1b5d-4ca1-a09b-1f873bba164a&page=queryresults
[0m21:30:39.001277 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12df1f7a0>]}
[0m21:30:39.002579 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.02s]
[0m21:30:39.003662 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:30:39.004756 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:30:39.005619 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:30:39.006325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:30:39.007674 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:30:39.016859 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:30:39.018421 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:30:39.020107 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:30:39.020725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:39.107805 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:30:39.760457 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d9520ba0-57fd-4daa-b1ee-0b7cba48290f&page=queryresults
[0m21:30:40.144735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12daf6db0>]}
[0m21:30:40.146015 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m21:30:40.147380 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:30:40.148789 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:30:40.149665 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:30:40.150430 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:30:40.150967 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:30:40.156633 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:30:40.157852 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:30:40.160427 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:30:40.160879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:40.252159 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        a.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(a.to_date, a.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), a.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m21:30:41.194503 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:99bd8d88-efbf-4c06-8b16-25d660ffcf83&page=queryresults
[0m21:30:41.327229 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Name subscription_id not found inside pc at [18:12]; reason: invalidQuery, location: query, message: Name subscription_id not found inside pc at [18:12]')
[0m21:30:42.933713 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a2c46bb3-aa68-4d2c-a2a3-21deab50a19f&page=queryresults
[0m21:30:43.039590 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a2c46bb3-aa68-4d2c-a2a3-21deab50a19f&page=queryresults
[0m21:30:43.055733 [debug] [Thread-1 (]: Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Name subscription_id not found inside pc at [18:12]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:30:43.056202 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fca783ed-f70e-44b4-8989-3a6c5567e4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb79040>]}
[0m21:30:43.056646 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model manual_test.mart_customer_retention_metrics  [[31mERROR[0m in 2.91s]
[0m21:30:43.057039 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:30:43.058034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:30:43.058283 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:30:43.058552 [info ] [MainThread]: 
[0m21:30:43.058768 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 7.94 seconds (7.94s).
[0m21:30:43.059526 [debug] [MainThread]: Command end result
[0m21:30:43.096356 [info ] [MainThread]: 
[0m21:30:43.096739 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:30:43.096968 [info ] [MainThread]: 
[0m21:30:43.097245 [error] [MainThread]:   Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Name subscription_id not found inside pc at [18:12]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:30:43.097458 [info ] [MainThread]: 
[0m21:30:43.097670 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:30:43.099761 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.135209, "process_user_time": 3.835128, "process_kernel_time": 0.369388, "process_mem_max_rss": "207831040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:30:43.100109 [debug] [MainThread]: Command `dbt run` failed at 21:30:43.100052 after 9.14 seconds
[0m21:30:43.100343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044d2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103760b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fc3b60>]}
[0m21:30:43.100565 [debug] [MainThread]: Flushing usage events
[0m21:31:37.261169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f0bf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f27110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f26e70>]}


============================== 21:31:37.263800 | d2665aef-d5bf-44e8-bf59-d29d673b8121 ==============================
[0m21:31:37.263800 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:31:37.264151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'send_anonymous_usage_stats': 'True'}
[0m21:31:38.110006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c40ce0>]}
[0m21:31:38.133839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1333baf90>]}
[0m21:31:38.134142 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:31:38.156279 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:31:38.251375 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:31:38.251744 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m21:31:38.354248 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
[0m21:31:38.360603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1375f0b30>]}
[0m21:31:38.411103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137208110>]}
[0m21:31:38.411389 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:31:38.411551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136fc8f50>]}
[0m21:31:38.412566 [info ] [MainThread]: 
[0m21:31:38.412867 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:31:38.414707 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:31:38.414910 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:38.793878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:31:38.795069 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:39.169100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136fcbce0>]}
[0m21:31:39.170141 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:31:39.170620 [info ] [MainThread]: 
[0m21:31:39.174928 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:31:39.175655 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:31:39.176362 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:31:39.176962 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:31:39.185354 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:31:39.186648 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:31:39.214265 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:31:39.214967 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:39.290147 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:31:39.972474 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3c155468-3109-4081-bce8-71b30537e9fa&page=queryresults
[0m21:31:40.232546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13331f0e0>]}
[0m21:31:40.233343 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.06s]
[0m21:31:40.233976 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:31:40.234395 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:31:40.234934 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:31:40.235433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:31:40.235801 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:31:40.241879 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:31:40.242698 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:31:40.295284 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:31:40.295784 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:40.361310 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:31:40.925137 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0331ecfb-295a-414e-9470-4d305829da6e&page=queryresults
[0m21:31:41.198934 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137619370>]}
[0m21:31:41.200380 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m21:31:41.201746 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:31:41.202755 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:31:41.203673 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:31:41.204463 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:31:41.204982 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:31:41.210508 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:31:41.211231 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:31:41.212935 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:31:41.213295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:41.301309 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:31:41.838324 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1f5b5fa4-5743-48e6-a40f-5432c1c2e32e&page=queryresults
[0m21:31:42.146473 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137666540>]}
[0m21:31:42.147649 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.94s]
[0m21:31:42.148662 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:31:42.149704 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:31:42.150325 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:31:42.150925 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:31:42.151558 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:31:42.157327 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:31:42.158169 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:31:42.160372 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:31:42.160801 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:42.254703 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:31:43.060488 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5dacf701-7e7a-419f-9940-2396bd58bf05&page=queryresults
[0m21:31:43.427471 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1374877a0>]}
[0m21:31:43.428760 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.28s]
[0m21:31:43.429665 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:31:43.430723 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:43.431398 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:31:43.431952 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:31:43.432400 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:43.437488 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:31:43.439110 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:43.446208 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:31:43.447022 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:43.535938 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        a.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(a.to_date, a.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), a.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m21:31:44.254585 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2997fa38-cb6f-45dd-aa2c-a4a32c6b446d&page=queryresults
[0m21:31:44.365977 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: a at [20:9]; reason: invalidQuery, location: query, message: Unrecognized name: a at [20:9]')
[0m21:31:46.068894 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:550ac126-ac73-4955-91aa-0f79430f54ae&page=queryresults
[0m21:31:46.193427 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:550ac126-ac73-4955-91aa-0f79430f54ae&page=queryresults
[0m21:31:46.209314 [debug] [Thread-1 (]: Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Unrecognized name: a at [20:9]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:31:46.209844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2665aef-d5bf-44e8-bf59-d29d673b8121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136ffffe0>]}
[0m21:31:46.210390 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model manual_test.mart_customer_retention_metrics  [[31mERROR[0m in 2.78s]
[0m21:31:46.210882 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:46.212061 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:31:46.212304 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:31:46.212593 [info ] [MainThread]: 
[0m21:31:46.212846 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 7.80 seconds (7.80s).
[0m21:31:46.213795 [debug] [MainThread]: Command end result
[0m21:31:46.252920 [info ] [MainThread]: 
[0m21:31:46.253314 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:31:46.253528 [info ] [MainThread]: 
[0m21:31:46.253910 [error] [MainThread]:   Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Unrecognized name: a at [20:9]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:31:46.254167 [info ] [MainThread]: 
[0m21:31:46.254543 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:31:46.257094 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.025676, "process_user_time": 3.891213, "process_kernel_time": 0.339145, "process_mem_max_rss": "206241792", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:31:46.257517 [debug] [MainThread]: Command `dbt run` failed at 21:31:46.257453 after 9.03 seconds
[0m21:31:46.257776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c86d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f270e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f27110>]}
[0m21:31:46.258010 [debug] [MainThread]: Flushing usage events
[0m21:32:02.588113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10704c1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ab6e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ab6ba0>]}


============================== 21:32:02.590987 | e766025c-55a7-466e-8938-01cc00b6f149 ==============================
[0m21:32:02.590987 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:32:02.591329 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:32:03.386279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b59e480>]}
[0m21:32:03.410159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b671580>]}
[0m21:32:03.410466 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:32:03.435862 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:32:03.511813 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:32:03.512171 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.sql
[0m21:32:03.610223 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
[0m21:32:03.616351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c8d3a40>]}
[0m21:32:03.664844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c471670>]}
[0m21:32:03.665125 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:32:03.665290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c5236e0>]}
[0m21:32:03.666293 [info ] [MainThread]: 
[0m21:32:03.666581 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:32:03.668426 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:32:03.668625 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:32:04.093646 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:32:04.094098 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:32:04.472675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c8a61b0>]}
[0m21:32:04.474419 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:32:04.475478 [info ] [MainThread]: 
[0m21:32:04.480214 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:32:04.481164 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:32:04.482120 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:32:04.482658 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:32:04.492769 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:32:04.493808 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:32:04.523152 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:32:04.523835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:04.598635 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:32:05.114644 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:77a1ad8b-f3cf-4e69-95c5-3c2c26d4e436&page=queryresults
[0m21:32:05.478027 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af5a300>]}
[0m21:32:05.478814 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m21:32:05.479448 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:32:05.479859 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:32:05.480406 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:32:05.480937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:32:05.481311 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:32:05.484656 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:32:05.487052 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:32:05.491371 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:32:05.492069 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:05.571248 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:32:06.142279 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:68ba264f-3fda-43fa-b434-f87c061c1cf8&page=queryresults
[0m21:32:06.491506 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c912390>]}
[0m21:32:06.492414 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.01s]
[0m21:32:06.493174 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:32:06.493687 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:32:06.494416 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:32:06.494854 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:32:06.495129 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:32:06.546856 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:32:06.547436 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:32:06.549102 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:32:06.549487 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:06.619776 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:32:07.150341 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:046270ee-33db-4c09-bdfd-5e5c7aeb9716&page=queryresults
[0m21:32:07.430605 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c1ffc20>]}
[0m21:32:07.431707 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.94s]
[0m21:32:07.432517 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:32:07.433907 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:32:07.434777 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:32:07.435387 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:32:07.436575 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:32:07.445719 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:32:07.446615 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:32:07.449766 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:32:07.450470 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:07.540642 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:32:08.261604 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:78a40889-54a6-437d-ad29-6c3427bb25df&page=queryresults
[0m21:32:08.586244 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c1cfc20>]}
[0m21:32:08.587581 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m21:32:08.588652 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:32:08.589675 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:08.590350 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:32:08.590909 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:32:08.591359 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:08.596600 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:32:08.597513 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:08.599536 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:32:08.599967 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:08.690901 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        a.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), oc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m21:32:09.465792 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:263581ea-efd2-46e0-a104-f7f5f911e4e3&page=queryresults
[0m21:32:09.577248 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: a at [20:9]; reason: invalidQuery, location: query, message: Unrecognized name: a at [20:9]')
[0m21:32:10.388485 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2e29faab-5daf-4ec5-979e-fb54b1b3e5d0&page=queryresults
[0m21:32:10.466548 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2e29faab-5daf-4ec5-979e-fb54b1b3e5d0&page=queryresults
[0m21:32:10.482146 [debug] [Thread-1 (]: Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Unrecognized name: a at [20:9]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:32:10.482670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e766025c-55a7-466e-8938-01cc00b6f149', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c919d90>]}
[0m21:32:10.483218 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model manual_test.mart_customer_retention_metrics  [[31mERROR[0m in 1.89s]
[0m21:32:10.483715 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:10.484956 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:32:10.485204 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:32:10.485490 [info ] [MainThread]: 
[0m21:32:10.485732 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 6.82 seconds (6.82s).
[0m21:32:10.486650 [debug] [MainThread]: Command end result
[0m21:32:10.526179 [info ] [MainThread]: 
[0m21:32:10.526506 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:32:10.526711 [info ] [MainThread]: 
[0m21:32:10.526954 [error] [MainThread]:   Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Unrecognized name: a at [20:9]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:32:10.527145 [info ] [MainThread]: 
[0m21:32:10.527336 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:32:10.529437 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.9717073, "process_user_time": 3.796367, "process_kernel_time": 0.381611, "process_mem_max_rss": "208453632", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:32:10.529787 [debug] [MainThread]: Command `dbt run` failed at 21:32:10.529726 after 7.97 seconds
[0m21:32:10.530026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10704c1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10850d340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087fe210>]}
[0m21:32:10.530245 [debug] [MainThread]: Flushing usage events
[0m21:32:23.861992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100dbf2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051b95e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10542ecf0>]}


============================== 21:32:23.864586 | 900fd04a-0d58-47da-b575-5e816e57495f ==============================
[0m21:32:23.864586 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:32:23.864892 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:32:24.655681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ad6a480>]}
[0m21:32:24.679555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cc49e0>]}
[0m21:32:24.679862 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:32:24.701227 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:32:24.778278 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:32:24.778655 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.sql
[0m21:32:24.875665 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.referential
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
[0m21:32:24.882119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4d3830>]}
[0m21:32:24.932545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b165fd0>]}
[0m21:32:24.932829 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:32:24.933002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4cc350>]}
[0m21:32:24.933980 [info ] [MainThread]: 
[0m21:32:24.934274 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:32:24.936172 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:32:24.936375 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:32:25.795309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:32:25.796441 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:32:26.675123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137eb9a00>]}
[0m21:32:26.676690 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:32:26.677555 [info ] [MainThread]: 
[0m21:32:26.682341 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:32:26.683168 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:32:26.684006 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:32:26.684782 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:32:26.693163 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:32:26.694248 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:32:26.724215 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:32:26.724922 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:26.800641 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:32:27.390288 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:792ed428-f4ff-45e3-a21c-bcc94d340597&page=queryresults
[0m21:32:27.769519 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e22690>]}
[0m21:32:27.770360 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.08s]
[0m21:32:27.771132 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:32:27.771591 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:32:27.772091 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:32:27.772517 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:32:27.772857 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:32:27.776186 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:32:27.777192 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:32:27.782340 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:32:27.782916 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:27.863193 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:32:28.400300 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8a84aed7-a271-4dab-9944-d16b084d59b8&page=queryresults
[0m21:32:28.696676 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b585bb0>]}
[0m21:32:28.698107 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m21:32:28.699532 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:32:28.700231 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:32:28.701069 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:32:28.701847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:32:28.702360 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:32:28.769734 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:32:28.770331 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:32:28.772150 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:32:28.772535 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:28.840070 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:32:29.385706 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d41c83dd-2f25-4512-b20b-fa7109b06743&page=queryresults
[0m21:32:29.727856 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14adce090>]}
[0m21:32:29.729458 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.03s]
[0m21:32:29.730377 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:32:29.731548 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:32:29.732357 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:32:29.733130 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:32:29.734546 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:32:29.749299 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:32:29.750537 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:32:29.753823 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:32:29.754698 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:29.839646 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:32:30.431785 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4fabb16c-2f54-49fc-9213-ceebf0fd1efb&page=queryresults
[0m21:32:30.724347 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5a29f0>]}
[0m21:32:30.726038 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.99s]
[0m21:32:30.727262 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:32:30.728570 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:30.729231 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:32:30.729870 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:32:30.730351 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:30.735725 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:32:30.737102 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:30.740110 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:32:30.740845 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:30.833091 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), oc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m21:32:31.547473 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:121947f8-370a-45da-a27c-6be67adc1623&page=queryresults
[0m21:32:31.734514 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('GET https://bigquery.googleapis.com/bigquery/v2/projects/manual-pasfield/queries/121947f8-370a-45da-a27c-6be67adc1623?maxResults=0&location=EU&prettyPrint=false: Unrecognized name: oc at [28:35]')
[0m21:32:33.196359 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8f282c5a-fbd2-46a2-b7e9-e1884ddabb3c&page=queryresults
[0m21:32:33.313018 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8f282c5a-fbd2-46a2-b7e9-e1884ddabb3c&page=queryresults
[0m21:32:33.327640 [debug] [Thread-1 (]: Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Unrecognized name: oc at [28:35]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:32:33.328067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '900fd04a-0d58-47da-b575-5e816e57495f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b379d00>]}
[0m21:32:33.328482 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model manual_test.mart_customer_retention_metrics  [[31mERROR[0m in 2.60s]
[0m21:32:33.328931 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:33.330852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:32:33.331223 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:32:33.331618 [info ] [MainThread]: 
[0m21:32:33.331972 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 8.40 seconds (8.40s).
[0m21:32:33.333222 [debug] [MainThread]: Command end result
[0m21:32:33.373649 [info ] [MainThread]: 
[0m21:32:33.373983 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:32:33.374185 [info ] [MainThread]: 
[0m21:32:33.374444 [error] [MainThread]:   Database Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  Unrecognized name: oc at [28:35]
  compiled Code at target/run/manual_pasfield/models/marts/mart_customer_retention_metrics.sql
[0m21:32:33.374631 [info ] [MainThread]: 
[0m21:32:33.374825 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:32:33.376988 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.546265, "process_user_time": 3.904336, "process_kernel_time": 0.3838, "process_mem_max_rss": "209076224", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:32:33.377398 [debug] [MainThread]: Command `dbt run` failed at 21:32:33.377330 after 9.55 seconds
[0m21:32:33.377661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10050ab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d76bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d98f80>]}
[0m21:32:33.377889 [debug] [MainThread]: Flushing usage events
[0m21:33:17.060630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108436330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10872f1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10872ef60>]}


============================== 21:33:17.063284 | 366e43e2-3d1b-4faa-8239-ef34edf997a9 ==============================
[0m21:33:17.063284 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:33:17.063638 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:33:17.894421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d8a6480>]}
[0m21:33:17.918550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dc792e0>]}
[0m21:33:17.918883 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:33:17.941466 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:33:18.024357 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:33:18.024738 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.sql
[0m21:33:18.120685 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.referential
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
[0m21:33:18.126645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e2d3800>]}
[0m21:33:18.176118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13df52330>]}
[0m21:33:18.176403 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:33:18.176571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e1cecf0>]}
[0m21:33:18.177585 [info ] [MainThread]: 
[0m21:33:18.177881 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:33:18.179732 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:33:18.179967 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:33:18.577753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:33:18.579020 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:33:18.967416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e2a3620>]}
[0m21:33:18.968972 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:33:18.969795 [info ] [MainThread]: 
[0m21:33:18.974324 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:33:18.975144 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:33:18.976022 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:33:18.976647 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:33:18.988468 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:33:18.990016 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:33:19.019252 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:33:19.019950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:19.094183 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:33:19.634202 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0c2ed2c7-ea93-48f6-91fc-6fede11a05de&page=queryresults
[0m21:33:19.998099 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc1ee40>]}
[0m21:33:19.998884 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.02s]
[0m21:33:19.999506 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:33:19.999923 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:33:20.000438 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:33:20.000848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:33:20.001189 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:33:20.004304 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:33:20.006012 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:33:20.011342 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:33:20.011973 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:20.088898 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:33:20.734733 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a4390b5d-7f5c-4bf1-871b-b883f79f581a&page=queryresults
[0m21:33:21.002113 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e316360>]}
[0m21:33:21.003775 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m21:33:21.004877 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:33:21.006210 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:33:21.007289 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:33:21.008235 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:33:21.008871 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:33:21.076536 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:33:21.077136 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:33:21.078926 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:33:21.079304 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:21.147000 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:33:21.757410 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b7adc1fa-fe08-4e0f-8573-2dc42c63da58&page=queryresults
[0m21:33:21.970704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dc14bf0>]}
[0m21:33:21.971622 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m21:33:21.972435 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:33:21.973525 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:33:21.974294 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:33:21.974956 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:33:21.976210 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:33:21.987076 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:33:21.987728 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:33:21.989565 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:33:21.989938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:22.076924 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    left join acq_orders on customers.customer_id = acq_orders.customer_id
    left join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:33:22.886343 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:47fd4217-6021-4dc2-9330-44f1d6f10d85&page=queryresults
[0m21:33:23.085230 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e35acf0>]}
[0m21:33:23.086676 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.11s]
[0m21:33:23.087547 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:33:23.088604 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:33:23.089376 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:33:23.090000 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:33:23.090484 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:33:23.096206 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:33:23.097860 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:33:23.100768 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:33:23.101394 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:23.192211 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m21:33:24.010526 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:adbe39ab-7bf4-48ff-9208-920762a81ba7&page=queryresults
[0m21:33:24.325361 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '366e43e2-3d1b-4faa-8239-ef34edf997a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e168500>]}
[0m21:33:24.326784 [info ] [Thread-1 (]: 5 of 5 OK created sql view model manual_test.mart_customer_retention_metrics ... [[32mCREATE VIEW (0 processed)[0m in 1.24s]
[0m21:33:24.327871 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:33:24.329979 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:33:24.330637 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:33:24.331247 [info ] [MainThread]: 
[0m21:33:24.331675 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 6.15 seconds (6.15s).
[0m21:33:24.333232 [debug] [MainThread]: Command end result
[0m21:33:24.372794 [info ] [MainThread]: 
[0m21:33:24.373181 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:33:24.373412 [info ] [MainThread]: 
[0m21:33:24.373640 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:33:24.376093 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.3472004, "process_user_time": 3.777139, "process_kernel_time": 0.449123, "process_mem_max_rss": "205602816", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:33:24.376499 [debug] [MainThread]: Command `dbt run` succeeded at 21:33:24.376429 after 7.35 seconds
[0m21:33:24.376757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a26b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107870290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e201ac0>]}
[0m21:33:24.377006 [debug] [MainThread]: Flushing usage events
[0m21:34:10.673873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e961b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10445b170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10445ae10>]}


============================== 21:34:10.676607 | 387e2aa9-4a14-4419-b669-c7f4df28f2c2 ==============================
[0m21:34:10.676607 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:34:10.676922 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:34:11.634207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12751ec60>]}
[0m21:34:11.658081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1271a5400>]}
[0m21:34:11.658405 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:34:11.680641 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:34:11.764387 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:34:11.764756 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m21:34:11.867804 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.referential
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
[0m21:34:11.873885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127650a40>]}
[0m21:34:11.926711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1277e0200>]}
[0m21:34:11.927091 [info ] [MainThread]: Found 5 models, 3 sources, 854 macros
[0m21:34:11.927279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1276516d0>]}
[0m21:34:11.928298 [info ] [MainThread]: 
[0m21:34:11.928609 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:34:11.930706 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:34:11.930942 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:34:12.298613 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:34:12.299805 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:34:12.684216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1263b98b0>]}
[0m21:34:12.685254 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:34:12.685676 [info ] [MainThread]: 
[0m21:34:12.690541 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:34:12.691441 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:34:12.692356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:34:12.693425 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:34:12.701059 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:34:12.702423 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:34:12.733658 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:34:12.734411 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:12.813421 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:34:13.188647 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bde41261-37a3-4a89-9050-06297d259892&page=queryresults
[0m21:34:13.550527 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1263227b0>]}
[0m21:34:13.551378 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.86s]
[0m21:34:13.552111 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:34:13.552608 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:34:13.553254 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:34:13.553863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:34:13.554234 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:34:13.561811 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:34:13.562673 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:34:13.613429 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:34:13.615647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:13.681494 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:34:14.572696 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d09fcb7c-7659-4bf0-8e6b-7ffad5c9c4d6&page=queryresults
[0m21:34:14.896024 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b7ea80>]}
[0m21:34:14.896937 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.34s]
[0m21:34:14.897740 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:34:14.898312 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:34:14.899062 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:34:14.899783 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:34:14.900283 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:34:14.904815 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:34:14.905750 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:34:14.908652 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:34:14.909215 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:14.999244 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:34:15.347748 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:767b3123-5bc2-404b-8c19-3eec6a40406b&page=queryresults
[0m21:34:15.688525 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1275fe7e0>]}
[0m21:34:15.689944 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.79s]
[0m21:34:15.691230 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:34:15.692498 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:34:15.693315 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:34:15.694048 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:34:15.694652 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:34:15.701536 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:34:15.703083 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:34:15.705625 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:34:15.706140 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:15.797710 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:34:16.645215 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:50494cd8-e60a-4074-a87f-c4e330ef3296&page=queryresults
[0m21:34:16.887289 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279820f0>]}
[0m21:34:16.888240 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.19s]
[0m21:34:16.889044 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:34:16.890109 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:34:16.890867 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m21:34:16.891582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:34:16.892271 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:34:16.897375 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:34:16.899143 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:34:16.903573 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:34:16.904172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:16.990124 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m21:34:17.880465 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:16a29237-cfe3-4566-9cf3-4820ad5ced32&page=queryresults
[0m21:34:18.091293 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387e2aa9-4a14-4419-b669-c7f4df28f2c2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10443f440>]}
[0m21:34:18.092626 [info ] [Thread-1 (]: 5 of 5 OK created sql view model manual_test.mart_customer_retention_metrics ... [[32mCREATE VIEW (0 processed)[0m in 1.20s]
[0m21:34:18.093486 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:34:18.095724 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:34:18.096409 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:34:18.096929 [info ] [MainThread]: 
[0m21:34:18.097390 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 6.17 seconds (6.17s).
[0m21:34:18.099521 [debug] [MainThread]: Command end result
[0m21:34:18.142301 [info ] [MainThread]: 
[0m21:34:18.142698 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:34:18.142935 [info ] [MainThread]: 
[0m21:34:18.143193 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:34:18.145741 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.5143476, "process_user_time": 3.891122, "process_kernel_time": 0.376235, "process_mem_max_rss": "204210176", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:34:18.146183 [debug] [MainThread]: Command `dbt run` succeeded at 21:34:18.146110 after 7.51 seconds
[0m21:34:18.146454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041414c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1279cff50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b9d490>]}
[0m21:34:18.146708 [debug] [MainThread]: Flushing usage events
[0m21:39:41.259614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1020065d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10461ee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10461ec00>]}


============================== 21:39:41.262544 | 2ffc26fc-ae58-4d69-8a9b-832455e92601 ==============================
[0m21:39:41.262544 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:39:41.262858 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'send_anonymous_usage_stats': 'True'}
[0m21:39:42.089612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c47e480>]}
[0m21:39:42.113347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5572f0>]}
[0m21:39:42.113649 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:39:42.135166 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:39:42.221924 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m21:39:42.222266 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m21:39:42.319750 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m21:39:42.325763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cc5fa40>]}
[0m21:39:42.375300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c97a210>]}
[0m21:39:42.375587 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m21:39:42.375753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c13c4d0>]}
[0m21:39:42.376774 [info ] [MainThread]: 
[0m21:39:42.377064 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:39:42.378945 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:39:42.379170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:39:42.838185 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:39:42.838482 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:39:43.203573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c9c6930>]}
[0m21:39:43.204590 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:39:43.205767 [info ] [MainThread]: 
[0m21:39:43.210412 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:39:43.211189 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:39:43.212005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:39:43.212530 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:39:43.221781 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:39:43.222672 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:39:43.250221 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:39:43.250932 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:39:43.327777 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:39:43.750805 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:98332bb9-0341-4231-a7a2-03c4dc023228&page=queryresults
[0m21:39:44.148459 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c0a7530>]}
[0m21:39:44.149345 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.94s]
[0m21:39:44.149967 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:39:44.150386 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:39:44.150941 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:39:44.151447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:39:44.151816 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:39:44.155184 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:39:44.156321 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:39:44.161262 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:39:44.161937 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:39:44.241243 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:39:44.838692 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d565440a-0e31-4d52-8c36-cc831980053d&page=queryresults
[0m21:39:45.059718 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cca1ee0>]}
[0m21:39:45.061342 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m21:39:45.062674 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:39:45.063429 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:39:45.064361 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:39:45.065122 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:39:45.065660 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:39:45.131778 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:39:45.132367 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:39:45.134150 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:39:45.134531 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:39:45.202105 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:39:45.813295 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:57cbbca6-fec8-46a3-b8c1-7430749828be&page=queryresults
[0m21:39:46.077914 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1021a18e0>]}
[0m21:39:46.079255 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.01s]
[0m21:39:46.080886 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:39:46.082123 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:39:46.083128 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:39:46.083976 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:39:46.085573 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:39:46.095527 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:39:46.097208 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:39:46.100622 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:39:46.101490 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:39:46.188966 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:39:47.002301 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8922158a-3147-40d8-8595-d5114239e494&page=queryresults
[0m21:39:47.360335 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c8eacc0>]}
[0m21:39:47.361652 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.28s]
[0m21:39:47.363047 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:39:47.364179 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:39:47.364978 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_cohort_retention_analysis ......... [RUN]
[0m21:39:47.365762 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:39:47.366357 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:39:47.372406 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:39:47.374301 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:39:47.377391 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:39:47.378268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:39:47.469313 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
  OPTIONS()
  as -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        safe_divide(retained_1_month, total_customers) * 100 as retention_rate_1_month,
        safe_divide(retained_3_months, total_customers) * 100 as retention_rate_3_months,
        safe_divide(retained_6_months, total_customers) * 100 as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month;;


[0m21:39:47.743358 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:55b16335-386f-48e9-b933-c0392e97a20d&page=queryresults
[0m21:39:47.745116 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ";" at [52:23]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ";" at [52:23]')
[0m21:39:48.566488 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f0271dfb-acc0-4b07-99d4-71a0fdb0444e&page=queryresults
[0m21:39:48.568573 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f0271dfb-acc0-4b07-99d4-71a0fdb0444e&page=queryresults
[0m21:39:48.584746 [debug] [Thread-1 (]: Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Syntax error: Unexpected ";" at [52:23]
  compiled Code at target/run/manual_pasfield/models/marts/mart_cohort_retention_analysis.sql
[0m21:39:48.585483 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ffc26fc-ae58-4d69-8a9b-832455e92601', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c3cbf80>]}
[0m21:39:48.586206 [error] [Thread-1 (]: 5 of 5 ERROR creating sql view model manual_test.mart_cohort_retention_analysis  [[31mERROR[0m in 1.22s]
[0m21:39:48.586856 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:39:48.588358 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:39:48.588748 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m21:39:48.589160 [info ] [MainThread]: 
[0m21:39:48.589514 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 6.21 seconds (6.21s).
[0m21:39:48.590907 [debug] [MainThread]: Command end result
[0m21:39:48.629464 [info ] [MainThread]: 
[0m21:39:48.629804 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:39:48.630005 [info ] [MainThread]: 
[0m21:39:48.630253 [error] [MainThread]:   Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Syntax error: Unexpected ";" at [52:23]
  compiled Code at target/run/manual_pasfield/models/marts/mart_cohort_retention_analysis.sql
[0m21:39:48.630445 [info ] [MainThread]: 
[0m21:39:48.630630 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:39:48.632764 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.4143305, "process_user_time": 3.853232, "process_kernel_time": 0.353474, "process_mem_max_rss": "208945152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:39:48.633165 [debug] [MainThread]: Command `dbt run` failed at 21:39:48.633096 after 7.41 seconds
[0m21:39:48.633419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100916b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104074fb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104074620>]}
[0m21:39:48.633648 [debug] [MainThread]: Flushing usage events
[0m21:41:45.700033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f6f380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111627050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111626d20>]}


============================== 21:41:45.702664 | a01ddb17-9a9d-41c8-b815-a4a28c970587 ==============================
[0m21:41:45.702664 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:41:45.702978 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:41:46.496479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130966d50>]}
[0m21:41:46.520403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075e4f50>]}
[0m21:41:46.520702 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:41:46.543244 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:41:46.621950 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:41:46.622319 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m21:41:46.720042 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.referential
- models.manual-pasfield.preparatory
[0m21:41:46.726201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137cdfda0>]}
[0m21:41:46.776351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1378b3260>]}
[0m21:41:46.776662 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m21:41:46.776831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137cda3c0>]}
[0m21:41:46.777850 [info ] [MainThread]: 
[0m21:41:46.778132 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:41:46.780041 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:41:46.780258 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:41:47.122109 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:41:47.123321 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:41:47.471743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072b1a30>]}
[0m21:41:47.472603 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:41:47.473063 [info ] [MainThread]: 
[0m21:41:47.477230 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:41:47.478017 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:41:47.478822 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:41:47.479475 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:41:47.488184 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:41:47.488792 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:41:47.514489 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:41:47.515210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:41:47.591399 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:41:48.191374 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cf8c8e2b-1306-4244-97f6-aaabd66840ba&page=queryresults
[0m21:41:48.439672 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131c1f0e0>]}
[0m21:41:48.440484 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m21:41:48.441095 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:41:48.441496 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:41:48.442033 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:41:48.442515 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:41:48.442865 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:41:48.446046 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:41:48.446934 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:41:48.461733 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:41:48.462351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:41:48.537782 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:41:49.157000 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:625769b1-12f0-4f87-a9b0-6ca74befb830&page=queryresults
[0m21:41:49.400640 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d1e090>]}
[0m21:41:49.401635 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.96s]
[0m21:41:49.402457 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:41:49.403020 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:41:49.403806 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:41:49.404511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:41:49.405056 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:41:49.468607 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:41:49.469187 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:41:49.470971 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:41:49.471319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:41:49.538208 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:41:50.120825 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:949b84ac-e6de-4e5e-9048-b180f13b7297&page=queryresults
[0m21:41:50.401510 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137644a70>]}
[0m21:41:50.402985 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m21:41:50.404022 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:41:50.405547 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:41:50.406537 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:41:50.407336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:41:50.407824 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:41:50.418106 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:41:50.418703 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:41:50.420526 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:41:50.420875 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:41:50.511358 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:41:51.406335 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c778a6eb-7dd9-40b1-9700-960d8d5faf25&page=queryresults
[0m21:41:51.642918 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d76990>]}
[0m21:41:51.644160 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.24s]
[0m21:41:51.645015 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:41:51.646568 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:41:51.647599 [info ] [Thread-1 (]: 5 of 5 START sql view model manual_test.mart_cohort_retention_analysis ......... [RUN]
[0m21:41:51.648298 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:41:51.648809 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:41:51.654739 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:41:51.655614 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:41:51.657931 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:41:51.658405 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:41:51.750483 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
  OPTIONS()
  as -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        safe_divide(retained_1_month, total_customers) * 100 as retention_rate_1_month,
        safe_divide(retained_3_months, total_customers) * 100 as retention_rate_3_months,
        safe_divide(retained_6_months, total_customers) * 100 as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month;


[0m21:41:52.531850 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d07d9eb7-0ac8-44f3-b439-fa12e2a5af6f&page=queryresults
[0m21:41:52.783983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a01ddb17-9a9d-41c8-b815-a4a28c970587', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d9a7e0>]}
[0m21:41:52.785040 [info ] [Thread-1 (]: 5 of 5 OK created sql view model manual_test.mart_cohort_retention_analysis .... [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m21:41:52.785857 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:41:52.787333 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:41:52.787739 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m21:41:52.788218 [info ] [MainThread]: 
[0m21:41:52.788641 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 6.01 seconds (6.01s).
[0m21:41:52.790237 [debug] [MainThread]: Command end result
[0m21:41:52.830385 [info ] [MainThread]: 
[0m21:41:52.830776 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:41:52.831012 [info ] [MainThread]: 
[0m21:41:52.831245 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:41:52.833767 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.1642723, "process_user_time": 3.834081, "process_kernel_time": 0.383274, "process_mem_max_rss": "208699392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:41:52.834167 [debug] [MainThread]: Command `dbt run` succeeded at 21:41:52.834100 after 7.16 seconds
[0m21:41:52.834410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137d541d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111323f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f6f380>]}
[0m21:41:52.834642 [debug] [MainThread]: Flushing usage events
[0m21:43:29.871436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a085eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a226fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a226d80>]}


============================== 21:43:29.874064 | 8326fc3e-bdb7-4768-a819-b0f3e97c5b46 ==============================
[0m21:43:29.874064 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:43:29.874383 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:43:30.736938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15622e480>]}
[0m21:43:30.760697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7a9b50>]}
[0m21:43:30.761009 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:43:30.783085 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:43:30.866881 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m21:43:30.867236 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m21:43:30.942793 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m21:43:30.948903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1569cfec0>]}
[0m21:43:30.998851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1567644a0>]}
[0m21:43:30.999135 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m21:43:30.999306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156623740>]}
[0m21:43:31.000312 [info ] [MainThread]: 
[0m21:43:31.000600 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:43:31.002478 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:43:31.002688 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:43:31.343860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:43:31.345950 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:43:31.715758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c45dc0>]}
[0m21:43:31.716977 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:43:31.717564 [info ] [MainThread]: 
[0m21:43:31.721712 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:43:31.722499 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m21:43:31.723234 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:43:31.723959 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:43:31.731459 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:43:31.732396 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:43:31.759022 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:43:31.759819 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:43:31.836814 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m21:43:32.376344 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f73238a0-10fe-47e2-9df7-c887107992a9&page=queryresults
[0m21:43:32.638567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1554226f0>]}
[0m21:43:32.639161 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m21:43:32.639635 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:43:32.639954 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:43:32.640375 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m21:43:32.640830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:43:32.641166 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:43:32.643775 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:43:32.644401 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:43:32.695520 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:43:32.696109 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:43:32.763805 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m21:43:33.153338 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:80ef62bb-aa15-4079-a803-16846c0ce07c&page=queryresults
[0m21:43:33.489676 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156913380>]}
[0m21:43:33.490683 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.85s]
[0m21:43:33.491417 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:43:33.491904 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:43:33.492535 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m21:43:33.493140 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:43:33.493627 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:43:33.498062 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:43:33.498966 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:43:33.501900 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:43:33.502404 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:43:33.585045 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m21:43:34.008635 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:af613c1f-ab3c-4501-a6c5-1f559727faa9&page=queryresults
[0m21:43:34.391780 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a255ee0>]}
[0m21:43:34.393173 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.90s]
[0m21:43:34.394913 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:43:34.395999 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:43:34.396917 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:43:34.397750 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:43:34.398271 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:43:34.412101 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:43:34.414273 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:43:34.417832 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:43:34.418631 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:43:34.504390 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:43:35.140509 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9ab860d2-b753-4c36-9452-2ba06780aba8&page=queryresults
[0m21:43:35.378623 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a208230>]}
[0m21:43:35.379699 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.98s]
[0m21:43:35.380592 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:43:35.382066 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:43:35.382833 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m21:43:35.383161 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:43:35.383418 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:43:35.387884 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:43:35.389576 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:43:35.401575 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:43:35.887171 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:43:35.888447 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        safe_divide(retained_1_month, total_customers) * 100 as retention_rate_1_month,
        safe_divide(retained_3_months, total_customers) * 100 as retention_rate_3_months,
        safe_divide(retained_6_months, total_customers) * 100 as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m21:43:36.351905 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:434a44cf-d4c2-43c8-9c64-64aa28020836&page=queryresults
[0m21:43:48.397132 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8326fc3e-bdb7-4768-a819-b0f3e97c5b46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156716000>]}
[0m21:43:48.399245 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test.mart_cohort_retention_analysis ... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 13.01s]
[0m21:43:48.400137 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:43:48.401696 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:43:48.402101 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m21:43:48.402586 [info ] [MainThread]: 
[0m21:43:48.403012 [info ] [MainThread]: Finished running 4 view models, 1 table model in 0 hours 0 minutes and 17.40 seconds (17.40s).
[0m21:43:48.404632 [debug] [MainThread]: Command end result
[0m21:43:48.443386 [info ] [MainThread]: 
[0m21:43:48.443763 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:43:48.443999 [info ] [MainThread]: 
[0m21:43:48.444228 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:43:48.446674 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 18.607338, "process_user_time": 3.878291, "process_kernel_time": 0.366016, "process_mem_max_rss": "206651392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:43:48.447135 [debug] [MainThread]: Command `dbt run` succeeded at 21:43:48.447057 after 18.61 seconds
[0m21:43:48.447417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1569b1dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15632a930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1564ca5d0>]}
[0m21:43:48.447679 [debug] [MainThread]: Flushing usage events
[0m22:03:50.160718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101a4b2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104996f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104996cf0>]}


============================== 22:03:50.163348 | 5404f0fb-2574-443d-8633-b5fb031c8352 ==============================
[0m22:03:50.163348 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:03:50.163658 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'send_anonymous_usage_stats': 'True'}
[0m22:03:51.016785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10494f2f0>]}
[0m22:03:51.040722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1415b7bc0>]}
[0m22:03:51.041054 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:03:51.062230 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m22:03:51.147136 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:03:51.147505 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m22:03:51.273793 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.marts
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
[0m22:03:51.279866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142551ca0>]}
[0m22:03:51.373912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142aece00>]}
[0m22:03:51.374197 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m22:03:51.374364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10586be60>]}
[0m22:03:51.375402 [info ] [MainThread]: 
[0m22:03:51.375680 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:03:51.377531 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m22:03:51.377730 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:03:51.775060 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m22:03:51.775720 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:03:52.124887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104750260>]}
[0m22:03:52.126179 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m22:03:52.126809 [info ] [MainThread]: 
[0m22:03:52.131387 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m22:03:52.132322 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m22:03:52.133008 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m22:03:52.133775 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m22:03:52.143543 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m22:03:52.144549 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m22:03:52.172496 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m22:03:52.173204 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:03:52.249465 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m22:03:52.845595 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:086a68bc-7a9c-4362-a3f6-57df5fb20d39&page=queryresults
[0m22:03:53.253906 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14141e480>]}
[0m22:03:53.254808 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.12s]
[0m22:03:53.255444 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m22:03:53.255878 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m22:03:53.256446 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m22:03:53.256958 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m22:03:53.257329 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m22:03:53.260888 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m22:03:53.261766 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m22:03:53.267158 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m22:03:53.267968 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:03:53.346316 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m22:03:53.905030 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d1f38f6f-3af7-4156-9862-1bf48f612ef9&page=queryresults
[0m22:03:54.270099 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142414980>]}
[0m22:03:54.270789 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.01s]
[0m22:03:54.271369 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m22:03:54.271758 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m22:03:54.272282 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m22:03:54.272775 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m22:03:54.273137 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m22:03:54.276976 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m22:03:54.277649 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m22:03:54.280435 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m22:03:54.280991 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:03:54.360654 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m22:03:54.781562 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8126dc1a-f188-4a43-96b2-22edc72273af&page=queryresults
[0m22:03:55.141585 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142865160>]}
[0m22:03:55.142891 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.87s]
[0m22:03:55.143921 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m22:03:55.145589 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m22:03:55.146343 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m22:03:55.146987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m22:03:55.147458 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m22:03:55.161671 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m22:03:55.163831 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m22:03:55.167737 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m22:03:55.168669 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:03:55.254570 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m22:03:56.040499 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9cb0d7fa-d918-4071-96fc-a0d069bb9e5b&page=queryresults
[0m22:03:56.294929 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142a71670>]}
[0m22:03:56.296371 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m22:03:56.297646 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m22:03:56.298893 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:03:56.299621 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m22:03:56.300263 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m22:03:56.300745 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:03:56.306755 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m22:03:56.309396 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:03:56.321303 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:03:56.690437 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m22:03:56.691698 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round_val((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round_val((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round_val((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m22:03:57.472444 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6e05fca9-1f25-416a-96f1-cbc383996a08&page=queryresults
[0m22:03:57.567247 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Function not found: round_val at [50:9]; reason: invalidQuery, location: query, message: Function not found: round_val at [50:9]')
[0m22:03:59.123858 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1d323f88-00dd-4879-b293-6cfa2f581042&page=queryresults
[0m22:03:59.239499 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1d323f88-00dd-4879-b293-6cfa2f581042&page=queryresults
[0m22:03:59.254931 [debug] [Thread-1 (]: Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Function not found: round_val at [50:9]
  compiled Code at target/run/manual_pasfield/models/marts/mart_cohort_retention_analysis.sql
[0m22:03:59.255427 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5404f0fb-2574-443d-8633-b5fb031c8352', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142a41730>]}
[0m22:03:59.255913 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test.mart_cohort_retention_analysis  [[31mERROR[0m in 2.96s]
[0m22:03:59.256353 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:03:59.257397 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:03:59.257613 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m22:03:59.257868 [info ] [MainThread]: 
[0m22:03:59.258089 [info ] [MainThread]: Finished running 4 view models, 1 table model in 0 hours 0 minutes and 7.88 seconds (7.88s).
[0m22:03:59.258918 [debug] [MainThread]: Command end result
[0m22:03:59.297831 [info ] [MainThread]: 
[0m22:03:59.298169 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:03:59.298416 [info ] [MainThread]: 
[0m22:03:59.298750 [error] [MainThread]:   Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Function not found: round_val at [50:9]
  compiled Code at target/run/manual_pasfield/models/marts/mart_cohort_retention_analysis.sql
[0m22:03:59.298978 [info ] [MainThread]: 
[0m22:03:59.299189 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m22:03:59.301378 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.173516, "process_user_time": 3.864275, "process_kernel_time": 0.38914, "process_mem_max_rss": "209813504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:03:59.301756 [debug] [MainThread]: Command `dbt run` failed at 22:03:59.301692 after 9.17 seconds
[0m22:03:59.302006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044b7740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142a3e900>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101a4b2c0>]}
[0m22:03:59.302232 [debug] [MainThread]: Flushing usage events
[0m22:04:15.033759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a13e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108446f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081961e0>]}


============================== 22:04:15.036544 | 79b45922-02c8-47da-bba8-2960da45c5f4 ==============================
[0m22:04:15.036544 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:04:15.036860 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/dbt/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'send_anonymous_usage_stats': 'True'}
[0m22:04:15.827112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c496480>]}
[0m22:04:15.850849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f67950>]}
[0m22:04:15.851146 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:04:15.873696 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m22:04:15.949660 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:04:15.950064 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m22:04:16.074385 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m22:04:16.080392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c561a60>]}
[0m22:04:16.170882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ccec4d0>]}
[0m22:04:16.171165 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m22:04:16.171332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e9770b0>]}
[0m22:04:16.172367 [info ] [MainThread]: 
[0m22:04:16.172662 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:04:16.174510 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m22:04:16.174706 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:04:16.521545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m22:04:16.522564 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:04:16.891107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083e23f0>]}
[0m22:04:16.891946 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m22:04:16.892401 [info ] [MainThread]: 
[0m22:04:16.896180 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m22:04:16.896867 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m22:04:16.897680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m22:04:16.898266 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m22:04:16.909133 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m22:04:16.910143 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m22:04:16.938661 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m22:04:16.939375 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:17.013168 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m22:04:17.439036 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:330a8a56-560a-4078-8d80-a647de948d9d&page=queryresults
[0m22:04:18.122054 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e61fd10>]}
[0m22:04:18.122948 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m22:04:18.123614 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m22:04:18.124017 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m22:04:18.124555 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m22:04:18.125051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m22:04:18.125411 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m22:04:18.128850 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m22:04:18.129961 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m22:04:18.135061 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m22:04:18.135543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:18.211238 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m22:04:18.737424 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9143f3e5-95e3-4001-91b6-c63a1e322041&page=queryresults
[0m22:04:19.035661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cb97c50>]}
[0m22:04:19.036880 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m22:04:19.037773 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m22:04:19.038336 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m22:04:19.039062 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m22:04:19.039755 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m22:04:19.040250 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m22:04:19.046112 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m22:04:19.047217 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m22:04:19.051038 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m22:04:19.051753 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:19.142832 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m22:04:19.648407 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a67fcd17-4825-47e2-8082-f67b652bf5a1&page=queryresults
[0m22:04:19.965198 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092fede0>]}
[0m22:04:19.966826 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 0.93s]
[0m22:04:19.968010 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m22:04:19.969055 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m22:04:19.969934 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m22:04:19.970699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m22:04:19.971235 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m22:04:19.983743 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m22:04:19.984637 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m22:04:19.986980 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m22:04:19.987421 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:20.074011 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m22:04:20.822345 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4c987f52-e446-44d9-95ab-4ba633084baa&page=queryresults
[0m22:04:21.153633 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc691c0>]}
[0m22:04:21.155129 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.18s]
[0m22:04:21.156005 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m22:04:21.157003 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:04:21.157777 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m22:04:21.158538 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m22:04:21.159065 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:04:21.165253 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m22:04:21.166817 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:04:21.175049 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:04:21.561473 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m22:04:21.562793 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m22:04:22.675993 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a51d4a17-a1a9-4e89-82ef-27c98bb9ca97&page=queryresults
[0m22:04:34.745959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79b45922-02c8-47da-bba8-2960da45c5f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cc710d0>]}
[0m22:04:34.748404 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test.mart_cohort_retention_analysis ... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 13.59s]
[0m22:04:34.750049 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m22:04:34.751800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:04:34.752338 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m22:04:34.752876 [info ] [MainThread]: 
[0m22:04:34.753327 [info ] [MainThread]: Finished running 4 view models, 1 table model in 0 hours 0 minutes and 18.58 seconds (18.58s).
[0m22:04:34.754976 [debug] [MainThread]: Command end result
[0m22:04:34.797225 [info ] [MainThread]: 
[0m22:04:34.797602 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:04:34.797847 [info ] [MainThread]: 
[0m22:04:34.798080 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m22:04:34.800509 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 19.799536, "process_user_time": 3.921224, "process_kernel_time": 0.346513, "process_mem_max_rss": "207863808", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:04:34.800958 [debug] [MainThread]: Command `dbt run` succeeded at 22:04:34.800883 after 19.80 seconds
[0m22:04:34.801237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e2d5520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d51730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108446f60>]}
[0m22:04:34.801490 [debug] [MainThread]: Flushing usage events
[0m10:44:44.238182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111586150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111727110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111726ed0>]}


============================== 10:44:44.240996 | 79f7eb2c-bbf6-4285-bb24-47beb4e516ba ==============================
[0m10:44:44.240996 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:44:44.241322 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:44:45.561828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d706150>]}
[0m10:44:45.585676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bfb92b0>]}
[0m10:44:45.585999 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:44:45.634778 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:44:45.717002 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:44:45.717246 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:44:45.719768 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.marts
- models.manual-pasfield.referential
[0m10:44:45.733928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14da29d90>]}
[0m10:44:45.784469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14de6cbc0>]}
[0m10:44:45.784759 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m10:44:45.784927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dd1ed50>]}
[0m10:44:45.785942 [info ] [MainThread]: 
[0m10:44:45.786231 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:44:45.788081 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m10:44:45.788274 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:44:47.249745 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m10:44:47.250985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:44:47.966958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dd55880>]}
[0m10:44:47.967570 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:44:47.967900 [info ] [MainThread]: 
[0m10:44:47.970442 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:44:47.970929 [info ] [Thread-1 (]: 1 of 5 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m10:44:47.971335 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:44:47.971649 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:44:47.981089 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:44:47.981953 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:44:48.004686 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m10:44:48.005300 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:44:48.075041 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m10:44:48.919077 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:eb4417da-59b2-4bb0-a6e0-815d80626b41&page=queryresults
[0m10:44:49.295903 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d31e150>]}
[0m10:44:49.296739 [info ] [Thread-1 (]: 1 of 5 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m10:44:49.297371 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:44:49.297826 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:44:49.298404 [info ] [Thread-1 (]: 2 of 5 START sql view model manual_test.ref_activity ........................... [RUN]
[0m10:44:49.298923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:44:49.299295 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:44:49.302624 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:44:49.303691 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:44:49.308766 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m10:44:49.309406 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:44:49.388482 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m10:44:50.218639 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:67e7352a-0e80-408a-840f-4dbefbd5d726&page=queryresults
[0m10:44:50.561303 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e896240>]}
[0m10:44:50.561721 [info ] [Thread-1 (]: 2 of 5 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.26s]
[0m10:44:50.562068 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:44:50.562287 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:44:50.562507 [info ] [Thread-1 (]: 3 of 5 START sql view model manual_test.ref_customers .......................... [RUN]
[0m10:44:50.562787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:44:50.563033 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:44:50.565256 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:44:50.565886 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:44:50.567745 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m10:44:50.568438 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:44:50.637378 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m10:44:51.506709 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8227de4c-3dfa-4917-a340-2a877b2e27db&page=queryresults
[0m10:44:52.013440 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e8b5280>]}
[0m10:44:52.014723 [info ] [Thread-1 (]: 3 of 5 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.45s]
[0m10:44:52.015619 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:44:52.016735 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:44:52.017365 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m10:44:52.017929 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:44:52.018408 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:44:52.033906 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:44:52.035980 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:44:52.039398 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m10:44:52.040099 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:44:52.125181 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m10:44:54.260641 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:df0899d3-eed7-42b3-8940-5fdee5b700b3&page=queryresults
[0m10:44:54.557553 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e968230>]}
[0m10:44:54.558901 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 2.54s]
[0m10:44:54.560051 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:44:54.561077 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:44:54.561828 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m10:44:54.562546 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m10:44:54.563065 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:44:54.569059 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:44:54.570110 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:44:54.583929 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:44:55.208924 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:44:55.210318 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m10:44:56.070556 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a4342c9e-4d4e-4b34-bdc8-9e77b9b46987&page=queryresults
[0m10:45:09.305093 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '79f7eb2c-bbf6-4285-bb24-47beb4e516ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e98daf0>]}
[0m10:45:09.305735 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test.mart_cohort_retention_analysis ... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 14.74s]
[0m10:45:09.306089 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:45:09.306782 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:45:09.307001 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m10:45:09.307232 [info ] [MainThread]: 
[0m10:45:09.307426 [info ] [MainThread]: Finished running 4 view models, 1 table model in 0 hours 0 minutes and 23.52 seconds (23.52s).
[0m10:45:09.308113 [debug] [MainThread]: Command end result
[0m10:45:09.379463 [info ] [MainThread]: 
[0m10:45:09.379786 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:45:09.379957 [info ] [MainThread]: 
[0m10:45:09.380112 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m10:45:09.381923 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.178663, "process_user_time": 3.85115, "process_kernel_time": 0.432508, "process_mem_max_rss": "203046912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:45:09.382377 [debug] [MainThread]: Command `dbt run` succeeded at 10:45:09.382305 after 25.18 seconds
[0m10:45:09.382613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c921ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107162f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046e6b40>]}
[0m10:45:09.382905 [debug] [MainThread]: Flushing usage events
[0m10:45:15.932649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b82600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108deaab0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dea750>]}


============================== 10:45:15.935155 | 017e3927-8bed-4b68-b364-4f5d95a6cdb1 ==============================
[0m10:45:15.935155 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:45:15.935463 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt clean', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:45:16.009242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '017e3927-8bed-4b68-b364-4f5d95a6cdb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108da5f70>]}
[0m10:45:16.015806 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
        The default package install path has changed from `dbt_modules` to
`dbt_packages`.         Please update `clean-targets` in `dbt_project.yml` and
check `.gitignore` as well.         Or, set `packages-install-path: dbt_modules`
if you'd like to keep the current value.
[0m10:45:16.016030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '017e3927-8bed-4b68-b364-4f5d95a6cdb1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f29e50>]}
[0m10:45:16.021453 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.11867338, "process_user_time": 0.650192, "process_kernel_time": 0.098586, "process_mem_max_rss": "94011392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:45:16.021785 [debug] [MainThread]: Command `dbt clean` succeeded at 10:45:16.021732 after 0.12 seconds
[0m10:45:16.021970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10512ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b3aa80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e1ab40>]}
[0m10:45:16.022146 [debug] [MainThread]: Flushing usage events
[0m10:45:22.901367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065ad4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b56f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b56c90>]}


============================== 10:45:22.903853 | a6d6584f-91f5-48cf-aea9-b29a97d96b2e ==============================
[0m10:45:22.903853 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:45:22.904166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:45:23.709169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1363e6d50>]}
[0m10:45:23.733164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1366d0830>]}
[0m10:45:23.733484 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:45:23.755738 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:45:23.756351 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:45:23.756557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a06db0>]}
[0m10:45:24.607745 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m10:45:24.654446 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.manual-pasfield.preparatory
- models.manual-pasfield.referential
- models.manual-pasfield.marts
[0m10:45:24.659802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137236ba0>]}
[0m10:45:24.709334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137258080>]}
[0m10:45:24.709618 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m10:45:24.709783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137029220>]}
[0m10:45:24.710679 [info ] [MainThread]: 
[0m10:45:24.710948 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:45:24.712827 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m10:45:24.713022 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:45:25.405651 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m10:45:25.405986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:45:26.074900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13702a510>]}
[0m10:45:26.076145 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:45:26.076658 [info ] [MainThread]: 
[0m10:45:26.081583 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:45:26.082496 [info ] [Thread-1 (]: 1 of 6 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m10:45:26.083508 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:45:26.084175 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:45:26.095207 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:45:26.096992 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:45:26.125011 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m10:45:26.126080 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:26.201236 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m10:45:26.987240 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a0988a4f-ebdb-49f4-89f0-fb02d0133c95&page=queryresults
[0m10:45:27.430996 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13621e420>]}
[0m10:45:27.431727 [info ] [Thread-1 (]: 1 of 6 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.35s]
[0m10:45:27.432279 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:45:27.432630 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:45:27.433110 [info ] [Thread-1 (]: 2 of 6 START sql view model manual_test.ref_activity ........................... [RUN]
[0m10:45:27.433551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:45:27.433893 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:45:27.438838 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:45:27.439635 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:45:27.442385 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m10:45:27.442880 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:27.521005 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m10:45:28.324113 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7ef636e2-362c-4266-96f3-6120d793345f&page=queryresults
[0m10:45:28.888486 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1373c4ef0>]}
[0m10:45:28.889477 [info ] [Thread-1 (]: 2 of 6 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.45s]
[0m10:45:28.890318 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:45:28.890901 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:45:28.891662 [info ] [Thread-1 (]: 3 of 6 START sql view model manual_test.ref_customers .......................... [RUN]
[0m10:45:28.892398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:45:28.892915 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:45:28.898047 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:45:28.899598 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:45:28.903493 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m10:45:28.904342 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:28.991664 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m10:45:29.939075 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1c84e232-2b93-4787-875a-9e0cb1aeb78a&page=queryresults
[0m10:45:30.228992 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1373cf110>]}
[0m10:45:30.230727 [info ] [Thread-1 (]: 3 of 6 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.34s]
[0m10:45:30.231926 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:45:30.233260 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:45:30.234023 [info ] [Thread-1 (]: 4 of 6 START sql view model manual_test.prep_customer .......................... [RUN]
[0m10:45:30.234794 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:45:30.235324 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:45:30.242660 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:45:30.243747 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:45:30.246787 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m10:45:30.247728 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:30.338747 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m10:45:31.902932 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4863e82b-928e-42ef-b883-2b34d8b106db&page=queryresults
[0m10:45:32.552894 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137461430>]}
[0m10:45:32.553307 [info ] [Thread-1 (]: 4 of 6 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 2.32s]
[0m10:45:32.553635 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:45:32.554046 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:45:32.554344 [info ] [Thread-1 (]: 5 of 6 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m10:45:32.554605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m10:45:32.554862 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:45:32.558068 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:45:32.558736 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:45:32.565126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:33.264410 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:45:33.265998 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m10:45:33.981446 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b25f224f-a750-4736-9ef9-e8956fd795e9&page=queryresults
[0m10:45:48.094677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137463350>]}
[0m10:45:48.097633 [info ] [Thread-1 (]: 5 of 6 OK created sql table model manual_test.mart_cohort_retention_analysis ... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 15.54s]
[0m10:45:48.098788 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:45:48.099645 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:45:48.100656 [info ] [Thread-1 (]: 6 of 6 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m10:45:48.101511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_retention_metrics)
[0m10:45:48.102055 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m10:45:48.109287 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:45:48.110909 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m10:45:48.115744 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:45:48.116894 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:45:48.205140 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m10:45:50.105262 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ce46fd4b-a00f-4797-a801-b2ce8b86d0c6&page=queryresults
[0m10:45:50.552876 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6d6584f-91f5-48cf-aea9-b29a97d96b2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1373c1eb0>]}
[0m10:45:50.554522 [info ] [Thread-1 (]: 6 of 6 OK created sql view model manual_test.mart_customer_retention_metrics ... [[32mCREATE VIEW (0 processed)[0m in 2.45s]
[0m10:45:50.555913 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:45:50.558093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:45:50.558553 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m10:45:50.559107 [info ] [MainThread]: 
[0m10:45:50.559557 [info ] [MainThread]: Finished running 5 view models, 1 table model in 0 hours 0 minutes and 25.85 seconds (25.85s).
[0m10:45:50.561874 [debug] [MainThread]: Command end result
[0m10:45:50.605775 [info ] [MainThread]: 
[0m10:45:50.606165 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:45:50.606412 [info ] [MainThread]: 
[0m10:45:50.606646 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m10:45:50.609025 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.73781, "process_user_time": 4.690296, "process_kernel_time": 0.366201, "process_mem_max_rss": "209305600", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:45:50.609442 [debug] [MainThread]: Command `dbt run` succeeded at 10:45:50.609375 after 27.74 seconds
[0m10:45:50.609690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106584620>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065ad3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065aca10>]}
[0m10:45:50.609924 [debug] [MainThread]: Flushing usage events
[0m10:46:57.767590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103466570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f3af30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f3ac00>]}


============================== 10:46:57.770390 | 84ec9428-7000-4ab0-880d-8f21476a5ec2 ==============================
[0m10:46:57.770390 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:46:57.770713 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:46:58.602276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132729730>]}
[0m10:46:58.626264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1379b0440>]}
[0m10:46:58.626569 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:46:58.649495 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:46:58.690977 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m10:46:58.691284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034cd1f0>]}
[0m10:46:59.538564 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m10:46:59.584780 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.referential
- models.marts
- models.preparatory
[0m10:46:59.590178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e57320>]}
[0m10:46:59.639153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14004b020>]}
[0m10:46:59.639430 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m10:46:59.639598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137bf3e00>]}
[0m10:46:59.640499 [info ] [MainThread]: 
[0m10:46:59.640781 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:46:59.642639 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m10:46:59.642831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:47:00.242079 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m10:47:00.243432 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:47:01.547472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137da36e0>]}
[0m10:47:01.548802 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:47:01.549437 [info ] [MainThread]: 
[0m10:47:01.553958 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:47:01.554707 [info ] [Thread-1 (]: 1 of 6 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m10:47:01.555440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:47:01.556072 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:47:01.565915 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:47:01.566687 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:47:01.593750 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m10:47:01.594461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:01.670391 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m10:47:02.924774 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d19eb700-6571-479b-8311-10e6155b3636&page=queryresults
[0m10:47:03.376225 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130822510>]}
[0m10:47:03.376901 [info ] [Thread-1 (]: 1 of 6 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.82s]
[0m10:47:03.377400 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:47:03.377730 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:47:03.378140 [info ] [Thread-1 (]: 2 of 6 START sql view model manual_test.ref_activity ........................... [RUN]
[0m10:47:03.378544 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:47:03.378852 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:47:03.381633 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:47:03.382232 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:47:03.384994 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m10:47:03.385661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:03.459459 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m10:47:04.373820 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9bfa6062-15b1-47ec-9abc-9aea8f2d2358&page=queryresults
[0m10:47:04.702257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14002ab40>]}
[0m10:47:04.703802 [info ] [Thread-1 (]: 2 of 6 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m10:47:04.704748 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:47:04.705372 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:47:04.706149 [info ] [Thread-1 (]: 3 of 6 START sql view model manual_test.ref_customers .......................... [RUN]
[0m10:47:04.706934 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:47:04.707454 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:47:04.713167 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:47:04.714315 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:47:04.718483 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m10:47:04.720062 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:04.808375 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m10:47:05.562759 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:379c3645-7215-4141-a43f-66e33b168916&page=queryresults
[0m10:47:05.875211 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14019f1d0>]}
[0m10:47:05.876558 [info ] [Thread-1 (]: 3 of 6 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.17s]
[0m10:47:05.877575 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:47:05.878494 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:47:05.879326 [info ] [Thread-1 (]: 4 of 6 START sql view model manual_test.prep_customer .......................... [RUN]
[0m10:47:05.880134 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:47:05.880619 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:47:05.887935 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:47:05.888579 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:47:05.892424 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m10:47:05.893180 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:05.981369 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m10:47:07.009413 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8b0419d8-5490-4731-a9f6-96bcba2c0043&page=queryresults
[0m10:47:07.382454 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14019dd00>]}
[0m10:47:07.382931 [info ] [Thread-1 (]: 4 of 6 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.50s]
[0m10:47:07.383320 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:47:07.383837 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:07.384201 [info ] [Thread-1 (]: 5 of 6 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m10:47:07.384472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m10:47:07.384689 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:07.387052 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:47:07.388074 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:07.395379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:08.057275 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:47:08.058557 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m10:47:08.772021 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:26dba7f2-5168-4607-8b41-cf61e6acecda&page=queryresults
[0m10:47:21.690624 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14003c650>]}
[0m10:47:21.691920 [info ] [Thread-1 (]: 5 of 6 OK created sql table model manual_test.mart_cohort_retention_analysis ... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 14.31s]
[0m10:47:21.692970 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:21.693639 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:21.694439 [info ] [Thread-1 (]: 6 of 6 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m10:47:21.694890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_retention_metrics)
[0m10:47:21.695355 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:21.697901 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:47:21.699278 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:21.703839 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:47:21.704608 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:21.782440 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m10:47:22.957932 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9645944f-9bf0-4630-a9f8-cf583c68693c&page=queryresults
[0m10:47:23.250872 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84ec9428-7000-4ab0-880d-8f21476a5ec2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1401d6c60>]}
[0m10:47:23.252434 [info ] [Thread-1 (]: 6 of 6 OK created sql view model manual_test.mart_customer_retention_metrics ... [[32mCREATE VIEW (0 processed)[0m in 1.56s]
[0m10:47:23.253529 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:23.255148 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:47:23.255566 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m10:47:23.256047 [info ] [MainThread]: 
[0m10:47:23.256829 [info ] [MainThread]: Finished running 5 view models, 1 table model in 0 hours 0 minutes and 23.62 seconds (23.62s).
[0m10:47:23.258680 [debug] [MainThread]: Command end result
[0m10:47:23.299068 [info ] [MainThread]: 
[0m10:47:23.299329 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:47:23.299477 [info ] [MainThread]: 
[0m10:47:23.299623 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m10:47:23.301435 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 25.566383, "process_user_time": 4.721726, "process_kernel_time": 0.372935, "process_mem_max_rss": "211058688", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:47:23.301699 [debug] [MainThread]: Command `dbt run` succeeded at 10:47:23.301656 after 25.57 seconds
[0m10:47:23.301868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10023ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137e62480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f3af00>]}
[0m10:47:23.302024 [debug] [MainThread]: Flushing usage events
[0m10:47:27.039354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10800d910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108646ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108646840>]}


============================== 10:47:27.041835 | 53563107-c448-463f-8345-3d4db79b14f5 ==============================
[0m10:47:27.041835 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:47:27.042146 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:47:27.113989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53563107-c448-463f-8345-3d4db79b14f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108203e60>]}
[0m10:47:27.120667 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
        The default package install path has changed from `dbt_modules` to
`dbt_packages`.         Please update `clean-targets` in `dbt_project.yml` and
check `.gitignore` as well.         Or, set `packages-install-path: dbt_modules`
if you'd like to keep the current value.
[0m10:47:27.120896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '53563107-c448-463f-8345-3d4db79b14f5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087632f0>]}
[0m10:47:27.124484 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.11466388, "process_user_time": 0.646073, "process_kernel_time": 0.096107, "process_mem_max_rss": "94781440", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:47:27.124742 [debug] [MainThread]: Command `dbt clean` succeeded at 10:47:27.124700 after 0.11 seconds
[0m10:47:27.124897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bda8a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10832d1c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086e2480>]}
[0m10:47:27.125044 [debug] [MainThread]: Flushing usage events
[0m10:47:30.002259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ed24b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105126f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105126c30>]}


============================== 10:47:30.004413 | 90e9e805-2d31-4b3b-aae6-d6228edbe944 ==============================
[0m10:47:30.004413 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:47:30.004737 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:47:30.561080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133f7de50>]}
[0m10:47:30.585031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105155610>]}
[0m10:47:30.585339 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:47:30.605731 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:47:30.606352 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:47:30.606553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043d12e0>]}
[0m10:47:31.450831 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m10:47:31.496995 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 3 unused configuration paths:
- models.referential
- models.preparatory
- models.marts
[0m10:47:31.502439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142933320>]}
[0m10:47:31.554623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b64710>]}
[0m10:47:31.554907 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m10:47:31.555078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1429314f0>]}
[0m10:47:31.556042 [info ] [MainThread]: 
[0m10:47:31.556317 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:47:31.558206 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m10:47:31.558420 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:47:32.429076 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m10:47:32.430112 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:47:33.248295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103545b50>]}
[0m10:47:33.249758 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:47:33.250272 [info ] [MainThread]: 
[0m10:47:33.255463 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:47:33.256534 [info ] [Thread-1 (]: 1 of 6 START sql view model manual_test.ref_acq_orders ......................... [RUN]
[0m10:47:33.257257 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:47:33.257744 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:47:33.269093 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:47:33.270817 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:47:33.299830 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m10:47:33.300887 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:33.375286 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_acq_orders`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`acq_orders`;


[0m10:47:34.598084 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:88c30131-b4e8-4533-a810-466a60319e29&page=queryresults
[0m10:47:34.962641 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133b22db0>]}
[0m10:47:34.963199 [info ] [Thread-1 (]: 1 of 6 OK created sql view model manual_test.ref_acq_orders .................... [[32mCREATE VIEW (0 processed)[0m in 1.71s]
[0m10:47:34.963589 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:47:34.963819 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:47:34.964057 [info ] [Thread-1 (]: 2 of 6 START sql view model manual_test.ref_activity ........................... [RUN]
[0m10:47:34.964338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:47:34.964553 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:47:34.967690 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:47:34.968223 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:47:34.970264 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m10:47:34.970850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:35.038065 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_activity`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`activity`;


[0m10:47:36.101545 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:09d8352e-d98b-42dc-a818-2e3fb6ff0e1e&page=queryresults
[0m10:47:36.514962 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142bc4ef0>]}
[0m10:47:36.516305 [info ] [Thread-1 (]: 2 of 6 OK created sql view model manual_test.ref_activity ...................... [[32mCREATE VIEW (0 processed)[0m in 1.55s]
[0m10:47:36.517190 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:47:36.517809 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:47:36.518605 [info ] [Thread-1 (]: 3 of 6 START sql view model manual_test.ref_customers .......................... [RUN]
[0m10:47:36.519328 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:47:36.519900 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:47:36.526566 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:47:36.528104 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:47:36.531997 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m10:47:36.533122 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:36.622950 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */


  create or replace view `manual-pasfield`.`manual_test`.`ref_customers`
  OPTIONS()
  as select
    *
from `manual-pasfield`.`manual`.`customers`;


[0m10:47:37.409733 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a30deab5-9ae6-432b-9a7a-fe1e162c31fe&page=queryresults
[0m10:47:37.726746 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142bc2600>]}
[0m10:47:37.733688 [info ] [Thread-1 (]: 3 of 6 OK created sql view model manual_test.ref_customers ..................... [[32mCREATE VIEW (0 processed)[0m in 1.21s]
[0m10:47:37.734234 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:47:37.734772 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:47:37.735086 [info ] [Thread-1 (]: 4 of 6 START sql view model manual_test.prep_customer .......................... [RUN]
[0m10:47:37.735407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:47:37.740416 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:47:37.760012 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:47:37.762847 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:47:37.770188 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m10:47:37.771610 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:37.861798 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        activity.subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m10:47:38.828361 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:978e55c0-36cd-4e16-9f1c-d1d935e320cd&page=queryresults
[0m10:47:39.153455 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c5d580>]}
[0m10:47:39.154771 [info ] [Thread-1 (]: 4 of 6 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.42s]
[0m10:47:39.155853 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:47:39.156738 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:39.157387 [info ] [Thread-1 (]: 5 of 6 START sql table model manual_test.mart_cohort_retention_analysis ........ [RUN]
[0m10:47:39.157973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m10:47:39.158359 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:39.165197 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:47:39.166427 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:39.180308 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:39.822150 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:47:39.823758 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test`.`mart_cohort_retention_analysis`
      
    
    

    OPTIONS()
    as (
      -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    );
  
[0m10:47:40.638431 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2a4e350a-ccf4-4bc1-91dd-dba45ab4a2c3&page=queryresults
[0m10:47:55.239323 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c2d700>]}
[0m10:47:55.241534 [info ] [Thread-1 (]: 5 of 6 OK created sql table model manual_test.mart_cohort_retention_analysis ... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 16.08s]
[0m10:47:55.242785 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:47:55.243721 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:55.244642 [info ] [Thread-1 (]: 6 of 6 START sql view model manual_test.mart_customer_retention_metrics ........ [RUN]
[0m10:47:55.245366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_retention_metrics)
[0m10:47:55.245874 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:55.251518 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:47:55.252728 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:55.255769 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:47:55.256318 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:47:55.344291 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */


  create or replace view `manual-pasfield`.`manual_test`.`mart_customer_retention_metrics`
  OPTIONS()
  as -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data;


[0m10:47:56.376559 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:268483bf-e778-4be5-bf22-0ed56c724918&page=queryresults
[0m10:47:56.661101 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90e9e805-2d31-4b3b-aae6-d6228edbe944', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c54530>]}
[0m10:47:56.662335 [info ] [Thread-1 (]: 6 of 6 OK created sql view model manual_test.mart_customer_retention_metrics ... [[32mCREATE VIEW (0 processed)[0m in 1.42s]
[0m10:47:56.663179 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:47:56.664702 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:47:56.665129 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m10:47:56.665592 [info ] [MainThread]: 
[0m10:47:56.666468 [info ] [MainThread]: Finished running 5 view models, 1 table model in 0 hours 0 minutes and 25.11 seconds (25.11s).
[0m10:47:56.669005 [debug] [MainThread]: Command end result
[0m10:47:56.712257 [info ] [MainThread]: 
[0m10:47:56.712911 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:47:56.713217 [info ] [MainThread]: 
[0m10:47:56.713550 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m10:47:56.716355 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 26.743341, "process_user_time": 4.587301, "process_kernel_time": 0.262436, "process_mem_max_rss": "208502784", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:47:56.716863 [debug] [MainThread]: Command `dbt run` succeeded at 10:47:56.716763 after 26.74 seconds
[0m10:47:56.718894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dc0b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a06b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142b08830>]}
[0m10:47:56.719253 [debug] [MainThread]: Flushing usage events
[0m10:49:52.183051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1015170b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105826a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105826780>]}


============================== 10:49:52.185716 | 38e88ac0-1c25-4c93-8473-d5dce5842cb2 ==============================
[0m10:49:52.185716 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:49:52.186033 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt clean', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:49:52.268994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38e88ac0-1c25-4c93-8473-d5dce5842cb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f64fe0>]}
[0m10:49:52.275500 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
        The default package install path has changed from `dbt_modules` to
`dbt_packages`.         Please update `clean-targets` in `dbt_project.yml` and
check `.gitignore` as well.         Or, set `packages-install-path: dbt_modules`
if you'd like to keep the current value.
[0m10:49:52.275713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '38e88ac0-1c25-4c93-8473-d5dce5842cb2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105967f50>]}
[0m10:49:52.280085 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.12935175, "process_user_time": 0.641901, "process_kernel_time": 0.123599, "process_mem_max_rss": "93454336", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:49:52.280347 [debug] [MainThread]: Command `dbt clean` succeeded at 10:49:52.280304 after 0.13 seconds
[0m10:49:52.280507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10332b140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100762b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105958e90>]}
[0m10:49:52.280655 [debug] [MainThread]: Flushing usage events
[0m10:50:04.031670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f332c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10648ef00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10648eba0>]}


============================== 10:50:04.034283 | d3011319-643d-47ef-b279-85ffbcc0810f ==============================
[0m10:50:04.034283 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:50:04.034606 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:50:04.879910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3011319-643d-47ef-b279-85ffbcc0810f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10648e9f0>]}
[0m10:50:04.903830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3011319-643d-47ef-b279-85ffbcc0810f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baa28d0>]}
[0m10:50:04.904162 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:50:04.927593 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:50:04.928646 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:50:04.928885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd3011319-643d-47ef-b279-85ffbcc0810f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bb91f10>]}
[0m10:50:05.791716 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m10:50:05.793189 [error] [MainThread]: Encountered an error:
Parsing Error
  Contract enforcement failed for: (models/marts/mart_cohort_retention_analysis.sql)
  Constraints must be defined in a `yml` schema configuration file like `schema.yml`.
[0m10:50:05.795912 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.7948203, "process_user_time": 3.531096, "process_kernel_time": 0.306978, "process_mem_max_rss": "203177984", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:50:05.796193 [debug] [MainThread]: Command `dbt run` failed at 10:50:05.796146 after 1.80 seconds
[0m10:50:05.796373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f332c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c821940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c827740>]}
[0m10:50:05.796530 [debug] [MainThread]: Flushing usage events
[0m10:50:15.251503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ac2c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c27050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c26db0>]}


============================== 10:50:15.254030 | c3807867-6add-47b7-8ab3-d9cd58eb6adc ==============================
[0m10:50:15.254030 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:50:15.254337 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:50:15.812239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3807867-6add-47b7-8ab3-d9cd58eb6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fcdd90>]}
[0m10:50:15.836254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3807867-6add-47b7-8ab3-d9cd58eb6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e73bc0>]}
[0m10:50:15.836577 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:50:15.856397 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:50:15.857018 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m10:50:15.857222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c3807867-6add-47b7-8ab3-d9cd58eb6adc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd78ce0>]}
[0m10:50:16.700638 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m10:50:16.702195 [error] [MainThread]: Encountered an error:
Parsing Error
  Contract enforcement failed for: (models/marts/mart_cohort_retention_analysis.sql)
  Constraints must be defined in a `yml` schema configuration file like `schema.yml`.
[0m10:50:16.704501 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.481456, "process_user_time": 3.41461, "process_kernel_time": 0.289824, "process_mem_max_rss": "201752576", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:50:16.704805 [debug] [MainThread]: Command `dbt run` failed at 10:50:16.704756 after 1.48 seconds
[0m10:50:16.704991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a84290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fcf4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137425d30>]}
[0m10:50:16.705155 [debug] [MainThread]: Flushing usage events
[0m11:31:28.431627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104301ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10467f080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10467ed20>]}


============================== 11:31:28.434461 | 6e93f5a1-fc51-449c-bb8a-5835c55e8209 ==============================
[0m11:31:28.434461 [info ] [MainThread]: Running with dbt=1.8.5
[0m11:31:28.434777 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:31:29.246172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e93f5a1-fc51-449c-bb8a-5835c55e8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bb91c70>]}
[0m11:31:29.270029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e93f5a1-fc51-449c-bb8a-5835c55e8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b923260>]}
[0m11:31:29.270345 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m11:31:29.292452 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m11:31:29.293071 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:31:29.293277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6e93f5a1-fc51-449c-bb8a-5835c55e8209', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103a65f70>]}
[0m11:31:29.298776 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading manual_pasfield: marts/mart_customer_retention_metrics.yml - Runtime Error
    Syntax error near line 18
    ------------------------------
    15 | 
    16 | customer_id
    17 | 
    18 | from_date
    19 | to_date
    20 | customer_country
    21 | taxonomy_business_category_group
    
    Raw Error:
    ------------------------------
    while scanning a simple key
      in "<unicode string>", line 16, column 1
    could not find expected ':'
      in "<unicode string>", line 18, column 1
[0m11:31:29.300974 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.91121674, "process_user_time": 2.691386, "process_kernel_time": 0.290921, "process_mem_max_rss": "191922176", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:31:29.301354 [debug] [MainThread]: Command `dbt run` failed at 11:31:29.301296 after 0.91 seconds
[0m11:31:29.301581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10467f080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec7be00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12eac9550>]}
[0m11:31:29.301749 [debug] [MainThread]: Flushing usage events
[0m11:31:38.087495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086a7ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086caf60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086cad20>]}


============================== 11:31:38.090260 | d3d31dda-2314-45dd-84d7-ac6d20b0039b ==============================
[0m11:31:38.090260 [info ] [MainThread]: Running with dbt=1.8.5
[0m11:31:38.090595 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:31:38.640631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3d31dda-2314-45dd-84d7-ac6d20b0039b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f2ca480>]}
[0m11:31:38.664277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3d31dda-2314-45dd-84d7-ac6d20b0039b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f86a5a0>]}
[0m11:31:38.664588 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m11:31:38.684391 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m11:31:38.685028 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:31:38.685241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'd3d31dda-2314-45dd-84d7-ac6d20b0039b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1184ce750>]}
[0m11:31:39.541108 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers_retention_metrics' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m11:31:39.542524 [error] [MainThread]: Encountered an error:
Parsing Error
  Contract enforcement failed for: (models/marts/mart_cohort_retention_analysis.sql)
  Constraints must be defined in a `yml` schema configuration file like `schema.yml`.
[0m11:31:39.544695 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.4980853, "process_user_time": 3.452537, "process_kernel_time": 0.250139, "process_mem_max_rss": "201949184", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:31:39.545008 [debug] [MainThread]: Command `dbt run` failed at 11:31:39.544958 after 1.50 seconds
[0m11:31:39.545199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086caed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd49010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5268d0>]}
[0m11:31:39.545376 [debug] [MainThread]: Flushing usage events
[0m11:34:10.202193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10716ac00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801ef60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801ec00>]}


============================== 11:34:10.204971 | 442a2fdc-c811-46f4-a83f-14f94adb69a2 ==============================
[0m11:34:10.204971 [info ] [MainThread]: Running with dbt=1.8.5
[0m11:34:10.205319 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:34:11.029883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fa1b0b0>]}
[0m11:34:11.053725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f653440>]}
[0m11:34:11.054028 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m11:34:11.075804 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m11:34:11.076409 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:34:11.076612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fc0ec60>]}
[0m11:34:12.020045 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'mart_customers_retention_metrics' in the 'models' section of file 'models/marts/mart_customer_retention_metrics.yml'
[0m11:34:12.072976 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m11:34:12.078526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1204d0fb0>]}
[0m11:34:12.129929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1205c1970>]}
[0m11:34:12.130209 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m11:34:12.130381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1204ce090>]}
[0m11:34:12.131094 [info ] [MainThread]: 
[0m11:34:12.131364 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:34:12.131829 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m11:34:12.132039 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:34:12.877462 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now create_manual-pasfield_manual_test_mart)
[0m11:34:12.879110 [debug] [ThreadPool]: Creating schema "database: "manual-pasfield"
schema: "manual_test_mart"
"
[0m11:34:12.895591 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:34:12.987709 [debug] [ThreadPool]: On create_manual-pasfield_manual_test_mart: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "create_manual-pasfield_manual_test_mart"} */
create schema if not exists `manual-pasfield`.`manual_test_mart`
  
[0m11:34:13.701925 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:693668cd-cbe4-43e1-98a7-2bf674cda19f&page=queryresults
[0m11:34:15.304213 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m11:34:15.304938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:34:16.375659 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m11:34:16.379210 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:34:18.293896 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m11:34:18.294555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:34:19.138416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120388c20>]}
[0m11:34:19.140242 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m11:34:19.140824 [info ] [MainThread]: 
[0m11:34:19.146996 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:34:19.147899 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m11:34:19.148628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.mart_customer_retention_metrics)
[0m11:34:19.149273 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m11:34:19.162890 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m11:34:19.164405 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m11:34:19.203522 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:34:19.204640 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '442a2fdc-c811-46f4-a83f-14f94adb69a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1205e7ec0>]}
[0m11:34:19.205066 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 0.06s]
[0m11:34:19.205468 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:34:19.206509 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:34:19.206682 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m11:34:19.206850 [info ] [MainThread]: 
[0m11:34:19.207028 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.08 seconds (7.08s).
[0m11:34:19.207414 [debug] [MainThread]: Command end result
[0m11:34:19.231584 [info ] [MainThread]: 
[0m11:34:19.231867 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:34:19.232019 [info ] [MainThread]: 
[0m11:34:19.232223 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:34:19.232393 [info ] [MainThread]: 
[0m11:34:19.232536 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:34:19.234482 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 9.06606, "process_user_time": 4.360618, "process_kernel_time": 0.376007, "process_mem_max_rss": "208945152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:34:19.234759 [debug] [MainThread]: Command `dbt run` failed at 11:34:19.234714 after 9.07 seconds
[0m11:34:19.234954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10801ef60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a7cbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6ac00>]}
[0m11:34:19.235118 [debug] [MainThread]: Flushing usage events
[0m11:36:19.431493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fca120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062bb0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062bae70>]}


============================== 11:36:19.434118 | 91322e7d-522f-4219-8a0d-e956ff67a238 ==============================
[0m11:36:19.434118 [info ] [MainThread]: Running with dbt=1.8.5
[0m11:36:19.434425 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:36:20.269369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a492480>]}
[0m11:36:20.293648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a59e510>]}
[0m11:36:20.293960 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m11:36:20.315376 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m11:36:20.401779 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:36:20.402212 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m11:36:20.534883 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m11:36:20.541017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ef72960>]}
[0m11:36:20.635604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f05f950>]}
[0m11:36:20.635903 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m11:36:20.636168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f0bc650>]}
[0m11:36:20.637182 [info ] [MainThread]: 
[0m11:36:20.637681 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:36:20.638213 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m11:36:20.638436 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:36:21.335934 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m11:36:21.336285 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:22.303114 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m11:36:22.303447 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:23.242406 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m11:36:23.243552 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:23.845604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10591f7d0>]}
[0m11:36:23.846075 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m11:36:23.846319 [info ] [MainThread]: 
[0m11:36:23.848261 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:23.848610 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m11:36:23.848883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.mart_customer_retention_metrics)
[0m11:36:23.849096 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:23.854566 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m11:36:23.855418 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:23.892441 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:36:23.893505 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '91322e7d-522f-4219-8a0d-e956ff67a238', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f06d220>]}
[0m11:36:23.893963 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 0.04s]
[0m11:36:23.894314 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:23.895248 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:36:23.895442 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m11:36:23.895622 [info ] [MainThread]: 
[0m11:36:23.895799 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.26 seconds (3.26s).
[0m11:36:23.896162 [debug] [MainThread]: Command end result
[0m11:36:23.918842 [info ] [MainThread]: 
[0m11:36:23.919128 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:36:23.919278 [info ] [MainThread]: 
[0m11:36:23.919485 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:36:23.919652 [info ] [MainThread]: 
[0m11:36:23.919791 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:36:23.921561 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.5225406, "process_user_time": 3.294822, "process_kernel_time": 0.384888, "process_mem_max_rss": "209436672", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:36:23.921894 [debug] [MainThread]: Command `dbt run` failed at 11:36:23.921845 after 4.52 seconds
[0m11:36:23.922087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11e8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105404290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e9cd4c0>]}
[0m11:36:23.922275 [debug] [MainThread]: Flushing usage events
[0m11:36:29.459192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104444410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105eaaff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105eaac90>]}


============================== 11:36:29.461474 | 14ffc140-a2b5-4052-8aaf-1b5d51fb37bb ==============================
[0m11:36:29.461474 [info ] [MainThread]: Running with dbt=1.8.5
[0m11:36:29.461787 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:36:30.046951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e332480>]}
[0m11:36:30.071007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11df43fe0>]}
[0m11:36:30.071406 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m11:36:30.091210 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m11:36:30.165722 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:36:30.166268 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m11:36:30.299283 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m11:36:30.305589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eab3e90>]}
[0m11:36:30.400144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e8a9670>]}
[0m11:36:30.400422 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m11:36:30.400587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bcb3620>]}
[0m11:36:30.401306 [info ] [MainThread]: 
[0m11:36:30.401577 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:36:30.401982 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m11:36:30.402154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:36:31.005852 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m11:36:31.006485 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:31.679851 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m11:36:31.680451 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:32.318894 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m11:36:32.322426 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:36:33.471867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121d5c470>]}
[0m11:36:33.473809 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m11:36:33.474434 [info ] [MainThread]: 
[0m11:36:33.480179 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:33.481160 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m11:36:33.482055 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.mart_customer_retention_metrics)
[0m11:36:33.482860 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:33.494834 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m11:36:33.496282 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:33.538370 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:36:33.539346 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14ffc140-a2b5-4052-8aaf-1b5d51fb37bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10543e240>]}
[0m11:36:33.539750 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 0.06s]
[0m11:36:33.540157 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:36:33.541306 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:36:33.541494 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m11:36:33.541673 [info ] [MainThread]: 
[0m11:36:33.541857 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.14 seconds (3.14s).
[0m11:36:33.542250 [debug] [MainThread]: Command end result
[0m11:36:33.569044 [info ] [MainThread]: 
[0m11:36:33.569313 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:36:33.569457 [info ] [MainThread]: 
[0m11:36:33.569657 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:36:33.569813 [info ] [MainThread]: 
[0m11:36:33.569947 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:36:33.571316 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.1433077, "process_user_time": 3.464141, "process_kernel_time": 0.271673, "process_mem_max_rss": "208584704", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:36:33.571607 [debug] [MainThread]: Command `dbt run` failed at 11:36:33.571560 after 4.14 seconds
[0m11:36:33.571810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bf7470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059091c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104444410>]}
[0m11:36:33.571975 [debug] [MainThread]: Flushing usage events
[0m11:39:39.620609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10111b500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104086ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104086c30>]}


============================== 11:39:39.623263 | 94a61bc3-bcab-4caa-a139-0c498f62d939 ==============================
[0m11:39:39.623263 [info ] [MainThread]: Running with dbt=1.8.5
[0m11:39:39.623597 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:39:40.444256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bca5ca0>]}
[0m11:39:40.467926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f9cef0>]}
[0m11:39:40.468227 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m11:39:40.489561 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m11:39:40.575416 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:39:40.575817 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m11:39:40.703571 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m11:39:40.709631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c5d1be0>]}
[0m11:39:40.803472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c6397f0>]}
[0m11:39:40.803757 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m11:39:40.803923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c71a780>]}
[0m11:39:40.804657 [info ] [MainThread]: 
[0m11:39:40.804928 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m11:39:40.805352 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m11:39:40.805549 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:39:42.040148 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m11:39:42.041052 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:39:42.907813 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m11:39:42.909266 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:39:44.367488 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m11:39:44.368538 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:39:45.295951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d9b050>]}
[0m11:39:45.297368 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m11:39:45.298519 [info ] [MainThread]: 
[0m11:39:45.303236 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:39:45.304047 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m11:39:45.304891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.mart_customer_retention_metrics)
[0m11:39:45.305591 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m11:39:45.314513 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m11:39:45.315455 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m11:39:45.353346 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:39:45.425803 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m11:39:46.884431 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2faa3d95-6c2a-4215-8ab6-769b8ea833d1&page=queryresults
[0m11:39:47.212958 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m11:39:47.698567 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5b23530d-647a-49d1-aed3-039c3bf33930&page=queryresults
[0m11:39:48.013690 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name                      | definition_type | contract_type | mismatch_reason       |
  | -------------------------------- | --------------- | ------------- | --------------------- |
  | cohort_month                     |                 | DATE          | missing in definition |
  | customer_country                 | STRING          |               | missing in contract   |
  | customer_id                      | STRING          |               | missing in contract   |
  | from_date                        | DATE            |               | missing in contract   |
  | retained_1_month                 |                 | INT64         | missing in definition |
  | retained_3_months                |                 | INT64         | missing in definition |
  | retained_6_months                |                 | INT64         | missing in definition |
  | retention_rate_1_month           |                 | FLOAT64       | missing in definition |
  | retention_rate_3_months          |                 | FLOAT64       | missing in definition |
  | retention_rate_6_months          |                 | FLOAT64       | missing in definition |
  | subscription_id                  | INT64           |               | missing in contract   |
  | subscription_length_days         | INT64           |               | missing in contract   |
  | taxonomy_business_category_group | STRING          |               | missing in contract   |
  | time_since_last_activity_days    | INT64           |               | missing in contract   |
  | to_date                          | DATE            |               | missing in contract   |
  | total_customers                  |                 | INT64         | missing in definition |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:39:48.015826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '94a61bc3-bcab-4caa-a139-0c498f62d939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c094230>]}
[0m11:39:48.016621 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 2.71s]
[0m11:39:48.017508 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m11:39:48.019252 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:39:48.019538 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m11:39:48.019810 [info ] [MainThread]: 
[0m11:39:48.020086 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.21 seconds (7.21s).
[0m11:39:48.020799 [debug] [MainThread]: Command end result
[0m11:39:48.050199 [info ] [MainThread]: 
[0m11:39:48.050528 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:39:48.050723 [info ] [MainThread]: 
[0m11:39:48.051064 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name                      | definition_type | contract_type | mismatch_reason       |
  | -------------------------------- | --------------- | ------------- | --------------------- |
  | cohort_month                     |                 | DATE          | missing in definition |
  | customer_country                 | STRING          |               | missing in contract   |
  | customer_id                      | STRING          |               | missing in contract   |
  | from_date                        | DATE            |               | missing in contract   |
  | retained_1_month                 |                 | INT64         | missing in definition |
  | retained_3_months                |                 | INT64         | missing in definition |
  | retained_6_months                |                 | INT64         | missing in definition |
  | retention_rate_1_month           |                 | FLOAT64       | missing in definition |
  | retention_rate_3_months          |                 | FLOAT64       | missing in definition |
  | retention_rate_6_months          |                 | FLOAT64       | missing in definition |
  | subscription_id                  | INT64           |               | missing in contract   |
  | subscription_length_days         | INT64           |               | missing in contract   |
  | taxonomy_business_category_group | STRING          |               | missing in contract   |
  | time_since_last_activity_days    | INT64           |               | missing in contract   |
  | to_date                          | DATE            |               | missing in contract   |
  | total_customers                  |                 | INT64         | missing in definition |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m11:39:48.051462 [info ] [MainThread]: 
[0m11:39:48.051707 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:39:48.053733 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.466111, "process_user_time": 3.63259, "process_kernel_time": 0.397097, "process_mem_max_rss": "207372288", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:39:48.054090 [debug] [MainThread]: Command `dbt run` failed at 11:39:48.054030 after 8.47 seconds
[0m11:39:48.054332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c217320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ae5220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c41b7d0>]}
[0m11:39:48.054553 [debug] [MainThread]: Flushing usage events
[0m16:01:58.542266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074d24b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f2f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f2cc0>]}


============================== 16:01:58.545633 | d9a7e2c3-209d-4178-bd2d-20c383c615b9 ==============================
[0m16:01:58.545633 [info ] [MainThread]: Running with dbt=1.8.5
[0m16:01:58.546010 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_cohort_retention_analysis', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:01:59.574219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1631ae480>]}
[0m16:01:59.600445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072f4380>]}
[0m16:01:59.600927 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m16:01:59.628007 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m16:01:59.729159 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:01:59.729434 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:01:59.732057 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m16:01:59.751178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163a757c0>]}
[0m16:01:59.811907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163c1bf80>]}
[0m16:01:59.812341 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m16:01:59.812519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163b5a0c0>]}
[0m16:01:59.813324 [info ] [MainThread]: 
[0m16:01:59.813621 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m16:01:59.814112 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m16:01:59.814329 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:02:00.344120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m16:02:00.344443 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:00.980941 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m16:02:00.982039 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:01.376635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m16:02:01.378994 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:02:01.706047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b45cd0>]}
[0m16:02:01.707410 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m16:02:01.707880 [info ] [MainThread]: 
[0m16:02:01.711925 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m16:02:01.713017 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m16:02:01.714208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m16:02:01.714765 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m16:02:01.721143 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m16:02:01.722047 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m16:02:01.751382 [debug] [Thread-1 (]: Compilation Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
[0m16:02:01.752241 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9a7e2c3-209d-4178-bd2d-20c383c615b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163c1ac00>]}
[0m16:02:01.752563 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model manual_test_mart.mart_cohort_retention_analysis  [[31mERROR[0m in 0.04s]
[0m16:02:01.752889 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m16:02:01.753860 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:02:01.754022 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m16:02:01.754168 [info ] [MainThread]: 
[0m16:02:01.754321 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m16:02:01.754636 [debug] [MainThread]: Command end result
[0m16:02:01.779296 [info ] [MainThread]: 
[0m16:02:01.779581 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:02:01.779731 [info ] [MainThread]: 
[0m16:02:01.779943 [error] [MainThread]:   Compilation Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  This model has an enforced contract, and its 'columns' specification is missing
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
[0m16:02:01.780106 [info ] [MainThread]: 
[0m16:02:01.780254 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m16:02:01.782016 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.2778628, "process_user_time": 2.637271, "process_kernel_time": 0.961016, "process_mem_max_rss": "203063296", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:02:01.782307 [debug] [MainThread]: Command `dbt run` failed at 16:02:01.782265 after 3.28 seconds
[0m16:02:01.782482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102776b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16327b290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x163b033b0>]}
[0m16:02:01.782636 [debug] [MainThread]: Flushing usage events
[0m16:02:07.135284 [debug] [MainThread]: Error sending anonymous usage statistics. Disabling tracking for this execution. If you wish to permanently disable tracking, see: https://docs.getdbt.com/reference/global-configs#send-anonymous-usage-stats.
[0m16:57:23.006403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10774a0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a26ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a26b70>]}


============================== 16:57:23.009043 | 3a8577e9-4b88-4e17-8748-5bbca5738cb7 ==============================
[0m16:57:23.009043 [info ] [MainThread]: Running with dbt=1.8.5
[0m16:57:23.009360 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_cohort_retention_analysis', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:57:23.847726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a8577e9-4b88-4e17-8748-5bbca5738cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d45730>]}
[0m16:57:23.871682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a8577e9-4b88-4e17-8748-5bbca5738cb7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cba12e0>]}
[0m16:57:23.871983 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m16:57:23.893048 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m16:57:23.940108 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading manual_pasfield: marts/mart_customer_retention_metrics.yml - Runtime Error
    Syntax error near line 10
    ------------------------------
    7  |     columns:
    8  | 
    9  | customer_id
    10 | subscription_id
    11 | from_date
    12 | to_date
    13 | customer_country
    
    Raw Error:
    ------------------------------
    while scanning a simple key
      in "<unicode string>", line 9, column 1
    could not find expected ':'
      in "<unicode string>", line 10, column 1
[0m16:57:23.942040 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.96673965, "process_user_time": 2.70705, "process_kernel_time": 0.310238, "process_mem_max_rss": "198705152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:57:23.942361 [debug] [MainThread]: Command `dbt run` failed at 16:57:23.942311 after 0.97 seconds
[0m16:57:23.942575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a26b70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e7b260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bc1130>]}
[0m16:57:23.942748 [debug] [MainThread]: Flushing usage events
[0m17:02:50.640367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107be3dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085eeff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085eedb0>]}


============================== 17:02:50.642983 | ae6607bd-081b-4a15-ae9d-f1ac275e7242 ==============================
[0m17:02:50.642983 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:02:50.643296 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select mart_cohort_retention_analysis', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:02:51.525378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae6607bd-081b-4a15-ae9d-f1ac275e7242', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1346b5730>]}
[0m17:02:51.556334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae6607bd-081b-4a15-ae9d-f1ac275e7242', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c02930>]}
[0m17:02:51.557233 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:02:51.590394 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:02:51.644859 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading manual_pasfield: marts/mart_customer_retention_metrics.yml - Runtime Error
    Syntax error near line 10
    ------------------------------
    7  |     columns:
    8  | 
    9  | customer_id
    10 | subscription_id
    11 | from_date
    12 | to_date
    13 | customer_country
    
    Raw Error:
    ------------------------------
    while scanning a simple key
      in "<unicode string>", line 9, column 1
    could not find expected ':'
      in "<unicode string>", line 10, column 1
[0m17:02:51.647006 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.03952, "process_user_time": 2.796202, "process_kernel_time": 0.312531, "process_mem_max_rss": "199557120", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:02:51.647417 [debug] [MainThread]: Command `dbt run` failed at 17:02:51.647356 after 1.04 seconds
[0m17:02:51.647713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048eeb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134ccfad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1340a1550>]}
[0m17:02:51.647945 [debug] [MainThread]: Flushing usage events
[0m17:02:59.247581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066f2180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e2ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069e2c90>]}


============================== 17:02:59.250092 | dbf5a9bc-52d3-49b7-86cb-9125fa1f78df ==============================
[0m17:02:59.250092 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:02:59.250402 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select mart_cohort_retention_analysis', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:02:59.788212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbf5a9bc-52d3-49b7-86cb-9125fa1f78df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc12480>]}
[0m17:02:59.812047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbf5a9bc-52d3-49b7-86cb-9125fa1f78df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b88e120>]}
[0m17:02:59.812405 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:02:59.832979 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:02:59.916088 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:02:59.916458 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m17:02:59.949381 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two schema.yml entries for the same resource named mart_customer_retention_metrics. Resources and their associated columns may only be described a single time. To fix this, remove the resource entry for mart_customer_retention_metrics in one of these files:
   - models/marts/mart_customer_retention_metrics.yml
  models/marts/mart_cohort_retention_analysis.yml
[0m17:02:59.950940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.7328116, "process_user_time": 2.688838, "process_kernel_time": 0.28452, "process_mem_max_rss": "199802880", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:02:59.951275 [debug] [MainThread]: Command `dbt run` failed at 17:02:59.951223 after 0.73 seconds
[0m17:02:59.951491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066f2180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ec49b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066f2060>]}
[0m17:02:59.951666 [debug] [MainThread]: Flushing usage events
[0m17:03:45.730319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1016470b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042795e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104592c90>]}


============================== 17:03:45.732981 | 62774391-698a-49f0-a44e-417656078057 ==============================
[0m17:03:45.732981 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:03:45.733300 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select mart_cohort_retention_analysis', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:03:46.559684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cdb2d50>]}
[0m17:03:46.583694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c7c7530>]}
[0m17:03:46.584043 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:03:46.605122 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:03:46.684505 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:03:46.684914 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m17:03:46.685113 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m17:03:46.816842 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m17:03:46.822900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1255d7e60>]}
[0m17:03:46.914748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1254a91c0>]}
[0m17:03:46.915029 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m17:03:46.915191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125544da0>]}
[0m17:03:46.915923 [info ] [MainThread]: 
[0m17:03:46.916185 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:03:46.916586 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m17:03:46.916760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:03:47.365506 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m17:03:47.365858 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:03:47.716679 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m17:03:47.718479 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:03:48.082616 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m17:03:48.086278 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:03:48.788798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1254a8110>]}
[0m17:03:48.791240 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m17:03:48.792634 [info ] [MainThread]: 
[0m17:03:48.797862 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:03:48.798949 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m17:03:48.799817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m17:03:48.800360 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:03:48.809728 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m17:03:48.810791 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:03:48.848372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:03:48.920707 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:03:49.919281 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:242c0951-0b04-46f1-a28b-c46c93a8a9a5&page=queryresults
[0m17:03:50.115776 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:03:50.427199 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:37444823-bd4e-4064-8ec5-b0dfa7e26c57&page=queryresults
[0m17:03:50.620577 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m17:03:50.622307 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    ) as model_subq
    );
  
[0m17:03:51.384882 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:26c635d9-1c3a-40ae-8ebc-1bb85eec5d6a&page=queryresults
[0m17:04:03.420571 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62774391-698a-49f0-a44e-417656078057', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f1fda0>]}
[0m17:04:03.421494 [info ] [Thread-1 (]: 1 of 1 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 14.62s]
[0m17:04:03.422163 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:04:03.423359 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:04:03.423706 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m17:04:03.424009 [info ] [MainThread]: 
[0m17:04:03.424311 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 16.51 seconds (16.51s).
[0m17:04:03.424918 [debug] [MainThread]: Command end result
[0m17:04:03.462152 [info ] [MainThread]: 
[0m17:04:03.462521 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:04:03.462709 [info ] [MainThread]: 
[0m17:04:03.462896 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m17:04:03.464960 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.76458, "process_user_time": 3.617505, "process_kernel_time": 0.423799, "process_mem_max_rss": "209584128", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:04:03.465298 [debug] [MainThread]: Command `dbt run` succeeded at 17:04:03.465242 after 17.76 seconds
[0m17:04:03.465521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040b2000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100892b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1016470b0>]}
[0m17:04:03.465732 [debug] [MainThread]: Flushing usage events
[0m17:04:16.534724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070d4650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c26ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c26cc0>]}


============================== 17:04:16.537206 | 047924d9-ced8-4c30-b2d4-11ef889c0c7f ==============================
[0m17:04:16.537206 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:04:16.537505 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:04:17.098145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14cdea480>]}
[0m17:04:17.121890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d401040>]}
[0m17:04:17.122212 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:04:17.143712 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:04:17.224196 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:04:17.224433 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:04:17.226929 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m17:04:17.241280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127b0a240>]}
[0m17:04:17.308678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d749d90>]}
[0m17:04:17.308987 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m17:04:17.309169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d2726f0>]}
[0m17:04:17.310009 [info ] [MainThread]: 
[0m17:04:17.310315 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:04:17.310777 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m17:04:17.310953 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:04:17.660353 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m17:04:17.661130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:04:18.487786 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m17:04:18.489512 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:04:18.861748 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m17:04:18.865614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:04:19.246251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ccb56a0>]}
[0m17:04:19.248101 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m17:04:19.248764 [info ] [MainThread]: 
[0m17:04:19.253564 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m17:04:19.254500 [info ] [Thread-1 (]: 1 of 1 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m17:04:19.255282 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.mart_customer_retention_metrics)
[0m17:04:19.255975 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m17:04:19.269053 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m17:04:19.271062 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m17:04:19.310132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:04:19.381549 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:04:20.383385 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0743aa5e-c6ba-43a5-b842-433a4f8ecf34&page=queryresults
[0m17:04:20.554087 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as date)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:04:21.041790 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:68f86312-dcdb-4b36-bbe6-8b4281437590&page=queryresults
[0m17:04:21.196788 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name     | definition_type | contract_type | mismatch_reason    |
  | --------------- | --------------- | ------------- | ------------------ |
  | customer_id     | STRING          | DATE          | data type mismatch |
  | subscription_id | INT64           | STRING        | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m17:04:21.198849 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '047924d9-ced8-4c30-b2d4-11ef889c0c7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107ce1b0>]}
[0m17:04:21.199659 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 1.94s]
[0m17:04:21.200447 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m17:04:21.202311 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:04:21.202656 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m17:04:21.202954 [info ] [MainThread]: 
[0m17:04:21.203256 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.89 seconds (3.89s).
[0m17:04:21.203954 [debug] [MainThread]: Command end result
[0m17:04:21.239711 [info ] [MainThread]: 
[0m17:04:21.240334 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:04:21.240645 [info ] [MainThread]: 
[0m17:04:21.241003 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name     | definition_type | contract_type | mismatch_reason    |
  | --------------- | --------------- | ------------- | ------------------ |
  | customer_id     | STRING          | DATE          | data type mismatch |
  | subscription_id | INT64           | STRING        | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m17:04:21.241423 [info ] [MainThread]: 
[0m17:04:21.241737 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m17:04:21.243923 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.737972, "process_user_time": 3.477364, "process_kernel_time": 0.242352, "process_mem_max_rss": "203390976", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:04:21.244305 [debug] [MainThread]: Command `dbt run` failed at 17:04:21.244252 after 4.74 seconds
[0m17:04:21.244519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d59f950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c27080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c26ea0>]}
[0m17:04:21.244731 [debug] [MainThread]: Flushing usage events
[0m17:07:30.232939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049d6450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10498a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c46d20>]}


============================== 17:07:30.235659 | e788cca1-9922-4ba1-9452-be5c9d24118c ==============================
[0m17:07:30.235659 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:07:30.236029 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select mart_customer_retention_metrics', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:07:31.081910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e788cca1-9922-4ba1-9452-be5c9d24118c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d84e480>]}
[0m17:07:31.106430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e788cca1-9922-4ba1-9452-be5c9d24118c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e2a930>]}
[0m17:07:31.106757 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:07:31.128741 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:07:31.214292 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m17:07:31.214704 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m17:07:31.214900 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m17:07:31.351299 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m17:07:31.357381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e788cca1-9922-4ba1-9452-be5c9d24118c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1255c5850>]}
[0m17:07:31.450041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e788cca1-9922-4ba1-9452-be5c9d24118c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125550890>]}
[0m17:07:31.450326 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m17:07:31.450492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e788cca1-9922-4ba1-9452-be5c9d24118c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125562b70>]}
[0m17:07:31.451225 [info ] [MainThread]: 
[0m17:07:31.451494 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:07:31.451927 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m17:07:31.452131 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:31.757449 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:07:31.758074 [debug] [MainThread]: Connection 'list_manual-pasfield' was left open.
[0m17:07:31.758560 [info ] [MainThread]: 
[0m17:07:31.759025 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.31 seconds (0.31s).
[0m17:07:31.759605 [error] [MainThread]: Encountered an error:

[0m17:07:31.766788 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/runnable.py", line 626, in create_schemas
    for ls_future in as_completed(list_futures):
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py", line 243, in as_completed
    waiter.event.wait(wait_timeout)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/threading.py", line 655, in wait
    signaled = self._cond.wait(timeout)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/threading.py", line 355, in wait
    waiter.acquire()
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 332, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/main.py", line 569, in run
    results = task.run()
              ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/runnable.py", line 526, in run
    result = self.execute_with_hooks(selected_uids)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/runnable.py", line 486, in execute_with_hooks
    self.before_run(adapter, selected_uids)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/run.py", line 459, in before_run
    self.create_schemas(adapter, required_schemas)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/runnable.py", line 617, in create_schemas
    with dbt_common.utils.executor(self.config) as tpe:  # type: ignore
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/_base.py", line 647, in __exit__
    self.shutdown(wait=True)
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/concurrent/futures/thread.py", line 238, in shutdown
    t.join()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/threading.py", line 1149, in join
    self._wait_for_tstate_lock()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/threading.py", line 1169, in _wait_for_tstate_lock
    if lock.acquire(block, timeout):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m17:07:31.771254 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.5706311, "process_user_time": 3.028889, "process_kernel_time": 0.381733, "process_mem_max_rss": "207978496", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:07:31.771995 [debug] [MainThread]: Command `dbt run` failed at 17:07:31.771879 after 1.57 seconds
[0m17:07:31.772434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f3eb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127421f40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1274238f0>]}
[0m17:07:31.772834 [debug] [MainThread]: Flushing usage events
[0m17:07:37.610261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083289e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d26ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d26c60>]}


============================== 17:07:37.612406 | 364903bc-81ee-493b-9907-9c8f5e09d8bc ==============================
[0m17:07:37.612406 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:07:37.612737 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:07:38.196609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f01730>]}
[0m17:07:38.222026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107845a30>]}
[0m17:07:38.222443 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:07:38.243581 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:07:38.321974 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:07:38.322223 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:07:38.324717 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m17:07:38.338934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147876e40>]}
[0m17:07:38.388617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fb38f0>]}
[0m17:07:38.388898 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m17:07:38.389065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14791efc0>]}
[0m17:07:38.390080 [info ] [MainThread]: 
[0m17:07:38.390368 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:07:38.392225 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m17:07:38.392469 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:38.706884 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:39.065380 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:39.482784 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now create_manual-pasfield_manual_test_ref)
[0m17:07:39.484837 [debug] [ThreadPool]: Creating schema "database: "manual-pasfield"
schema: "manual_test_ref"
"
[0m17:07:39.502539 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:39.590186 [debug] [ThreadPool]: On create_manual-pasfield_manual_test_ref: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "create_manual-pasfield_manual_test_ref"} */
create schema if not exists `manual-pasfield`.`manual_test_ref`
  
[0m17:07:40.109546 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:60a96761-73f7-4f9a-9099-a48f92f6c7f6&page=queryresults
[0m17:07:42.165808 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m17:07:42.166776 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:42.556587 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m17:07:42.558959 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:43.284425 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m17:07:43.285789 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:43.647395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e41f70>]}
[0m17:07:43.648619 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m17:07:43.649093 [info ] [MainThread]: 
[0m17:07:43.653210 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m17:07:43.654006 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m17:07:43.654796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m17:07:43.655470 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m17:07:43.665398 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m17:07:43.666629 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m17:07:43.697137 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m17:07:43.698286 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:43.771504 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m17:07:44.957854 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:86054ee2-aae2-4386-86bb-71c8ff545df4&page=queryresults
[0m17:07:48.425147 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bc73e0>]}
[0m17:07:48.426975 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.77s]
[0m17:07:48.427633 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m17:07:48.428058 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m17:07:48.428614 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m17:07:48.429141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m17:07:48.429507 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m17:07:48.432886 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m17:07:48.433880 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m17:07:48.436942 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m17:07:48.437671 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:48.516232 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m17:07:49.493069 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2aae0659-a048-4dfa-bd92-4a04a077d782&page=queryresults
[0m17:07:53.632558 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c3fce0>]}
[0m17:07:53.634415 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.20s]
[0m17:07:53.636199 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m17:07:53.637052 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m17:07:53.637910 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m17:07:53.638702 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m17:07:53.639274 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m17:07:53.645299 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m17:07:53.647188 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m17:07:53.651951 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m17:07:53.653033 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:53.742912 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m17:07:54.694747 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5bba7f82-3513-4601-8541-1dae15089226&page=queryresults
[0m17:07:57.932104 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c7dd90>]}
[0m17:07:57.934034 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.29s]
[0m17:07:57.935943 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m17:07:57.937493 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m17:07:57.938630 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m17:07:57.939409 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m17:07:57.939935 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m17:07:57.952608 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m17:07:57.954322 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m17:07:57.974747 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m17:07:57.975560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:58.054495 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m17:07:58.835215 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:00138004-6e44-49cf-87b2-19c0b60ce2c8&page=queryresults
[0m17:07:59.215537 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147aa5430>]}
[0m17:07:59.216455 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.28s]
[0m17:07:59.217251 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m17:07:59.218128 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m17:07:59.218861 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m17:07:59.219548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m17:07:59.220077 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m17:07:59.225331 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m17:07:59.226617 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m17:07:59.236959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:59.322078 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:08:00.288042 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1869b35d-89ac-4bb0-b742-b0bd8a4f3fb8&page=queryresults
[0m17:08:00.441618 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as int64)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:08:00.898890 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0f4a0b84-4564-46b2-a738-b2734a5a4899&page=queryresults
[0m17:08:01.063019 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name     | definition_type | contract_type | mismatch_reason    |
  | --------------- | --------------- | ------------- | ------------------ |
  | subscription_id | STRING          | INT64         | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m17:08:01.063608 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '364903bc-81ee-493b-9907-9c8f5e09d8bc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e0d220>]}
[0m17:08:01.064182 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 1.84s]
[0m17:08:01.064757 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m17:08:01.066000 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:08:01.066249 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m17:08:01.066548 [info ] [MainThread]: 
[0m17:08:01.066815 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 22.68 seconds (22.68s).
[0m17:08:01.067716 [debug] [MainThread]: Command end result
[0m17:08:01.143737 [info ] [MainThread]: 
[0m17:08:01.144006 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:08:01.144161 [info ] [MainThread]: 
[0m17:08:01.144378 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name     | definition_type | contract_type | mismatch_reason    |
  | --------------- | --------------- | ------------- | ------------------ |
  | subscription_id | STRING          | INT64         | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m17:08:01.144619 [info ] [MainThread]: 
[0m17:08:01.144815 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m17:08:01.146432 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 23.565014, "process_user_time": 3.938948, "process_kernel_time": 0.849115, "process_mem_max_rss": "206848000", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:08:01.146717 [debug] [MainThread]: Command `dbt run` failed at 17:08:01.146670 after 23.57 seconds
[0m17:08:01.146904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076e15b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146b24c20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c301d0>]}
[0m17:08:01.147075 [debug] [MainThread]: Flushing usage events
[0m17:08:17.409266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e4a030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11312edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11312eb70>]}


============================== 17:08:17.412063 | 38c2f9ab-0a34-47a2-ab3f-ac66b21f2341 ==============================
[0m17:08:17.412063 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:08:17.412442 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_customer_retention_metrics', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:08:18.217020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1473921e0>]}
[0m17:08:18.241011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14772e510>]}
[0m17:08:18.241315 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:08:18.263546 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:08:18.342345 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:08:18.342759 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m17:08:18.473075 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m17:08:18.479210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147b50710>]}
[0m17:08:18.572065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147ff1fd0>]}
[0m17:08:18.572347 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m17:08:18.572512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a71220>]}
[0m17:08:18.573518 [info ] [MainThread]: 
[0m17:08:18.573789 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:08:18.575631 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m17:08:18.575841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:18.940837 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:19.326958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:19.729781 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m17:08:19.731270 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:20.106400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m17:08:20.108998 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:20.480778 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m17:08:20.483289 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:20.844042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150048da0>]}
[0m17:08:20.845338 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m17:08:20.846112 [info ] [MainThread]: 
[0m17:08:20.851042 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m17:08:20.852193 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m17:08:20.852931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m17:08:20.853447 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m17:08:20.865245 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m17:08:20.865935 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m17:08:20.877898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:08:21.620186 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m17:08:21.621262 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m17:08:22.200478 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5d9fe3bf-7c80-450c-960b-0ef1293604a4&page=queryresults
[0m17:08:25.194311 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111dce330>]}
[0m17:08:25.195002 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.34s]
[0m17:08:25.195530 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m17:08:25.195880 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m17:08:25.196354 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m17:08:25.196789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m17:08:25.197110 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m17:08:25.200016 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m17:08:25.200828 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m17:08:25.203146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:08:25.685438 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m17:08:25.687899 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m17:08:26.293999 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4de22d86-07a0-4528-8eda-4681d4ececcc&page=queryresults
[0m17:08:31.118295 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15006c980>]}
[0m17:08:31.119997 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.92s]
[0m17:08:31.121206 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m17:08:31.121966 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m17:08:31.123071 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m17:08:31.124051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m17:08:31.124690 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m17:08:31.129981 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m17:08:31.132400 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m17:08:31.136487 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:08:31.723277 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m17:08:31.726230 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m17:08:32.132634 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0e7bb620-374a-45d1-ba4c-4505d75b884c&page=queryresults
[0m17:08:35.310916 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15006da60>]}
[0m17:08:35.313443 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.19s]
[0m17:08:35.315281 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m17:08:35.317441 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m17:08:35.318355 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m17:08:35.319569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m17:08:35.320174 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m17:08:35.330258 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m17:08:35.331187 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m17:08:35.356348 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m17:08:35.357186 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:08:35.437456 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m17:08:35.992229 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7b6efe6e-d195-404e-9bf1-dc1d69a40a1c&page=queryresults
[0m17:08:36.348198 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x150196ba0>]}
[0m17:08:36.349567 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.03s]
[0m17:08:36.350431 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m17:08:36.351396 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m17:08:36.352130 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m17:08:36.352793 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_retention_metrics)
[0m17:08:36.353326 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m17:08:36.359381 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m17:08:36.360392 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m17:08:36.376107 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:08:36.460364 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:08:37.559049 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:29c5b63b-81cc-4189-aa90-292d81e167f3&page=queryresults
[0m17:08:37.725547 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:08:38.181993 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8c42e0a9-469c-445c-b915-9e70055960b0&page=queryresults
[0m17:08:38.356759 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m17:08:38.358207 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m17:08:39.098082 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:077a18ae-e1e1-4986-919e-568ca7df54ab&page=queryresults
[0m17:08:46.523497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '38c2f9ab-0a34-47a2-ab3f-ac66b21f2341', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479cd280>]}
[0m17:08:46.525875 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (2.0m rows, 88.0 MiB processed)[0m in 10.17s]
[0m17:08:46.527265 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m17:08:46.529336 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:08:46.529833 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m17:08:46.530577 [info ] [MainThread]: 
[0m17:08:46.531508 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 27.96 seconds (27.96s).
[0m17:08:46.533624 [debug] [MainThread]: Command end result
[0m17:08:46.563461 [info ] [MainThread]: 
[0m17:08:46.563739 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:08:46.563901 [info ] [MainThread]: 
[0m17:08:46.564055 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m17:08:46.565940 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 29.188444, "process_user_time": 4.519547, "process_kernel_time": 0.379879, "process_mem_max_rss": "208404480", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:08:46.566405 [debug] [MainThread]: Command `dbt run` succeeded at 17:08:46.566326 after 29.19 seconds
[0m17:08:46.566698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b5b740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1130e2030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147cd5be0>]}
[0m17:08:46.566944 [debug] [MainThread]: Flushing usage events
[0m17:08:57.822469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107917aa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108382fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108382d20>]}


============================== 17:08:57.824929 | 858436be-8742-4703-bfe7-33d832176822 ==============================
[0m17:08:57.824929 [info ] [MainThread]: Running with dbt=1.8.5
[0m17:08:57.825241 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m17:08:58.382544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107299550>]}
[0m17:08:58.406264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e112f90>]}
[0m17:08:58.406575 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m17:08:58.425888 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m17:08:58.509869 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m17:08:58.510111 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m17:08:58.512641 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m17:08:58.527287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e7ce0f0>]}
[0m17:08:58.576713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f1b18b0>]}
[0m17:08:58.576998 [info ] [MainThread]: Found 6 models, 3 sources, 854 macros
[0m17:08:58.577167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe92ba0>]}
[0m17:08:58.578202 [info ] [MainThread]: 
[0m17:08:58.578505 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:08:58.580348 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m17:08:58.580565 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:08:58.971802 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:59.301502 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:08:59.643641 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m17:08:59.644887 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:09:00.038011 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m17:09:00.040818 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:09:00.414991 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m17:09:00.418513 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:09:00.786807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f38e480>]}
[0m17:09:00.788445 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m17:09:00.789024 [info ] [MainThread]: 
[0m17:09:00.794562 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m17:09:00.795767 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m17:09:00.796687 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m17:09:00.797263 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m17:09:00.807922 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m17:09:00.808531 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m17:09:00.821835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:09:01.282676 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m17:09:01.283502 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m17:09:01.724103 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5f6a342d-79be-40c9-965b-5d608f095bd0&page=queryresults
[0m17:09:04.761413 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079162d0>]}
[0m17:09:04.762213 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.96s]
[0m17:09:04.762845 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m17:09:04.763268 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m17:09:04.763809 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m17:09:04.764304 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m17:09:04.764657 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m17:09:04.767976 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m17:09:04.768805 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m17:09:04.776429 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:09:05.141565 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m17:09:05.143813 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m17:09:05.474293 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6d824a14-5855-4900-a79e-3fa506716ccb&page=queryresults
[0m17:09:09.796704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f5016d0>]}
[0m17:09:09.798964 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.03s]
[0m17:09:09.800398 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m17:09:09.800925 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m17:09:09.801599 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m17:09:09.802379 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m17:09:09.802801 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m17:09:09.806501 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m17:09:09.807472 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m17:09:09.810325 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:09:10.159675 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m17:09:10.162078 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m17:09:10.461642 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ff2bd0cd-b05a-4a4b-a93b-95621be32570&page=queryresults
[0m17:09:13.707504 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f122330>]}
[0m17:09:13.709069 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.91s]
[0m17:09:13.709996 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m17:09:13.711444 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m17:09:13.712177 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m17:09:13.712817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m17:09:13.713323 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m17:09:13.728899 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m17:09:13.729931 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m17:09:13.749522 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m17:09:13.750296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:09:13.827310 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m17:09:14.305689 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d123502d-7680-4f96-bd05-b72e44dd66a0&page=queryresults
[0m17:09:14.630442 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f5b2b70>]}
[0m17:09:14.631831 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m17:09:14.632706 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m17:09:14.633733 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:09:14.634314 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m17:09:14.634896 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m17:09:14.635381 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:09:14.640789 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m17:09:14.643477 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:09:14.645326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:09:15.035745 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:09:15.754375 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5dd21d36-4d2a-44bd-b3fa-5ec99a26dcb8&page=queryresults
[0m17:09:15.911571 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m17:09:16.469730 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:de036f42-3394-41d6-bb7f-db64b75aa5dd&page=queryresults
[0m17:09:16.600703 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m17:09:16.602072 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    ) as model_subq
    );
  
[0m17:09:17.392397 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c080a95f-8f81-4c08-a9e8-7782d71d9116&page=queryresults
[0m17:09:27.930472 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '858436be-8742-4703-bfe7-33d832176822', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f562d20>]}
[0m17:09:27.932985 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 13.30s]
[0m17:09:27.934108 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m17:09:27.935772 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:09:27.936186 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m17:09:27.936732 [info ] [MainThread]: 
[0m17:09:27.937210 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 29.36 seconds (29.36s).
[0m17:09:27.938783 [debug] [MainThread]: Command end result
[0m17:09:28.018374 [info ] [MainThread]: 
[0m17:09:28.018646 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:09:28.018801 [info ] [MainThread]: 
[0m17:09:28.018965 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m17:09:28.020972 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 30.227203, "process_user_time": 4.328344, "process_kernel_time": 0.31302, "process_mem_max_rss": "205209600", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:09:28.021286 [debug] [MainThread]: Command `dbt run` succeeded at 17:09:28.021234 after 30.23 seconds
[0m17:09:28.021482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ea3500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d4ce60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d4c560>]}
[0m17:09:28.021656 [debug] [MainThread]: Flushing usage events
[0m18:20:03.448710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bcca10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078eafc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078ead80>]}


============================== 18:20:03.451336 | 6c2e3354-e69a-4bba-b0a1-318e9e2c8276 ==============================
[0m18:20:03.451336 [info ] [MainThread]: Running with dbt=1.8.5
[0m18:20:03.451642 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:20:04.272433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c2e3354-e69a-4bba-b0a1-318e9e2c8276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1448f06b0>]}
[0m18:20:04.297328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c2e3354-e69a-4bba-b0a1-318e9e2c8276', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056d33e0>]}
[0m18:20:04.297663 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m18:20:04.319822 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m18:20:04.368164 [error] [MainThread]: Encountered an error:
Parsing Error
  Error reading manual_pasfield: marts/mart_customer_metrics.yml - Runtime Error
    Syntax error near line 10
    ------------------------------
    7  | 
    8  |     columns:
    9  |     acquisition_month as month,
    10 |     acquired_customers,
    11 |     coalesce(retained_customers, 0) as retained_customers,
    12 |     coalesce(churned_customers, 0) as churned_customers,
    13 |     safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    
    Raw Error:
    ------------------------------
    while scanning a simple key
      in "<unicode string>", line 9, column 5
    could not find expected ':'
      in "<unicode string>", line 10, column 5
[0m18:20:04.370103 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.9531659, "process_user_time": 2.747167, "process_kernel_time": 0.278541, "process_mem_max_rss": "196444160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:20:04.370426 [debug] [MainThread]: Command `dbt run` failed at 18:20:04.370375 after 0.95 seconds
[0m18:20:04.370656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078eaf00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056bb260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14489e840>]}
[0m18:20:04.370838 [debug] [MainThread]: Flushing usage events
[0m18:20:12.815122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10405ec00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045bae70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045bac30>]}


============================== 18:20:12.817901 | 2a31335d-fede-4ed1-95c5-9ddb7e08b764 ==============================
[0m18:20:12.817901 [info ] [MainThread]: Running with dbt=1.8.5
[0m18:20:12.818267 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'send_anonymous_usage_stats': 'True'}
[0m18:20:13.367956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130149730>]}
[0m18:20:13.391643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1301b1e20>]}
[0m18:20:13.391955 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m18:20:13.413679 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m18:20:13.499047 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m18:20:13.499398 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customer_metrics.yml
[0m18:20:13.499565 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m18:20:13.628242 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m18:20:13.634731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130e7a9f0>]}
[0m18:20:13.727965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130e4ba40>]}
[0m18:20:13.728238 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m18:20:13.728397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130e572f0>]}
[0m18:20:13.729398 [info ] [MainThread]: 
[0m18:20:13.729672 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:20:13.731498 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m18:20:13.731717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:20:14.164073 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:14.517119 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:14.903532 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m18:20:14.904779 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:15.277801 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m18:20:15.281470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:15.678328 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m18:20:15.680690 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:16.044476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130e0b140>]}
[0m18:20:16.046043 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m18:20:16.046626 [info ] [MainThread]: 
[0m18:20:16.050868 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m18:20:16.051961 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m18:20:16.052761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m18:20:16.053399 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m18:20:16.062582 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m18:20:16.063628 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m18:20:16.070877 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:16.494354 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m18:20:16.495562 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m18:20:17.021972 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:83b2422d-c589-421f-935b-cb66a9d5ba80&page=queryresults
[0m18:20:20.139770 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b4e330>]}
[0m18:20:20.140548 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.09s]
[0m18:20:20.141166 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m18:20:20.141583 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m18:20:20.142142 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m18:20:20.142645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m18:20:20.143015 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m18:20:20.146449 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m18:20:20.147578 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m18:20:20.150111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:20.507880 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m18:20:20.510253 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m18:20:20.950824 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:735b6918-046b-476e-948f-977810e35473&page=queryresults
[0m18:20:25.477877 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130ddce00>]}
[0m18:20:25.479818 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.33s]
[0m18:20:25.481587 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m18:20:25.482315 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m18:20:25.483187 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m18:20:25.483965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m18:20:25.484519 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m18:20:25.489820 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m18:20:25.491034 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m18:20:25.494490 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:25.861337 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m18:20:25.863876 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m18:20:26.306162 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ebd35603-99f0-4c32-a72f-50f57028dba4&page=queryresults
[0m18:20:29.327677 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1300223c0>]}
[0m18:20:29.329164 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.84s]
[0m18:20:29.330033 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m18:20:29.331664 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m18:20:29.332802 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m18:20:29.333667 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m18:20:29.334165 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m18:20:29.347461 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m18:20:29.348521 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m18:20:29.370695 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m18:20:29.371765 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:29.449711 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m18:20:30.012759 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:41119bc4-7e49-44a5-844a-2df09b427ff8&page=queryresults
[0m18:20:30.396685 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130eb7290>]}
[0m18:20:30.398110 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.06s]
[0m18:20:30.399378 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m18:20:30.401006 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m18:20:30.401875 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m18:20:30.402664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m18:20:30.403193 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m18:20:30.409013 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m18:20:30.410755 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m18:20:30.421863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:30.508849 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month;
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m18:20:30.798152 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c92d48f7-53b6-4c88-996f-00bc27b941b2&page=queryresults
[0m18:20:30.801901 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [54:27]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [54:27]')
[0m18:20:31.415202 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:780a970c-72ca-402b-a2f2-e284e8ddc173&page=queryresults
[0m18:20:31.417863 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:780a970c-72ca-402b-a2f2-e284e8ddc173&page=queryresults
[0m18:20:31.433935 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got ";" at [54:27]
[0m18:20:31.434403 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a31335d-fede-4ed1-95c5-9ddb7e08b764', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130eb5f10>]}
[0m18:20:31.434829 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 1.03s]
[0m18:20:31.435204 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m18:20:31.436132 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:20:31.436351 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m18:20:31.436588 [info ] [MainThread]: 
[0m18:20:31.436796 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 17.71 seconds (17.71s).
[0m18:20:31.437557 [debug] [MainThread]: Command end result
[0m18:20:31.474978 [info ] [MainThread]: 
[0m18:20:31.475315 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:20:31.475517 [info ] [MainThread]: 
[0m18:20:31.475758 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got ";" at [54:27]
[0m18:20:31.475948 [info ] [MainThread]: 
[0m18:20:31.476145 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m18:20:31.478177 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 18.69183, "process_user_time": 4.34904, "process_kernel_time": 0.311855, "process_mem_max_rss": "210108416", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:20:31.478578 [debug] [MainThread]: Command `dbt run` failed at 18:20:31.478513 after 18.69 seconds
[0m18:20:31.478835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045bae10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104019400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040189b0>]}
[0m18:20:31.479064 [debug] [MainThread]: Flushing usage events
[0m18:20:38.242217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c7b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066e6fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066e6c60>]}


============================== 18:20:38.245120 | 8c6859a4-0536-42c8-8fab-43e23af0943c ==============================
[0m18:20:38.245120 [info ] [MainThread]: Running with dbt=1.8.5
[0m18:20:38.245435 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'send_anonymous_usage_stats': 'True'}
[0m18:20:38.787401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cb98b0>]}
[0m18:20:38.811053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa85fa0>]}
[0m18:20:38.811365 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m18:20:38.831773 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m18:20:38.914598 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:20:38.914982 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m18:20:39.039652 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m18:20:39.045788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c19730>]}
[0m18:20:39.136295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134f01700>]}
[0m18:20:39.136578 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m18:20:39.136745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a72a50>]}
[0m18:20:39.137746 [info ] [MainThread]: 
[0m18:20:39.138031 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:20:39.139914 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m18:20:39.140130 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:20:39.481928 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:39.889282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:40.278098 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m18:20:40.279329 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:40.624891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m18:20:40.627724 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:40.966812 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m18:20:40.969320 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:20:41.330336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112881c10>]}
[0m18:20:41.331807 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m18:20:41.332633 [info ] [MainThread]: 
[0m18:20:41.337923 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m18:20:41.338951 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m18:20:41.339718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m18:20:41.340237 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m18:20:41.350243 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m18:20:41.351212 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m18:20:41.365251 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:41.767670 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m18:20:41.768810 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m18:20:42.352524 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:582a46eb-cc2d-43ee-b2fc-80f4919ed026&page=queryresults
[0m18:20:45.533250 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1358946e0>]}
[0m18:20:45.534128 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.19s]
[0m18:20:45.534749 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m18:20:45.535167 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m18:20:45.535717 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m18:20:45.536204 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m18:20:45.536563 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m18:20:45.539917 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m18:20:45.540991 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m18:20:45.543863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:46.511158 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m18:20:46.513350 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m18:20:47.388440 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f82df30e-19eb-4573-a598-33c605eea771&page=queryresults
[0m18:20:52.470673 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13596b1a0>]}
[0m18:20:52.472459 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 6.93s]
[0m18:20:52.473935 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m18:20:52.474626 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m18:20:52.475417 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m18:20:52.476178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m18:20:52.476704 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m18:20:52.481708 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m18:20:52.482857 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m18:20:52.486686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:52.833779 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m18:20:52.836436 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m18:20:53.310160 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6cae8693-82f2-4904-8c1a-5c54c4392527&page=queryresults
[0m18:20:56.308414 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1359f6b70>]}
[0m18:20:56.310870 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.83s]
[0m18:20:56.312065 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m18:20:56.313906 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m18:20:56.315062 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m18:20:56.315779 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m18:20:56.316284 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m18:20:56.330627 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m18:20:56.331335 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m18:20:56.350892 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m18:20:56.351642 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:56.430721 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m18:20:56.996576 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:96b929e7-b022-44a0-b216-5048025f951d&page=queryresults
[0m18:20:57.283298 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10669f5c0>]}
[0m18:20:57.284811 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.97s]
[0m18:20:57.286097 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m18:20:57.287560 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m18:20:57.288271 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m18:20:57.288922 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m18:20:57.289393 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m18:20:57.295609 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m18:20:57.296184 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m18:20:57.309202 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:20:57.395879 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m18:20:58.328193 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2a1b9a33-53f3-47d1-afdd-b702aa2f2848&page=queryresults
[0m18:20:58.330781 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for function GENERATE_ARRAY\n  Argument types: DATE, DATE, INTERVAL\n  Signature: GENERATE_ARRAY(INT64, INT64, [INT64])\n    Argument 1: Unable to coerce type DATE to expected type INT64\n  Signature: GENERATE_ARRAY(NUMERIC, NUMERIC, [NUMERIC])\n    Argument 1: Unable to coerce type DATE to expected type NUMERIC\n  Signature: GENERATE_ARRAY(BIGNUMERIC, BIGNUMERIC, [BIGNUMERIC])\n    Argument 1: Unable to coerce type DATE to expected type BIGNUMERIC\n  Signature: GENERATE_ARRAY(FLOAT64, FLOAT64, [FLOAT64])\n    Argument 1: Unable to coerce type DATE to expected type FLOAT64 at [39:12]; reason: invalidQuery, location: query, message: No matching signature for function GENERATE_ARRAY\n  Argument types: DATE, DATE, INTERVAL\n  Signature: GENERATE_ARRAY(INT64, INT64, [INT64])\n    Argument 1: Unable to coerce type DATE to expected type INT64\n  Signature: GENERATE_ARRAY(NUMERIC, NUMERIC, [NUMERIC])\n    Argument 1: Unable to coerce type DATE to expected type NUMERIC\n  Signature: GENERATE_ARRAY(BIGNUMERIC, BIGNUMERIC, [BIGNUMERIC])\n    Argument 1: Unable to coerce type DATE to expected type BIGNUMERIC\n  Signature: GENERATE_ARRAY(FLOAT64, FLOAT64, [FLOAT64])\n    Argument 1: Unable to coerce type DATE to expected type FLOAT64 at [39:12]')
[0m18:20:59.454604 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7e3f07c8-d36c-484b-976a-faa092cc5bc6&page=queryresults
[0m18:20:59.457422 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7e3f07c8-d36c-484b-976a-faa092cc5bc6&page=queryresults
[0m18:20:59.473687 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  No matching signature for function GENERATE_ARRAY
    Argument types: DATE, DATE, INTERVAL
    Signature: GENERATE_ARRAY(INT64, INT64, [INT64])
      Argument 1: Unable to coerce type DATE to expected type INT64
    Signature: GENERATE_ARRAY(NUMERIC, NUMERIC, [NUMERIC])
      Argument 1: Unable to coerce type DATE to expected type NUMERIC
    Signature: GENERATE_ARRAY(BIGNUMERIC, BIGNUMERIC, [BIGNUMERIC])
      Argument 1: Unable to coerce type DATE to expected type BIGNUMERIC
    Signature: GENERATE_ARRAY(FLOAT64, FLOAT64, [FLOAT64])
      Argument 1: Unable to coerce type DATE to expected type FLOAT64 at [39:12]
[0m18:20:59.474275 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c6859a4-0536-42c8-8fab-43e23af0943c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134f1b5c0>]}
[0m18:20:59.475016 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 2.19s]
[0m18:20:59.475696 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m18:20:59.477532 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:20:59.478010 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m18:20:59.478446 [info ] [MainThread]: 
[0m18:20:59.478813 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 20.34 seconds (20.34s).
[0m18:20:59.480165 [debug] [MainThread]: Command end result
[0m18:20:59.518288 [info ] [MainThread]: 
[0m18:20:59.518618 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m18:20:59.518822 [info ] [MainThread]: 
[0m18:20:59.519084 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  No matching signature for function GENERATE_ARRAY
    Argument types: DATE, DATE, INTERVAL
    Signature: GENERATE_ARRAY(INT64, INT64, [INT64])
      Argument 1: Unable to coerce type DATE to expected type INT64
    Signature: GENERATE_ARRAY(NUMERIC, NUMERIC, [NUMERIC])
      Argument 1: Unable to coerce type DATE to expected type NUMERIC
    Signature: GENERATE_ARRAY(BIGNUMERIC, BIGNUMERIC, [BIGNUMERIC])
      Argument 1: Unable to coerce type DATE to expected type BIGNUMERIC
    Signature: GENERATE_ARRAY(FLOAT64, FLOAT64, [FLOAT64])
      Argument 1: Unable to coerce type DATE to expected type FLOAT64 at [39:12]
[0m18:20:59.519301 [info ] [MainThread]: 
[0m18:20:59.519491 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m18:20:59.521451 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 21.31067, "process_user_time": 4.398361, "process_kernel_time": 0.306093, "process_mem_max_rss": "208715776", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:20:59.521822 [debug] [MainThread]: Command `dbt run` failed at 18:20:59.521762 after 21.31 seconds
[0m18:20:59.522074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a53080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a53800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a52f60>]}
[0m18:20:59.522290 [debug] [MainThread]: Flushing usage events
[0m18:21:53.607601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065bec60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106606f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106606c30>]}


============================== 18:21:53.610289 | b7856842-fbaa-4bcd-9978-399aa1480d26 ==============================
[0m18:21:53.610289 [info ] [MainThread]: Running with dbt=1.8.5
[0m18:21:53.610646 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m18:21:54.438544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f677140>]}
[0m18:21:54.462336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074bdfa0>]}
[0m18:21:54.462660 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m18:21:54.485474 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m18:21:54.575904 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m18:21:54.576318 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m18:21:54.703459 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m18:21:54.709662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fc8bef0>]}
[0m18:21:54.803933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f948290>]}
[0m18:21:54.804208 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m18:21:54.804383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b3a10>]}
[0m18:21:54.805359 [info ] [MainThread]: 
[0m18:21:54.805638 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:21:54.807528 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m18:21:54.807743 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:21:55.176317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:21:55.533292 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:21:55.892812 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m18:21:55.894213 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:21:56.256435 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m18:21:56.260467 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:21:56.620907 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m18:21:56.623835 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:21:57.003629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fc710d0>]}
[0m18:21:57.005599 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m18:21:57.006824 [info ] [MainThread]: 
[0m18:21:57.012302 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m18:21:57.013343 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m18:21:57.014051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m18:21:57.014554 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m18:21:57.024880 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m18:21:57.026309 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m18:21:57.044646 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:21:57.437970 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m18:21:57.438973 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m18:21:57.997792 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b4a28efb-2965-4798-8d77-ab504d9482c2&page=queryresults
[0m18:22:01.473839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e6b5820>]}
[0m18:22:01.474654 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.46s]
[0m18:22:01.475283 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m18:22:01.475681 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m18:22:01.476219 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m18:22:01.476721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m18:22:01.477100 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m18:22:01.480521 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m18:22:01.482436 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m18:22:01.485112 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:22:01.854658 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m18:22:01.857037 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m18:22:02.326004 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1ea77f2c-8888-4142-a65d-e05cb700e158&page=queryresults
[0m18:22:06.555256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fbdcf50>]}
[0m18:22:06.558098 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.08s]
[0m18:22:06.559262 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m18:22:06.559904 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m18:22:06.560670 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m18:22:06.561473 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m18:22:06.562028 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m18:22:06.567227 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m18:22:06.568440 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m18:22:06.572217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:22:06.942160 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m18:22:06.945901 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m18:22:07.352814 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:024d61a4-558b-4e37-9dae-a4d4244c09ba&page=queryresults
[0m18:22:10.352337 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fdc16a0>]}
[0m18:22:10.354472 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.79s]
[0m18:22:10.355984 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m18:22:10.357487 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m18:22:10.358279 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m18:22:10.358984 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m18:22:10.359471 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m18:22:10.371905 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m18:22:10.372962 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m18:22:10.396523 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m18:22:10.397688 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:22:10.475120 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m18:22:11.070008 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:eeab1b0d-5d4a-4a7a-b520-ddcca69d31a0&page=queryresults
[0m18:22:11.422256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065eac30>]}
[0m18:22:11.423514 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.06s]
[0m18:22:11.424406 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m18:22:11.425420 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m18:22:11.426015 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m18:22:11.426627 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m18:22:11.427119 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m18:22:11.433454 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m18:22:11.434617 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m18:22:11.451142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:22:11.534679 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m18:22:12.358575 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8058cfad-b154-4e49-852a-b2d503d22eb0&page=queryresults
[0m18:22:12.528496 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m18:22:12.928241 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:81d08624-72eb-4611-beb9-2e511be16177&page=queryresults
[0m18:22:13.093667 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m18:22:13.095534 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as model_subq
    );
  
[0m18:22:14.307939 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cab611b9-5d1a-4d9f-869f-f7084c06a106&page=queryresults
[0m18:22:21.683448 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b7856842-fbaa-4bcd-9978-399aa1480d26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fc91a30>]}
[0m18:22:21.686662 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 10.26s]
[0m18:22:21.687990 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m18:22:21.689827 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:22:21.690333 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m18:22:21.690851 [info ] [MainThread]: 
[0m18:22:21.691300 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 26.89 seconds (26.89s).
[0m18:22:21.693183 [debug] [MainThread]: Command end result
[0m18:22:21.739090 [info ] [MainThread]: 
[0m18:22:21.739449 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:22:21.739674 [info ] [MainThread]: 
[0m18:22:21.739902 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m18:22:21.742263 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 28.1677, "process_user_time": 4.511032, "process_kernel_time": 0.404838, "process_mem_max_rss": "208142336", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:22:21.742684 [debug] [MainThread]: Command `dbt run` succeeded at 18:22:21.742615 after 28.17 seconds
[0m18:22:21.742941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c40c980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b3200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e5a91c0>]}
[0m18:22:21.743173 [debug] [MainThread]: Flushing usage events
[0m19:22:20.106615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029a8140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104412f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104412cf0>]}


============================== 19:22:20.109529 | 8e7ca9e8-4794-4ccc-a495-5c0b81e1af23 ==============================
[0m19:22:20.109529 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:22:20.109847 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:22:20.925262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cfb4e30>]}
[0m19:22:20.949011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fcaacc0>]}
[0m19:22:20.949315 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:22:20.971246 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:22:21.057235 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m19:22:21.057673 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m19:22:21.057842 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m19:22:21.189217 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m19:22:21.195724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1284ac5f0>]}
[0m19:22:21.289173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285ff950>]}
[0m19:22:21.289451 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m19:22:21.289615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1283214f0>]}
[0m19:22:21.290629 [info ] [MainThread]: 
[0m19:22:21.290915 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:22:21.292809 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:22:21.293024 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:22:21.706571 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:22.096648 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:22.488201 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m19:22:22.489382 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:22.850400 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m19:22:22.852701 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:23.211348 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m19:22:23.213398 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:22:23.629567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12856d400>]}
[0m19:22:23.631194 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:22:23.631915 [info ] [MainThread]: 
[0m19:22:23.638110 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m19:22:23.638947 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m19:22:23.639986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m19:22:23.640622 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m19:22:23.650563 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m19:22:23.652220 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m19:22:23.669598 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:24.107233 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m19:22:24.109034 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m19:22:24.647495 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:54a4bd4f-1c32-49d2-bf4e-6ea542b3d556&page=queryresults
[0m19:22:27.931163 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285655b0>]}
[0m19:22:27.932022 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.29s]
[0m19:22:27.932742 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m19:22:27.933189 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m19:22:27.933752 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m19:22:27.934273 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m19:22:27.934657 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m19:22:27.938042 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m19:22:27.939041 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m19:22:27.941911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:28.274956 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m19:22:28.276546 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m19:22:28.745496 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5ca296ce-d676-417a-b1c7-ffba634e4ea9&page=queryresults
[0m19:22:32.664512 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285671d0>]}
[0m19:22:32.666278 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.73s]
[0m19:22:32.667525 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m19:22:32.668322 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:22:32.669176 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m19:22:32.669906 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m19:22:32.670433 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:22:32.675363 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:22:32.676444 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:22:32.679988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:33.050061 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:22:33.051840 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m19:22:33.456133 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d2d8ebc4-7870-4e68-abcc-49d4e3af9824&page=queryresults
[0m19:22:36.148785 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128564cb0>]}
[0m19:22:36.149705 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.48s]
[0m19:22:36.150501 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:22:36.151464 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m19:22:36.152349 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m19:22:36.153143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m19:22:36.153647 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m19:22:36.168443 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m19:22:36.169479 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m19:22:36.193489 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m19:22:36.194714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:36.273368 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m19:22:36.838649 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:835c3571-bd65-49ac-8d03-489062b7a93f&page=queryresults
[0m19:22:37.072487 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11feceed0>]}
[0m19:22:37.073888 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.92s]
[0m19:22:37.075201 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m19:22:37.076728 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:22:37.077623 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m19:22:37.078446 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m19:22:37.078928 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:22:37.085464 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m19:22:37.088482 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:22:37.091783 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:22:37.498842 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days,  -- Subscription length in days
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_active_date  -- Last active date, defaults to current date if still active
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months,
        
        -- Calculate the number of churned customers as those who have a non-null to_date before today
        count(distinct case when to_date is not null and to_date < current_date() then customer_id end) as customers_churned
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months, including churn rate and months since acquisition
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        
        -- Retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months,
        
        -- Churn percentage
        round((safe_divide(customers_churned, total_customers) * 100), 2) as churn_percentage,
        
        -- Additional timeline-related metrics
        max(last_active_date) as last_active_date,
        date_diff(current_date(), cohort_month, month) as months_since_acquisition
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates, grouped by country and business category
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m19:22:38.680038 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:80a32201-f69d-4436-8759-9870832fa92c&page=queryresults
[0m19:22:38.684549 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: last_active_date at [58:13]; reason: invalidQuery, location: query, message: Unrecognized name: last_active_date at [58:13]')
[0m19:22:39.703040 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:87b99669-d2f2-4773-b52c-c3a3212e05aa&page=queryresults
[0m19:22:39.705742 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:87b99669-d2f2-4773-b52c-c3a3212e05aa&page=queryresults
[0m19:22:39.721438 [debug] [Thread-1 (]: Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Unrecognized name: last_active_date at [58:13]
[0m19:22:39.721885 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e7ca9e8-4794-4ccc-a495-5c0b81e1af23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1284ad9d0>]}
[0m19:22:39.722339 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_cohort_retention_analysis  [[31mERROR[0m in 2.64s]
[0m19:22:39.722729 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:22:39.723688 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:22:39.723874 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m19:22:39.724100 [info ] [MainThread]: 
[0m19:22:39.724300 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 18.43 seconds (18.43s).
[0m19:22:39.725033 [debug] [MainThread]: Command end result
[0m19:22:39.763881 [info ] [MainThread]: 
[0m19:22:39.764233 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:22:39.764435 [info ] [MainThread]: 
[0m19:22:39.764686 [error] [MainThread]:   Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Unrecognized name: last_active_date at [58:13]
[0m19:22:39.764872 [info ] [MainThread]: 
[0m19:22:39.765068 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m19:22:39.767309 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 19.694178, "process_user_time": 4.425876, "process_kernel_time": 0.404245, "process_mem_max_rss": "208453632", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:22:39.767723 [debug] [MainThread]: Command `dbt run` failed at 19:22:39.767654 after 19.69 seconds
[0m19:22:39.767993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029a8140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104412f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104412f30>]}
[0m19:22:39.768230 [debug] [MainThread]: Flushing usage events
[0m19:24:10.972373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048f1eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104be30e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104be2d80>]}


============================== 19:24:10.975811 | 5635450d-e1dd-484d-8146-db4b6fc7a9d3 ==============================
[0m19:24:10.975811 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:24:10.976226 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:24:11.956540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128212480>]}
[0m19:24:11.980435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f8e7e0>]}
[0m19:24:11.980743 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:24:12.004418 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:24:12.090853 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:24:12.091096 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:24:12.093705 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m19:24:12.108054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ab5e80>]}
[0m19:24:12.159917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128a51bb0>]}
[0m19:24:12.160212 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m19:24:12.160372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128956b40>]}
[0m19:24:12.161447 [info ] [MainThread]: 
[0m19:24:12.161741 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:24:12.163786 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:24:12.164055 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:12.549608 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:12.883376 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:13.236034 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m19:24:13.237494 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:13.613321 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m19:24:13.613913 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:13.928438 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m19:24:13.929341 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:14.263803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034ed9a0>]}
[0m19:24:14.264284 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:24:14.264527 [info ] [MainThread]: 
[0m19:24:14.267800 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m19:24:14.268228 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m19:24:14.268557 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m19:24:14.268796 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m19:24:14.275559 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m19:24:14.276817 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m19:24:14.288071 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:14.627924 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m19:24:14.628642 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m19:24:15.076001 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:169a6037-75e2-434b-be28-3e6bb476c148&page=queryresults
[0m19:24:17.830535 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041760f0>]}
[0m19:24:17.831478 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.56s]
[0m19:24:17.832206 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m19:24:17.832651 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m19:24:17.833202 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m19:24:17.833705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m19:24:17.834058 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m19:24:17.837468 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m19:24:17.839873 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m19:24:17.842657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:18.198664 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m19:24:18.201130 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m19:24:18.723675 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f847da48-a212-4e94-82d3-96af0ac4764a&page=queryresults
[0m19:24:22.945554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128db3890>]}
[0m19:24:22.945995 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.11s]
[0m19:24:22.946333 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m19:24:22.946561 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:24:22.946862 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m19:24:22.947257 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m19:24:22.947475 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:24:22.949387 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:24:22.949881 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:24:22.951352 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:23.285861 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:24:23.288298 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m19:24:23.843867 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bec687b0-6df9-447e-93be-d8caa9075361&page=queryresults
[0m19:24:27.136104 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb4a420>]}
[0m19:24:27.137104 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.19s]
[0m19:24:27.137550 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:24:27.138159 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m19:24:27.138483 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m19:24:27.138781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m19:24:27.139030 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m19:24:27.147443 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m19:24:27.148282 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m19:24:27.162489 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m19:24:27.163386 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:27.231417 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m19:24:27.838873 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:86ff250b-cd70-4739-852a-f9bfb1ae31a1&page=queryresults
[0m19:24:28.088649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb25e50>]}
[0m19:24:28.089225 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.95s]
[0m19:24:28.089686 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m19:24:28.090176 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:24:28.090666 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m19:24:28.091245 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m19:24:28.091528 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:24:28.094507 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m19:24:28.097058 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:24:28.099384 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:28.471938 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days,  -- Subscription length in days
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_active_date  -- Last active date, defaults to current date if still active
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months,
        
        -- Calculate the number of churned customers as those who have a non-null to_date before today
        count(distinct case when to_date is not null and to_date < current_date() then customer_id end) as customers_churned
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months, including churn rate and months since acquisition
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        
        -- Retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months,
        
        -- Churn percentage
        round((safe_divide(customers_churned, total_customers) * 100), 2) as churn_percentage,
        
        -- Additional timeline-related metrics
        max(last_active_date) as last_active_date,
        date_diff(current_date(), cohort_month, month) as months_since_acquisition
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates, grouped by country and business category
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m19:24:29.067018 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:055ce9e1-4a6e-4765-95ee-fcf8f79b1340&page=queryresults
[0m19:24:29.069994 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: last_active_date at [58:13]; reason: invalidQuery, location: query, message: Unrecognized name: last_active_date at [58:13]')
[0m19:24:29.985655 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8e3383f7-5b9c-4788-bcd0-23fcc1b009c4&page=queryresults
[0m19:24:29.986316 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8e3383f7-5b9c-4788-bcd0-23fcc1b009c4&page=queryresults
[0m19:24:29.995431 [debug] [Thread-1 (]: Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Unrecognized name: last_active_date at [58:13]
[0m19:24:29.995776 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5635450d-e1dd-484d-8146-db4b6fc7a9d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12889c380>]}
[0m19:24:29.996109 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_cohort_retention_analysis  [[31mERROR[0m in 1.90s]
[0m19:24:29.996388 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:24:29.997409 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:24:29.997632 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m19:24:29.997864 [info ] [MainThread]: 
[0m19:24:29.998087 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 17.84 seconds (17.84s).
[0m19:24:29.998712 [debug] [MainThread]: Command end result
[0m19:24:30.070746 [info ] [MainThread]: 
[0m19:24:30.071066 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:24:30.071221 [info ] [MainThread]: 
[0m19:24:30.071428 [error] [MainThread]:   Database Error in model mart_cohort_retention_analysis (models/marts/mart_cohort_retention_analysis.sql)
  Unrecognized name: last_active_date at [58:13]
[0m19:24:30.071576 [info ] [MainThread]: 
[0m19:24:30.071724 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m19:24:30.073799 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 19.132795, "process_user_time": 4.059731, "process_kernel_time": 0.457423, "process_mem_max_rss": "206159872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:24:30.074201 [debug] [MainThread]: Command `dbt run` failed at 19:24:30.074146 after 19.13 seconds
[0m19:24:30.074417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aee6c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1288cb710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ee2b40>]}
[0m19:24:30.074602 [debug] [MainThread]: Flushing usage events
[0m19:24:53.798557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d2e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106026ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106026ba0>]}


============================== 19:24:53.801106 | 8cd62c81-eeb0-4b2f-baac-6842bed3abc1 ==============================
[0m19:24:53.801106 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:24:53.801450 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m19:24:54.601760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e68dfa0>]}
[0m19:24:54.625709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f62a930>]}
[0m19:24:54.626014 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:24:54.647905 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:24:54.730686 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m19:24:54.731128 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m19:24:54.731298 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m19:24:54.860345 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m19:24:54.866493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe93a10>]}
[0m19:24:54.957577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fef4050>]}
[0m19:24:54.957852 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m19:24:54.958016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fc1e2d0>]}
[0m19:24:54.958969 [info ] [MainThread]: 
[0m19:24:54.959241 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:24:54.961168 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:24:54.961392 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:24:55.312049 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:55.708155 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:56.189866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m19:24:56.191097 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:56.554370 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m19:24:56.556919 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:56.950072 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m19:24:56.950710 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:24:57.288019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff1d790>]}
[0m19:24:57.288633 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:24:57.288963 [info ] [MainThread]: 
[0m19:24:57.292461 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m19:24:57.292937 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m19:24:57.293297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m19:24:57.293583 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m19:24:57.301249 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m19:24:57.302007 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m19:24:57.316020 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:24:57.696419 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m19:24:57.697598 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m19:24:58.250926 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9403329e-baf2-4fa9-aa94-d927fb0bb428&page=queryresults
[0m19:25:00.949289 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe4fad0>]}
[0m19:25:00.950385 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.66s]
[0m19:25:00.951078 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m19:25:00.951490 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m19:25:00.952031 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m19:25:00.952533 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m19:25:00.952893 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m19:25:00.956270 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m19:25:00.957090 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m19:25:00.960217 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:01.312190 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m19:25:01.316189 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m19:25:01.737141 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5c5233af-49e1-4c04-a8ee-7a7bf930b3a8&page=queryresults
[0m19:25:06.555082 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fda1220>]}
[0m19:25:06.556328 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.60s]
[0m19:25:06.557409 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m19:25:06.558085 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:25:06.558845 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m19:25:06.559577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m19:25:06.560097 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:25:06.565136 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:25:06.566380 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:25:06.570212 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:06.949447 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:25:06.951564 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m19:25:07.874948 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4048ffdd-7abf-4a56-bf2d-f3f57b1b924e&page=queryresults
[0m19:25:10.794872 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe4fad0>]}
[0m19:25:10.796841 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.24s]
[0m19:25:10.797712 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:25:10.799355 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m19:25:10.800474 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m19:25:10.801354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m19:25:10.801927 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m19:25:10.816031 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m19:25:10.817197 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m19:25:10.839915 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m19:25:10.840972 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:10.918092 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m19:25:11.563616 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:714fbdff-3070-441a-a704-7782147b41f9&page=queryresults
[0m19:25:11.794157 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106024050>]}
[0m19:25:11.795420 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.99s]
[0m19:25:11.796497 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m19:25:11.797457 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:25:11.798241 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m19:25:11.798990 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m19:25:11.799551 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:25:11.806088 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m19:25:11.808582 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:25:11.810401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:25:12.199092 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days,  -- Subscription length in days
        customer_country,
        taxonomy_business_category_group,
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months,
        
        -- Calculate the number of churned customers as those who have a non-null to_date before today
        count(distinct case when to_date is not null and to_date < current_date() then customer_id end) as customers_churned
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months, including churn rate and months since acquisition
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        
        -- Retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months,
        
        -- Churn percentage
        round((safe_divide(customers_churned, total_customers) * 100), 2) as churn_percentage,
        
        -- Additional timeline-related metrics
        date_diff(current_date(), cohort_month, month) as months_since_acquisition
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates, grouped by country and business category
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m19:25:12.997554 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bb90cec8-b97b-4015-81c4-ad6a6ac6b649&page=queryresults
[0m19:25:13.177903 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months, 
      
    cast(null as float64)
 as churn_percentage, 
      
    cast(null as int64)
 as months_since_acquisition
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m19:25:13.511567 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:28cbc5e5-55b4-45fb-b17c-472652102660&page=queryresults
[0m19:25:13.668396 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m19:25:13.670010 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    total_customers int64,
    customer_country string,
    taxonomy_business_category_group string,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64,
    churn_percentage float64,
    months_since_acquisition int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, total_customers, customer_country, taxonomy_business_category_group, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months, churn_percentage, months_since_acquisition
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days,  -- Subscription length in days
        customer_country,
        taxonomy_business_category_group,
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months,
        
        -- Calculate the number of churned customers as those who have a non-null to_date before today
        count(distinct case when to_date is not null and to_date < current_date() then customer_id end) as customers_churned
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months, including churn rate and months since acquisition
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        
        -- Retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months,
        
        -- Churn percentage
        round((safe_divide(customers_churned, total_customers) * 100), 2) as churn_percentage,
        
        -- Additional timeline-related metrics
        date_diff(current_date(), cohort_month, month) as months_since_acquisition
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates, grouped by country and business category
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m19:25:14.360129 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:75528997-427b-402d-99a2-7391b00418b7&page=queryresults
[0m19:25:32.197901 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8cd62c81-eeb0-4b2f-baac-6842bed3abc1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f814230>]}
[0m19:25:32.200321 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 20.40s]
[0m19:25:32.201426 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:25:32.202930 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:25:32.203340 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m19:25:32.203827 [info ] [MainThread]: 
[0m19:25:32.204244 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 37.24 seconds (37.24s).
[0m19:25:32.205812 [debug] [MainThread]: Command end result
[0m19:25:32.249799 [info ] [MainThread]: 
[0m19:25:32.250178 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:25:32.250407 [info ] [MainThread]: 
[0m19:25:32.250631 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m19:25:32.252979 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 38.484245, "process_user_time": 4.525043, "process_kernel_time": 0.374808, "process_mem_max_rss": "208388096", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:25:32.253331 [debug] [MainThread]: Command `dbt run` succeeded at 19:25:32.253273 after 38.48 seconds
[0m19:25:32.253569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f307440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b36e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b2270>]}
[0m19:25:32.253788 [debug] [MainThread]: Flushing usage events
[0m19:43:39.003795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ecfe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11998a990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119c2ec00>]}


============================== 19:43:39.006707 | 534ce343-7991-4e39-a476-c5e4e1ee4711 ==============================
[0m19:43:39.006707 [info ] [MainThread]: Running with dbt=1.8.5
[0m19:43:39.007040 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:43:39.837142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bfcd070>]}
[0m19:43:39.861010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x149c78380>]}
[0m19:43:39.861312 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m19:43:39.883305 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m19:43:39.969723 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m19:43:39.970138 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m19:43:39.970314 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m19:43:40.099925 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m19:43:40.106075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ee722a0>]}
[0m19:43:40.202496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e9b1b80>]}
[0m19:43:40.202823 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m19:43:40.203001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ea53440>]}
[0m19:43:40.204043 [info ] [MainThread]: 
[0m19:43:40.204329 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m19:43:40.206255 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m19:43:40.206474 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:43:40.615695 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:43:41.024024 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:43:41.376815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m19:43:41.378252 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:43:41.757204 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m19:43:41.758873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:43:42.152230 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m19:43:42.154852 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:43:42.538641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1467b1cd0>]}
[0m19:43:42.539803 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m19:43:42.540490 [info ] [MainThread]: 
[0m19:43:42.545335 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m19:43:42.546400 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m19:43:42.547558 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m19:43:42.548144 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m19:43:42.555951 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m19:43:42.557127 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m19:43:42.573251 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:43:42.960080 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m19:43:42.961102 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m19:43:43.411056 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:86dfe345-10e5-4b94-8a42-8d75e6599b89&page=queryresults
[0m19:43:46.513581 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ecc9a90>]}
[0m19:43:46.515346 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.97s]
[0m19:43:46.515979 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m19:43:46.516410 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m19:43:46.516988 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m19:43:46.517504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m19:43:46.517893 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m19:43:46.521300 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m19:43:46.522112 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m19:43:46.524780 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:43:46.866474 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m19:43:46.868747 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m19:43:47.330201 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:efb3d79a-e0ac-44f4-a5d8-9bf6bdd217d3&page=queryresults
[0m19:43:52.277075 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ea47aa0>]}
[0m19:43:52.278528 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.76s]
[0m19:43:52.280264 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m19:43:52.281051 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m19:43:52.281923 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m19:43:52.282705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m19:43:52.283222 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m19:43:52.288535 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m19:43:52.289791 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m19:43:52.293316 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:43:52.684745 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m19:43:52.687040 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m19:43:53.273794 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:02751e3c-f9b6-49d1-b241-4b4d7abaa060&page=queryresults
[0m19:43:56.237868 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ec82ed0>]}
[0m19:43:56.239204 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.96s]
[0m19:43:56.240211 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m19:43:56.241900 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m19:43:56.242782 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m19:43:56.243678 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m19:43:56.244165 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m19:43:56.257665 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m19:43:56.259701 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m19:43:56.280913 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m19:43:56.281895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:43:56.359669 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m19:43:57.152366 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cdb01bcb-9185-4437-a954-4aa8a5d2cece&page=queryresults
[0m19:43:57.382819 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14efcc5f0>]}
[0m19:43:57.383725 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m19:43:57.384349 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m19:43:57.385090 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:43:57.385627 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m19:43:57.386132 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m19:43:57.386525 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:43:57.392020 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m19:43:57.394570 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:43:57.397135 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:43:57.772063 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m19:43:58.547731 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a37422ae-2af9-4f15-bd9a-3eeb9fd5d96b&page=queryresults
[0m19:43:58.711943 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m19:43:59.178978 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:85ded040-712b-4b81-8659-690425af57db&page=queryresults
[0m19:43:59.338585 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m19:43:59.341155 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months
    select
        cohort_month,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates
select *
from cohort_retention_rates
order by cohort_month
    ) as model_subq
    );
  
[0m19:44:00.018062 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cec590de-127d-4390-909f-b789f82e4945&page=queryresults
[0m19:44:12.745283 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '534ce343-7991-4e39-a476-c5e4e1ee4711', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ea09100>]}
[0m19:44:12.747788 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 15.36s]
[0m19:44:12.749477 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m19:44:12.751401 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:44:12.751928 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m19:44:12.752480 [info ] [MainThread]: 
[0m19:44:12.752952 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 32.55 seconds (32.55s).
[0m19:44:12.754811 [debug] [MainThread]: Command end result
[0m19:44:12.801582 [info ] [MainThread]: 
[0m19:44:12.801925 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:44:12.802128 [info ] [MainThread]: 
[0m19:44:12.802330 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m19:44:12.804728 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 33.84355, "process_user_time": 4.531018, "process_kernel_time": 0.408715, "process_mem_max_rss": "208633856", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:44:12.805135 [debug] [MainThread]: Command `dbt run` succeeded at 19:44:12.805066 after 33.84 seconds
[0m19:44:12.805389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c66b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ecfe30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14eef6a20>]}
[0m19:44:12.805622 [debug] [MainThread]: Flushing usage events
[0m20:11:51.593868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c89fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b695e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f7adb0>]}


============================== 20:11:51.596731 | 27299189-c57a-4f49-bce3-ae57d2fb13b5 ==============================
[0m20:11:51.596731 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:11:51.597082 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_cohort_retention_analysis', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:11:52.459270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f832480>]}
[0m20:11:52.483057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f542f90>]}
[0m20:11:52.483356 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:11:52.505326 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:11:52.591848 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:11:52.592272 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.yml
[0m20:11:52.592443 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m20:11:52.724410 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:11:52.731161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034a1a90>]}
[0m20:11:52.824906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14815f1a0>]}
[0m20:11:52.825177 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:11:52.825344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14847f800>]}
[0m20:11:52.826326 [info ] [MainThread]: 
[0m20:11:52.826608 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:11:52.828501 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:11:52.828710 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:11:53.251586 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:11:53.687379 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:11:54.042798 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m20:11:54.044129 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:11:54.395056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m20:11:54.397634 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:11:54.769205 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m20:11:54.771124 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:11:55.145574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd3b200>]}
[0m20:11:55.147047 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:11:55.147586 [info ] [MainThread]: 
[0m20:11:55.153217 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:11:55.154355 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:11:55.155180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m20:11:55.155682 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:11:55.164862 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:11:55.166076 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:11:55.180287 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:11:55.589324 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:11:55.590270 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:11:56.055565 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:93b71426-1041-4a51-9944-fe931337f93d&page=queryresults
[0m20:11:58.807403 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10350e330>]}
[0m20:11:58.808446 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.65s]
[0m20:11:58.809169 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:11:58.809642 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:11:58.810210 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:11:58.810662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:11:58.811020 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:11:58.814325 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:11:58.815351 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:11:58.818386 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:11:59.187940 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:11:59.190621 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:11:59.708459 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e164236e-8c29-4b40-99b5-5617293b3053&page=queryresults
[0m20:12:04.019714 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148448a10>]}
[0m20:12:04.021085 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.21s]
[0m20:12:04.021984 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:12:04.022586 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:12:04.023367 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:12:04.024041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:12:04.024499 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:12:04.028896 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:12:04.029802 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:12:04.033123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:12:04.419672 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:12:04.420972 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:12:04.884825 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:885b3138-0ad4-4852-aec5-df620057c63f&page=queryresults
[0m20:12:07.641041 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14846e2d0>]}
[0m20:12:07.642909 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.62s]
[0m20:12:07.644308 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:12:07.645709 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:12:07.646651 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:12:07.647438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:12:07.648222 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:12:07.661873 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:12:07.662850 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:12:07.687024 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:12:07.688200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:12:07.767210 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:12:08.379811 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b715cffb-1324-4200-b2c6-09899869a7a9&page=queryresults
[0m20:12:08.767457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f5e060>]}
[0m20:12:08.768792 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.12s]
[0m20:12:08.769970 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:12:08.770982 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m20:12:08.771584 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m20:12:08.772147 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m20:12:08.772605 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m20:12:08.778407 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m20:12:08.780259 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m20:12:08.783798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:12:09.125519 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:12:09.951738 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3b94caf4-e5cc-46cc-a642-8863b561e6f3&page=queryresults
[0m20:12:10.179161 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:12:10.612230 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:013e6f82-c6ba-4d69-bba9-6380cb2e5caf&page=queryresults
[0m20:12:10.777988 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m20:12:10.780269 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m20:12:11.486822 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1879ba48-12b5-427a-b443-4d455c9d7282&page=queryresults
[0m20:12:23.727941 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27299189-c57a-4f49-bce3-ae57d2fb13b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd40cb0>]}
[0m20:12:23.729320 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 14.96s]
[0m20:12:23.730300 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m20:12:23.732560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:12:23.733421 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_cohort_retention_analysis' was properly closed.
[0m20:12:23.734044 [info ] [MainThread]: 
[0m20:12:23.734534 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 30.91 seconds (30.91s).
[0m20:12:23.736578 [debug] [MainThread]: Command end result
[0m20:12:23.773009 [info ] [MainThread]: 
[0m20:12:23.773433 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:12:23.773643 [info ] [MainThread]: 
[0m20:12:23.773843 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m20:12:23.776053 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 32.213768, "process_user_time": 4.519586, "process_kernel_time": 0.406673, "process_mem_max_rss": "209666048", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:12:23.776447 [debug] [MainThread]: Command `dbt run` succeeded at 20:12:23.776393 after 32.21 seconds
[0m20:12:23.776663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032d1100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fb99670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103ae6f30>]}
[0m20:12:23.776851 [debug] [MainThread]: Flushing usage events
[0m20:18:37.921366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104365c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104657020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104656cc0>]}


============================== 20:18:37.924116 | b383c257-f01c-455b-be53-e06adacc65b4 ==============================
[0m20:18:37.924116 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:18:37.924464 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:18:38.728531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102efea50>]}
[0m20:18:38.752313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103561730>]}
[0m20:18:38.752623 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:18:38.775360 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:18:38.861264 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:18:38.861669 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.yml
[0m20:18:38.861837 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:18:38.990628 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:18:38.996766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a576270>]}
[0m20:18:39.091773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a2b1be0>]}
[0m20:18:39.092057 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:18:39.092222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a67ca40>]}
[0m20:18:39.093200 [info ] [MainThread]: 
[0m20:18:39.093472 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:18:39.095352 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:18:39.095568 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:18:39.582451 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:18:39.952192 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:18:40.339859 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:18:40.341241 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:18:40.708067 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m20:18:40.709941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:18:41.105252 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m20:18:41.106919 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:18:41.465935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10301d730>]}
[0m20:18:41.467297 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:18:41.467891 [info ] [MainThread]: 
[0m20:18:41.472399 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:18:41.473208 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:18:41.473957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m20:18:41.474608 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:18:41.485433 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:18:41.486927 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:18:41.504943 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:41.932882 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:18:41.934099 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:18:42.438532 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9c2497cd-4cbc-4dc8-bae0-ee3b1fc5e880&page=queryresults
[0m20:18:45.171245 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a56bd40>]}
[0m20:18:45.172083 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.70s]
[0m20:18:45.173000 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:18:45.173411 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:18:45.173968 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:18:45.174472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:18:45.174855 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:18:45.178255 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:18:45.179504 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:18:45.182371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:45.530726 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:18:45.533764 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:18:46.137707 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:412ecebb-6bb3-4a55-89ed-4d60a520abca&page=queryresults
[0m20:18:50.050741 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a6c2570>]}
[0m20:18:50.053095 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.88s]
[0m20:18:50.054458 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:18:50.055138 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:18:50.055906 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:18:50.056698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:18:50.057213 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:18:50.062469 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:18:50.063696 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:18:50.067242 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:50.448398 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:18:50.450811 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:18:50.900050 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5f9cf09f-61b5-4cfe-b66e-14e61fae0c92&page=queryresults
[0m20:18:53.885295 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a613b60>]}
[0m20:18:53.886628 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.83s]
[0m20:18:53.887874 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:18:53.889450 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:18:53.890304 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:18:53.890998 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:18:53.891512 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:18:53.903317 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:18:53.904132 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:18:53.924319 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:18:53.925450 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:54.004895 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:18:54.915253 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a8302fd1-4961-4e3f-bbfd-031acfcf3c7c&page=queryresults
[0m20:18:55.255289 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a044b00>]}
[0m20:18:55.256759 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.36s]
[0m20:18:55.258416 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:18:55.259660 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:18:55.260500 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:18:55.261308 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:18:55.261839 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:18:55.269328 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:18:55.270898 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:18:55.273058 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:18:55.724905 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date, grouped by country and taxonomy
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date,
        customer_country,
        taxonomy_business_category_group
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition by country and taxonomy
    select
        acquisition_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn by country and taxonomy
    select
        churn_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month, customer_country, taxonomy_business_category_group
),

active_data as (
    -- calculate monthly retention by counting customers active in each month by country and taxonomy
    select
        date_trunc(monthly_date, month) as month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity` as activity
    join cohort_base as base on activity.customer_id = base.customer_id
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month, customer_country, taxonomy_business_category_group
)

-- final metrics table
select
    monthly_cohorts.acquisition_month as month,
    monthly_cohorts.customer_country,
    monthly_cohorts.taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data 
    on monthly_cohorts.acquisition_month = churn_data.churn_month
    and monthly_cohorts.customer_country = churn_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = churn_data.taxonomy_business_category_group
left join active_data 
    on monthly_cohorts.acquisition_month = active_data.month
    and monthly_cohorts.customer_country = active_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = active_data.taxonomy_business_category_group
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:18:55.855523 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6c38be6b-4fa5-43c2-a18b-00bcfdd215b9&page=queryresults
[0m20:18:55.858907 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword UNNEST at [48:5]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got keyword UNNEST at [48:5]')
[0m20:18:56.248971 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6f7c3b3e-86ba-4caa-9638-a559323092bc&page=queryresults
[0m20:18:56.251925 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6f7c3b3e-86ba-4caa-9638-a559323092bc&page=queryresults
[0m20:18:56.268121 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got keyword UNNEST at [48:5]
[0m20:18:56.268683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b383c257-f01c-455b-be53-e06adacc65b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a645280>]}
[0m20:18:56.269433 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 1.01s]
[0m20:18:56.270088 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:18:56.271606 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:18:56.272006 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:18:56.272426 [info ] [MainThread]: 
[0m20:18:56.272793 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 17.18 seconds (17.18s).
[0m20:18:56.274104 [debug] [MainThread]: Command end result
[0m20:18:56.313630 [info ] [MainThread]: 
[0m20:18:56.313979 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:18:56.314194 [info ] [MainThread]: 
[0m20:18:56.314446 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got keyword UNNEST at [48:5]
[0m20:18:56.314637 [info ] [MainThread]: 
[0m20:18:56.314836 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:18:56.316986 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 18.427467, "process_user_time": 4.453069, "process_kernel_time": 0.377448, "process_mem_max_rss": "208945152", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:18:56.317365 [debug] [MainThread]: Command `dbt run` failed at 20:18:56.317302 after 18.43 seconds
[0m20:18:56.317607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100956b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f619a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102098a70>]}
[0m20:18:56.317826 [debug] [MainThread]: Flushing usage events
[0m20:20:06.318286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104030cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10466ae40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034aa1e0>]}


============================== 20:20:06.320972 | cddeb6f8-4ba9-4515-8d03-57450c96b3d9 ==============================
[0m20:20:06.320972 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:20:06.321308 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:20:07.129046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f67020>]}
[0m20:20:07.152804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4a9cd0>]}
[0m20:20:07.153117 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:20:07.176937 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:20:07.262098 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:20:07.262467 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:20:07.391044 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:20:07.397182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ccb05c0>]}
[0m20:20:07.490706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cc9b590>]}
[0m20:20:07.490979 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:20:07.491144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c91fc20>]}
[0m20:20:07.492154 [info ] [MainThread]: 
[0m20:20:07.492448 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:20:07.494322 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:20:07.494532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:20:07.868552 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:08.469463 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:08.851872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:20:08.853146 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:09.238405 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m20:20:09.240337 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:09.653288 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m20:20:09.655721 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:20:10.028080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cc54aa0>]}
[0m20:20:10.029499 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:20:10.030467 [info ] [MainThread]: 
[0m20:20:10.036064 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:20:10.037130 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:20:10.037934 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m20:20:10.038431 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:20:10.044836 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:20:10.046194 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:20:10.062317 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:10.450035 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:20:10.451057 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:20:10.926412 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:99cd6ac7-c1d2-45a4-9f2e-a89ef7a9b3f6&page=queryresults
[0m20:20:13.949546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1039c0fe0>]}
[0m20:20:13.950492 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.91s]
[0m20:20:13.951236 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:20:13.951652 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:20:13.952199 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:20:13.952725 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:20:13.953099 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:20:13.956475 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:20:13.957501 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:20:13.960328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:14.362091 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:20:14.364767 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:20:14.818578 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3676b6b9-e55e-4acb-8d5a-91dd381d3809&page=queryresults
[0m20:20:19.079777 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cbbb140>]}
[0m20:20:19.081440 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.13s]
[0m20:20:19.082963 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:20:19.083659 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:20:19.084529 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:20:19.085325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:20:19.085875 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:20:19.091066 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:20:19.092383 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:20:19.096327 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:19.502467 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:20:19.505672 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:20:20.038890 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d619a172-3ad6-4ec8-9bb9-a7d2e67b307a&page=queryresults
[0m20:20:23.035699 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ccb0dd0>]}
[0m20:20:23.037349 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.95s]
[0m20:20:23.038392 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:20:23.039756 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:20:23.041237 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:20:23.042256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:20:23.042900 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:20:23.056112 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:20:23.057147 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:20:23.079581 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:20:23.080614 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:23.158765 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:20:23.830691 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:300f1ac5-d229-4630-a896-6a07f9d4ad0e&page=queryresults
[0m20:20:24.076012 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cc754c0>]}
[0m20:20:24.076894 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.03s]
[0m20:20:24.077578 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:20:24.078474 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:20:24.079063 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:20:24.079512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:20:24.079866 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:20:24.084742 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:20:24.086162 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:20:24.088104 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:20:24.494999 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- Define each customer's acquisition date, active period, and any churn date, grouped by country and taxonomy
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date,
        customer_country,
        taxonomy_business_category_group
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- Calculate monthly cohorts for acquisition by country and taxonomy
    select
        acquisition_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- Calculate monthly churn by country and taxonomy
    select
        churn_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month, customer_country, taxonomy_business_category_group
),

active_data as (
    -- Calculate monthly retention by counting customers active in each month by country and taxonomy
    select
        date_trunc(activity_month, month) as month,
        base.customer_country,
        base.taxonomy_business_category_group,
        count(distinct base.customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity` as activity
    join cohort_base as base 
        on activity.customer_id = base.customer_id
    cross join unnest(generate_date_array(
        date_trunc(activity.from_date, month),
        date_trunc(activity.to_date, month),
        interval 1 month
    )) as activity_month
    group by month, base.customer_country, base.taxonomy_business_category_group
)

-- Final metrics table
select
    monthly_cohorts.acquisition_month as month,
    monthly_cohorts.customer_country,
    monthly_cohorts.taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data 
    on monthly_cohorts.acquisition_month = churn_data.churn_month
    and monthly_cohorts.customer_country = churn_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = churn_data.taxonomy_business_category_group
left join active_data 
    on monthly_cohorts.acquisition_month = active_data.month
    and monthly_cohorts.customer_country = active_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = active_data.taxonomy_business_category_group
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:20:25.185435 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e3d8762e-c58d-434a-9f75-017917e72240&page=queryresults
[0m20:20:25.190795 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for operator = for argument types: INT64, STRING\n  Signature: T1 = T1\n    Unable to find common supertype for templated argument <T1>\n      Input types for <T1>: {INT64, STRING} at [48:12]; reason: invalidQuery, location: query, message: No matching signature for operator = for argument types: INT64, STRING\n  Signature: T1 = T1\n    Unable to find common supertype for templated argument <T1>\n      Input types for <T1>: {INT64, STRING} at [48:12]')
[0m20:20:26.698247 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0e755664-4a1f-4207-b413-222769cf353c&page=queryresults
[0m20:20:26.701414 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0e755664-4a1f-4207-b413-222769cf353c&page=queryresults
[0m20:20:26.719080 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [48:12]
[0m20:20:26.719921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cddeb6f8-4ba9-4515-8d03-57450c96b3d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cbb9970>]}
[0m20:20:26.720711 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 2.64s]
[0m20:20:26.721412 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:20:26.722999 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:20:26.723331 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:20:26.723718 [info ] [MainThread]: 
[0m20:20:26.724061 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 19.23 seconds (19.23s).
[0m20:20:26.725350 [debug] [MainThread]: Command end result
[0m20:20:26.764065 [info ] [MainThread]: 
[0m20:20:26.764399 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:20:26.764598 [info ] [MainThread]: 
[0m20:20:26.764847 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [48:12]
[0m20:20:26.765042 [info ] [MainThread]: 
[0m20:20:26.765234 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:20:26.767301 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 20.479954, "process_user_time": 4.475422, "process_kernel_time": 0.393418, "process_mem_max_rss": "208781312", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:20:26.767632 [debug] [MainThread]: Command `dbt run` failed at 20:20:26.767576 after 20.48 seconds
[0m20:20:26.767853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10096ab40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104030cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cccf260>]}
[0m20:20:26.768055 [debug] [MainThread]: Flushing usage events
[0m20:34:02.325248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10888a420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108af2ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108af2db0>]}


============================== 20:34:02.327913 | c1abe333-3cd5-476d-970e-8a6338d65ac0 ==============================
[0m20:34:02.327913 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:34:02.328234 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'send_anonymous_usage_stats': 'True'}
[0m20:34:03.154453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1477c9730>]}
[0m20:34:03.178234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad6c00>]}
[0m20:34:03.178546 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:34:03.200766 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:34:03.294782 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:34:03.295151 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:34:03.424917 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:34:03.431071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479d0770>]}
[0m20:34:03.524078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147efec60>]}
[0m20:34:03.524364 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:34:03.524527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c5f2f0>]}
[0m20:34:03.525493 [info ] [MainThread]: 
[0m20:34:03.525768 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:34:03.527666 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:34:03.527875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:34:04.030077 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:04.360514 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:04.724734 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m20:34:04.726006 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:05.106866 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m20:34:05.108389 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:05.506239 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m20:34:05.508290 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:05.897819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14776ffe0>]}
[0m20:34:05.899382 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:34:05.899967 [info ] [MainThread]: 
[0m20:34:05.905525 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:34:05.906777 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:34:05.907664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m20:34:05.908212 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:34:05.914495 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:34:05.915486 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:34:05.930100 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:06.329325 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:34:06.330456 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:34:06.723240 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8365626a-2f16-4327-9db4-f33d13b10cfa&page=queryresults
[0m20:34:09.799540 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147de0f20>]}
[0m20:34:09.800475 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.89s]
[0m20:34:09.801209 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:34:09.801652 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:34:09.802241 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:34:09.802771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:34:09.803165 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:34:09.806593 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:34:09.808800 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:34:09.811552 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:10.193003 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:34:10.196340 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:34:10.716084 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a0038286-bcd3-4ca7-b12a-22eae44f85a5&page=queryresults
[0m20:34:15.973350 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147b40b30>]}
[0m20:34:15.974604 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 6.17s]
[0m20:34:15.975502 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:34:15.976104 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:34:15.976870 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:34:15.977586 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:34:15.978119 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:34:15.983241 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:34:15.984449 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:34:15.988335 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:16.335273 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:34:16.337924 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:34:16.645585 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:38792b5b-3e86-402c-a680-4f9b97b9c565&page=queryresults
[0m20:34:19.698394 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147de0f20>]}
[0m20:34:19.699891 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.72s]
[0m20:34:19.700772 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:34:19.702620 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:34:19.703797 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:34:19.704479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:34:19.704993 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:34:19.717669 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:34:19.718471 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:34:19.741247 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:34:19.742284 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:19.820549 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:34:20.547264 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:04a9f808-d05b-4780-a3f4-dbbbb6b1ec03&page=queryresults
[0m20:34:20.776023 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147e5c3e0>]}
[0m20:34:20.777387 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.07s]
[0m20:34:20.778868 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:34:20.780042 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:34:20.780842 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:34:20.781454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:34:20.781935 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:34:20.788379 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:34:20.790307 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:34:20.792132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:21.151474 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- Define each customer's acquisition date, active period, and any churn date, grouped by country and taxonomy
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date,
        customer_country,
        taxonomy_business_category_group
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- Calculate monthly cohorts for acquisition by country and taxonomy
    select
        acquisition_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- Calculate monthly churn by country and taxonomy
    select
        churn_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month, customer_country, taxonomy_business_category_group
),

active_data as (
    -- Calculate monthly retention by counting customers active in each month by country and taxonomy
    select
        date_trunc(activity_month, month) as month,
        base.customer_country,
        base.taxonomy_business_category_group,
        count(distinct cast(base.customer_id as string) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity` as activity
    join cohort_base as base 
        on activity.customer_id = base.customer_id
    cross join unnest(generate_date_array(
        date_trunc(activity.from_date, month),
        date_trunc(activity.to_date, month),
        interval 1 month
    )) as activity_month
    group by month, base.customer_country, base.taxonomy_business_category_group
)

-- Final metrics table
select
    monthly_cohorts.acquisition_month as month,
    monthly_cohorts.customer_country,
    monthly_cohorts.taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data 
    on monthly_cohorts.acquisition_month = churn_data.churn_month
    and monthly_cohorts.customer_country = churn_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = churn_data.taxonomy_business_category_group
left join active_data 
    on monthly_cohorts.acquisition_month = active_data.month
    and monthly_cohorts.customer_country = active_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = active_data.taxonomy_business_category_group
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:34:21.387392 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6b9f991a-2886-4e71-8d66-19787b91df14&page=queryresults
[0m20:34:21.390096 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got keyword FROM at [46:5]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got keyword FROM at [46:5]')
[0m20:34:22.287316 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3c60505f-36d4-4c65-b77b-79230940d70b&page=queryresults
[0m20:34:22.288442 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3c60505f-36d4-4c65-b77b-79230940d70b&page=queryresults
[0m20:34:22.301382 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got keyword FROM at [46:5]
[0m20:34:22.301864 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1abe333-3cd5-476d-970e-8a6338d65ac0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147eac200>]}
[0m20:34:22.302348 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 1.52s]
[0m20:34:22.302772 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:34:22.303842 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:34:22.304109 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:34:22.304402 [info ] [MainThread]: 
[0m20:34:22.304644 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 18.78 seconds (18.78s).
[0m20:34:22.305658 [debug] [MainThread]: Command end result
[0m20:34:22.336208 [info ] [MainThread]: 
[0m20:34:22.336510 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:34:22.336685 [info ] [MainThread]: 
[0m20:34:22.336891 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got keyword FROM at [46:5]
[0m20:34:22.337048 [info ] [MainThread]: 
[0m20:34:22.337208 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:34:22.339309 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 20.046759, "process_user_time": 4.408339, "process_kernel_time": 0.389129, "process_mem_max_rss": "210550784", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:34:22.339690 [debug] [MainThread]: Command `dbt run` failed at 20:34:22.339632 after 20.05 seconds
[0m20:34:22.339909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147c3b4a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c3c170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147e45550>]}
[0m20:34:22.340098 [debug] [MainThread]: Flushing usage events
[0m20:34:49.393893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ad9d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065b6ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065b6b70>]}


============================== 20:34:49.397121 | 032d3c4a-13f6-4e98-8382-8f21f50f0b6b ==============================
[0m20:34:49.397121 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:34:49.397466 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:34:50.207739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065dd730>]}
[0m20:34:50.231410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065b4860>]}
[0m20:34:50.231726 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:34:50.253301 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:34:50.336195 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:34:50.336580 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:34:50.464389 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:34:50.470726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137adaea0>]}
[0m20:34:50.562742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137ac0c50>]}
[0m20:34:50.563023 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:34:50.563188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1340f09b0>]}
[0m20:34:50.564206 [info ] [MainThread]: 
[0m20:34:50.564495 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:34:50.566409 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:34:50.566645 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:34:50.920897 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:51.285850 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:51.733197 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m20:34:51.733841 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:52.084577 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m20:34:52.087854 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:52.452348 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m20:34:52.455345 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:34:52.814129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1346a1700>]}
[0m20:34:52.815901 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:34:52.816493 [info ] [MainThread]: 
[0m20:34:52.822854 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:34:52.823814 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:34:52.824778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:34:52.825393 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:34:52.833432 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:34:52.834451 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:34:52.853484 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:53.255784 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:34:53.256923 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:34:53.726886 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cd1cf4b3-28b1-4ac4-9f98-8843d3007e81&page=queryresults
[0m20:34:56.454818 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137894ad0>]}
[0m20:34:56.455702 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.63s]
[0m20:34:56.456397 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:34:56.456847 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:34:56.457390 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:34:56.457885 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:34:56.458241 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:34:56.461570 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:34:56.462556 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:34:56.465366 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:34:56.842136 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:34:56.845476 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:34:57.220350 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6d60d6e0-394b-423b-8628-be948cbdd52b&page=queryresults
[0m20:35:01.747090 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a52b10>]}
[0m20:35:01.748031 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.29s]
[0m20:35:01.748860 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:35:01.749408 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:35:01.750161 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:35:01.750872 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:35:01.751322 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:35:01.755542 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:35:01.757020 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:35:01.760720 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:35:02.155715 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:35:02.158666 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:35:02.632661 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a6fb9048-40ee-4fc8-8db6-3332aa2a706b&page=queryresults
[0m20:35:05.974324 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137aa2f90>]}
[0m20:35:05.975122 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.22s]
[0m20:35:05.975807 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:35:05.976613 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:35:05.977202 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:35:05.977777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:35:05.978204 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:35:05.989822 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:35:05.990559 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:35:06.008678 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:35:06.009310 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:35:06.084163 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:35:06.729304 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fe848220-6565-479f-b62d-69bbc2dd7664&page=queryresults
[0m20:35:06.980416 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137bc5e20>]}
[0m20:35:06.981781 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m20:35:06.982827 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:35:06.983859 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:35:06.984583 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:35:06.985210 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:35:06.985686 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:35:06.992379 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:35:06.993130 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:35:06.995250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:35:07.391886 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- Define each customer's acquisition date, active period, and any churn date, grouped by country and taxonomy
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date,
        customer_country,
        taxonomy_business_category_group
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- Calculate monthly cohorts for acquisition by country and taxonomy
    select
        acquisition_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- Calculate monthly churn by country and taxonomy
    select
        churn_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month, customer_country, taxonomy_business_category_group
),

active_data as (
    -- Calculate monthly retention by counting customers active in each month by country and taxonomy
    select
        date_trunc(activity_month, month) as month,
        base.customer_country,
        base.taxonomy_business_category_group,
        count(distinct cast(base.customer_id as string)) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity` as activity
    join cohort_base as base 
        on activity.customer_id = base.customer_id
    cross join unnest(generate_date_array(
        date_trunc(activity.from_date, month),
        date_trunc(activity.to_date, month),
        interval 1 month
    )) as activity_month
    group by month, base.customer_country, base.taxonomy_business_category_group
)

-- Final metrics table
select
    monthly_cohorts.acquisition_month as month,
    monthly_cohorts.customer_country,
    monthly_cohorts.taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data 
    on monthly_cohorts.acquisition_month = churn_data.churn_month
    and monthly_cohorts.customer_country = churn_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = churn_data.taxonomy_business_category_group
left join active_data 
    on monthly_cohorts.acquisition_month = active_data.month
    and monthly_cohorts.customer_country = active_data.customer_country
    and monthly_cohorts.taxonomy_business_category_group = active_data.taxonomy_business_category_group
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:35:08.164946 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:821ca85f-5091-4d30-9ad3-566ef1752f6d&page=queryresults
[0m20:35:08.167750 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('No matching signature for operator = for argument types: INT64, STRING\n  Signature: T1 = T1\n    Unable to find common supertype for templated argument <T1>\n      Input types for <T1>: {INT64, STRING} at [48:12]; reason: invalidQuery, location: query, message: No matching signature for operator = for argument types: INT64, STRING\n  Signature: T1 = T1\n    Unable to find common supertype for templated argument <T1>\n      Input types for <T1>: {INT64, STRING} at [48:12]')
[0m20:35:09.390179 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e992da08-c1e2-46d6-8f3a-a03baf78fde7&page=queryresults
[0m20:35:09.391233 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e992da08-c1e2-46d6-8f3a-a03baf78fde7&page=queryresults
[0m20:35:09.404086 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [48:12]
[0m20:35:09.404509 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '032d3c4a-13f6-4e98-8382-8f21f50f0b6b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137a93020>]}
[0m20:35:09.404941 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 2.42s]
[0m20:35:09.405337 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:35:09.406483 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:35:09.406703 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:35:09.406939 [info ] [MainThread]: 
[0m20:35:09.407147 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 18.84 seconds (18.84s).
[0m20:35:09.407908 [debug] [MainThread]: Command end result
[0m20:35:09.434953 [info ] [MainThread]: 
[0m20:35:09.435289 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:35:09.435462 [info ] [MainThread]: 
[0m20:35:09.435669 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  No matching signature for operator = for argument types: INT64, STRING
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {INT64, STRING} at [48:12]
[0m20:35:09.435827 [info ] [MainThread]: 
[0m20:35:09.435987 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:35:09.438376 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 20.081076, "process_user_time": 4.43988, "process_kernel_time": 0.378848, "process_mem_max_rss": "209829888", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:35:09.438795 [debug] [MainThread]: Command `dbt run` failed at 20:35:09.438724 after 20.08 seconds
[0m20:35:09.439089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10623c470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b3cd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a13a40>]}
[0m20:35:09.439298 [debug] [MainThread]: Flushing usage events
[0m20:38:17.092020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111186300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111327050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111326cf0>]}


============================== 20:38:17.094674 | 324701fb-a370-46f6-a838-228a5deeab84 ==============================
[0m20:38:17.094674 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:38:17.094983 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:38:17.920056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '324701fb-a370-46f6-a838-228a5deeab84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146b9f080>]}
[0m20:38:17.943877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '324701fb-a370-46f6-a838-228a5deeab84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1468d0110>]}
[0m20:38:17.944242 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:38:17.966431 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:38:18.053325 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:38:18.053732 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.yml
[0m20:38:18.053906 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:38:18.158273 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.manual_pasfield.mart_customer_metrics' (models/marts/mart_customer_metrics.sql) depends on a node named 'activity' which was not found
[0m20:38:18.160512 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1008881, "process_user_time": 2.849056, "process_kernel_time": 0.322006, "process_mem_max_rss": "202326016", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:38:18.160856 [debug] [MainThread]: Command `dbt run` failed at 20:38:18.160802 after 1.10 seconds
[0m20:38:18.161073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111326ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075a2a80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f845f0>]}
[0m20:38:18.161252 [debug] [MainThread]: Flushing usage events
[0m20:41:10.815755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f52540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b1afc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b1ad20>]}


============================== 20:41:10.818541 | f810bbd6-a768-4f76-88fd-8c9ffe1b9630 ==============================
[0m20:41:10.818541 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:41:10.818891 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:41:11.635887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bbc3b0>]}
[0m20:41:11.660149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074259d0>]}
[0m20:41:11.660455 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:41:11.682187 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:41:11.768578 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m20:41:11.769001 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.yml
[0m20:41:11.769171 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:41:11.898878 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:41:11.905044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121fabfb0>]}
[0m20:41:11.998617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121b696a0>]}
[0m20:41:11.998899 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:41:11.999066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c48080>]}
[0m20:41:12.000059 [info ] [MainThread]: 
[0m20:41:12.000333 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:41:12.002199 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:41:12.002407 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:41:12.435525 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:12.782523 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:13.172411 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m20:41:13.173741 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:13.538175 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m20:41:13.541443 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:13.925961 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m20:41:13.928503 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:14.314862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bc4e870>]}
[0m20:41:14.316383 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:41:14.316999 [info ] [MainThread]: 
[0m20:41:14.322620 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:41:14.323562 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:41:14.324395 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m20:41:14.324963 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:41:14.335222 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:41:14.336187 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:41:14.351863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:14.748855 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:41:14.750013 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:41:15.371398 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:926e80fe-9810-4787-9c38-5eba9f3b765c&page=queryresults
[0m20:41:18.077281 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121e9f050>]}
[0m20:41:18.078599 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.75s]
[0m20:41:18.079220 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:41:18.079645 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:41:18.080223 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:41:18.080736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:41:18.081097 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:41:18.084268 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:41:18.085049 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:41:18.087647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:18.454345 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:41:18.457474 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:41:18.931611 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b101c878-54ef-4183-8409-7edbd26f3fcc&page=queryresults
[0m20:41:23.162839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c1fb60>]}
[0m20:41:23.165185 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.08s]
[0m20:41:23.166525 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:41:23.167472 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:41:23.168372 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:41:23.169107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:41:23.170374 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:41:23.176384 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:41:23.178601 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:41:23.182748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:23.566894 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:41:23.569179 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:41:24.032060 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c73d03fe-221a-49e6-a556-1d3c0d2bf92d&page=queryresults
[0m20:41:27.889752 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104effbc0>]}
[0m20:41:27.890800 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.72s]
[0m20:41:27.891577 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:41:27.892402 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:41:27.893041 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:41:27.893503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:41:27.893825 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:41:27.904016 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:41:27.904635 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:41:27.920564 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:41:27.921510 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:27.994960 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:41:28.507156 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1c972a73-9209-45d5-b366-d9b74df30e1c&page=queryresults
[0m20:41:28.848150 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1220d0bf0>]}
[0m20:41:28.849045 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.95s]
[0m20:41:28.849766 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:41:28.850474 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:41:28.851114 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:41:28.851679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:41:28.852131 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:41:28.857223 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:41:28.859254 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:41:28.861436 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:29.242462 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month;
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:41:29.364457 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c43f1753-08ec-4fd1-82fe-d28e0e0a7221&page=queryresults
[0m20:41:29.365385 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Expected ")" but got ";" at [54:27]; reason: invalidQuery, location: query, message: Syntax error: Expected ")" but got ";" at [54:27]')
[0m20:41:30.026595 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c982f4e2-029e-4ef2-88a3-987519d5713c&page=queryresults
[0m20:41:30.027256 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c982f4e2-029e-4ef2-88a3-987519d5713c&page=queryresults
[0m20:41:30.036556 [debug] [Thread-1 (]: Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got ";" at [54:27]
[0m20:41:30.036970 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f810bbd6-a768-4f76-88fd-8c9ffe1b9630', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121e9f500>]}
[0m20:41:30.037370 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 1.19s]
[0m20:41:30.037726 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:41:30.038560 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:41:30.038758 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:41:30.038955 [info ] [MainThread]: 
[0m20:41:30.039125 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 18.04 seconds (18.04s).
[0m20:41:30.039700 [debug] [MainThread]: Command end result
[0m20:41:30.064262 [info ] [MainThread]: 
[0m20:41:30.064537 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:41:30.064684 [info ] [MainThread]: 
[0m20:41:30.064868 [error] [MainThread]:   Database Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  Syntax error: Expected ")" but got ";" at [54:27]
[0m20:41:30.065005 [info ] [MainThread]: 
[0m20:41:30.065145 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:41:30.067013 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 19.28218, "process_user_time": 4.373578, "process_kernel_time": 0.391685, "process_mem_max_rss": "211533824", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:41:30.067352 [debug] [MainThread]: Command `dbt run` failed at 20:41:30.067300 after 19.28 seconds
[0m20:41:30.067556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863b950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121f13740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121f13920>]}
[0m20:41:30.067723 [debug] [MainThread]: Flushing usage events
[0m20:41:42.446519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ad64b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d3eff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d3ec90>]}


============================== 20:41:42.449288 | 905a3549-9bbb-439c-bf56-6db77743f956 ==============================
[0m20:41:42.449288 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:41:42.449607 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:41:43.229229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ab5c350>]}
[0m20:41:43.252992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b5a000>]}
[0m20:41:43.253300 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:41:43.274792 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:41:43.353667 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:41:43.354101 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:41:43.482577 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:41:43.488692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d32a270>]}
[0m20:41:43.580184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf5cc80>]}
[0m20:41:43.580468 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:41:43.580638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d32a0c0>]}
[0m20:41:43.581602 [info ] [MainThread]: 
[0m20:41:43.581874 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:41:43.583819 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:41:43.584033 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:41:43.958309 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:44.332798 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:44.710902 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m20:41:44.712135 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:45.071006 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m20:41:45.073390 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:45.436351 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m20:41:45.438218 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:45.809389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d098110>]}
[0m20:41:45.811072 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:41:45.811670 [info ] [MainThread]: 
[0m20:41:45.817273 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:41:45.818417 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:41:45.819113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m20:41:45.819604 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:41:45.830787 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:41:45.831786 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:41:45.849802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:46.276808 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:41:46.277958 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:41:46.788655 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:75083587-b9ec-4d1b-96e4-05877b9bc270&page=queryresults
[0m20:41:49.437155 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d245790>]}
[0m20:41:49.438071 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.62s]
[0m20:41:49.438695 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:41:49.439112 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:41:49.439678 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:41:49.440178 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:41:49.440539 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:41:49.443922 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:41:49.445005 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:41:49.447767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:49.803370 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:41:49.805780 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:41:50.301739 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1d833f22-9a67-4f4f-974e-935c4116dffd&page=queryresults
[0m20:41:54.540145 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cfb4c50>]}
[0m20:41:54.541514 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.10s]
[0m20:41:54.542374 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:41:54.542880 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:41:54.543545 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:41:54.544184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:41:54.544620 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:41:54.548957 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:41:54.549859 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:41:54.553542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:54.908586 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:41:54.911419 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:41:55.412066 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:68c4e3c1-7c7c-4f0f-accc-4e83ed76d772&page=queryresults
[0m20:41:58.456745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d36c9e0>]}
[0m20:41:58.458090 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.91s]
[0m20:41:58.459317 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:41:58.460995 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:41:58.461813 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:41:58.462520 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:41:58.463004 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:41:58.474794 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:41:58.475829 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:41:58.498464 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:41:58.499171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:58.577681 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:41:59.486660 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:feff97a6-0a11-44ef-9f70-611a50b288bd&page=queryresults
[0m20:41:59.823557 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d369d30>]}
[0m20:41:59.824705 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.36s]
[0m20:41:59.825719 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:41:59.826545 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:41:59.827333 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:41:59.828029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:41:59.828597 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:41:59.835018 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:41:59.835942 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:41:59.837712 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:42:00.275195 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:42:00.992386 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cce3820e-9567-4849-83ba-9c15c937a2d2&page=queryresults
[0m20:42:01.139110 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:42:01.457664 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:86e5beaf-de39-489d-bae8-a9253aa1c076&page=queryresults
[0m20:42:01.618797 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m20:42:01.620818 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- models/marts/customer_metrics.sql

with cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- final metrics table
select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as model_subq
    );
  
[0m20:42:02.286673 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f5edda94-4698-406f-8362-1da4a9f139c3&page=queryresults
[0m20:42:10.041968 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '905a3549-9bbb-439c-bf56-6db77743f956', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d300050>]}
[0m20:42:10.043746 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 10.21s]
[0m20:42:10.044878 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:42:10.046906 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:42:10.047496 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:42:10.048184 [info ] [MainThread]: 
[0m20:42:10.049010 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 26.47 seconds (26.47s).
[0m20:42:10.051335 [debug] [MainThread]: Command end result
[0m20:42:10.097559 [info ] [MainThread]: 
[0m20:42:10.097975 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:42:10.098223 [info ] [MainThread]: 
[0m20:42:10.098463 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m20:42:10.100886 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.695246, "process_user_time": 4.546807, "process_kernel_time": 0.364348, "process_mem_max_rss": "208060416", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:42:10.101336 [debug] [MainThread]: Command `dbt run` succeeded at 20:42:10.101263 after 27.70 seconds
[0m20:42:10.101589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104299430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d30c0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011bea20>]}
[0m20:42:10.101825 [debug] [MainThread]: Flushing usage events
[0m20:50:38.913103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e0f950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f2f170>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f2ef30>]}


============================== 20:50:38.915722 | f931d107-4adf-4d63-9e24-d453609f286b ==============================
[0m20:50:38.915722 [info ] [MainThread]: Running with dbt=1.8.5
[0m20:50:38.916032 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:50:39.738473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f08cb0>]}
[0m20:50:39.763759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104df1730>]}
[0m20:50:39.764187 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m20:50:39.787804 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m20:50:39.875436 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:50:39.875806 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m20:50:40.007961 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m20:50:40.014301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143151640>]}
[0m20:50:40.106997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143344740>]}
[0m20:50:40.107272 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m20:50:40.107436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103054800>]}
[0m20:50:40.108416 [info ] [MainThread]: 
[0m20:50:40.108690 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m20:50:40.110588 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m20:50:40.110806 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:50:40.558343 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:50:40.894583 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:50:41.294722 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m20:50:41.295627 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:50:41.654459 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m20:50:41.655700 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:50:42.016324 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m20:50:42.018239 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:50:42.404282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030374a0>]}
[0m20:50:42.405340 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m20:50:42.405948 [info ] [MainThread]: 
[0m20:50:42.410342 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m20:50:42.410829 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m20:50:42.411195 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m20:50:42.411559 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m20:50:42.417879 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m20:50:42.418987 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m20:50:42.432981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:50:42.831811 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m20:50:42.832473 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m20:50:43.387794 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6dd46a98-86f7-4913-98b6-2edfbe7237e6&page=queryresults
[0m20:50:46.424674 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1425aad20>]}
[0m20:50:46.425506 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.01s]
[0m20:50:46.426145 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m20:50:46.426479 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m20:50:46.426866 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m20:50:46.427213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m20:50:46.427462 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m20:50:46.431130 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m20:50:46.432007 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m20:50:46.435058 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:50:46.830957 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m20:50:46.832676 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m20:50:47.381973 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2640cc0f-1e22-4c9a-82c8-f16b5513a0bd&page=queryresults
[0m20:50:51.621425 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14359c9b0>]}
[0m20:50:51.623272 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.19s]
[0m20:50:51.624643 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m20:50:51.625269 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m20:50:51.626002 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m20:50:51.626405 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m20:50:51.626660 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m20:50:51.630616 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m20:50:51.632638 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m20:50:51.635013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:50:51.993244 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m20:50:51.995192 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m20:50:52.616444 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b4956cff-b4a5-4e86-a9db-658f4d2afec6&page=queryresults
[0m20:50:55.680869 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1436924e0>]}
[0m20:50:55.683784 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.05s]
[0m20:50:55.685074 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m20:50:55.686295 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m20:50:55.686969 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m20:50:55.687494 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m20:50:55.688482 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m20:50:55.698686 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m20:50:55.699686 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m20:50:55.723629 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m20:50:55.724561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:50:55.805729 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m20:50:56.394568 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a8215304-1ce1-46c8-935c-f445b7370ca5&page=queryresults
[0m20:50:56.660659 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1436b95e0>]}
[0m20:50:56.661801 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.97s]
[0m20:50:56.662637 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m20:50:56.664127 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m20:50:56.665227 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m20:50:56.665927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m20:50:56.666430 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m20:50:56.673291 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m20:50:56.675601 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m20:50:56.678174 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:50:57.074387 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

activity as (
    select 
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from activity,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:50:57.827766 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5a8b2f2e-e65e-493a-8e5f-eaaba1ab7ab9&page=queryresults
[0m20:50:57.994735 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m20:50:58.466661 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0921a3a7-8ae1-4933-a623-6ba393a54fbc&page=queryresults
[0m20:50:58.650352 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m20:50:58.652201 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

activity as (
    select 
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from activity,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100 as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as model_subq
    );
  
[0m20:50:59.262698 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:71529695-31bd-4b8c-b4e0-afd73d036148&page=queryresults
[0m20:51:05.993554 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f931d107-4adf-4d63-9e24-d453609f286b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104edb680>]}
[0m20:51:05.994636 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 9.33s]
[0m20:51:05.995423 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m20:51:05.996485 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:51:05.996776 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m20:51:05.997081 [info ] [MainThread]: 
[0m20:51:05.997334 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 25.89 seconds (25.89s).
[0m20:51:05.998258 [debug] [MainThread]: Command end result
[0m20:51:06.032650 [info ] [MainThread]: 
[0m20:51:06.033098 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:51:06.033359 [info ] [MainThread]: 
[0m20:51:06.033616 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m20:51:06.036252 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 27.161161, "process_user_time": 4.415887, "process_kernel_time": 0.397409, "process_mem_max_rss": "209027072", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:51:06.036734 [debug] [MainThread]: Command `dbt run` succeeded at 20:51:06.036653 after 27.16 seconds
[0m20:51:06.037036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049f6750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103757a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143356d20>]}
[0m20:51:06.037318 [debug] [MainThread]: Flushing usage events
[0m21:00:27.989484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084e1730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10952efc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10952ec90>]}


============================== 21:00:27.992149 | 5d9b024c-6bb8-41e8-ae56-178f3a76b2cf ==============================
[0m21:00:27.992149 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:00:27.992468 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:00:28.810672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d9b024c-6bb8-41e8-ae56-178f3a76b2cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109555820>]}
[0m21:00:28.834895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d9b024c-6bb8-41e8-ae56-178f3a76b2cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10875b860>]}
[0m21:00:28.835227 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:00:28.857663 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:00:28.945678 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:00:28.945960 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:00:28.948637 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:00:28.963865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d9b024c-6bb8-41e8-ae56-178f3a76b2cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14501e7e0>]}
[0m21:00:28.975496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d9b024c-6bb8-41e8-ae56-178f3a76b2cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1486e81d0>]}
[0m21:00:28.975788 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m21:00:28.975951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d9b024c-6bb8-41e8-ae56-178f3a76b2cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14535aa20>]}
[0m21:00:28.976919 [info ] [MainThread]: 
[0m21:00:28.977205 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:00:28.979117 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_mart'
[0m21:00:28.979322 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:00:29.489713 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m21:00:29.491920 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:00:29.850775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m21:00:29.852875 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:00:30.216004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d9b024c-6bb8-41e8-ae56-178f3a76b2cf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1447b5af0>]}
[0m21:00:30.217386 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:00:30.218124 [info ] [MainThread]: 
[0m21:00:30.221707 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:00:30.222416 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m21:00:30.222827 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:00:30.232476 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:00:30.233698 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:00:30.234494 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:00:30.235080 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:00:30.235900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:00:30.236239 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:00:30.238701 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:00:30.239431 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:00:30.239893 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:00:30.240149 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:00:30.240418 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:00:30.240628 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:00:30.242751 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:00:30.243206 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:00:30.243616 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:00:30.244057 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:00:30.244366 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:00:30.244610 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:00:30.251753 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:00:30.252283 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:00:30.252673 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:00:30.253101 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:00:30.253381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:00:30.253589 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:00:30.255796 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:00:30.256710 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:00:30.257063 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:00:30.257265 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m21:00:30.257474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m21:00:30.257650 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m21:00:30.259686 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m21:00:30.260363 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m21:00:30.260693 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m21:00:30.260890 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:00:30.261087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:00:30.261252 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:00:30.263799 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:00:30.264540 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:00:30.264923 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:00:30.265383 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:00:30.265535 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:00:30.266226 [debug] [MainThread]: Command end result
[0m21:00:30.321490 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m21:00:30.321702 [info ] [MainThread]: Building catalog
[0m21:00:30.324259 [debug] [ThreadPool]: Acquiring new bigquery connection 'manual-pasfield.information_schema'
[0m21:00:30.335145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:00:30.400715 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_mart`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_metrics')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_cohort_retention_analysis')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_retention_metrics')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m21:00:30.948572 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:20b416e6-19d3-4d47-a8f2-75e298848f7a&page=queryresults
[0m21:00:32.801738 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:00:32.894942 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_ref`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_activity')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_customers')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_acq_orders')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m21:00:33.524999 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c27090e6-a626-42ca-b873-3d4d66004625&page=queryresults
[0m21:00:35.549969 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:00:35.643666 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test')
                            and upper(table_name) = upper('prep_customer')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m21:00:36.055773 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:87f5c6fb-7790-4200-8063-ccd3a408328b&page=queryresults
[0m21:00:37.454732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:00:37.553754 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual`.__TABLES__ tables
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('activity')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('customers')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('acq_orders')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m21:00:38.085399 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:59036ba0-771a-4930-a820-3fbb8f2d82cc&page=queryresults
[0m21:00:41.006930 [info ] [MainThread]: Catalog written to /Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/target/catalog.json
[0m21:00:41.008982 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 13.054322, "process_user_time": 3.777807, "process_kernel_time": 0.345605, "process_mem_max_rss": "205373440", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:00:41.009330 [debug] [MainThread]: Command `dbt docs generate` succeeded at 21:00:41.009280 after 13.05 seconds
[0m21:00:41.009491 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m21:00:41.009610 [debug] [MainThread]: Connection 'manual-pasfield.information_schema' was properly closed.
[0m21:00:41.009750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144945280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056dd8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f5370>]}
[0m21:00:41.009913 [debug] [MainThread]: Flushing usage events
[0m21:01:33.644024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e861e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119027050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119026e10>]}


============================== 21:01:33.647028 | 5bf0dc99-3e85-4df3-9738-92ee7832c706 ==============================
[0m21:01:33.647028 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:01:33.647445 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:01:34.547112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5bf0dc99-3e85-4df3-9738-92ee7832c706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155acd6d0>]}
[0m21:01:34.571126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5bf0dc99-3e85-4df3-9738-92ee7832c706', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107445b20>]}
[0m21:02:45.503756 [error] [MainThread]: Encountered an error:

[0m21:02:45.512826 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m21:02:45.516763 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 71.90618, "process_user_time": 2.650164, "process_kernel_time": 0.402791, "process_mem_max_rss": "193347584", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:02:45.517613 [debug] [MainThread]: Command `dbt docs serve` failed at 21:02:45.517501 after 71.91 seconds
[0m21:02:45.518102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119026e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155acd6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155b9f500>]}
[0m21:02:45.518484 [debug] [MainThread]: Flushing usage events
[0m21:02:52.886822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cd2b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f82f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f82bd0>]}


============================== 21:02:52.889305 | 6d42088f-5182-4985-8ae1-7a8640c67c40 ==============================
[0m21:02:52.889305 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:02:52.889608 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:02:53.478747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13857deb0>]}
[0m21:02:53.502780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13808df10>]}
[0m21:02:53.503119 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:02:53.525057 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:02:53.615086 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:02:53.615484 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m21:02:53.746439 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:02:53.752589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138f41a60>]}
[0m21:02:53.848964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138fbf5f0>]}
[0m21:02:53.849270 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m21:02:53.849441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138f6e060>]}
[0m21:02:53.850467 [info ] [MainThread]: 
[0m21:02:53.850759 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:02:53.852740 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:02:53.852965 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:02:54.225361 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:02:54.567777 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:02:55.007646 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:02:55.008641 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:02:55.377829 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m21:02:55.379776 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:02:55.737330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m21:02:55.739987 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:02:56.086465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138c00e90>]}
[0m21:02:56.086923 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:02:56.087163 [info ] [MainThread]: 
[0m21:02:56.090950 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:02:56.091637 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m21:02:56.092387 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m21:02:56.093096 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:02:56.101078 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:02:56.102361 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:02:56.114954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:02:56.527239 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:02:56.528322 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m21:02:56.852847 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b01488a7-f1f0-424b-b61a-fdf155645d0f&page=queryresults
[0m21:02:59.852236 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138d94920>]}
[0m21:02:59.852766 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.76s]
[0m21:02:59.853168 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:02:59.853436 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:02:59.853790 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m21:02:59.854117 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:02:59.854364 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:02:59.856566 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:02:59.857125 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:02:59.858870 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:00.225165 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:03:00.226557 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m21:03:00.498271 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a6d03c03-8b5f-46c7-83e1-4917b3b78188&page=queryresults
[0m21:03:04.475182 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138974290>]}
[0m21:03:04.476373 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.62s]
[0m21:03:04.477215 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:03:04.477791 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:03:04.478458 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m21:03:04.479675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:03:04.480501 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:03:04.484677 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:03:04.485817 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:03:04.489296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:04.885010 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:03:04.886562 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m21:03:05.174547 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5b980175-2df3-44f9-97aa-a56eaa6a0b3d&page=queryresults
[0m21:03:08.901473 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138b1cb60>]}
[0m21:03:08.903460 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.42s]
[0m21:03:08.904465 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:03:08.906150 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:03:08.907174 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:03:08.908009 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:03:08.908621 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:03:08.919788 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:03:08.920453 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:03:08.941079 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:03:08.942067 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:09.023080 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:03:09.950721 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a2042a93-79db-4d69-8c31-8421799c6e8d&page=queryresults
[0m21:03:10.316922 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13981ddf0>]}
[0m21:03:10.318026 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.41s]
[0m21:03:10.318900 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:03:10.319996 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m21:03:10.320766 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m21:03:10.321417 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m21:03:10.321893 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m21:03:10.328022 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m21:03:10.329550 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m21:03:10.331837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:10.711319 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:03:11.397477 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e9687ed2-a9ee-475f-9885-02f4e4a91df3&page=queryresults
[0m21:03:11.821859 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:03:12.317555 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:96032bfb-628a-4aab-b893-a6cb30bb0911&page=queryresults
[0m21:03:12.522740 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m21:03:12.525122 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers
    from cohort_base
    group by acquisition_month
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month
    ) as model_subq
    );
  
[0m21:03:13.052149 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9110d626-2235-4a3d-814a-30fbc211bb16&page=queryresults
[0m21:03:29.040215 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d42088f-5182-4985-8ae1-7a8640c67c40', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138f13bc0>]}
[0m21:03:29.042217 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (68.0 rows, 57.8 MiB processed)[0m in 18.72s]
[0m21:03:29.043066 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m21:03:29.044451 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:03:29.044780 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m21:03:29.045192 [info ] [MainThread]: 
[0m21:03:29.045650 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 35.19 seconds (35.19s).
[0m21:03:29.046472 [debug] [MainThread]: Command end result
[0m21:03:29.086446 [info ] [MainThread]: 
[0m21:03:29.086802 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:03:29.087014 [info ] [MainThread]: 
[0m21:03:29.087228 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:03:29.090094 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 36.23637, "process_user_time": 4.354822, "process_kernel_time": 0.376149, "process_mem_max_rss": "208732160", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:03:29.090603 [debug] [MainThread]: Command `dbt run` succeeded at 21:03:29.090531 after 36.24 seconds
[0m21:03:29.090989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0cc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079e1070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138d6f020>]}
[0m21:03:29.091241 [debug] [MainThread]: Flushing usage events
[0m09:51:09.609188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a4a030>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cf3050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d43020>]}


============================== 09:51:09.611828 | b3af9044-51af-4479-9d51-abd00af193cd ==============================
[0m09:51:09.611828 [info ] [MainThread]: Running with dbt=1.8.5
[0m09:51:09.612138 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt docs generate', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m09:51:11.227255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3af9044-51af-4479-9d51-abd00af193cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b911460>]}
[0m09:51:11.251288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3af9044-51af-4479-9d51-abd00af193cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bbfbf20>]}
[0m09:51:11.251619 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m09:51:11.310996 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m09:51:11.398067 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:51:11.398314 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:51:11.400839 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m09:51:11.415885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3af9044-51af-4479-9d51-abd00af193cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075c0bf0>]}
[0m09:51:11.427016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3af9044-51af-4479-9d51-abd00af193cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d56c200>]}
[0m09:51:11.427324 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m09:51:11.427496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3af9044-51af-4479-9d51-abd00af193cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d400260>]}
[0m09:51:11.428523 [info ] [MainThread]: 
[0m09:51:11.428820 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m09:51:11.430748 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_mart'
[0m09:51:11.430974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:11.983909 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m09:51:11.986442 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:12.488578 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m09:51:12.491117 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:13.023792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3af9044-51af-4479-9d51-abd00af193cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082cc860>]}
[0m09:51:13.025220 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m09:51:13.025772 [info ] [MainThread]: 
[0m09:51:13.030712 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m09:51:13.031598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m09:51:13.032429 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m09:51:13.046451 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m09:51:13.048820 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m09:51:13.049581 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m09:51:13.049825 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m09:51:13.050091 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m09:51:13.050279 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m09:51:13.052397 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m09:51:13.053113 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m09:51:13.053646 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m09:51:13.054005 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m09:51:13.054390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m09:51:13.054708 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m09:51:13.057635 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m09:51:13.058328 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m09:51:13.058900 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m09:51:13.059499 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m09:51:13.059894 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m09:51:13.060481 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m09:51:13.069996 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m09:51:13.070836 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m09:51:13.071393 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m09:51:13.071894 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m09:51:13.072271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m09:51:13.072528 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m09:51:13.075152 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m09:51:13.076127 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m09:51:13.076617 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m09:51:13.076900 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m09:51:13.077193 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m09:51:13.077464 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m09:51:13.080033 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m09:51:13.080709 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m09:51:13.081121 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m09:51:13.081360 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m09:51:13.081598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m09:51:13.081805 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m09:51:13.084973 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m09:51:13.085715 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m09:51:13.086122 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m09:51:13.086641 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:51:13.086821 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m09:51:13.087620 [debug] [MainThread]: Command end result
[0m09:51:13.138887 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m09:51:13.139101 [info ] [MainThread]: Building catalog
[0m09:51:13.141615 [debug] [ThreadPool]: Acquiring new bigquery connection 'manual-pasfield.information_schema'
[0m09:51:13.152345 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:51:13.217454 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_ref`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_activity')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_acq_orders')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_customers')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m09:51:13.891952 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:70f2318d-4bf6-4d67-8605-20230f468e8c&page=queryresults
[0m09:51:15.400645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:15.487534 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual`.__TABLES__ tables
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('customers')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('acq_orders')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('activity')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m09:51:16.102455 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8e8709d4-ddb9-4817-9c0d-a7eab24c3104&page=queryresults
[0m09:51:17.787418 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:17.874861 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_mart`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_retention_metrics')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_metrics')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_cohort_retention_analysis')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m09:51:18.608119 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e03dcd7d-ad98-4ba7-90fc-7a9b2f17b604&page=queryresults
[0m09:51:20.204473 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:51:20.301786 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test')
                            and upper(table_name) = upper('prep_customer')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m09:51:21.128040 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:602b3661-cad4-4999-90b8-930ddb84988e&page=queryresults
[0m09:51:22.679556 [info ] [MainThread]: Catalog written to /Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/target/catalog.json
[0m09:51:22.681485 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 13.105404, "process_user_time": 3.985363, "process_kernel_time": 0.394046, "process_mem_max_rss": "205848576", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m09:51:22.681814 [debug] [MainThread]: Command `dbt docs generate` succeeded at 09:51:22.681767 after 13.11 seconds
[0m09:51:22.681971 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m09:51:22.682086 [debug] [MainThread]: Connection 'manual-pasfield.information_schema' was properly closed.
[0m09:51:22.682228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108267b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068c95e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d813110>]}
[0m09:51:22.682386 [debug] [MainThread]: Flushing usage events
[0m09:51:48.546531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a6d0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a2edb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a2ea50>]}


============================== 09:51:48.549338 | 3844db99-22e9-4d0b-8e70-d76b8374b388 ==============================
[0m09:51:48.549338 [info ] [MainThread]: Running with dbt=1.8.5
[0m09:51:48.549687 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt docs serve --port 8080', 'send_anonymous_usage_stats': 'True'}
[0m09:51:49.370562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3844db99-22e9-4d0b-8e70-d76b8374b388', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12081a480>]}
[0m09:51:49.394434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3844db99-22e9-4d0b-8e70-d76b8374b388', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e45ca0>]}
[0m10:08:59.728223 [error] [MainThread]: Encountered an error:

[0m10:08:59.744180 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m10:08:59.749343 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 1031.2211, "process_user_time": 2.864238, "process_kernel_time": 0.385705, "process_mem_max_rss": "193511424", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:08:59.752887 [debug] [MainThread]: Command `dbt docs serve` failed at 10:08:59.752645 after 1031.22 seconds
[0m10:08:59.753884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058878c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1210a4230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e2dd00>]}
[0m10:08:59.754563 [debug] [MainThread]: Flushing usage events
[0m10:09:20.427815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106022180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106312f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106312c00>]}


============================== 10:09:20.430478 | 6e9af80b-3883-421e-b2a4-c5b4cfa13439 ==============================
[0m10:09:20.430478 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:09:20.430789 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m10:09:21.269325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c39c10>]}
[0m10:09:21.293032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144e28f20>]}
[0m10:09:21.293354 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:09:21.315287 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:09:21.410120 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m10:09:21.410579 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.yml
[0m10:09:21.410751 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m10:09:21.540084 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m10:09:21.546210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145121a90>]}
[0m10:09:21.639504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1455c1310>]}
[0m10:09:21.639781 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m10:09:21.639947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145622180>]}
[0m10:09:21.640923 [info ] [MainThread]: 
[0m10:09:21.641200 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:09:21.643091 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m10:09:21.643304 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:09:22.233046 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:22.632128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:23.076349 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m10:09:23.077107 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:23.581033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m10:09:23.582905 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:24.039780 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m10:09:24.042289 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:09:24.606001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145597f80>]}
[0m10:09:24.607666 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:09:24.608277 [info ] [MainThread]: 
[0m10:09:24.614127 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:09:24.615290 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m10:09:24.616113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:09:24.616637 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:09:24.625147 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:09:24.625968 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:09:24.643932 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:25.162474 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m10:09:25.164589 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m10:09:25.661560 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:85ff2994-b2cc-4a3e-bbe4-ce3e42314832&page=queryresults
[0m10:09:29.306764 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1454dc050>]}
[0m10:09:29.307594 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.69s]
[0m10:09:29.308216 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:09:29.308637 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:09:29.309192 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m10:09:29.309708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:09:29.310107 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:09:29.313534 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:09:29.315300 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:09:29.317853 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:30.370218 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m10:09:30.372768 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m10:09:30.802575 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4039aa0c-d0fb-4e3c-b35e-fe555b3547e6&page=queryresults
[0m10:09:34.964368 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14549baa0>]}
[0m10:09:34.966835 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.65s]
[0m10:09:34.968633 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:09:34.969891 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:09:34.970813 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m10:09:34.971568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:09:34.972091 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:09:34.978405 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:09:34.979836 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:09:34.983364 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:35.563485 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m10:09:35.566656 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m10:09:36.009540 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f653739f-7bed-430a-84c8-56e07e97c9fb&page=queryresults
[0m10:09:39.559933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1455948c0>]}
[0m10:09:39.561724 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.59s]
[0m10:09:39.562735 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:09:39.564381 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:09:39.565702 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m10:09:39.566537 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:09:39.567231 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:09:39.582624 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:09:39.583883 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:09:39.606433 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m10:09:39.607549 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:39.684572 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m10:09:40.672252 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:48edea70-bc04-48c7-8193-5a0e1d62bc05&page=queryresults
[0m10:09:41.119008 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1456c4710>]}
[0m10:09:41.120429 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.55s]
[0m10:09:41.121780 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:09:41.123190 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m10:09:41.123909 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m10:09:41.124556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m10:09:41.125014 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m10:09:41.131328 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m10:09:41.133376 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m10:09:41.136797 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:09:41.552527 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m10:09:42.334063 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:48409c88-8b71-422f-9d18-9c55dfd87b0b&page=queryresults
[0m10:09:42.580693 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m10:09:43.010335 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:46b67d7a-1ac2-410f-a6eb-75beca54ea9c&page=queryresults
[0m10:09:43.236565 [debug] [Thread-1 (]: Compilation Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name                      | definition_type | contract_type | mismatch_reason       |
  | -------------------------------- | --------------- | ------------- | --------------------- |
  | acquired_customers               | STRING          | INT64         | data type mismatch    |
  | taxonomy_business_category_group |                 | STRING        | missing in definition |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
[0m10:09:43.237412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e9af80b-3883-421e-b2a4-c5b4cfa13439', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144f14c80>]}
[0m10:09:43.238213 [error] [Thread-1 (]: 5 of 5 ERROR creating sql table model manual_test_mart.mart_customer_metrics ... [[31mERROR[0m in 2.11s]
[0m10:09:43.239018 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m10:09:43.240574 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:09:43.240858 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m10:09:43.241224 [info ] [MainThread]: 
[0m10:09:43.241526 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 21.60 seconds (21.60s).
[0m10:09:43.242768 [debug] [MainThread]: Command end result
[0m10:09:43.279630 [info ] [MainThread]: 
[0m10:09:43.279951 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:09:43.280139 [info ] [MainThread]: 
[0m10:09:43.280400 [error] [MainThread]:   Compilation Error in model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name                      | definition_type | contract_type | mismatch_reason       |
  | -------------------------------- | --------------- | ------------- | --------------------- |
  | acquired_customers               | STRING          | INT64         | data type mismatch    |
  | taxonomy_business_category_group |                 | STRING        | missing in definition |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_metrics (models/marts/mart_customer_metrics.sql)
[0m10:09:43.280690 [info ] [MainThread]: 
[0m10:09:43.280913 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m10:09:43.283005 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 22.887562, "process_user_time": 4.590666, "process_kernel_time": 0.368932, "process_mem_max_rss": "209240064", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:09:43.283337 [debug] [MainThread]: Command `dbt run` failed at 10:09:43.283280 after 22.89 seconds
[0m10:09:43.283558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cdbce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102612b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14549bce0>]}
[0m10:09:43.283760 [debug] [MainThread]: Flushing usage events
[0m10:12:20.504104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074e2c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bfeea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bfeb40>]}


============================== 10:12:20.506880 | 7ed48ce0-6b10-4458-ac4d-d966c3f8436b ==============================
[0m10:12:20.506880 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:12:20.507231 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select +mart_customer_metrics', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:12:21.329992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b0a690>]}
[0m10:12:21.353693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eed0980>]}
[0m10:12:21.354204 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:12:21.376371 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:12:21.461892 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:12:21.462257 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m10:12:21.592115 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m10:12:21.598253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fa21e20>]}
[0m10:12:21.695343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fab22d0>]}
[0m10:12:21.695615 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m10:12:21.695780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ff98080>]}
[0m10:12:21.696746 [info ] [MainThread]: 
[0m10:12:21.697024 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:12:21.698930 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m10:12:21.699140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:12:22.268944 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:12:22.813999 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:12:23.327325 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m10:12:23.328626 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:12:23.859681 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m10:12:23.860847 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:12:24.371721 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m10:12:24.374152 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:12:24.970509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eca15b0>]}
[0m10:12:24.971977 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:12:24.972985 [info ] [MainThread]: 
[0m10:12:24.978625 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:12:24.979686 [info ] [Thread-1 (]: 1 of 5 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m10:12:24.980570 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:12:24.981164 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:12:24.990107 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:12:24.991215 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:12:25.008922 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:12:25.495427 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m10:12:25.496375 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m10:12:25.934752 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f1ad4e8a-9841-46cb-80be-3d72c08c5e73&page=queryresults
[0m10:12:29.454140 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd9d8e0>]}
[0m10:12:29.454949 [info ] [Thread-1 (]: 1 of 5 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.47s]
[0m10:12:29.455574 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:12:29.455986 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:12:29.456525 [info ] [Thread-1 (]: 2 of 5 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m10:12:29.457031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:12:29.457415 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:12:29.460792 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:12:29.462439 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:12:29.465314 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:12:29.932494 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m10:12:29.933587 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m10:12:30.511119 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a59b30e4-9e3a-4fc8-bda8-6c3998069bc9&page=queryresults
[0m10:12:34.799056 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd29a00>]}
[0m10:12:34.800018 [info ] [Thread-1 (]: 2 of 5 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.34s]
[0m10:12:34.800760 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:12:34.801224 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:12:34.801805 [info ] [Thread-1 (]: 3 of 5 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m10:12:34.802378 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:12:34.802816 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:12:34.806787 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:12:34.807736 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:12:34.810800 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:12:35.342357 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m10:12:35.345483 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m10:12:35.993343 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5fa1dfe7-de3f-43bf-a2f3-d6576c18f88e&page=queryresults
[0m10:12:38.719280 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fd9b470>]}
[0m10:12:38.720769 [info ] [Thread-1 (]: 3 of 5 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.92s]
[0m10:12:38.721666 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:12:38.723000 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:12:38.724344 [info ] [Thread-1 (]: 4 of 5 START sql view model manual_test.prep_customer .......................... [RUN]
[0m10:12:38.725066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:12:38.725566 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:12:38.737696 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:12:38.738699 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:12:38.761976 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m10:12:38.763100 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:12:38.841329 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m10:12:39.413973 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:50137b75-0b98-41e8-950e-ed5735edcda0&page=queryresults
[0m10:12:39.762189 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1500ccf20>]}
[0m10:12:39.762857 [info ] [Thread-1 (]: 4 of 5 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m10:12:39.763419 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:12:39.764036 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m10:12:39.764653 [info ] [Thread-1 (]: 5 of 5 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m10:12:39.765107 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_customer_metrics)
[0m10:12:39.765437 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m10:12:39.770008 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m10:12:39.771964 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m10:12:39.773940 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:12:40.215276 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m10:12:40.945036 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f2d92edb-2d9e-4826-b696-1aff7d39e58d&page=queryresults
[0m10:12:41.145246 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m10:12:41.586635 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0585027b-1c49-4e26-812d-830ed7d3656f&page=queryresults
[0m10:12:41.779099 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m10:12:41.781542 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m10:12:42.518285 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c7eda608-04b5-4cb4-bf2e-800fab14b758&page=queryresults
[0m10:13:00.503888 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ed48ce0-6b10-4458-ac4d-d966c3f8436b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ffb9190>]}
[0m10:13:00.505964 [info ] [Thread-1 (]: 5 of 5 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 20.74s]
[0m10:13:00.506846 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m10:13:00.508358 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:00.508786 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_metrics' was properly closed.
[0m10:13:00.509317 [info ] [MainThread]: 
[0m10:13:00.509749 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 38.81 seconds (38.81s).
[0m10:13:00.511433 [debug] [MainThread]: Command end result
[0m10:13:00.551520 [info ] [MainThread]: 
[0m10:13:00.551894 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:13:00.552134 [info ] [MainThread]: 
[0m10:13:00.552367 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m10:13:00.554583 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 40.082783, "process_user_time": 4.526569, "process_kernel_time": 0.394149, "process_mem_max_rss": "207896576", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:13:00.555013 [debug] [MainThread]: Command `dbt run` succeeded at 10:13:00.554943 after 40.08 seconds
[0m10:13:00.555277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104efeb40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cab6240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ff13d40>]}
[0m10:13:00.555517 [debug] [MainThread]: Flushing usage events
[0m10:22:17.267900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104be3200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f2ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f2b70>]}


============================== 10:22:17.270520 | de944980-48fe-440f-8d93-7e12863bfc93 ==============================
[0m10:22:17.270520 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:22:17.270831 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs generate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:22:18.107483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'de944980-48fe-440f-8d93-7e12863bfc93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126996fc0>]}
[0m10:22:18.131077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'de944980-48fe-440f-8d93-7e12863bfc93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1426e6f90>]}
[0m10:22:18.131370 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:22:18.153153 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:22:18.245599 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m10:22:18.245932 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/overview.md
[0m10:22:18.275680 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m10:22:18.281870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'de944980-48fe-440f-8d93-7e12863bfc93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142d9f800>]}
[0m10:22:18.294582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'de944980-48fe-440f-8d93-7e12863bfc93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143004830>]}
[0m10:22:18.294866 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m10:22:18.295030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de944980-48fe-440f-8d93-7e12863bfc93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1430ed700>]}
[0m10:22:18.296011 [info ] [MainThread]: 
[0m10:22:18.296304 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:22:18.298142 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_ref'
[0m10:22:18.298355 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:18.789033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m10:22:18.791485 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:19.880779 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m10:22:19.881884 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:20.310931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'de944980-48fe-440f-8d93-7e12863bfc93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142d44bc0>]}
[0m10:22:20.312503 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:22:20.313160 [info ] [MainThread]: 
[0m10:22:20.319061 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:22:20.319912 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m10:22:20.320701 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:22:20.332896 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:22:20.334806 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:22:20.335688 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:22:20.336157 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:22:20.336659 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:22:20.337128 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:22:20.342186 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:22:20.343242 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:22:20.343907 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:22:20.344293 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:22:20.344675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:22:20.344981 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:22:20.348012 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:22:20.348562 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:22:20.349040 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:22:20.349592 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:22:20.349931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:22:20.350199 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:22:20.359086 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:22:20.359596 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:22:20.360074 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:22:20.360562 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:22:20.360845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m10:22:20.361085 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:22:20.363655 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:22:20.364648 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:22:20.365080 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:22:20.365337 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m10:22:20.365608 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m10:22:20.365845 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m10:22:20.368393 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m10:22:20.369274 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m10:22:20.369661 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m10:22:20.369896 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:22:20.370155 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m10:22:20.370388 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m10:22:20.372518 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:22:20.373210 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m10:22:20.373628 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:22:20.374144 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:22:20.374328 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m10:22:20.375146 [debug] [MainThread]: Command end result
[0m10:22:20.426538 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m10:22:20.426802 [info ] [MainThread]: Building catalog
[0m10:22:20.429307 [debug] [ThreadPool]: Acquiring new bigquery connection 'manual-pasfield.information_schema'
[0m10:22:20.440130 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:20.505186 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_ref`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_customers')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_activity')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_acq_orders')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:22:21.099187 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:77826f98-e20f-4953-ac59-218fdd116d6d&page=queryresults
[0m10:22:22.574260 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:22.673152 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_mart`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_metrics')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_retention_metrics')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_cohort_retention_analysis')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:22:23.203343 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:224512db-2fd0-4d10-9ba2-cdcd19ea2997&page=queryresults
[0m10:22:25.590012 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:25.688213 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual`.__TABLES__ tables
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('acq_orders')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('customers')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('activity')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:22:26.176329 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4d262690-ee21-4be1-bc96-f884ded85783&page=queryresults
[0m10:22:27.614131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:27.683860 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test')
                            and upper(table_name) = upper('prep_customer')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:22:28.646690 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:592a76bc-f6b5-411a-9551-4c7638c3e78d&page=queryresults
[0m10:22:30.725619 [info ] [MainThread]: Catalog written to /Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/target/catalog.json
[0m10:22:30.728016 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 13.49368, "process_user_time": 3.897456, "process_kernel_time": 0.360455, "process_mem_max_rss": "204210176", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:22:30.728428 [debug] [MainThread]: Command `dbt docs generate` succeeded at 10:22:30.728368 after 13.49 seconds
[0m10:22:30.728627 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m10:22:30.728773 [debug] [MainThread]: Connection 'manual-pasfield.information_schema' was properly closed.
[0m10:22:30.728941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103fce060>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142c6a0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143123680>]}
[0m10:22:30.729135 [debug] [MainThread]: Flushing usage events
[0m10:22:53.874286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040bec30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104686ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104686ba0>]}


============================== 10:22:53.876882 | fd315323-fa6c-490c-8b75-7c3725561a2f ==============================
[0m10:22:53.876882 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:22:53.877211 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt docs serve --port 8080', 'send_anonymous_usage_stats': 'True'}
[0m10:22:54.675308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd315323-fa6c-490c-8b75-7c3725561a2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121446060>]}
[0m10:22:54.699287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd315323-fa6c-490c-8b75-7c3725561a2f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b8eff0>]}
[0m10:23:12.210330 [error] [MainThread]: Encountered an error:

[0m10:23:12.218724 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m10:23:12.223780 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 18.378983, "process_user_time": 2.66364, "process_kernel_time": 0.348994, "process_mem_max_rss": "193708032", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:23:12.224938 [debug] [MainThread]: Command `dbt docs serve` failed at 10:23:12.224784 after 18.38 seconds
[0m10:23:12.225580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040bec30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089cb920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ca23f80>]}
[0m10:23:12.226966 [debug] [MainThread]: Flushing usage events
[0m10:23:15.272733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082674a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972f200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972ef60>]}


============================== 10:23:15.275221 | be6107ec-cad5-4cc5-b745-89396cf4f592 ==============================
[0m10:23:15.275221 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:23:15.275527 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt docs generate', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:23:15.868358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'be6107ec-cad5-4cc5-b745-89396cf4f592', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128ac3da0>]}
[0m10:23:15.892633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'be6107ec-cad5-4cc5-b745-89396cf4f592', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1299daf90>]}
[0m10:23:15.892958 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m10:23:15.915382 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m10:23:16.001448 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m10:23:16.001800 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/overview.md
[0m10:23:16.031522 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m10:23:16.037950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'be6107ec-cad5-4cc5-b745-89396cf4f592', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ed1ed80>]}
[0m10:23:16.049693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'be6107ec-cad5-4cc5-b745-89396cf4f592', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ef46990>]}
[0m10:23:16.049979 [info ] [MainThread]: Found 7 models, 3 sources, 854 macros
[0m10:23:16.050142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be6107ec-cad5-4cc5-b745-89396cf4f592', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12edb0830>]}
[0m10:23:16.051095 [info ] [MainThread]: 
[0m10:23:16.051384 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m10:23:16.053239 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_ref'
[0m10:23:16.053451 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:16.473635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m10:23:16.475736 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:16.926178 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m10:23:16.928048 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:17.433724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'be6107ec-cad5-4cc5-b745-89396cf4f592', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107342120>]}
[0m10:23:17.435177 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m10:23:17.435744 [info ] [MainThread]: 
[0m10:23:17.441334 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m10:23:17.442390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m10:23:17.442970 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m10:23:17.454567 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m10:23:17.456465 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m10:23:17.457553 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m10:23:17.458053 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m10:23:17.458590 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m10:23:17.459055 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m10:23:17.464261 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m10:23:17.465130 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m10:23:17.465780 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m10:23:17.466149 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m10:23:17.466515 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m10:23:17.466819 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m10:23:17.469883 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m10:23:17.470456 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m10:23:17.470990 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m10:23:17.471571 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m10:23:17.472012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m10:23:17.472347 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m10:23:17.481415 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m10:23:17.481936 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m10:23:17.482427 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m10:23:17.482874 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:23:17.483200 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m10:23:17.483477 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:23:17.486030 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m10:23:17.487401 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:23:17.487851 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m10:23:17.488119 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m10:23:17.488403 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m10:23:17.488633 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m10:23:17.491180 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m10:23:17.491792 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m10:23:17.492172 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m10:23:17.492405 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:23:17.492633 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m10:23:17.492836 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m10:23:17.494922 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m10:23:17.495466 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m10:23:17.495861 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m10:23:17.496389 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:17.496574 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m10:23:17.497387 [debug] [MainThread]: Command end result
[0m10:23:17.548369 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m10:23:17.548642 [info ] [MainThread]: Building catalog
[0m10:23:17.551162 [debug] [ThreadPool]: Acquiring new bigquery connection 'manual-pasfield.information_schema'
[0m10:23:17.561693 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:17.626889 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_mart`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_retention_metrics')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_cohort_retention_analysis')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_metrics')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:23:18.275861 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:edd315a5-2e23-4f42-89d7-452c411ffe8b&page=queryresults
[0m10:23:19.837113 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:19.931454 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_ref`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_customers')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_acq_orders')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_activity')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:23:20.960694 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7a54f798-d713-434b-b3ee-5e5069a67c36&page=queryresults
[0m10:23:22.451324 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:22.548675 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual`.__TABLES__ tables
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('acq_orders')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('activity')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('customers')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:23:23.076485 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8897afe2-9867-4b89-8c79-bb40479514d0&page=queryresults
[0m10:23:24.636504 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:24.705378 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test')
                            and upper(table_name) = upper('prep_customer')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m10:23:25.458209 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ddef5b42-b7a0-4938-a6f7-579353fc0cb4&page=queryresults
[0m10:23:26.987903 [info ] [MainThread]: Catalog written to /Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/target/catalog.json
[0m10:23:26.989580 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 11.746673, "process_user_time": 3.783435, "process_kernel_time": 0.353662, "process_mem_max_rss": "205750272", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:23:26.989960 [debug] [MainThread]: Command `dbt docs generate` succeeded at 10:23:26.989903 after 11.75 seconds
[0m10:23:26.990144 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m10:23:26.990282 [debug] [MainThread]: Connection 'manual-pasfield.information_schema' was properly closed.
[0m10:23:26.990442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082ce300>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129322fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fa95fd0>]}
[0m10:23:26.990628 [debug] [MainThread]: Flushing usage events
[0m10:23:30.060794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121dd35c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221f3140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221f2de0>]}


============================== 10:23:30.063337 | 7cb169cb-3d8a-47ab-89d4-db5a1706b222 ==============================
[0m10:23:30.063337 [info ] [MainThread]: Running with dbt=1.8.5
[0m10:23:30.063646 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve --port 8080', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:23:30.633905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7cb169cb-3d8a-47ab-89d4-db5a1706b222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120345730>]}
[0m10:23:30.657764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7cb169cb-3d8a-47ab-89d4-db5a1706b222', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d6a2480>]}
[0m21:27:52.441140 [error] [MainThread]: Encountered an error:

[0m21:27:52.465143 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
              ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/selectors.py", line 415, in select
    fd_event_list = self._selector.poll(timeout)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt

[0m21:27:52.501750 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 27367.71, "process_user_time": 5.248936, "process_kernel_time": 2.185357, "process_mem_max_rss": "193216512", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:27:52.502974 [debug] [MainThread]: Command `dbt docs serve` failed at 21:27:52.502873 after 27367.71 seconds
[0m21:27:52.503871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221f3140>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d82a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121dd26f0>]}
[0m21:27:52.504727 [debug] [MainThread]: Flushing usage events
[0m21:27:58.874625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b04500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f06f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f06c00>]}


============================== 21:27:58.877107 | 27845323-3329-4609-a830-627d8b4eab85 ==============================
[0m21:27:58.877107 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:27:58.877421 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:27:59.698609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1254aeba0>]}
[0m21:27:59.722509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038cfbf0>]}
[0m21:27:59.722815 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:27:59.745262 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:27:59.831956 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
[0m21:27:59.832273 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://macros/populate_random_names.sql
[0m21:27:59.832431 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://seeds/customer_names.csv
[0m21:27:59.832571 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/prepatory/prep_customer_with_names.sql
[0m21:27:59.990046 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:27:59.996299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134f67c50>]}
[0m21:28:00.096796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134f15fa0>]}
[0m21:28:00.097098 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 854 macros
[0m21:28:00.097268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134fe7710>]}
[0m21:28:00.098141 [info ] [MainThread]: 
[0m21:28:00.098408 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:28:00.098835 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:28:00.099044 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:28:00.764090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m21:28:00.764894 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:28:01.272042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m21:28:01.274363 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:28:01.904204 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m21:28:01.906645 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:28:02.327310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1349b38f0>]}
[0m21:28:02.329007 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:28:02.329704 [info ] [MainThread]: 
[0m21:28:02.335292 [debug] [Thread-1 (]: Began running node seed.manual_pasfield.customer_names
[0m21:28:02.336444 [info ] [Thread-1 (]: 1 of 1 START seed file manual_test.customer_names .............................. [RUN]
[0m21:28:02.337302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now seed.manual_pasfield.customer_names)
[0m21:28:02.337808 [debug] [Thread-1 (]: Began compiling node seed.manual_pasfield.customer_names
[0m21:28:02.338286 [debug] [Thread-1 (]: Began executing node seed.manual_pasfield.customer_names
[0m21:28:02.369737 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:28:05.903943 [debug] [Thread-1 (]: On seed.manual_pasfield.customer_names: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "seed.manual_pasfield.customer_names"} */

    alter table `manual-pasfield`.`manual_test`.`customer_names` set OPTIONS()
  
[0m21:28:06.428759 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1dd665db-fae5-4210-900c-9d327806ebee&page=queryresults
[0m21:28:06.946272 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.manual_pasfield.customer_names"
[0m21:28:06.970884 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '27845323-3329-4609-a830-627d8b4eab85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1027b1760>]}
[0m21:28:06.971518 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file manual_test.customer_names .......................... [[32mINSERT 52[0m in 4.63s]
[0m21:28:06.972153 [debug] [Thread-1 (]: Finished running node seed.manual_pasfield.customer_names
[0m21:28:06.973335 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:28:06.973586 [debug] [MainThread]: Connection 'seed.manual_pasfield.customer_names' was properly closed.
[0m21:28:06.973828 [info ] [MainThread]: 
[0m21:28:06.974079 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 6.88 seconds (6.88s).
[0m21:28:06.974607 [debug] [MainThread]: Command end result
[0m21:28:07.007140 [info ] [MainThread]: 
[0m21:28:07.007478 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:28:07.007674 [info ] [MainThread]: 
[0m21:28:07.007865 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:28:07.009690 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 8.168222, "process_user_time": 3.72931, "process_kernel_time": 0.334082, "process_mem_max_rss": "210124800", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:28:07.010004 [debug] [MainThread]: Command `dbt seed` succeeded at 21:28:07.009951 after 8.17 seconds
[0m21:28:07.010210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b04500>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100206b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134a4b8c0>]}
[0m21:28:07.010405 [debug] [MainThread]: Flushing usage events
[0m21:30:19.311050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10626e150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10655eff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10655edb0>]}


============================== 21:30:19.314014 | 488badc2-a0be-4fb3-87a2-fa50a9f3195e ==============================
[0m21:30:19.314014 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:30:19.314348 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:30:20.113576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e647fe0>]}
[0m21:30:20.137559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e69b20>]}
[0m21:30:20.137861 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:30:20.159145 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:30:20.245918 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:30:20.246166 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:30:20.248774 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:30:20.269777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061e9c70>]}
[0m21:30:20.323501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ee4da0>]}
[0m21:30:20.323825 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 854 macros
[0m21:30:20.324000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105996180>]}
[0m21:30:20.325068 [info ] [MainThread]: 
[0m21:30:20.325429 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:30:20.327488 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:30:20.327732 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:30:20.764317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:21.696652 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:22.418318 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:30:22.419699 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:22.816371 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m21:30:22.818527 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:23.347077 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m21:30:23.350281 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:30:23.842054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e80e8a0>]}
[0m21:30:23.843871 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:30:23.844497 [info ] [MainThread]: 
[0m21:30:23.849913 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer_with_names
[0m21:30:23.851390 [info ] [Thread-1 (]: 1 of 8 START sql view model manual_test.prep_customer_with_names ............... [RUN]
[0m21:30:23.852331 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.prep_customer_with_names)
[0m21:30:23.852913 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer_with_names
[0m21:30:23.866805 [debug] [Thread-1 (]: Compilation Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  'populate_random_names' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m21:30:23.867829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ea3f860>]}
[0m21:30:23.868569 [error] [Thread-1 (]: 1 of 8 ERROR creating sql view model manual_test.prep_customer_with_names ...... [[31mERROR[0m in 0.01s]
[0m21:30:23.869224 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer_with_names
[0m21:30:23.869630 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:30:23.870728 [info ] [Thread-1 (]: 2 of 8 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m21:30:23.871229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer_with_names, now model.manual_pasfield.ref_acq_orders)
[0m21:30:23.871587 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:30:23.874837 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:30:23.875856 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:30:23.891285 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:24.543773 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:30:24.545907 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m21:30:25.167606 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:933e875b-1d33-4537-aff8-9ecf4f1a405c&page=queryresults
[0m21:30:27.539322 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eaf4770>]}
[0m21:30:27.540162 [info ] [Thread-1 (]: 2 of 8 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.67s]
[0m21:30:27.540758 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:30:27.541165 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:30:27.541725 [info ] [Thread-1 (]: 3 of 8 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m21:30:27.542229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:30:27.542598 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:30:27.545722 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:30:27.546772 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:30:27.549296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:28.060844 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:30:28.061854 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m21:30:28.521605 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:16d9e1df-8424-40c1-9166-00785a645268&page=queryresults
[0m21:30:31.980331 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb7c050>]}
[0m21:30:31.980743 [info ] [Thread-1 (]: 3 of 8 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.44s]
[0m21:30:31.981069 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:30:31.981279 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:30:31.981478 [info ] [Thread-1 (]: 4 of 8 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m21:30:31.981735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:30:31.981957 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:30:31.983807 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:30:31.985287 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:30:31.986684 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:32.326454 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:30:32.327118 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m21:30:32.735957 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2649a633-7d01-4dd1-a1ef-6c4681b163f2&page=queryresults
[0m21:30:35.422337 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eb9da90>]}
[0m21:30:35.422731 [info ] [Thread-1 (]: 4 of 8 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.44s]
[0m21:30:35.423047 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:30:35.423543 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:30:35.423893 [info ] [Thread-1 (]: 5 of 8 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:30:35.424212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:30:35.424411 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:30:35.431696 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:30:35.432296 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:30:35.442535 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:30:35.443040 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:35.508528 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:30:36.230402 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:96e2aac6-9369-4393-ac16-687e922672ed&page=queryresults
[0m21:30:36.704928 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ea85820>]}
[0m21:30:36.706503 [info ] [Thread-1 (]: 5 of 8 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.28s]
[0m21:30:36.707764 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:30:36.708983 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:30:36.709854 [info ] [Thread-1 (]: 6 of 8 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m21:30:36.710536 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:30:36.711063 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:30:36.717340 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:30:36.719736 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:30:36.723094 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:37.124267 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:30:37.949768 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:00a7cf7d-28a9-42cc-b847-27193c51a628&page=queryresults
[0m21:30:38.170078 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:30:38.413499 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:65ce53fc-dcb9-44af-bca4-da508f13d3ab&page=queryresults
[0m21:30:38.576148 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:30:38.578439 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:30:39.520657 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6827b536-e8dc-4d17-923c-85486d6f48ab&page=queryresults
[0m21:30:50.337227 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebb3b30>]}
[0m21:30:50.339968 [info ] [Thread-1 (]: 6 of 8 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 13.63s]
[0m21:30:50.341240 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:30:50.341878 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m21:30:50.342691 [info ] [Thread-1 (]: 7 of 8 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m21:30:50.343469 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m21:30:50.344035 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m21:30:50.350298 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m21:30:50.352072 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m21:30:50.414162 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:30:50.877604 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:30:51.776334 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f582a2de-a090-4c07-acfd-378f1f25b816&page=queryresults
[0m21:30:51.951013 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:30:52.430417 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:914228ad-a337-41e8-b9c8-07384d1cf4a4&page=queryresults
[0m21:30:52.599862 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m21:30:52.602834 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:30:53.535988 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2462e8d3-ef11-422a-8e0b-b50bbbd35989&page=queryresults
[0m21:31:05.797113 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebd12b0>]}
[0m21:31:05.798077 [info ] [Thread-1 (]: 7 of 8 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 15.45s]
[0m21:31:05.798971 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m21:31:05.799561 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:05.800230 [info ] [Thread-1 (]: 8 of 8 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m21:31:05.800876 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:31:05.801431 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:05.805736 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:31:05.806888 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:05.811208 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:06.790429 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:31:07.390002 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:aa0e48df-f585-488a-8818-6fd416a6b589&page=queryresults
[0m21:31:07.540009 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:31:08.159203 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6b2e38e3-7f37-4f34-bfcf-decd309674b1&page=queryresults
[0m21:31:08.295470 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:31:08.298584 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m21:31:08.968090 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c7b53422-205c-417e-89f4-bdcd410354e0&page=queryresults
[0m21:31:14.705236 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '488badc2-a0be-4fb3-87a2-fa50a9f3195e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebd34d0>]}
[0m21:31:14.706464 [info ] [Thread-1 (]: 8 of 8 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (2.0m rows, 88.0 MiB processed)[0m in 8.90s]
[0m21:31:14.707325 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:31:14.708953 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:31:14.709481 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:31:14.710033 [info ] [MainThread]: 
[0m21:31:14.710489 [info ] [MainThread]: Finished running 2 view models, 6 table models in 0 hours 0 minutes and 54.38 seconds (54.38s).
[0m21:31:14.712678 [debug] [MainThread]: Command end result
[0m21:31:14.757668 [info ] [MainThread]: 
[0m21:31:14.758010 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:31:14.758214 [info ] [MainThread]: 
[0m21:31:14.758462 [error] [MainThread]:   Compilation Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  'populate_random_names' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m21:31:14.758658 [info ] [MainThread]: 
[0m21:31:14.758851 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m21:31:14.760927 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 55.4889, "process_user_time": 4.811825, "process_kernel_time": 0.408737, "process_mem_max_rss": "205242368", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:31:14.761337 [debug] [MainThread]: Command `dbt run` failed at 21:31:14.761269 after 55.49 seconds
[0m21:31:14.761590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10596c470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10607f680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e69d60>]}
[0m21:31:14.761829 [debug] [MainThread]: Flushing usage events
[0m21:31:19.229261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f3c6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b3020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b2cc0>]}


============================== 21:31:19.231780 | 252c7d98-b795-4438-9f39-2756d2444a83 ==============================
[0m21:31:19.231780 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:31:19.232100 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:31:19.776403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142d41e50>]}
[0m21:31:19.800218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f0f770>]}
[0m21:31:19.800522 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:31:19.820978 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:31:19.907577 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:31:19.907922 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://macros/populate_random_names.sql
[0m21:31:19.942171 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:31:19.948364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1035a8140>]}
[0m21:31:20.002805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1430418b0>]}
[0m21:31:20.003091 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:31:20.003257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1430cf440>]}
[0m21:31:20.004252 [info ] [MainThread]: 
[0m21:31:20.004553 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:31:20.006446 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:31:20.006661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:31:20.471819 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:20.975210 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:21.485873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m21:31:21.487129 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:22.037700 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m21:31:22.041189 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:22.513137 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m21:31:22.515772 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:31:23.044453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1432ec710>]}
[0m21:31:23.045969 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:31:23.046577 [info ] [MainThread]: 
[0m21:31:23.051394 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer_with_names
[0m21:31:23.052369 [info ] [Thread-1 (]: 1 of 8 START sql view model manual_test.prep_customer_with_names ............... [RUN]
[0m21:31:23.053419 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.prep_customer_with_names)
[0m21:31:23.054017 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer_with_names
[0m21:31:23.075250 [debug] [Thread-1 (]: Compilation Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  dbt was unable to infer all dependencies for the model "prep_customer_with_names".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "prep_customer_with_names":
  
  -- depends_on: {{ ref('prep_customer') }}
  
  > in macro populate_random_names (macros/populate_random_names.sql)
  > called by model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
[0m21:31:23.076404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142f1ede0>]}
[0m21:31:23.076962 [error] [Thread-1 (]: 1 of 8 ERROR creating sql view model manual_test.prep_customer_with_names ...... [[31mERROR[0m in 0.02s]
[0m21:31:23.077540 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer_with_names
[0m21:31:23.077937 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:31:23.079327 [info ] [Thread-1 (]: 2 of 8 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m21:31:23.080103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer_with_names, now model.manual_pasfield.ref_acq_orders)
[0m21:31:23.080446 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:31:23.083541 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:31:23.084412 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:31:23.099387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:23.604658 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:31:23.605836 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m21:31:24.022680 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5f5bce5c-2323-443d-8d47-869d2de6f398&page=queryresults
[0m21:31:26.404244 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143339fd0>]}
[0m21:31:26.404997 [info ] [Thread-1 (]: 2 of 8 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.32s]
[0m21:31:26.405605 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:31:26.406005 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:31:26.406552 [info ] [Thread-1 (]: 3 of 8 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m21:31:26.407059 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:31:26.407412 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:31:26.410562 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:31:26.411555 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:31:26.414025 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:26.758787 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:31:26.761221 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m21:31:27.201064 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8245488e-5d77-43ee-b47c-4202c0c7d245&page=queryresults
[0m21:31:30.885521 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143342c30>]}
[0m21:31:30.888393 [info ] [Thread-1 (]: 3 of 8 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.48s]
[0m21:31:30.889355 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:31:30.889875 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:31:30.890511 [info ] [Thread-1 (]: 4 of 8 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m21:31:30.891187 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:31:30.891625 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:31:30.896272 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:31:30.897208 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:31:30.900375 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:31.424865 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:31:31.426500 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m21:31:31.839752 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:683eaef5-ac7d-42c3-b1e0-3666462e819a&page=queryresults
[0m21:31:34.649214 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14340e1b0>]}
[0m21:31:34.650824 [info ] [Thread-1 (]: 4 of 8 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.76s]
[0m21:31:34.651855 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:31:34.653146 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:31:34.653851 [info ] [Thread-1 (]: 5 of 8 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:31:34.654541 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:31:34.655270 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:31:34.669188 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:31:34.670109 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:31:34.739544 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:31:34.740111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:34.805868 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:31:35.422424 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:086b799e-aef8-4d0b-9e19-c3a643cdf048&page=queryresults
[0m21:31:35.605363 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143167ec0>]}
[0m21:31:35.606716 [info ] [Thread-1 (]: 5 of 8 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.95s]
[0m21:31:35.607765 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:31:35.608794 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:31:35.609547 [info ] [Thread-1 (]: 6 of 8 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m21:31:35.610148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:31:35.610611 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:31:35.617027 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:31:35.617827 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:31:35.619709 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:36.184413 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:31:36.864284 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e8619f9a-874d-4485-80ce-1b048beb46b7&page=queryresults
[0m21:31:37.015279 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:31:37.518691 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:be7f82ce-8d19-4230-a808-819ee8760db9&page=queryresults
[0m21:31:37.691180 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:31:37.692804 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:31:38.359718 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5831093a-1117-477a-b6b9-daff427971fb&page=queryresults
[0m21:31:49.278792 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x142dcfd10>]}
[0m21:31:49.281174 [info ] [Thread-1 (]: 6 of 8 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 13.67s]
[0m21:31:49.282199 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:31:49.282859 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m21:31:49.283602 [info ] [Thread-1 (]: 7 of 8 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m21:31:49.284344 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m21:31:49.284863 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m21:31:49.291684 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m21:31:49.292580 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m21:31:49.294794 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:31:49.863945 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:31:50.505220 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:24489415-b8b8-401f-86c8-6b209ee687fc&page=queryresults
[0m21:31:50.670254 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:31:51.152756 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9aba88cb-db82-4928-81ba-7d38389d9894&page=queryresults
[0m21:31:51.354576 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m21:31:51.356072 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:31:51.954947 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d05a4125-6ee7-40de-86e8-a17d25467178&page=queryresults
[0m21:32:03.993327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143470a70>]}
[0m21:32:03.994926 [info ] [Thread-1 (]: 7 of 8 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 14.71s]
[0m21:32:03.995797 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m21:32:03.996827 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:03.998196 [info ] [Thread-1 (]: 8 of 8 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m21:32:03.999026 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:32:03.999576 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:04.004921 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:32:04.006315 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:04.008139 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:04.469892 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:32:05.174214 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:aaf166a0-660b-4390-b66f-87b2ffb05512&page=queryresults
[0m21:32:05.311595 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:32:05.834739 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3f95509a-899c-43d1-9ff8-e9b500255c54&page=queryresults
[0m21:32:05.954181 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:32:05.955405 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m21:32:06.551824 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:05067da3-00b6-4737-bce1-1778d4e63640&page=queryresults
[0m21:32:12.128915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '252c7d98-b795-4438-9f39-2756d2444a83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143470320>]}
[0m21:32:12.138702 [info ] [Thread-1 (]: 8 of 8 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (2.0m rows, 88.0 MiB processed)[0m in 8.13s]
[0m21:32:12.141068 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:32:12.142881 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:32:12.143574 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:32:12.143971 [info ] [MainThread]: 
[0m21:32:12.144237 [info ] [MainThread]: Finished running 2 view models, 6 table models in 0 hours 0 minutes and 52.14 seconds (52.14s).
[0m21:32:12.145516 [debug] [MainThread]: Command end result
[0m21:32:12.183043 [info ] [MainThread]: 
[0m21:32:12.183480 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:32:12.183741 [info ] [MainThread]: 
[0m21:32:12.184073 [error] [MainThread]:   Compilation Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  dbt was unable to infer all dependencies for the model "prep_customer_with_names".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "prep_customer_with_names":
  
  -- depends_on: {{ ref('prep_customer') }}
  
  > in macro populate_random_names (macros/populate_random_names.sql)
  > called by model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
[0m21:32:12.184363 [info ] [MainThread]: 
[0m21:32:12.184610 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m21:32:12.187079 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 52.986584, "process_user_time": 4.853812, "process_kernel_time": 0.30673, "process_mem_max_rss": "207405056", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:32:12.187529 [debug] [MainThread]: Command `dbt run` failed at 21:32:12.187455 after 52.99 seconds
[0m21:32:12.187781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143058f80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x143058590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1430597c0>]}
[0m21:32:12.187952 [debug] [MainThread]: Flushing usage events
[0m21:34:32.511230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077c9c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082a7080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082a6d20>]}


============================== 21:34:32.514106 | 78310707-4f5a-44d1-93c4-318b7077f265 ==============================
[0m21:34:32.514106 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:34:32.514472 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:34:33.288973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1359e8fb0>]}
[0m21:34:33.312618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135d11d00>]}
[0m21:34:33.312932 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:34:33.334204 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:34:33.420929 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:34:33.421273 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://macros/populate_random_names.sql
[0m21:34:33.455681 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:34:33.462178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1377d2960>]}
[0m21:34:33.517036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147249af0>]}
[0m21:34:33.517315 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:34:33.517483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1472cd4f0>]}
[0m21:34:33.518469 [info ] [MainThread]: 
[0m21:34:33.518767 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:34:33.520705 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:34:33.520919 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:34:34.735631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:34:35.126417 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:34:35.514134 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m21:34:35.515413 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:34:36.060695 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m21:34:36.063260 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:34:36.534951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m21:34:36.537249 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:34:37.112643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147123260>]}
[0m21:34:37.114339 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:34:37.115059 [info ] [MainThread]: 
[0m21:34:37.120064 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer_with_names
[0m21:34:37.121255 [info ] [Thread-1 (]: 1 of 8 START sql view model manual_test.prep_customer_with_names ............... [RUN]
[0m21:34:37.122095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.prep_customer_with_names)
[0m21:34:37.122709 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer_with_names
[0m21:34:37.144393 [debug] [Thread-1 (]: Compilation Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  dbt was unable to infer all dependencies for the model "prep_customer_with_names".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "prep_customer_with_names":
  
  -- depends_on: {{ ref('prep_customer') }}
  
  > in macro populate_random_names (macros/populate_random_names.sql)
  > called by model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
[0m21:34:37.145842 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147151130>]}
[0m21:34:37.146464 [error] [Thread-1 (]: 1 of 8 ERROR creating sql view model manual_test.prep_customer_with_names ...... [[31mERROR[0m in 0.02s]
[0m21:34:37.147118 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer_with_names
[0m21:34:37.147734 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:34:37.148848 [info ] [Thread-1 (]: 2 of 8 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m21:34:37.149628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer_with_names, now model.manual_pasfield.ref_acq_orders)
[0m21:34:37.149991 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:34:37.153134 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:34:37.154300 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:34:37.169707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:37.914447 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:34:37.915628 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m21:34:38.400770 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:40e699dc-58de-4e53-9883-d7e5dab512f7&page=queryresults
[0m21:34:41.198745 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147538950>]}
[0m21:34:41.199649 [info ] [Thread-1 (]: 2 of 8 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.05s]
[0m21:34:41.200275 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:34:41.200679 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:34:41.201274 [info ] [Thread-1 (]: 3 of 8 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m21:34:41.201777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:34:41.202146 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:34:41.205485 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:34:41.206397 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:34:41.209319 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:41.749637 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:34:41.752182 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m21:34:42.112561 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fdaa89aa-485c-4d5f-b201-ec54cd55bbe9&page=queryresults
[0m21:34:46.386624 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1476080e0>]}
[0m21:34:46.388614 [info ] [Thread-1 (]: 3 of 8 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.18s]
[0m21:34:46.390242 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:34:46.390917 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:34:46.391734 [info ] [Thread-1 (]: 4 of 8 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m21:34:46.392504 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:34:46.393017 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:34:46.397971 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:34:46.398932 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:34:46.402126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:47.002835 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:34:47.006399 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m21:34:47.407345 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7121d753-7b78-42b8-9a72-4123592fa58b&page=queryresults
[0m21:34:50.464249 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135b1e8a0>]}
[0m21:34:50.465581 [info ] [Thread-1 (]: 4 of 8 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.07s]
[0m21:34:50.466684 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:34:50.467746 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:34:50.468596 [info ] [Thread-1 (]: 5 of 8 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:34:50.469249 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:34:50.469754 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:34:50.483034 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:34:50.484131 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:34:50.552029 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:34:50.552597 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:50.618417 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:34:51.328096 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4f02fb8c-8447-41f6-b118-b015d770ff20&page=queryresults
[0m21:34:52.316536 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13762ba40>]}
[0m21:34:52.317755 [info ] [Thread-1 (]: 5 of 8 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.85s]
[0m21:34:52.318608 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:34:52.319678 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:34:52.320438 [info ] [Thread-1 (]: 6 of 8 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m21:34:52.321034 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:34:52.321515 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:34:52.327796 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:34:52.329838 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:34:52.333165 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:34:52.812623 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:34:53.612465 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:89ded9ea-bdbf-4843-b820-84fbd69db3be&page=queryresults
[0m21:34:53.801718 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:34:54.205905 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:910834ce-97e3-4567-b936-94fa2e82b3e8&page=queryresults
[0m21:34:54.380611 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:34:54.381989 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:34:55.049316 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0b81f3f4-e33f-47b8-ab91-a9d9b9678fff&page=queryresults
[0m21:35:09.472034 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1474a0740>]}
[0m21:35:09.473546 [info ] [Thread-1 (]: 6 of 8 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 17.15s]
[0m21:35:09.474841 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:35:09.475627 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m21:35:09.476689 [info ] [Thread-1 (]: 7 of 8 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m21:35:09.477565 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m21:35:09.478114 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m21:35:09.484024 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m21:35:09.485532 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m21:35:09.488917 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:10.524796 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:35:11.248304 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1988176c-10b7-4267-ad12-f3264607e76d&page=queryresults
[0m21:35:11.436248 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:35:11.827136 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:db976496-8ad2-474c-ac2e-4a35378d4a46&page=queryresults
[0m21:35:11.966571 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m21:35:11.968496 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:35:12.642671 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d58eec99-4517-456e-a35f-c167fc2c1fa1&page=queryresults
[0m21:35:28.878355 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1475d45f0>]}
[0m21:35:28.880213 [info ] [Thread-1 (]: 7 of 8 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 19.40s]
[0m21:35:28.881216 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m21:35:28.881827 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:35:28.882580 [info ] [Thread-1 (]: 8 of 8 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m21:35:28.883311 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:35:28.883803 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:35:28.888371 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:35:28.889543 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:35:28.892627 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:35:29.418888 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:35:30.310048 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b080dc65-a4ad-451f-9c5a-cb50e245d519&page=queryresults
[0m21:35:30.438540 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:35:30.701769 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bbb78e70-4689-42a2-84d1-43de50752722&page=queryresults
[0m21:35:30.877581 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:35:30.880329 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m21:35:31.452717 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f6382d4b-f940-449a-b344-d70b7a2b21f5&page=queryresults
[0m21:35:40.026048 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '78310707-4f5a-44d1-93c4-318b7077f265', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135a8dcd0>]}
[0m21:35:40.027521 [info ] [Thread-1 (]: 8 of 8 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (2.0m rows, 88.0 MiB processed)[0m in 11.14s]
[0m21:35:40.028769 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:35:40.031064 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:35:40.031602 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m21:35:40.032170 [info ] [MainThread]: 
[0m21:35:40.032649 [info ] [MainThread]: Finished running 2 view models, 6 table models in 0 hours 1 minutes and 6.51 seconds (66.51s).
[0m21:35:40.035161 [debug] [MainThread]: Command end result
[0m21:35:40.069579 [info ] [MainThread]: 
[0m21:35:40.069905 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:35:40.070159 [info ] [MainThread]: 
[0m21:35:40.070507 [error] [MainThread]:   Compilation Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  dbt was unable to infer all dependencies for the model "prep_customer_with_names".
  This typically happens when ref() is placed within a conditional block.
  
  To fix this, add the following hint to the top of the model "prep_customer_with_names":
  
  -- depends_on: {{ ref('prep_customer') }}
  
  > in macro populate_random_names (macros/populate_random_names.sql)
  > called by model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
[0m21:35:40.070767 [info ] [MainThread]: 
[0m21:35:40.071010 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m21:35:40.072946 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 67.5987, "process_user_time": 4.871235, "process_kernel_time": 0.411078, "process_mem_max_rss": "206503936", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:35:40.073250 [debug] [MainThread]: Command `dbt run` failed at 21:35:40.073202 after 67.60 seconds
[0m21:35:40.073430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137746150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137746720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137747f20>]}
[0m21:35:40.073586 [debug] [MainThread]: Flushing usage events
[0m21:35:56.300347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103644dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a2eea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a2eb40>]}


============================== 21:35:56.302889 | 171b1a77-803c-4b79-b746-f6cf46220589 ==============================
[0m21:35:56.302889 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:35:56.303211 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:35:56.886914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14306a360>]}
[0m21:35:56.911367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104545c10>]}
[0m21:35:56.911711 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:35:56.933298 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:35:57.017742 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:35:57.018099 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer_with_names.sql
[0m21:35:57.121826 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:35:57.127906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3f5640>]}
[0m21:35:57.181675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146751c70>]}
[0m21:35:57.181974 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:35:57.182144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3f3ec0>]}
[0m21:35:57.183106 [info ] [MainThread]: 
[0m21:35:57.183389 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:35:57.185346 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:35:57.185560 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:35:57.737676 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:35:58.276289 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:35:58.823793 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:35:58.824935 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:35:59.405436 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m21:35:59.408137 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:35:59.953149 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m21:35:59.955267 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:36:00.405625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3f6690>]}
[0m21:36:00.407555 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:36:00.408450 [info ] [MainThread]: 
[0m21:36:00.412857 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m21:36:00.413708 [info ] [Thread-1 (]: 1 of 8 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m21:36:00.414525 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m21:36:00.415093 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m21:36:00.424774 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m21:36:00.425529 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m21:36:00.490602 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:01.049888 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m21:36:01.050870 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m21:36:01.529019 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:02b0a24e-cde3-4cc7-97f4-1f9638a9da74&page=queryresults
[0m21:36:04.666940 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b020e30>]}
[0m21:36:04.667886 [info ] [Thread-1 (]: 1 of 8 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.25s]
[0m21:36:04.668518 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m21:36:04.668939 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m21:36:04.669512 [info ] [Thread-1 (]: 2 of 8 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m21:36:04.670032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m21:36:04.670408 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m21:36:04.673829 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m21:36:04.674727 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m21:36:04.677735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:05.185348 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m21:36:05.187880 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m21:36:05.588280 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9d427c07-ce0f-4b87-8d5b-67a57589a7b6&page=queryresults
[0m21:36:11.208435 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b34f080>]}
[0m21:36:11.210929 [info ] [Thread-1 (]: 2 of 8 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 6.54s]
[0m21:36:11.212637 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m21:36:11.213323 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m21:36:11.214201 [info ] [Thread-1 (]: 3 of 8 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m21:36:11.214946 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m21:36:11.215482 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m21:36:11.220218 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m21:36:11.221284 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m21:36:11.224696 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:11.598595 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m21:36:11.600668 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m21:36:11.998336 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f8d9b147-5d7b-4208-9da3-8e13091a055a&page=queryresults
[0m21:36:14.877883 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b29c140>]}
[0m21:36:14.880504 [info ] [Thread-1 (]: 3 of 8 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.66s]
[0m21:36:14.882487 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m21:36:14.884346 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:36:14.885208 [info ] [Thread-1 (]: 4 of 8 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:36:14.885962 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m21:36:14.886485 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:36:14.900052 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:36:14.901258 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:36:14.924570 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:36:14.925311 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:15.004742 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:36:15.575140 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1c78d778-6a67-44c7-8b27-9479f5481341&page=queryresults
[0m21:36:15.923287 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b47fe90>]}
[0m21:36:15.924220 [info ] [Thread-1 (]: 4 of 8 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m21:36:15.925013 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:36:15.925949 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:36:15.926683 [info ] [Thread-1 (]: 5 of 8 START sql table model manual_test_mart.mart_cohort_retention_analysis ... [RUN]
[0m21:36:15.927377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis)
[0m21:36:15.927899 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:36:15.933761 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:36:15.934722 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:36:15.936182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:16.472334 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:36:17.103234 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4d63d2ae-cee2-464c-82c3-26a588b8374e&page=queryresults
[0m21:36:17.242322 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:36:18.049378 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cc60bf0a-614a-4d0b-bb71-38e8a9e958aa&page=queryresults
[0m21:36:18.209052 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis"
[0m21:36:18.210632 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- models/cohort_retention_analysis.sql

with cohort_data as (
    -- Select the necessary fields from the prep_customer table
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,  -- Group by acquisition month
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- Subscription length in days
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

cohort_intervals as (
    -- Define intervals to track retention at 1, 3, and 6 months, grouped by country and taxonomy
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,  -- Total customers in the cohort
        -- Number of customers still active at 1 month (30 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        -- Number of customers still active at 3 months (90 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        -- Number of customers still active at 6 months (180 days)
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- Calculate retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        -- Calculate retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- Final select statement to get the cohort retention rates grouped by country and taxonomy
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:36:19.131095 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5bc57390-388e-472e-af07-f7567dc578d7&page=queryresults
[0m21:36:32.832803 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b0620>]}
[0m21:36:32.834339 [info ] [Thread-1 (]: 5 of 8 OK created sql table model manual_test_mart.mart_cohort_retention_analysis  [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 16.91s]
[0m21:36:32.835260 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis
[0m21:36:32.836711 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics
[0m21:36:32.837734 [info ] [Thread-1 (]: 6 of 8 START sql table model manual_test_mart.mart_customer_metrics ............ [RUN]
[0m21:36:32.838567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis, now model.manual_pasfield.mart_customer_metrics)
[0m21:36:32.839129 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics
[0m21:36:32.845251 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics"
[0m21:36:32.846510 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics
[0m21:36:32.852529 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:33.413552 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:36:34.271460 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a8071203-e612-4d0a-bae1-1755c8f57dd9&page=queryresults
[0m21:36:34.424608 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:36:34.795462 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9f149bd8-2bb2-4d80-96da-e187a4519995&page=queryresults
[0m21:36:34.951300 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics"
[0m21:36:34.953476 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- define each customer's acquisition date, active period, and any churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    -- calculate monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- calculate monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- calculate retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL

select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m21:36:35.557147 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b034df37-3843-4bd0-801d-e7c6a06515a1&page=queryresults
[0m21:36:50.536979 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b29c140>]}
[0m21:36:50.539034 [info ] [Thread-1 (]: 6 of 8 OK created sql table model manual_test_mart.mart_customer_metrics ....... [[32mCREATE TABLE (423.0 rows, 71.4 MiB processed)[0m in 17.70s]
[0m21:36:50.540692 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics
[0m21:36:50.541405 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:36:50.542254 [info ] [Thread-1 (]: 7 of 8 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m21:36:50.543061 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics, now model.manual_pasfield.mart_customer_retention_metrics)
[0m21:36:50.543615 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m21:36:50.549338 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:36:50.550168 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m21:36:50.552512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:51.051539 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:36:51.623675 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ff95bda7-fa3c-4ec6-92c1-53c99b782f76&page=queryresults
[0m21:36:51.746110 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m21:36:52.104181 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:06a8cef5-eb55-41c6-807a-e6505d4055e7&page=queryresults
[0m21:36:52.203677 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m21:36:52.206392 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        -- models/customer_retention_metrics.sql

with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- Join all three tables on customer_id
merged_data as (
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,

        -- Calculate subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,

        -- Calculate time since last activity (difference between to_date and current date)
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m21:36:52.622987 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:59ab0127-6164-44f1-8897-e2353e8ed53a&page=queryresults
[0m21:36:59.697725 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4928d0>]}
[0m21:36:59.700017 [info ] [Thread-1 (]: 7 of 8 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (2.0m rows, 88.0 MiB processed)[0m in 9.15s]
[0m21:36:59.701416 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m21:36:59.702245 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer_with_names
[0m21:36:59.703046 [info ] [Thread-1 (]: 8 of 8 START sql view model manual_test.prep_customer_with_names ............... [RUN]
[0m21:36:59.703729 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_retention_metrics, now model.manual_pasfield.prep_customer_with_names)
[0m21:36:59.704282 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer_with_names
[0m21:36:59.710985 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer_with_names"
[0m21:36:59.711927 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer_with_names
[0m21:36:59.714698 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer_with_names"
[0m21:36:59.715297 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:36:59.808278 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer_with_names: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer_with_names"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer_with_names`
  OPTIONS()
  as -- depends_on: `manual-pasfield`.`manual_test`.`prep_customer`
select * from 
    -- Description:
    -- This macro populates random customer names for a target customer table
    -- using names from a specified seed list.

    with randomized_names as (
        -- Join the customer table with the seed list of names using a randomization trick
        select
            customer_id,
            name,
            row_number() over (order by rand()) as random_order -- Randomize the order of names
        from `manual-pasfield`.`manual_test`.`prep_customer`,
             `manual-pasfield`.`manual_test`.`customer_names`
    ),
    
    assigned_names as (
        -- Partition by customer_id and select the first randomized name
        select
            customer_id,
            first_value(name) over (partition by customer_id order by random_order) as random_name
        from randomized_names
    )

    select * from assigned_names
;


[0m21:37:00.161598 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5dca5bc4-c7bf-43e0-bfb9-228363f40171&page=queryresults
[0m21:37:00.163599 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected keyword WITH at [12:5]; reason: invalidQuery, location: query, message: Syntax error: Unexpected keyword WITH at [12:5]')
[0m21:37:00.611734 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a6372608-7581-44d0-b467-e4213ff94535&page=queryresults
[0m21:37:00.612640 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a6372608-7581-44d0-b467-e4213ff94535&page=queryresults
[0m21:37:00.626714 [debug] [Thread-1 (]: Database Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  Syntax error: Unexpected keyword WITH at [12:5]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer_with_names.sql
[0m21:37:00.627352 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '171b1a77-803c-4b79-b746-f6cf46220589', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b490a70>]}
[0m21:37:00.627985 [error] [Thread-1 (]: 8 of 8 ERROR creating sql view model manual_test.prep_customer_with_names ...... [[31mERROR[0m in 0.92s]
[0m21:37:00.628534 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer_with_names
[0m21:37:00.630133 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:37:00.630477 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer_with_names' was properly closed.
[0m21:37:00.630843 [info ] [MainThread]: 
[0m21:37:00.631203 [info ] [MainThread]: Finished running 6 table models, 2 view models in 0 hours 1 minutes and 3.45 seconds (63.45s).
[0m21:37:00.632945 [debug] [MainThread]: Command end result
[0m21:37:00.669281 [info ] [MainThread]: 
[0m21:37:00.669603 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:37:00.669790 [info ] [MainThread]: 
[0m21:37:00.670018 [error] [MainThread]:   Database Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  Syntax error: Unexpected keyword WITH at [12:5]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer_with_names.sql
[0m21:37:00.670196 [info ] [MainThread]: 
[0m21:37:00.670374 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m21:37:00.672322 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 64.39977, "process_user_time": 5.056555, "process_kernel_time": 0.345578, "process_mem_max_rss": "209059840", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:37:00.672692 [debug] [MainThread]: Command `dbt run` failed at 21:37:00.672635 after 64.40 seconds
[0m21:37:00.672915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1467ea7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b3b3a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b0440e0>]}
[0m21:37:00.673113 [debug] [MainThread]: Flushing usage events
[0m21:37:50.831011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ef68a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feafc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feac60>]}


============================== 21:37:50.833677 | c6cfbc30-4a12-4716-b74e-05fc6e5d3593 ==============================
[0m21:37:50.833677 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:37:50.833993 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select prep_customer_with_names', 'send_anonymous_usage_stats': 'True'}
[0m21:37:51.780160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fcd8c80>]}
[0m21:37:51.808255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff46f90>]}
[0m21:37:51.808710 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:37:51.829625 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:37:51.923555 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:37:51.923913 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer_with_names.sql
[0m21:37:51.924105 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://macros/populate_random_names.sql
[0m21:37:52.039278 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:37:52.046495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127bea2a0>]}
[0m21:37:52.106923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12783e0f0>]}
[0m21:37:52.107282 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:37:52.107501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127aa7d10>]}
[0m21:37:52.108405 [info ] [MainThread]: 
[0m21:37:52.108753 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:37:52.109254 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:37:52.109485 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:37:52.928392 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:37:52.929160 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:53.310848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m21:37:53.312921 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:53.694226 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m21:37:53.697341 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:37:54.359449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105de72c0>]}
[0m21:37:54.361040 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:37:54.361581 [info ] [MainThread]: 
[0m21:37:54.366195 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer_with_names
[0m21:37:54.367111 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer_with_names ............... [RUN]
[0m21:37:54.367931 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.prep_customer_with_names)
[0m21:37:54.368562 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer_with_names
[0m21:37:54.382426 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer_with_names"
[0m21:37:54.383940 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer_with_names
[0m21:37:54.452908 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer_with_names"
[0m21:37:54.453500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:37:54.519133 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer_with_names: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer_with_names"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer_with_names`
  OPTIONS()
  as -- depends_on: `manual-pasfield`.`manual_test`.`prep_customer`

    -- Description:
    -- This macro populates random customer names for a target customer table
    -- using names from a specified seed list.

    with randomized_names as (
        -- Join the customer table with the seed list of names using a randomization trick
        select
            customer_id,
            name,
            row_number() over (order by rand()) as random_order -- Randomize the order of names
        from `manual-pasfield`.`manual_test`.`prep_customer`,
             `manual-pasfield`.`manual_test`.`customer_names`
    ),
    
    assigned_names as (
        -- Partition by customer_id and select the first randomized name
        select
            customer_id,
            first_value(name) over (partition by customer_id order by random_order) as random_name
        from randomized_names
    )

    select * from assigned_names
;


[0m21:37:55.223935 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2991ca88-1246-4427-84b4-47ddeb774206&page=queryresults
[0m21:37:55.407003 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: name at [16:13]; reason: invalidQuery, location: query, message: Unrecognized name: name at [16:13]')
[0m21:37:56.735620 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e488db5b-146b-4ad4-95a9-799fdc708e8a&page=queryresults
[0m21:37:56.843107 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e488db5b-146b-4ad4-95a9-799fdc708e8a&page=queryresults
[0m21:37:56.856548 [debug] [Thread-1 (]: Database Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  Unrecognized name: name at [16:13]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer_with_names.sql
[0m21:37:56.857552 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6cfbc30-4a12-4716-b74e-05fc6e5d3593', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127bbc950>]}
[0m21:37:56.857967 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model manual_test.prep_customer_with_names ...... [[31mERROR[0m in 2.49s]
[0m21:37:56.858300 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer_with_names
[0m21:37:56.859220 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:37:56.859390 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer_with_names' was properly closed.
[0m21:37:56.859533 [info ] [MainThread]: 
[0m21:37:56.859773 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 4.75 seconds (4.75s).
[0m21:37:56.860627 [debug] [MainThread]: Command end result
[0m21:37:56.902004 [info ] [MainThread]: 
[0m21:37:56.902400 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:37:56.902627 [info ] [MainThread]: 
[0m21:37:56.902912 [error] [MainThread]:   Database Error in model prep_customer_with_names (models/prepatory/prep_customer_with_names.sql)
  Unrecognized name: name at [16:13]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer_with_names.sql
[0m21:37:56.903110 [info ] [MainThread]: 
[0m21:37:56.903302 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:37:56.905331 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.1075106, "process_user_time": 3.509118, "process_kernel_time": 0.440818, "process_mem_max_rss": "209813504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:37:56.905740 [debug] [MainThread]: Command `dbt run` failed at 21:37:56.905672 after 6.11 seconds
[0m21:37:56.905994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079c0230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a9ac00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127a9a600>]}
[0m21:37:56.906219 [debug] [MainThread]: Flushing usage events
[0m21:41:48.720492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049d63f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cc6fc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cc6c60>]}


============================== 21:41:48.723342 | 0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8 ==============================
[0m21:41:48.723342 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:41:48.723663 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select prep_customer_with_names', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:41:49.572057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b9cd730>]}
[0m21:41:49.595743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10466c170>]}
[0m21:41:49.596046 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:41:49.618997 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:41:49.712661 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:41:49.713023 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer_with_names.sql
[0m21:41:49.814754 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:41:49.820772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bafe9f0>]}
[0m21:41:49.874731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bcfcad0>]}
[0m21:41:49.875024 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:41:49.875193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13be6ccb0>]}
[0m21:41:49.875997 [info ] [MainThread]: 
[0m21:41:49.876287 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:41:49.876725 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:41:49.876903 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:41:50.294995 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m21:41:50.295601 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:41:50.673979 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m21:41:50.676605 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:41:51.196084 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m21:41:51.197791 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:41:51.690571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b2b5b20>]}
[0m21:41:51.692186 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:41:51.692794 [info ] [MainThread]: 
[0m21:41:51.698147 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer_with_names
[0m21:41:51.699128 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer_with_names ............... [RUN]
[0m21:41:51.700236 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.prep_customer_with_names)
[0m21:41:51.700971 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer_with_names
[0m21:41:51.711315 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer_with_names"
[0m21:41:51.712300 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer_with_names
[0m21:41:51.742811 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer_with_names"
[0m21:41:51.743742 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:41:51.818718 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer_with_names: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer_with_names"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer_with_names`
  OPTIONS()
  as -- models/prepatory/prep_customer_with_names.sql

with cohort_base as (
    -- First CTE: Define customer data with cohort information
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        ifnull(to_date, current_date()) as last_activity_date
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

random_names as (
    -- Second CTE: Assign random names from the seed data
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name
    from cohort_base
    join `manual-pasfield`.`manual_test`.`customer_names` on true
)

-- Final SELECT to join all CTEs and get the desired fields
select
    cohort_base.customer_id,
    acquisition_month,
    churn_month,
    last_activity_date,
    random_names.first_name,
    random_names.last_name
from cohort_base
left join random_names on cohort_base.customer_id = random_names.customer_id
order by acquisition_month;


[0m21:41:52.769228 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8f349299-d95c-4320-8fe5-02b2bb640b1f&page=queryresults
[0m21:41:53.259149 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e8a6a1c-bd56-49ab-8b82-b1c70591f0c8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136b23ef0>]}
[0m21:41:53.259621 [info ] [Thread-1 (]: 1 of 1 OK created sql view model manual_test.prep_customer_with_names .......... [[32mCREATE VIEW (0 processed)[0m in 1.56s]
[0m21:41:53.259957 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer_with_names
[0m21:41:53.260580 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:41:53.260728 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer_with_names' was properly closed.
[0m21:41:53.260870 [info ] [MainThread]: 
[0m21:41:53.261019 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.38 seconds (3.38s).
[0m21:41:53.261341 [debug] [MainThread]: Command end result
[0m21:41:53.285191 [info ] [MainThread]: 
[0m21:41:53.285496 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:41:53.285646 [info ] [MainThread]: 
[0m21:41:53.285792 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:41:53.287534 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6077275, "process_user_time": 3.654805, "process_kernel_time": 0.339004, "process_mem_max_rss": "207142912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:41:53.287803 [debug] [MainThread]: Command `dbt run` succeeded at 21:41:53.287759 after 4.61 seconds
[0m21:41:53.287982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10494c470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100fc6b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c7ff50>]}
[0m21:41:53.288147 [debug] [MainThread]: Flushing usage events
[0m21:50:53.901288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105373d40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105beb080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105beae40>]}


============================== 21:50:53.903833 | 13f737fd-2ed4-4ca9-a97b-a38915bcbba9 ==============================
[0m21:50:53.903833 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:50:53.904151 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select prep_customer', 'send_anonymous_usage_stats': 'True'}
[0m21:50:54.723235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ebce4e0>]}
[0m21:50:54.746984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b1abf20>]}
[0m21:50:54.747286 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:50:54.769480 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:50:54.863171 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:50:54.863529 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m21:50:54.968877 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:50:54.974917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105785400>]}
[0m21:50:55.029607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b6ccda0>]}
[0m21:50:55.029918 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:50:55.030091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5482f0>]}
[0m21:50:55.030847 [info ] [MainThread]: 
[0m21:50:55.031129 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:50:55.031552 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:50:55.031728 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:50:55.599489 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m21:50:55.600182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:56.152434 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m21:50:56.155091 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:56.681171 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m21:50:56.683729 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:50:57.265299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b549d30>]}
[0m21:50:57.267147 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:50:57.267851 [info ] [MainThread]: 
[0m21:50:57.272695 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:50:57.273553 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:50:57.274433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.prep_customer)
[0m21:50:57.275122 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:50:57.285017 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:50:57.286309 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:50:57.359068 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:50:57.359666 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:50:57.425214 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names as (
    -- Second CTE: Assign random names from the seed data
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
)

-- FINAL CTE
select * from final;


[0m21:50:58.039978 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:79f7bb4e-2555-43db-9ac8-63885e95ed51&page=queryresults
[0m21:50:58.320075 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '13f737fd-2ed4-4ca9-a97b-a38915bcbba9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a322db0>]}
[0m21:50:58.320907 [info ] [Thread-1 (]: 1 of 1 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.05s]
[0m21:50:58.321527 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:50:58.322696 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:50:58.322974 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m21:50:58.323249 [info ] [MainThread]: 
[0m21:50:58.323532 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m21:50:58.324140 [debug] [MainThread]: Command end result
[0m21:50:58.359554 [info ] [MainThread]: 
[0m21:50:58.359883 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:50:58.360073 [info ] [MainThread]: 
[0m21:50:58.360264 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:50:58.362538 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4935145, "process_user_time": 3.600094, "process_kernel_time": 0.370558, "process_mem_max_rss": "207683584", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:50:58.362924 [debug] [MainThread]: Command `dbt run` succeeded at 21:50:58.362862 after 4.49 seconds
[0m21:50:58.363165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056c0470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105399340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105398a10>]}
[0m21:50:58.363381 [debug] [MainThread]: Flushing usage events
[0m21:52:42.011444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108009b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10837efc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10837ec60>]}


============================== 21:52:42.014392 | 669b3607-f4fd-49ca-94bc-96a5e4440f8a ==============================
[0m21:52:42.014392 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:52:42.014713 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select prep_customer', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:52:43.000713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a99c4a0>]}
[0m21:52:43.027175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13adf6780>]}
[0m21:52:43.027619 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:52:43.052934 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:52:43.155675 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:52:43.156100 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m21:52:43.272382 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:52:43.278911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c0f2ff0>]}
[0m21:52:43.339803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b5ccda0>]}
[0m21:52:43.340138 [info ] [MainThread]: Found 8 models, 1 seed, 3 sources, 855 macros
[0m21:52:43.340314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b7f6c60>]}
[0m21:52:43.341148 [info ] [MainThread]: 
[0m21:52:43.341459 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:52:43.341941 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:52:43.342174 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:52:43.815363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m21:52:43.815748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:44.273063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m21:52:44.274344 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:44.752826 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m21:52:44.753349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:45.326398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c0ed130>]}
[0m21:52:45.327536 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:52:45.328147 [info ] [MainThread]: 
[0m21:52:45.331857 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:52:45.332666 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:52:45.333191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.prep_customer)
[0m21:52:45.333514 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:52:45.342035 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:52:45.343548 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:52:45.407791 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:52:45.409295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:52:45.478283 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names as (
    -- Second CTE: Assign random names from the seed data
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        random_names.first_name,
        random_names.last_name,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names on customers.customer_id = random_names.customer_id
)

-- FINAL CTE
select * from final;


[0m21:52:46.304153 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:88838599-cb9a-464b-83ed-d1949a5facda&page=queryresults
[0m21:52:46.720039 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '669b3607-f4fd-49ca-94bc-96a5e4440f8a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c081340>]}
[0m21:52:46.721077 [info ] [Thread-1 (]: 1 of 1 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.39s]
[0m21:52:46.721643 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:52:46.722420 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:52:46.722601 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m21:52:46.722767 [info ] [MainThread]: 
[0m21:52:46.722935 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.38 seconds (3.38s).
[0m21:52:46.723295 [debug] [MainThread]: Command end result
[0m21:52:46.750100 [info ] [MainThread]: 
[0m21:52:46.750384 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:52:46.750539 [info ] [MainThread]: 
[0m21:52:46.750688 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m21:52:46.752662 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.775853, "process_user_time": 3.453994, "process_kernel_time": 0.424751, "process_mem_max_rss": "208617472", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:52:46.752995 [debug] [MainThread]: Command `dbt run` succeeded at 21:52:46.752940 after 4.78 seconds
[0m21:52:46.753194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c0f3e00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ddcf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b690e90>]}
[0m21:52:46.753368 [debug] [MainThread]: Flushing usage events
[0m21:59:35.896479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108795220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a46ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a46b40>]}


============================== 21:59:35.899361 | 9e315b3e-24fc-4990-a23d-2a14f78aff46 ==============================
[0m21:59:35.899361 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:59:35.899680 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select prep_customer', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:59:36.882505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072ee930>]}
[0m21:59:36.909270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107351c70>]}
[0m21:59:36.909710 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:59:36.933198 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:59:37.034925 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 1 files added, 1 files changed.
[0m21:59:37.035259 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://macros/generate_mobile_numbers.sql
[0m21:59:37.035417 [debug] [MainThread]: Partial parsing: deleted file: manual_pasfield://models/prepatory/prep_customer_with_names.sql
[0m21:59:37.035549 [debug] [MainThread]: Partial parsing: deleted file: manual_pasfield://macros/populate_random_names.sql
[0m21:59:37.035727 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m21:59:37.154629 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:59:37.162115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1377f7050>]}
[0m21:59:37.221494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137351580>]}
[0m21:59:37.222454 [info ] [MainThread]: Found 7 models, 1 seed, 3 sources, 855 macros
[0m21:59:37.223148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136fcfd10>]}
[0m21:59:37.224193 [info ] [MainThread]: 
[0m21:59:37.226998 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:59:37.227507 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:59:37.229885 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:59:37.854919 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m21:59:37.855226 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:38.967327 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m21:59:38.969540 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:39.474102 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m21:59:39.476315 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:40.000448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137422ba0>]}
[0m21:59:40.001680 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:59:40.002419 [info ] [MainThread]: 
[0m21:59:40.006294 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:59:40.006745 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:59:40.007072 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.prep_customer)
[0m21:59:40.007530 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:59:40.063948 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:59:40.066040 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:59:40.082035 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:59:40.082761 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:59:40.150407 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Second CTE: Assign random names from the seed data
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- Generate a 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- Generate a 6-digit line number (100000-999999)
    )

    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        random_names.first_name,
        random_names.last_name,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names on customers.customer_id = random_names.customer_id
)

-- FINAL CTE
select * from final;


[0m21:59:40.536773 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:96aa781a-12f2-4d99-8c5b-cab8a5ad38df&page=queryresults
[0m21:59:40.538323 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Table "random_names" must be qualified with a dataset (e.g. dataset.table).; reason: invalid, location: random_names, message: Table "random_names" must be qualified with a dataset (e.g. dataset.table).')
[0m21:59:40.908132 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fe4a3d61-5b31-4ae3-9bd2-68482928b162&page=queryresults
[0m21:59:40.909134 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fe4a3d61-5b31-4ae3-9bd2-68482928b162&page=queryresults
[0m21:59:40.918591 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Table "random_names" must be qualified with a dataset (e.g. dataset.table).
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m21:59:40.919604 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e315b3e-24fc-4990-a23d-2a14f78aff46', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137494110>]}
[0m21:59:40.920036 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 0.91s]
[0m21:59:40.920390 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m21:59:40.921405 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:59:40.921612 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m21:59:40.921786 [info ] [MainThread]: 
[0m21:59:40.921959 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.69 seconds (3.69s).
[0m21:59:40.922354 [debug] [MainThread]: Command end result
[0m21:59:40.950001 [info ] [MainThread]: 
[0m21:59:40.950316 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:59:40.950480 [info ] [MainThread]: 
[0m21:59:40.950687 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Table "random_names" must be qualified with a dataset (e.g. dataset.table).
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m21:59:40.950841 [info ] [MainThread]: 
[0m21:59:40.950992 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m21:59:40.952915 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.092355, "process_user_time": 3.510379, "process_kernel_time": 0.353804, "process_mem_max_rss": "208551936", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:59:40.953220 [debug] [MainThread]: Command `dbt run` failed at 21:59:40.953172 after 5.09 seconds
[0m21:59:40.953423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065d16d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b90290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14322ed50>]}
[0m21:59:40.953611 [debug] [MainThread]: Flushing usage events
[0m21:59:56.391525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10624a090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066eaed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066eac90>]}


============================== 21:59:56.394424 | 3783ce67-fb7e-438b-a142-0b52bb432998 ==============================
[0m21:59:56.394424 [info ] [MainThread]: Running with dbt=1.8.5
[0m21:59:56.394751 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select prep_customer', 'send_anonymous_usage_stats': 'True'}
[0m21:59:57.326311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106719580>]}
[0m21:59:57.352817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106719580>]}
[0m21:59:57.353226 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m21:59:57.377971 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m21:59:57.472441 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:59:57.473133 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m21:59:57.587765 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m21:59:57.594987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c258cb0>]}
[0m21:59:57.653029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ffd4ef0>]}
[0m21:59:57.653326 [info ] [MainThread]: Found 7 models, 1 seed, 3 sources, 855 macros
[0m21:59:57.653490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c2f0c80>]}
[0m21:59:57.654263 [info ] [MainThread]: 
[0m21:59:57.654559 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m21:59:57.655021 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m21:59:57.655232 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:59:58.235026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m21:59:58.235346 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:58.756722 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m21:59:58.758422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:59.339922 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m21:59:59.341220 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:59:59.871789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a45c40>]}
[0m21:59:59.873781 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m21:59:59.874194 [info ] [MainThread]: 
[0m21:59:59.876783 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m21:59:59.877242 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer .......................... [RUN]
[0m21:59:59.877563 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.prep_customer)
[0m21:59:59.877771 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m21:59:59.884629 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m21:59:59.885487 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m21:59:59.951849 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m21:59:59.952533 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:00:00.021621 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Second CTE: Assign random names from the seed data
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- Generate a 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- Generate a 6-digit line number (100000-999999)
    )

    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        random_names.first_name,
        random_names.last_name,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
)

-- FINAL CTE
select * from final;


[0m22:00:00.688639 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:40d7caa7-9b6c-42be-a37b-dbd9c2389d19&page=queryresults
[0m22:00:00.771979 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Unrecognized name: random_names at [51:9]; reason: invalidQuery, location: query, message: Unrecognized name: random_names at [51:9]')
[0m22:00:01.386004 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c0a415b4-09ac-4e74-95a8-7daf948dc740&page=queryresults
[0m22:00:01.493010 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c0a415b4-09ac-4e74-95a8-7daf948dc740&page=queryresults
[0m22:00:01.505267 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: random_names at [51:9]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m22:00:01.507142 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3783ce67-fb7e-438b-a142-0b52bb432998', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee13170>]}
[0m22:00:01.507711 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 1.63s]
[0m22:00:01.508057 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m22:00:01.509030 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:00:01.509210 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m22:00:01.509368 [info ] [MainThread]: 
[0m22:00:01.509528 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.85 seconds (3.85s).
[0m22:00:01.509853 [debug] [MainThread]: Command end result
[0m22:00:01.534915 [info ] [MainThread]: 
[0m22:00:01.535242 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:00:01.535398 [info ] [MainThread]: 
[0m22:00:01.535582 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Unrecognized name: random_names at [51:9]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m22:00:01.535721 [info ] [MainThread]: 
[0m22:00:01.535864 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m22:00:01.538112 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.180557, "process_user_time": 3.496955, "process_kernel_time": 0.369855, "process_mem_max_rss": "208650240", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:00:01.538441 [debug] [MainThread]: Command `dbt run` failed at 22:00:01.538390 after 5.18 seconds
[0m22:00:01.538639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c2eede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff3e570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff3e240>]}
[0m22:00:01.538822 [debug] [MainThread]: Flushing usage events
[0m22:01:27.723761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106110a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090eaf60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090eac30>]}


============================== 22:01:27.726768 | ec4a0a64-8d86-418b-9d28-e2ef87be840c ==============================
[0m22:01:27.726768 [info ] [MainThread]: Running with dbt=1.8.5
[0m22:01:27.727101 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select prep_customer', 'send_anonymous_usage_stats': 'True'}
[0m22:01:28.769586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b201730>]}
[0m22:01:28.796677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b728260>]}
[0m22:01:28.797204 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m22:01:28.822409 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m22:01:28.933324 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:01:28.933784 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m22:01:29.053360 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m22:01:29.060283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13abfac60>]}
[0m22:01:29.120372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a8e0c80>]}
[0m22:01:29.120702 [info ] [MainThread]: Found 7 models, 1 seed, 3 sources, 855 macros
[0m22:01:29.120879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ab4dee0>]}
[0m22:01:29.121729 [info ] [MainThread]: 
[0m22:01:29.122028 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m22:01:29.122511 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m22:01:29.122731 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:01:29.829464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m22:01:29.829836 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:30.249860 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m22:01:30.251758 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:30.640652 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m22:01:30.641880 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:01:31.262037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ab5b20>]}
[0m22:01:31.263136 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m22:01:31.263877 [info ] [MainThread]: 
[0m22:01:31.267407 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m22:01:31.268053 [info ] [Thread-1 (]: 1 of 1 START sql view model manual_test.prep_customer .......................... [RUN]
[0m22:01:31.268356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.prep_customer)
[0m22:01:31.268792 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m22:01:31.277563 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m22:01:31.278629 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m22:01:31.355754 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m22:01:31.357340 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:01:31.430671 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Second CTE: Assign random names from the seed data
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- Generate a 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- Generate a 6-digit line number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
)

-- FINAL CTE
select * from final;


[0m22:01:31.917512 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b71c56fe-a0e4-43ef-bf7e-622ada6c52c1&page=queryresults
[0m22:01:32.150950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec4a0a64-8d86-418b-9d28-e2ef87be840c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b67a0f0>]}
[0m22:01:32.151368 [info ] [Thread-1 (]: 1 of 1 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.88s]
[0m22:01:32.151696 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m22:01:32.152348 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:01:32.152544 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m22:01:32.152710 [info ] [MainThread]: 
[0m22:01:32.152879 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.03 seconds (3.03s).
[0m22:01:32.153223 [debug] [MainThread]: Command end result
[0m22:01:32.179073 [info ] [MainThread]: 
[0m22:01:32.179363 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:01:32.179521 [info ] [MainThread]: 
[0m22:01:32.179674 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m22:01:32.181622 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.494227, "process_user_time": 2.966585, "process_kernel_time": 0.364769, "process_mem_max_rss": "207044608", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:01:32.181945 [debug] [MainThread]: Command `dbt run` succeeded at 22:01:32.181894 after 4.49 seconds
[0m22:01:32.182135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106110a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aa83b30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aa812b0>]}
[0m22:01:32.182303 [debug] [MainThread]: Flushing usage events
[0m23:10:24.830846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105087b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105226ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105226b70>]}


============================== 23:10:24.833585 | 0a8822cc-35ae-4570-9698-4ac785553f04 ==============================
[0m23:10:24.833585 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:10:24.833895 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:10:25.806521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a8822cc-35ae-4570-9698-4ac785553f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c45730>]}
[0m23:10:25.832740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a8822cc-35ae-4570-9698-4ac785553f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127fd4320>]}
[0m23:10:25.833163 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:10:25.858432 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:10:25.959398 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 4 files added, 5 files changed.
[0m23:10:25.959818 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_cohort_retention_analysis_monthly.yml
[0m23:10:25.960019 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:10:25.960169 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_customer_metrics_monthly.sql
[0m23:10:25.960307 [debug] [MainThread]: Partial parsing: added file: manual_pasfield://models/marts/mart_cohort_retention_analysis_monthly.sql
[0m23:10:25.960531 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m23:10:25.960706 [debug] [MainThread]: Partial parsing: deleted file: manual_pasfield://models/marts/mart_customer_metrics.sql
[0m23:10:25.960830 [debug] [MainThread]: Partial parsing: deleted file: manual_pasfield://models/marts/mart_cohort_retention_analysis.sql
[0m23:10:25.960996 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:10:25.961162 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://macros/generate_mobile_numbers.sql
[0m23:10:25.961318 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/overview.md
[0m23:10:25.961450 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.sql
[0m23:10:26.176594 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:10:26.183394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a8822cc-35ae-4570-9698-4ac785553f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1523fe150>]}
[0m23:10:26.305298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a8822cc-35ae-4570-9698-4ac785553f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152987c80>]}
[0m23:10:26.305590 [info ] [MainThread]: Found 7 models, 1 seed, 5 data tests, 3 sources, 855 macros
[0m23:10:26.305769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a8822cc-35ae-4570-9698-4ac785553f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152c01370>]}
[0m23:10:26.307049 [info ] [MainThread]: 
[0m23:10:26.307479 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:10:26.309601 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_mart'
[0m23:10:26.309825 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:10:27.403313 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m23:10:27.405274 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:10:27.876500 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:10:27.879664 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:10:28.356306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a8822cc-35ae-4570-9698-4ac785553f04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1524b23f0>]}
[0m23:10:28.357186 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:10:28.357671 [info ] [MainThread]: 
[0m23:10:28.360901 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:10:28.361434 [info ] [Thread-1 (]: 1 of 5 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:10:28.362020 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:10:28.362323 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:10:28.373015 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:10:28.374198 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:10:28.385509 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:10:28.386729 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:10:28.462563 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:10:29.217999 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4163b4cb-83b2-4462-a2b7-aeff137cdb98&page=queryresults
[0m23:10:29.219239 [debug] [Thread-1 (]: BigQuery adapter: Unhandled error while running:
/* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:10:29.220203 [debug] [Thread-1 (]: BigQuery adapter: 404 Not found: Table manual-pasfield:manual_test_mart.mart_cohort_retention_analysis_monthly was not found in location EU; reason: notFound, message: Not found: Table manual-pasfield:manual_test_mart.mart_cohort_retention_analysis_monthly was not found in location EU

Location: EU
Job ID: 4163b4cb-83b2-4462-a2b7-aeff137cdb98

[0m23:10:29.228938 [debug] [Thread-1 (]: Runtime Error in test not_null_mart_cohort_retention_analysis_monthly_cohort_month (models/marts/mart_cohort_retention_analysis_monthly.yml)
  404 Not found: Table manual-pasfield:manual_test_mart.mart_cohort_retention_analysis_monthly was not found in location EU; reason: notFound, message: Not found: Table manual-pasfield:manual_test_mart.mart_cohort_retention_analysis_monthly was not found in location EU
  
  Location: EU
  Job ID: 4163b4cb-83b2-4462-a2b7-aeff137cdb98
  
[0m23:10:29.229324 [error] [Thread-1 (]: 1 of 5 ERROR not_null_mart_cohort_retention_analysis_monthly_cohort_month ...... [[31mERROR[0m in 0.87s]
[0m23:10:29.229721 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:10:29.229960 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:10:29.230674 [info ] [Thread-1 (]: 2 of 5 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:10:29.230923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:10:29.231101 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:10:29.233414 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:10:29.233916 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:10:29.235267 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:10:29.235702 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:10:29.315516 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:10:30.042157 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8e444ade-a552-4a6a-acce-0b0053afce3d&page=queryresults
[0m23:10:30.542706 [info ] [Thread-1 (]: 2 of 5 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.31s]
[0m23:10:30.543402 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:10:30.543827 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:10:30.544104 [info ] [Thread-1 (]: 3 of 5 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:10:30.544396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:10:30.544588 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:10:30.548788 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:10:30.549314 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:10:30.550750 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:10:30.551159 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:10:30.628077 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:10:31.439849 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f92bd868-b135-423e-9b25-638a3f6d452b&page=queryresults
[0m23:10:31.840431 [info ] [Thread-1 (]: 3 of 5 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.30s]
[0m23:10:31.841409 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:10:31.841954 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:10:31.842479 [info ] [Thread-1 (]: 4 of 5 START test unique_mart_customer_retention_metrics_customer_id ........... [RUN]
[0m23:10:31.843040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1)
[0m23:10:31.843505 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:10:31.850463 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:10:31.851102 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:10:31.852712 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:10:31.853663 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:10:31.931953 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select customer_id as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
  where customer_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:10:33.558720 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1613628b-cba7-46ed-9ab5-b8ac12b175ee&page=queryresults
[0m23:10:34.058559 [error] [Thread-1 (]: 4 of 5 FAIL 401215 unique_mart_customer_retention_metrics_customer_id .......... [[31mFAIL 401215[0m in 2.22s]
[0m23:10:34.060171 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:10:34.060979 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:10:34.061769 [info ] [Thread-1 (]: 5 of 5 START test unique_mart_customer_retention_metrics_subscription_id ....... [RUN]
[0m23:10:34.062433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1, now test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82)
[0m23:10:34.062988 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:10:34.067481 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82"
[0m23:10:34.068134 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:10:34.069871 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82"
[0m23:10:34.070336 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:10:34.145098 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select subscription_id as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
  where subscription_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:10:36.230482 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0c37ea2a-8d96-4281-a6dd-99570874db90&page=queryresults
[0m23:10:36.950212 [error] [Thread-1 (]: 5 of 5 FAIL 309659 unique_mart_customer_retention_metrics_subscription_id ...... [[31mFAIL 309659[0m in 2.89s]
[0m23:10:36.951552 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:10:36.953401 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:10:36.953853 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82' was properly closed.
[0m23:10:36.954257 [info ] [MainThread]: 
[0m23:10:36.954669 [info ] [MainThread]: Finished running 5 data tests in 0 hours 0 minutes and 10.65 seconds (10.65s).
[0m23:10:36.955950 [debug] [MainThread]: Command end result
[0m23:10:36.984211 [info ] [MainThread]: 
[0m23:10:36.984483 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m23:10:36.984631 [info ] [MainThread]: 
[0m23:10:36.984820 [error] [MainThread]:   Runtime Error in test not_null_mart_cohort_retention_analysis_monthly_cohort_month (models/marts/mart_cohort_retention_analysis_monthly.yml)
  404 Not found: Table manual-pasfield:manual_test_mart.mart_cohort_retention_analysis_monthly was not found in location EU; reason: notFound, message: Not found: Table manual-pasfield:manual_test_mart.mart_cohort_retention_analysis_monthly was not found in location EU
  
  Location: EU
  Job ID: 4163b4cb-83b2-4462-a2b7-aeff137cdb98
  
[0m23:10:36.984961 [info ] [MainThread]: 
[0m23:10:36.985126 [error] [MainThread]: [31mFailure in test unique_mart_customer_retention_metrics_customer_id (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:10:36.985286 [error] [MainThread]:   Got 401215 results, configured to fail if != 0
[0m23:10:36.985412 [info ] [MainThread]: 
[0m23:10:36.985575 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/unique_mart_customer_retention_metrics_customer_id.sql
[0m23:10:36.985708 [info ] [MainThread]: 
[0m23:10:36.985874 [error] [MainThread]: [31mFailure in test unique_mart_customer_retention_metrics_subscription_id (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:10:36.986029 [error] [MainThread]:   Got 309659 results, configured to fail if != 0
[0m23:10:36.986152 [info ] [MainThread]: 
[0m23:10:36.986308 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/unique_mart_customer_retention_metrics_subscription_id.sql
[0m23:10:36.986439 [info ] [MainThread]: 
[0m23:10:36.986579 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=3 SKIP=0 TOTAL=5
[0m23:10:36.988446 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 12.192354, "process_user_time": 4.034685, "process_kernel_time": 0.379431, "process_mem_max_rss": "213614592", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:10:36.988741 [debug] [MainThread]: Command `dbt test` failed at 23:10:36.988693 after 12.19 seconds
[0m23:10:36.988944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105087b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100256b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1529439b0>]}
[0m23:10:36.989122 [debug] [MainThread]: Flushing usage events
[0m23:12:15.481930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055f30b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b26f60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122b26c00>]}


============================== 23:12:15.484644 | c8b0b312-979f-4d2c-8e69-359492552203 ==============================
[0m23:12:15.484644 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:12:15.484959 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m23:12:16.435411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d774d10>]}
[0m23:12:16.461866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15da14380>]}
[0m23:12:16.462310 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:12:16.487079 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:12:16.595757 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:12:16.596166 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:12:16.716539 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:12:16.724386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d544dd0>]}
[0m23:12:16.790202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15df5b9e0>]}
[0m23:12:16.790552 [info ] [MainThread]: Found 7 models, 1 seed, 5 data tests, 3 sources, 855 macros
[0m23:12:16.790733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15dff3440>]}
[0m23:12:16.791856 [info ] [MainThread]: 
[0m23:12:16.792180 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:12:16.794210 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:12:16.794452 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:17.226101 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:17.614881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:18.028223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m23:12:18.029154 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:18.521918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m23:12:18.523574 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:19.019455 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m23:12:19.021182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:19.548745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d901c70>]}
[0m23:12:19.551315 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:12:19.554141 [info ] [MainThread]: 
[0m23:12:19.557986 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:12:19.558877 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:12:19.559582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m23:12:19.560111 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:12:19.615174 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:12:19.617690 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:12:19.626472 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:20.064987 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:12:20.065549 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:12:20.367244 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0fffa7e5-d369-4f02-bb58-5ab82980ddd2&page=queryresults
[0m23:12:23.296865 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d323470>]}
[0m23:12:23.297712 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.74s]
[0m23:12:23.298057 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:12:23.298273 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:12:23.298554 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:12:23.298815 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:12:23.298992 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:12:23.300765 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:12:23.301603 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:12:23.303906 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:24.385358 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:12:24.387016 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:12:25.086511 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5cf29602-9b91-41ab-8968-39343b841cdb&page=queryresults
[0m23:12:28.961696 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15dd55f40>]}
[0m23:12:28.964114 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 5.66s]
[0m23:12:28.965153 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:12:28.965540 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:12:28.965888 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:12:28.966426 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:12:28.966712 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:12:28.974568 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:12:28.977244 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:12:28.981944 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:29.514662 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:12:29.517569 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:12:30.198334 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c2d04f86-ba77-43e8-a604-24613ada098e&page=queryresults
[0m23:12:32.756931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e9b4110>]}
[0m23:12:32.758657 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.79s]
[0m23:12:32.759620 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:12:32.760768 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:12:32.761283 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:12:32.761600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:12:32.761805 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:12:32.764800 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:12:32.765618 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:12:32.780083 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:12:32.780838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:32.852876 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
    distinct
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    -- CLEANING
    where
)

-- FINAL CTE
select * from final;


[0m23:12:33.684863 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bd1cd9b5-2630-4648-a89f-b591efc6db25&page=queryresults
[0m23:12:33.686188 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected ")" at [67:1]; reason: invalidQuery, location: query, message: Syntax error: Unexpected ")" at [67:1]')
[0m23:12:34.112665 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8bc3e7d8-af58-4d8b-84aa-0ac2364b2294&page=queryresults
[0m23:12:34.113978 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8bc3e7d8-af58-4d8b-84aa-0ac2364b2294&page=queryresults
[0m23:12:34.126382 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Syntax error: Unexpected ")" at [67:1]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:12:34.126777 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8b0b312-979f-4d2c-8e69-359492552203', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e9b2060>]}
[0m23:12:34.127153 [error] [Thread-1 (]: 4 of 7 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 1.37s]
[0m23:12:34.127484 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:12:34.128299 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:12:34.128573 [info ] [Thread-1 (]: 5 of 7 SKIP relation manual_test_mart.mart_cohort_retention_analysis_monthly ... [[33mSKIP[0m]
[0m23:12:34.128813 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:12:34.129015 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:12:34.129224 [info ] [Thread-1 (]: 6 of 7 SKIP relation manual_test_mart.mart_customer_metrics_monthly ............ [[33mSKIP[0m]
[0m23:12:34.129429 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:12:34.129614 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:12:34.129807 [info ] [Thread-1 (]: 7 of 7 SKIP relation manual_test_mart.mart_customer_retention_metrics .......... [[33mSKIP[0m]
[0m23:12:34.130009 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:12:34.130576 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:12:34.130779 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:12:34.130997 [info ] [MainThread]: 
[0m23:12:34.131180 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 17.34 seconds (17.34s).
[0m23:12:34.131831 [debug] [MainThread]: Command end result
[0m23:12:34.159095 [info ] [MainThread]: 
[0m23:12:34.159394 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:12:34.159540 [info ] [MainThread]: 
[0m23:12:34.159728 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Syntax error: Unexpected ")" at [67:1]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:12:34.159870 [info ] [MainThread]: 
[0m23:12:34.160012 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=3 TOTAL=7
[0m23:12:34.161909 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 18.71627, "process_user_time": 4.124684, "process_kernel_time": 0.424165, "process_mem_max_rss": "209780736", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:12:34.162185 [debug] [MainThread]: Command `dbt run` failed at 23:12:34.162142 after 18.72 seconds
[0m23:12:34.162371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d6d27b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e993800>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15e9931d0>]}
[0m23:12:34.162545 [debug] [MainThread]: Flushing usage events
[0m23:12:52.802895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074573e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bfaf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bfad50>]}


============================== 23:12:52.805831 | b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74 ==============================
[0m23:12:52.805831 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:12:52.806259 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:12:53.755697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1381d9730>]}
[0m23:12:53.781800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1236d4440>]}
[0m23:12:53.782232 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:12:53.807379 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:12:53.916891 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:12:53.917291 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:12:54.038727 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:12:54.046531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1388ecce0>]}
[0m23:12:54.115329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138a80710>]}
[0m23:12:54.115636 [info ] [MainThread]: Found 7 models, 1 seed, 5 data tests, 3 sources, 855 macros
[0m23:12:54.115809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138350e60>]}
[0m23:12:54.116840 [info ] [MainThread]: 
[0m23:12:54.117144 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:12:54.119197 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:12:54.119439 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:54.654079 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:55.191688 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:55.723419 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m23:12:55.724159 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:56.196705 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m23:12:56.198544 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:56.722862 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:12:56.724198 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:57.212725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138350230>]}
[0m23:12:57.213128 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:12:57.213314 [info ] [MainThread]: 
[0m23:12:57.214866 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:12:57.215189 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:12:57.215439 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m23:12:57.215621 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:12:57.270955 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:12:57.272798 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:12:57.281130 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:57.871395 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:12:57.872558 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:12:58.405668 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:aad480fd-f3b3-4ec1-b9df-305c87130623&page=queryresults
[0m23:13:00.869190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120b23050>]}
[0m23:13:00.869612 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.65s]
[0m23:13:00.870017 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:13:00.870266 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:13:00.870503 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:13:00.870781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:13:00.870948 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:13:00.873054 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:13:00.873919 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:13:00.875413 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:13:01.434907 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:13:01.436825 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:13:01.787810 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:51aa5c0b-5af7-4455-ba2f-44d385265cf8&page=queryresults
[0m23:13:05.258113 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13879edb0>]}
[0m23:13:05.260021 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.39s]
[0m23:13:05.261047 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:13:05.261667 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:13:05.262422 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:13:05.262987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:13:05.263431 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:13:05.265822 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:13:05.266600 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:13:05.268503 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:13:05.719831 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:13:05.722154 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:13:06.091135 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e0445cf9-f600-4b7d-a0f4-5521cdd388a9&page=queryresults
[0m23:13:08.407684 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1387ae720>]}
[0m23:13:08.408531 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.14s]
[0m23:13:08.409356 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:13:08.410332 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:13:08.411141 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:13:08.411810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:13:08.412268 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:13:08.417040 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:13:08.417655 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:13:08.428264 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:13:08.428971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:13:08.505515 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
    distinct
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    -- CLEANING
)

-- FINAL CTE
select * from final;


[0m23:13:09.742402 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:88ad0507-d8d2-4f87-bed9-82c7bb79db8e&page=queryresults
[0m23:13:10.048466 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138276570>]}
[0m23:13:10.049488 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.64s]
[0m23:13:10.050482 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:13:10.051599 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:13:10.052828 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m23:13:10.053937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m23:13:10.054497 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:13:10.059394 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:13:10.060384 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:13:10.070463 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:13:10.143029 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:13:10.997043 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fe9f65c1-428b-4e68-a2f7-4d8b755dbe90&page=queryresults
[0m23:13:11.237730 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:13:11.782144 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7836ab6a-8dae-4e58-9aaf-b957f6151623&page=queryresults
[0m23:13:11.903434 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:13:11.905080 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:13:12.795416 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fc9350a3-dcfa-4975-9254-52777c12eb62&page=queryresults
[0m23:13:43.734126 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13880c440>]}
[0m23:13:43.736186 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 33.68s]
[0m23:13:43.737148 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:13:43.737781 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:13:43.738447 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m23:13:43.739025 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m23:13:43.739479 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:13:43.743683 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:13:43.745063 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:13:43.747142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:13:43.821930 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:13:44.978555 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a29f0113-b9a3-4f99-9ac9-112c1852c300&page=queryresults
[0m23:13:45.487781 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:13:45.867959 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2cc642cd-ca1f-4fc8-a986-6389fb53c60d&page=queryresults
[0m23:13:45.988653 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:13:45.990200 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:13:46.489961 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0ffe7b1d-c2e4-4331-96f4-c482bf09171b&page=queryresults
[0m23:14:19.664404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1385c4530>]}
[0m23:14:19.665908 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 35.93s]
[0m23:14:19.666896 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:14:19.667604 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:14:19.668352 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m23:14:19.668972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m23:14:19.669878 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m23:14:19.674060 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:14:19.675863 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m23:14:19.677866 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:14:20.174038 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:14:21.152024 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9af21ea3-8699-4667-9cc5-a7ead42050f5&page=queryresults
[0m23:14:21.530448 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:14:22.005517 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ff1aa5c6-ae95-4bc8-8703-d81b9f26f5ba&page=queryresults
[0m23:14:22.107432 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:14:22.110021 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m23:14:22.717325 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4fa811d9-f47a-4e02-8728-e0a861aa5145&page=queryresults
[0m23:14:44.679812 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b9c4c6b8-f030-4fb5-8fd4-0c039dec7b74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138a146b0>]}
[0m23:14:44.681789 [info ] [Thread-1 (]: 7 of 7 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (103.3m rows, 88.0 MiB processed)[0m in 25.01s]
[0m23:14:44.682673 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:14:44.684151 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:14:44.684418 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m23:14:44.684687 [info ] [MainThread]: 
[0m23:14:44.684890 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 1 minutes and 50.57 seconds (110.57s).
[0m23:14:44.685793 [debug] [MainThread]: Command end result
[0m23:14:44.717175 [info ] [MainThread]: 
[0m23:14:44.717475 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:14:44.717636 [info ] [MainThread]: 
[0m23:14:44.717796 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:14:44.720072 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 111.95154, "process_user_time": 4.624803, "process_kernel_time": 0.407227, "process_mem_max_rss": "211517440", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:14:44.720418 [debug] [MainThread]: Command `dbt run` succeeded at 23:14:44.720371 after 111.95 seconds
[0m23:14:44.720628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1388fef30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067857f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1381dbec0>]}
[0m23:14:44.720802 [debug] [MainThread]: Flushing usage events
[0m23:15:28.637206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aa8740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106102f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106102bd0>]}


============================== 23:15:28.640415 | d030756d-36ce-4cf4-8ded-f6f7c1532908 ==============================
[0m23:15:28.640415 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:15:28.640830 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:15:29.598487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd030756d-36ce-4cf4-8ded-f6f7c1532908', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188bb320>]}
[0m23:15:29.625694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd030756d-36ce-4cf4-8ded-f6f7c1532908', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128214ec0>]}
[0m23:15:29.626140 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:15:29.649785 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:15:29.756878 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:15:29.757155 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:15:29.759988 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:15:29.785559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd030756d-36ce-4cf4-8ded-f6f7c1532908', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e844590>]}
[0m23:15:29.858653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd030756d-36ce-4cf4-8ded-f6f7c1532908', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ee45cd0>]}
[0m23:15:29.858971 [info ] [MainThread]: Found 7 models, 1 seed, 5 data tests, 3 sources, 855 macros
[0m23:15:29.859145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd030756d-36ce-4cf4-8ded-f6f7c1532908', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e9551f0>]}
[0m23:15:29.860219 [info ] [MainThread]: 
[0m23:15:29.860529 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:15:29.863149 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_ref'
[0m23:15:29.863415 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:15:30.401765 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m23:15:30.402321 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:15:30.914981 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m23:15:30.916957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:15:31.400293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd030756d-36ce-4cf4-8ded-f6f7c1532908', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a0de80>]}
[0m23:15:31.401318 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:15:31.401892 [info ] [MainThread]: 
[0m23:15:31.405075 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:15:31.405657 [info ] [Thread-1 (]: 1 of 5 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:15:31.406110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:15:31.406362 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:15:31.418215 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:15:31.419377 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:15:31.430377 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:15:31.430928 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:31.505999 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:15:32.353904 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a330fd83-c3cb-4bc5-876d-e5045c9dc676&page=queryresults
[0m23:15:33.109845 [info ] [Thread-1 (]: 1 of 5 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.70s]
[0m23:15:33.110453 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:15:33.110703 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:15:33.110891 [info ] [Thread-1 (]: 2 of 5 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:15:33.111189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:15:33.111788 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:15:33.114259 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:15:33.114680 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:15:33.116000 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:15:33.116585 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:33.194910 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:15:34.649217 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7e9f8a55-ee00-4e1f-826a-af86296abaf9&page=queryresults
[0m23:15:35.011387 [info ] [Thread-1 (]: 2 of 5 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.90s]
[0m23:15:35.012787 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:15:35.013525 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:15:35.014128 [info ] [Thread-1 (]: 3 of 5 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:15:35.014708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:15:35.015191 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:15:35.021360 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:15:35.023340 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:15:35.024904 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:15:35.025356 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:35.097783 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:15:36.242543 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a20272ba-e470-4a47-a98c-6be20f6e58c9&page=queryresults
[0m23:15:36.656405 [info ] [Thread-1 (]: 3 of 5 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.64s]
[0m23:15:36.657438 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:15:36.657990 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:15:36.658517 [info ] [Thread-1 (]: 4 of 5 START test unique_mart_customer_retention_metrics_customer_id ........... [RUN]
[0m23:15:36.659087 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1)
[0m23:15:36.659554 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:15:36.666055 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:15:36.666722 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:15:36.668326 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:15:36.668766 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:36.744400 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select customer_id as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
  where customer_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:15:38.549673 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a8bc9cd6-9424-4fd9-96c1-7d2e47bd56e3&page=queryresults
[0m23:15:40.257065 [error] [Thread-1 (]: 4 of 5 FAIL 507470 unique_mart_customer_retention_metrics_customer_id .......... [[31mFAIL 507470[0m in 3.60s]
[0m23:15:40.257554 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:15:40.257822 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:15:40.258106 [info ] [Thread-1 (]: 5 of 5 START test unique_mart_customer_retention_metrics_subscription_id ....... [RUN]
[0m23:15:40.258437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1, now test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82)
[0m23:15:40.258678 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:15:40.261777 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82"
[0m23:15:40.262294 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:15:40.264093 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82"
[0m23:15:40.264796 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:15:40.341356 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select subscription_id as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
  where subscription_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:15:41.910534 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:63685e92-55da-43c7-90d7-744a479ce948&page=queryresults
[0m23:15:44.842845 [error] [Thread-1 (]: 5 of 5 FAIL 1475099 unique_mart_customer_retention_metrics_subscription_id ..... [[31mFAIL 1475099[0m in 4.58s]
[0m23:15:44.844598 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82
[0m23:15:44.846568 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:15:44.847116 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_retention_metrics_subscription_id.84c5e84c82' was properly closed.
[0m23:15:44.847595 [info ] [MainThread]: 
[0m23:15:44.848104 [info ] [MainThread]: Finished running 5 data tests in 0 hours 0 minutes and 14.99 seconds (14.99s).
[0m23:15:44.850427 [debug] [MainThread]: Command end result
[0m23:15:44.924611 [info ] [MainThread]: 
[0m23:15:44.924921 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:15:44.925087 [info ] [MainThread]: 
[0m23:15:44.925295 [error] [MainThread]: [31mFailure in test unique_mart_customer_retention_metrics_customer_id (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:15:44.925474 [error] [MainThread]:   Got 507470 results, configured to fail if != 0
[0m23:15:44.925609 [info ] [MainThread]: 
[0m23:15:44.925774 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/unique_mart_customer_retention_metrics_customer_id.sql
[0m23:15:44.925907 [info ] [MainThread]: 
[0m23:15:44.926078 [error] [MainThread]: [31mFailure in test unique_mart_customer_retention_metrics_subscription_id (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:15:44.926238 [error] [MainThread]:   Got 1475099 results, configured to fail if != 0
[0m23:15:44.926364 [info ] [MainThread]: 
[0m23:15:44.926521 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/unique_mart_customer_retention_metrics_subscription_id.sql
[0m23:15:44.926656 [info ] [MainThread]: 
[0m23:15:44.926806 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=0 TOTAL=5
[0m23:15:44.928746 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 16.330025, "process_user_time": 3.841891, "process_kernel_time": 0.360471, "process_mem_max_rss": "206749696", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:15:44.929043 [debug] [MainThread]: Command `dbt test` failed at 23:15:44.928995 after 16.33 seconds
[0m23:15:44.929241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102402b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cc8da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ef2bcb0>]}
[0m23:15:44.929416 [debug] [MainThread]: Flushing usage events
[0m23:26:35.548638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104958230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feb020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fead80>]}


============================== 23:26:35.551586 | acf87bf4-eeea-4281-b76c-c4f6f9f909f1 ==============================
[0m23:26:35.551586 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:26:35.551922 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:26:36.415014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd99e50>]}
[0m23:26:36.442669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fdce300>]}
[0m23:26:36.443161 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:26:36.472937 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:26:36.584378 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m23:26:36.584908 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m23:26:36.585121 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:26:36.798009 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:26:36.804715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153e2f7d0>]}
[0m23:26:36.915937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1538fe900>]}
[0m23:26:36.916228 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:26:36.916396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153a4dfa0>]}
[0m23:26:36.917455 [info ] [MainThread]: 
[0m23:26:36.917858 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:26:36.920004 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:26:36.920269 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:26:37.796176 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:26:38.527270 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:26:38.923696 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m23:26:38.924226 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:26:39.424344 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m23:26:39.427264 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:26:40.003509 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m23:26:40.005295 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:26:40.461316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1540e4230>]}
[0m23:26:40.462154 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:26:40.462650 [info ] [MainThread]: 
[0m23:26:40.465923 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:26:40.466634 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:26:40.467197 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m23:26:40.467631 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:26:40.475076 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:26:40.476623 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:26:40.490495 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:26:41.046376 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:26:41.046967 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:26:41.463798 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4c4727c2-6b09-4009-aeb0-c4bb900ea394&page=queryresults
[0m23:26:43.954377 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fc06db0>]}
[0m23:26:43.955026 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.49s]
[0m23:26:43.955379 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:26:43.955612 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:26:43.955825 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:26:43.956068 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:26:43.956236 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:26:43.959263 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:26:43.959662 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:26:43.960944 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:26:44.415695 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:26:44.417105 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:26:44.805012 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:570e03e8-8f40-494c-bcf5-588b8f3af6f6&page=queryresults
[0m23:26:48.084002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153f115e0>]}
[0m23:26:48.085074 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.13s]
[0m23:26:48.086637 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:26:48.087416 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:26:48.088398 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:26:48.089336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:26:48.089845 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:26:48.094702 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:26:48.096465 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:26:48.098639 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:26:48.443265 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:26:48.446003 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:26:48.832335 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:995e0d56-07ff-4dad-bb35-cdd2448a1e73&page=queryresults
[0m23:26:51.496377 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153ed7a40>]}
[0m23:26:51.497276 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.41s]
[0m23:26:51.498218 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:26:51.499289 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:26:51.499931 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:26:51.500797 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:26:51.501295 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:26:51.504201 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:26:51.505178 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:26:51.515971 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:26:51.516653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:26:51.602601 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
    distinct
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        customers.customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    
)

-- FINAL CTE
select * from final;


[0m23:26:52.277301 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:72e011b8-2b6f-45e3-834d-85b45e5c7198&page=queryresults
[0m23:26:52.497899 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1536ff770>]}
[0m23:26:52.498785 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m23:26:52.499686 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:26:52.500704 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:26:52.501326 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m23:26:52.501861 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m23:26:52.502309 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:26:52.506999 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:26:52.508611 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:26:52.510504 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:26:53.034781 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:26:53.855291 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:65aa86dc-ffa2-493b-abb0-091a41dcffc6&page=queryresults
[0m23:26:54.005051 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:26:54.432437 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:90c93071-53b2-4788-8706-c42175be5db8&page=queryresults
[0m23:26:54.570953 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:26:54.571953 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:26:55.327708 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c5c83e6d-b9b2-4bb8-b61b-83e5df7286ff&page=queryresults
[0m23:27:15.058255 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153854dd0>]}
[0m23:27:15.060866 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 22.56s]
[0m23:27:15.062051 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:27:15.062629 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:27:15.063341 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m23:27:15.063804 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m23:27:15.064073 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:27:15.066528 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:27:15.067934 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:27:15.070119 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:27:15.561053 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:27:16.159789 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:279d5d28-ff8e-44ad-a771-bfcd43785dd7&page=queryresults
[0m23:27:16.399216 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:27:16.661998 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4db56fe9-a62a-4312-a9d6-f537b2a0ef37&page=queryresults
[0m23:27:16.923929 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:27:16.926965 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:27:17.446110 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d28a6a7f-2c22-41e2-a349-feb39e6944dd&page=queryresults
[0m23:27:44.447144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153ed40e0>]}
[0m23:27:44.449815 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 29.38s]
[0m23:27:44.451495 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:27:44.452247 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:27:44.453143 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m23:27:44.453936 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m23:27:44.454477 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m23:27:44.459072 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:27:44.461256 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m23:27:44.464537 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:27:44.887333 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:27:45.623807 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a5099d79-cba2-4ec9-ad1c-46b8849cbc98&page=queryresults
[0m23:27:45.788584 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:27:46.281620 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a25b5e67-0a17-40a6-aac8-82692571f59e&page=queryresults
[0m23:27:46.407513 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:27:46.410394 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m23:27:47.017219 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8954ff81-f8e9-4268-93b3-e1334ac007ad&page=queryresults
[0m23:28:08.697292 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acf87bf4-eeea-4281-b76c-c4f6f9f909f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153ed60f0>]}
[0m23:28:08.698643 [info ] [Thread-1 (]: 7 of 7 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (103.3m rows, 88.0 MiB processed)[0m in 24.24s]
[0m23:28:08.699190 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:28:08.700748 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:28:08.701012 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m23:28:08.701308 [info ] [MainThread]: 
[0m23:28:08.701522 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 1 minutes and 31.78 seconds (91.78s).
[0m23:28:08.702468 [debug] [MainThread]: Command end result
[0m23:28:08.739660 [info ] [MainThread]: 
[0m23:28:08.740047 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:28:08.740258 [info ] [MainThread]: 
[0m23:28:08.740469 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:28:08.744082 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 93.23047, "process_user_time": 4.679836, "process_kernel_time": 0.443401, "process_mem_max_rss": "209846272", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:28:08.744909 [debug] [MainThread]: Command `dbt run` succeeded at 23:28:08.744848 after 93.23 seconds
[0m23:28:08.745217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f90200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114421e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153367020>]}
[0m23:28:08.745415 [debug] [MainThread]: Flushing usage events
[0m23:28:55.867178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1020b0cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d26e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d26b10>]}


============================== 23:28:55.870067 | 757a3c1d-8ea1-40a9-83ab-282d1a8213de ==============================
[0m23:28:55.870067 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:28:55.870389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:28:56.775626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137f29730>]}
[0m23:28:56.801681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13730c680>]}
[0m23:28:56.802138 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:28:56.831937 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:28:56.935716 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:28:56.936126 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:28:57.053337 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:28:57.060764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13efec6b0>]}
[0m23:28:57.125759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb03080>]}
[0m23:28:57.126051 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:28:57.126223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ec46030>]}
[0m23:28:57.127208 [info ] [MainThread]: 
[0m23:28:57.127489 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:28:57.129718 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:28:57.130031 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:28:57.585243 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:28:57.980260 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:28:58.374900 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m23:28:58.375846 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:28:58.867962 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:28:58.869960 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:28:59.368154 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:28:59.370153 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:28:59.884265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137b9eba0>]}
[0m23:28:59.885348 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:28:59.885904 [info ] [MainThread]: 
[0m23:28:59.890718 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:28:59.891734 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:28:59.892489 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m23:28:59.893153 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:28:59.952650 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:28:59.954700 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:28:59.963074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:00.445308 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:29:00.445990 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:29:00.729060 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:44810567-4f09-4628-abb0-a2b2f6328b0e&page=queryresults
[0m23:29:03.366838 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13765aae0>]}
[0m23:29:03.367241 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.47s]
[0m23:29:03.367561 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:29:03.367780 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:29:03.367995 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:29:03.368276 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:29:03.368498 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:29:03.370306 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:29:03.370778 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:29:03.372151 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:03.707044 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:29:03.709669 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:29:03.942266 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:825fae9d-0c31-4f05-88d4-1ba3b474b8fe&page=queryresults
[0m23:29:07.210086 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f070620>]}
[0m23:29:07.211618 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 3.84s]
[0m23:29:07.212557 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:29:07.213198 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:29:07.213876 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:29:07.214598 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:29:07.215120 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:29:07.217612 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:29:07.218403 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:29:07.220314 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:07.766318 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:29:07.767772 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:29:08.212030 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0349e335-61df-41ea-b7b4-6b03d7aa786b&page=queryresults
[0m23:29:11.021503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13edb2fc0>]}
[0m23:29:11.022626 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.81s]
[0m23:29:11.023523 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:29:11.024528 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:29:11.025104 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:29:11.025601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:29:11.026025 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:29:11.031247 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:29:11.032785 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:29:11.045115 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:29:11.046205 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:11.126179 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- import ctes
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- logical cte

final as (
    select
        customers.customer_id,
        max(random_names_and_numbers.first_name) as first_name,
        max(random_names_and_numbers.last_name) as last_name,
        max(random_names_and_numbers.mobile_number) as mobile_number,
        customers.customer_country,
        max(acq_orders.taxonomy_business_category_group) as taxonomy_business_category_group,
        activity.subscription_id,
        max(activity.from_date) as from_date,
        max(activity.to_date) as to_date,
        max(case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end) as has_active_subscription
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    group by
        customers.customer_id,
        activity.subscription_id,
        customers.customer_country
)

-- final cte
select * from final;


[0m23:29:12.264790 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:63cece36-797a-4823-a221-3b9ce6a61814&page=queryresults
[0m23:29:12.480909 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ea55850>]}
[0m23:29:12.481894 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.46s]
[0m23:29:12.482671 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:29:12.483575 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:29:12.484208 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m23:29:12.484739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m23:29:12.485000 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:29:12.490766 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:29:12.493205 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:29:12.495639 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:13.015359 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:29:13.706611 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:462cec41-726e-4532-b084-4690f4f71443&page=queryresults
[0m23:29:13.851385 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:29:14.363752 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:505e3109-e1ed-4cf9-98b3-0c4a998c5476&page=queryresults
[0m23:29:14.501062 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:29:14.501719 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:29:15.139919 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e5dcdd56-5428-46de-a98e-f79c2178974a&page=queryresults
[0m23:29:24.580304 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f0aaba0>]}
[0m23:29:24.582857 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 12.10s]
[0m23:29:24.583794 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:29:24.584329 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:29:24.584935 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m23:29:24.585479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m23:29:24.585967 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:29:24.590162 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:29:24.591247 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:29:24.593350 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:25.109979 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:29:25.898307 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1412defc-b127-471d-88ca-0733eb936724&page=queryresults
[0m23:29:26.030818 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:29:26.287523 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cb2604c6-72cb-4da1-a1ea-1c47837a9d98&page=queryresults
[0m23:29:26.426803 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:29:26.429331 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:29:27.001963 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:58391611-bce6-4a59-acc5-e2d7c526d838&page=queryresults
[0m23:29:38.549412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13edc13d0>]}
[0m23:29:38.550635 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 13.96s]
[0m23:29:38.551446 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:29:38.551974 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:29:38.552561 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m23:29:38.553089 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m23:29:38.553356 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m23:29:38.555695 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:29:38.556270 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m23:29:38.560216 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:29:39.005847 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:29:39.529943 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a7c4e944-2b28-47a4-a0f0-a9d52c7ec8f8&page=queryresults
[0m23:29:39.650394 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:29:40.051633 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ed6379bd-fe2a-4dea-9d55-442c6a4c056e&page=queryresults
[0m23:29:40.182123 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name     | definition_type | contract_type | mismatch_reason    |
  | --------------- | --------------- | ------------- | ------------------ |
  | customer_id     | INT64           | STRING        | data type mismatch |
  | subscription_id | INT64           | STRING        | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m23:29:40.182560 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757a3c1d-8ea1-40a9-83ab-282d1a8213de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13edad310>]}
[0m23:29:40.182929 [error] [Thread-1 (]: 7 of 7 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 1.63s]
[0m23:29:40.183309 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:29:40.184445 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:29:40.184611 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m23:29:40.184811 [info ] [MainThread]: 
[0m23:29:40.184986 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 43.06 seconds (43.06s).
[0m23:29:40.185791 [debug] [MainThread]: Command end result
[0m23:29:40.215839 [info ] [MainThread]: 
[0m23:29:40.216129 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:29:40.216279 [info ] [MainThread]: 
[0m23:29:40.216493 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name     | definition_type | contract_type | mismatch_reason    |
  | --------------- | --------------- | ------------- | ------------------ |
  | customer_id     | INT64           | STRING        | data type mismatch |
  | subscription_id | INT64           | STRING        | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m23:29:40.216680 [info ] [MainThread]: 
[0m23:29:40.216825 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m23:29:40.219111 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 44.385464, "process_user_time": 4.671651, "process_kernel_time": 0.393843, "process_mem_max_rss": "208404480", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:29:40.219799 [debug] [MainThread]: Command `dbt run` failed at 23:29:40.219743 after 44.39 seconds
[0m23:29:40.220023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ad2630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ecc0e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104699010>]}
[0m23:29:40.220215 [debug] [MainThread]: Flushing usage events
[0m23:31:00.185343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037598b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041c6f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041c6c90>]}


============================== 23:31:00.188131 | 80400976-0abc-4e0f-92de-252ab5562f50 ==============================
[0m23:31:00.188131 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:31:00.188437 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:31:01.089271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c256d0>]}
[0m23:31:01.114779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f9b2510>]}
[0m23:31:01.115207 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:31:01.140100 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:31:01.243217 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:31:01.243596 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:31:01.360329 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:31:01.367466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128611a60>]}
[0m23:31:01.433232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1283447d0>]}
[0m23:31:01.433536 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:31:01.433710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128665b50>]}
[0m23:31:01.434732 [info ] [MainThread]: 
[0m23:31:01.435030 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:31:01.437110 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:31:01.437411 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:31:01.989138 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:31:02.483971 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:31:03.017571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_mart)
[0m23:31:03.017907 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:31:03.418057 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m23:31:03.420394 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:31:03.810147 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m23:31:03.812203 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:31:04.197507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128169130>]}
[0m23:31:04.198624 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:31:04.199179 [info ] [MainThread]: 
[0m23:31:04.202446 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:31:04.203078 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:31:04.203456 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m23:31:04.203646 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:31:04.260633 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:31:04.262979 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:31:04.272871 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:31:04.749866 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:31:04.750576 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:31:05.116817 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:37841aa0-2457-4499-a81e-a1fa8c3f6183&page=queryresults
[0m23:31:08.350602 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128770c50>]}
[0m23:31:08.352783 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.15s]
[0m23:31:08.353500 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:31:08.353975 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:31:08.354599 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:31:08.355192 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:31:08.355626 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:31:08.359570 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:31:08.360892 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:31:08.363971 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:31:08.866929 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:31:08.868891 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:31:09.215055 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d28292b1-5494-4d49-97b4-4620f524cae6&page=queryresults
[0m23:31:12.460604 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10375a180>]}
[0m23:31:12.462484 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.11s]
[0m23:31:12.463352 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:31:12.463872 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:31:12.464503 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:31:12.465058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:31:12.465505 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:31:12.467832 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:31:12.468394 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:31:12.470379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:31:12.855069 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:31:12.857454 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:31:13.076564 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b41dcfce-31e9-496d-86fb-c1349aeac9d6&page=queryresults
[0m23:31:15.765183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1285af530>]}
[0m23:31:15.766376 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.30s]
[0m23:31:15.767264 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:31:15.768208 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:31:15.768863 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:31:15.769392 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:31:15.769655 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:31:15.773076 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:31:15.774002 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:31:15.786981 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:31:15.787729 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:31:15.862505 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    final as (
    select
        customers.customer_id,
        max(random_names_and_numbers.first_name) as first_name,
        max(random_names_and_numbers.last_name) as last_name,
        max(random_names_and_numbers.mobile_number) as mobile_number,
        customers.customer_country,
        max(acq_orders.taxonomy_business_category_group) as taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        max(activity.from_date) as from_date,
        max(activity.to_date) as to_date,
        max(case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end) as has_active_subscription
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    group by
        customers.customer_id,
        activity.subscription_id,
        customers.customer_country
)

    
)

-- FINAL CTE
select * from final;


[0m23:31:16.287438 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:00acd792-3b4f-475e-af47-e2be7ff4a09e&page=queryresults
[0m23:31:16.288717 [debug] [Thread-1 (]: BigQuery adapter: Retry attempt 1 of 1 after error: BadRequest('Syntax error: Unexpected identifier "final" at [49:5]; reason: invalidQuery, location: query, message: Syntax error: Unexpected identifier "final" at [49:5]')
[0m23:31:17.245883 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:20f37e7e-9d5d-49ab-bef4-d77e66415fd4&page=queryresults
[0m23:31:17.246958 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:20f37e7e-9d5d-49ab-bef4-d77e66415fd4&page=queryresults
[0m23:31:17.256877 [debug] [Thread-1 (]: Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Syntax error: Unexpected identifier "final" at [49:5]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:31:17.257235 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '80400976-0abc-4e0f-92de-252ab5562f50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128586840>]}
[0m23:31:17.257599 [error] [Thread-1 (]: 4 of 7 ERROR creating sql view model manual_test.prep_customer ................. [[31mERROR[0m in 1.49s]
[0m23:31:17.257918 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:31:17.258890 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:31:17.259357 [info ] [Thread-1 (]: 5 of 7 SKIP relation manual_test_mart.mart_cohort_retention_analysis_monthly ... [[33mSKIP[0m]
[0m23:31:17.259691 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:31:17.259910 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:31:17.260145 [info ] [Thread-1 (]: 6 of 7 SKIP relation manual_test_mart.mart_customer_metrics_monthly ............ [[33mSKIP[0m]
[0m23:31:17.260373 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:31:17.260574 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:31:17.260773 [info ] [Thread-1 (]: 7 of 7 SKIP relation manual_test_mart.mart_customer_retention_metrics .......... [[33mSKIP[0m]
[0m23:31:17.260971 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:31:17.261508 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:31:17.261677 [debug] [MainThread]: Connection 'model.manual_pasfield.prep_customer' was properly closed.
[0m23:31:17.261872 [info ] [MainThread]: 
[0m23:31:17.262040 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 15.83 seconds (15.83s).
[0m23:31:17.262725 [debug] [MainThread]: Command end result
[0m23:31:17.292832 [info ] [MainThread]: 
[0m23:31:17.293180 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:31:17.293373 [info ] [MainThread]: 
[0m23:31:17.293609 [error] [MainThread]:   Database Error in model prep_customer (models/prepatory/prep_customer.sql)
  Syntax error: Unexpected identifier "final" at [49:5]
  compiled Code at target/run/manual_pasfield/models/prepatory/prep_customer.sql
[0m23:31:17.293802 [info ] [MainThread]: 
[0m23:31:17.294042 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=3 TOTAL=7
[0m23:31:17.296574 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 17.149261, "process_user_time": 4.126021, "process_kernel_time": 0.363999, "process_mem_max_rss": "208158720", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:31:17.297276 [debug] [MainThread]: Command `dbt run` failed at 23:31:17.297148 after 17.15 seconds
[0m23:31:17.297647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ffa810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12859cfe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12859fce0>]}
[0m23:31:17.297887 [debug] [MainThread]: Flushing usage events
[0m23:32:00.448265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db1fa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080a2e70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080a2b10>]}


============================== 23:32:00.450913 | af355a13-c2b1-4e9b-8875-411dd5cde15c ==============================
[0m23:32:00.450913 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:32:00.451244 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:32:01.368795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c2b1e50>]}
[0m23:32:01.394710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080a2de0>]}
[0m23:32:01.395137 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:32:01.426206 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:32:01.531520 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:32:01.531919 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:32:01.651529 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:32:01.658482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ecec9e0>]}
[0m23:32:01.721827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13df447a0>]}
[0m23:32:01.722121 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:32:01.722295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ecee600>]}
[0m23:32:01.723274 [info ] [MainThread]: 
[0m23:32:01.723564 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:32:01.725505 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:32:01.725748 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:32:02.333154 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:32:02.930559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:32:03.422480 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m23:32:03.423394 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:32:03.920403 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:32:03.922344 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:32:04.413127 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m23:32:04.414695 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:32:04.940773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ec5ecc0>]}
[0m23:32:04.941838 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:32:04.942456 [info ] [MainThread]: 
[0m23:32:04.946260 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:32:04.946946 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:32:04.947481 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now model.manual_pasfield.ref_acq_orders)
[0m23:32:04.947756 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:32:05.007864 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:32:05.010106 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:32:05.018321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:05.516371 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:32:05.517079 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:32:05.911364 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a5415f86-5de1-4441-892d-b3cad3d3044e&page=queryresults
[0m23:32:08.048141 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c1225a0>]}
[0m23:32:08.048534 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.10s]
[0m23:32:08.048847 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:32:08.049064 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:32:08.049284 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:32:08.049568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:32:08.049791 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:32:08.051801 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:32:08.052642 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:32:08.054067 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:08.616862 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:32:08.618727 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:32:08.969563 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e90c8242-f006-424d-8033-ac7afb4bfc01&page=queryresults
[0m23:32:12.226301 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e894860>]}
[0m23:32:12.227523 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.18s]
[0m23:32:12.228424 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:32:12.229043 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:32:12.229726 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:32:12.230281 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:32:12.230795 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:32:12.233241 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:32:12.235156 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:32:12.236957 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:12.736702 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:32:12.738267 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:32:13.164365 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:170b4033-50f5-43a3-bf93-e58738216bea&page=queryresults
[0m23:32:15.773274 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eab6540>]}
[0m23:32:15.774482 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.54s]
[0m23:32:15.775629 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:32:15.776753 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:32:15.777386 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:32:15.777785 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:32:15.778004 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:32:15.781961 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:32:15.782664 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:32:15.795870 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:32:15.796850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:15.873846 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE
final as (
    select
        customers.customer_id,
        max(random_names_and_numbers.first_name) as first_name,
        max(random_names_and_numbers.last_name) as last_name,
        max(random_names_and_numbers.mobile_number) as mobile_number,
        customers.customer_country,
        max(acq_orders.taxonomy_business_category_group) as taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        max(activity.from_date) as from_date,
        max(activity.to_date) as to_date,
        max(case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end) as has_active_subscription
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    group by
        customers.customer_id,
        activity.subscription_id,
        customers.customer_country
)

-- FINAL CTE
select * from final;


[0m23:32:16.383361 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:db35aa6f-51fc-4abf-9a9a-02775d9c3f87&page=queryresults
[0m23:32:16.914237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107226f60>]}
[0m23:32:16.915236 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m23:32:16.916005 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:32:16.916861 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:32:16.917688 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m23:32:16.919077 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m23:32:16.919679 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:32:16.926300 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:32:16.928615 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:32:16.932005 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:17.496921 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:32:18.033327 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:19ad0644-14c6-4d55-ba8d-e0254ca53bd1&page=queryresults
[0m23:32:18.167566 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:32:18.594329 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b25ca7b5-89ed-4f1d-9a2d-650975e0fc73&page=queryresults
[0m23:32:18.714720 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:32:18.715522 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:32:19.316175 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6231a84d-cd70-480f-9f55-9c695abf45e0&page=queryresults
[0m23:32:29.927903 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eeb0ad0>]}
[0m23:32:29.929408 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 13.01s]
[0m23:32:29.930211 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:32:29.930735 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:32:29.931462 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m23:32:29.932037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m23:32:29.932486 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:32:29.936645 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:32:29.937868 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:32:29.939607 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:30.448310 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:32:31.063354 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:de832216-375a-4239-86eb-1548ba52547b&page=queryresults
[0m23:32:31.182379 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:32:31.510963 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8d911adf-79d3-4305-93a5-1b4f6e5af538&page=queryresults
[0m23:32:31.655445 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:32:31.657852 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:32:32.086841 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3e7537ba-29fa-475f-9eee-2e2db143612f&page=queryresults
[0m23:32:43.763723 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dcffcb0>]}
[0m23:32:43.765528 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 13.83s]
[0m23:32:43.766383 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:32:43.767012 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:32:43.767714 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m23:32:43.768287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m23:32:43.768728 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m23:32:43.771853 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:32:43.772654 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m23:32:43.774705 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:32:44.271765 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:32:44.885363 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:32368e78-9de7-4d79-b5aa-cd64b26b7454&page=queryresults
[0m23:32:45.134447 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:32:45.524520 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:21c2f241-7441-4d4f-a346-416d807e9fa0&page=queryresults
[0m23:32:45.665338 [debug] [Thread-1 (]: Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name | definition_type | contract_type | mismatch_reason    |
  | ----------- | --------------- | ------------- | ------------------ |
  | customer_id | INT64           | STRING        | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m23:32:45.665799 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'af355a13-c2b1-4e9b-8875-411dd5cde15c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dcfd5b0>]}
[0m23:32:45.666130 [error] [Thread-1 (]: 7 of 7 ERROR creating sql table model manual_test_mart.mart_customer_retention_metrics  [[31mERROR[0m in 1.90s]
[0m23:32:45.666465 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:32:45.667412 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:32:45.667558 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m23:32:45.667741 [info ] [MainThread]: 
[0m23:32:45.667900 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 43.94 seconds (43.94s).
[0m23:32:45.668622 [debug] [MainThread]: Command end result
[0m23:32:45.700696 [info ] [MainThread]: 
[0m23:32:45.701017 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:32:45.701192 [info ] [MainThread]: 
[0m23:32:45.701438 [error] [MainThread]:   Compilation Error in model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
  This model has an enforced contract that failed.
  Please ensure the name, data_type, and number of columns in your contract match the columns in your model's definition.
  
  | column_name | definition_type | contract_type | mismatch_reason    |
  | ----------- | --------------- | ------------- | ------------------ |
  | customer_id | INT64           | STRING        | data type mismatch |
  
  
  > in macro assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro default__get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro get_assert_columns_equivalent (macros/relations/column/columns_spec_ddl.sql)
  > called by macro bigquery__create_table_as (macros/adapters.sql)
  > called by macro create_table_as (macros/relations/table/create.sql)
  > called by macro statement (macros/etc/statement.sql)
  > called by macro materialization_table_bigquery (macros/materializations/table.sql)
  > called by model mart_customer_retention_metrics (models/marts/mart_customer_retention_metrics.sql)
[0m23:32:45.701723 [info ] [MainThread]: 
[0m23:32:45.701948 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m23:32:45.704111 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 45.28953, "process_user_time": 4.654173, "process_kernel_time": 0.422229, "process_mem_max_rss": "208207872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:32:45.704433 [debug] [MainThread]: Command `dbt run` failed at 23:32:45.704377 after 45.29 seconds
[0m23:32:45.704657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eab7320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107db09b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e841cd0>]}
[0m23:32:45.704852 [debug] [MainThread]: Flushing usage events
[0m23:33:32.528497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042a2ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062f31a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062f2e70>]}


============================== 23:33:32.531995 | a1b3c174-e9ea-4afd-a9eb-41d37e143680 ==============================
[0m23:33:32.531995 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:33:32.532358 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:33:33.444090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a3d0c80>]}
[0m23:33:33.469193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe0e3c0>]}
[0m23:33:33.469626 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:33:33.492722 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:33:33.598042 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:33:33.598459 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:33:33.715538 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:33:33.722026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ac65be0>]}
[0m23:33:33.786262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a7b07a0>]}
[0m23:33:33.786586 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:33:33.786760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a6444d0>]}
[0m23:33:33.787826 [info ] [MainThread]: 
[0m23:33:33.788133 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:33:33.790175 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:33:33.790420 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:33:34.159486 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:34.674873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:35.175650 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m23:33:35.176559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:35.654910 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:33:35.656980 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:36.155761 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:33:36.158271 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:33:36.695989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104400170>]}
[0m23:33:36.697029 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:33:36.697437 [info ] [MainThread]: 
[0m23:33:36.700059 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:33:36.700458 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:33:36.700785 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m23:33:36.701017 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:33:36.755674 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:33:36.757520 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:33:36.766182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:33:37.271279 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:33:37.271942 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:33:37.694764 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2ce0104a-faf6-4da4-860d-503a0e5232ab&page=queryresults
[0m23:33:41.558846 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fd16f00>]}
[0m23:33:41.559366 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.86s]
[0m23:33:41.560085 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:33:41.560568 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:33:41.561201 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:33:41.561801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:33:41.562238 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:33:41.565428 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:33:41.566375 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:33:41.568254 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:33:42.150833 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:33:42.152491 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:33:42.402848 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9d216a80-1cf2-4218-8efe-d4004f82d14f&page=queryresults
[0m23:33:45.614129 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ae75d60>]}
[0m23:33:45.614511 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.05s]
[0m23:33:45.614814 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:33:45.615023 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:33:45.615293 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:33:45.615547 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:33:45.615737 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:33:45.617437 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:33:45.617873 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:33:45.619256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:33:46.119009 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:33:46.120573 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:33:46.491683 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3a47db54-c16f-410b-a9a7-2fb4865db491&page=queryresults
[0m23:33:48.572345 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aaaf2c0>]}
[0m23:33:48.573551 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 2.96s]
[0m23:33:48.574536 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:33:48.575801 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:33:48.576418 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:33:48.576981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:33:48.577417 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:33:48.581123 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:33:48.582613 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:33:48.594619 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:33:48.595407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:33:48.671908 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE
final as (
    select
        cast(customers.customer_id as string) as customer_id,
        max(random_names_and_numbers.first_name) as first_name,
        max(random_names_and_numbers.last_name) as last_name,
        max(random_names_and_numbers.mobile_number) as mobile_number,
        customers.customer_country,
        max(acq_orders.taxonomy_business_category_group) as taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        max(activity.from_date) as from_date,
        max(activity.to_date) as to_date,
        max(case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end) as has_active_subscription
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    group by
        customers.customer_id,
        activity.subscription_id,
        customers.customer_country
)

-- FINAL CTE
select * from final;


[0m23:33:49.168596 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8cf52073-353e-4628-a567-e3c92bdec1b0&page=queryresults
[0m23:33:49.491040 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aa96750>]}
[0m23:33:49.492021 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.91s]
[0m23:33:49.492776 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:33:49.493647 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:33:49.494222 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m23:33:49.494648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m23:33:49.494858 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:33:49.497589 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:33:49.499490 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:33:49.501661 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:33:49.901314 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:33:50.406177 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:119aa707-0799-43c3-a51a-3e3256683659&page=queryresults
[0m23:33:50.848453 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:33:51.191736 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9371ad61-dbea-4bbf-916f-1e8d10e8cc01&page=queryresults
[0m23:33:51.320227 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:33:51.320895 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:33:51.926315 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:36901354-763b-4c30-bca8-46d9b0ef1522&page=queryresults
[0m23:34:02.525591 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ac5e9c0>]}
[0m23:34:02.527980 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 13.03s]
[0m23:34:02.528925 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:34:02.529519 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:34:02.530155 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m23:34:02.530719 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m23:34:02.531304 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:34:02.535199 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:34:02.536485 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:34:02.538473 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:02.999824 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:34:03.777514 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ff724221-40f0-42d2-894c-927ac2f664b0&page=queryresults
[0m23:34:03.912139 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:34:04.168267 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8e95fa7f-33e8-4431-a8a2-06126eeae165&page=queryresults
[0m23:34:04.307882 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:34:04.310605 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:34:04.924012 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0978dd2a-fb3e-4982-9080-f86f0c41569b&page=queryresults
[0m23:34:17.611495 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aab17c0>]}
[0m23:34:17.613526 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 15.08s]
[0m23:34:17.614401 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:34:17.614969 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:34:17.615640 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m23:34:17.616141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m23:34:17.616410 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m23:34:17.618674 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:34:17.619189 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m23:34:17.621325 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:34:18.172916 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:34:18.649011 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bb6e5b5e-5994-45c5-958e-a437eb01133d&page=queryresults
[0m23:34:18.852013 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:34:19.072006 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4472f9a6-7f2f-4236-9f8c-f077e366a734&page=queryresults
[0m23:34:19.186453 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:34:19.188742 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m23:34:19.677370 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:89d8ea62-77e4-4bb4-aa43-774ee073ef6a&page=queryresults
[0m23:34:26.648780 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a1b3c174-e9ea-4afd-a9eb-41d37e143680', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aab04a0>]}
[0m23:34:26.650006 [info ] [Thread-1 (]: 7 of 7 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (1.5m rows, 88.0 MiB processed)[0m in 9.03s]
[0m23:34:26.651012 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:34:26.652631 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:34:26.653022 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m23:34:26.653488 [info ] [MainThread]: 
[0m23:34:26.653901 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 0 minutes and 52.87 seconds (52.87s).
[0m23:34:26.656814 [debug] [MainThread]: Command end result
[0m23:34:26.691500 [info ] [MainThread]: 
[0m23:34:26.691795 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:34:26.691965 [info ] [MainThread]: 
[0m23:34:26.692132 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:34:26.694326 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 54.21716, "process_user_time": 4.645513, "process_kernel_time": 0.428219, "process_mem_max_rss": "207437824", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:34:26.694663 [debug] [MainThread]: Command `dbt run` succeeded at 23:34:26.694611 after 54.22 seconds
[0m23:34:26.694862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a943da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a703a40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a7012b0>]}
[0m23:34:26.695046 [debug] [MainThread]: Flushing usage events
[0m23:36:30.806760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ba1580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1182f2e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1182f2c00>]}


============================== 23:36:30.809874 | 7d7950dd-d445-4d4c-b6f8-7998c355fc50 ==============================
[0m23:36:30.809874 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:36:30.810256 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt test', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:36:31.815005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d7950dd-d445-4d4c-b6f8-7998c355fc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c6d32c0>]}
[0m23:36:31.841165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d7950dd-d445-4d4c-b6f8-7998c355fc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195c7050>]}
[0m23:36:31.841620 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:36:31.873145 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:36:32.004493 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:36:32.004766 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:36:32.007494 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:36:32.033417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d7950dd-d445-4d4c-b6f8-7998c355fc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14c152ff0>]}
[0m23:36:32.107182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d7950dd-d445-4d4c-b6f8-7998c355fc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154b4aa80>]}
[0m23:36:32.107487 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:36:32.107657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d7950dd-d445-4d4c-b6f8-7998c355fc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079e3d10>]}
[0m23:36:32.108697 [info ] [MainThread]: 
[0m23:36:32.108998 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:36:32.111054 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:36:32.111847 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:36:32.873745 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:36:32.875454 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:36:33.434215 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:36:33.434856 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:36:33.885669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d7950dd-d445-4d4c-b6f8-7998c355fc50', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070bede0>]}
[0m23:36:33.886714 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:36:33.887317 [info ] [MainThread]: 
[0m23:36:33.890789 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:36:33.891368 [info ] [Thread-1 (]: 1 of 4 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:36:33.891903 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:36:33.892163 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:36:33.903937 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:36:33.904963 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:36:33.917209 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:36:33.917822 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:36:33.998684 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:36:34.798649 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8c06406c-9b17-4cb9-b32d-6ee1fb3f1b85&page=queryresults
[0m23:36:35.176565 [info ] [Thread-1 (]: 1 of 4 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.28s]
[0m23:36:35.177124 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:36:35.177421 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:36:35.178204 [info ] [Thread-1 (]: 2 of 4 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:36:35.179118 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:36:35.180476 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:36:35.184098 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:36:35.184828 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:36:35.187617 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:36:35.188304 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:36:35.264694 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:36:35.987600 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:adc51b1b-623b-4143-b857-f2495346e00a&page=queryresults
[0m23:36:36.347768 [info ] [Thread-1 (]: 2 of 4 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.17s]
[0m23:36:36.349530 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:36:36.350461 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:36:36.351114 [info ] [Thread-1 (]: 3 of 4 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:36:36.351813 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:36:36.352345 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:36:36.357693 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:36:36.359050 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:36:36.360647 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:36:36.361052 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:36:36.441275 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:36:37.293045 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e36e1cc0-e72a-4af8-bf5e-dd7b39bbfc93&page=queryresults
[0m23:36:37.728095 [info ] [Thread-1 (]: 3 of 4 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.38s]
[0m23:36:37.729644 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:36:37.730434 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:36:37.731062 [info ] [Thread-1 (]: 4 of 4 START test unique_mart_customer_retention_metrics_customer_id ........... [RUN]
[0m23:36:37.731739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1)
[0m23:36:37.732276 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:36:37.741963 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:36:37.743171 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:36:37.746223 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:36:37.746645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:36:37.828381 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select customer_id as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
  where customer_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:36:39.038357 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7245bd36-7422-4660-8463-5d2bbfca5e21&page=queryresults
[0m23:36:39.503420 [error] [Thread-1 (]: 4 of 4 FAIL 362452 unique_mart_customer_retention_metrics_customer_id .......... [[31mFAIL 362452[0m in 1.77s]
[0m23:36:39.504866 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:36:39.506714 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:36:39.507253 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1' was properly closed.
[0m23:36:39.507713 [info ] [MainThread]: 
[0m23:36:39.508163 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 7.40 seconds (7.40s).
[0m23:36:39.510625 [debug] [MainThread]: Command end result
[0m23:36:39.587694 [info ] [MainThread]: 
[0m23:36:39.587958 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:36:39.588105 [info ] [MainThread]: 
[0m23:36:39.588293 [error] [MainThread]: [31mFailure in test unique_mart_customer_retention_metrics_customer_id (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:36:39.588452 [error] [MainThread]:   Got 362452 results, configured to fail if != 0
[0m23:36:39.588572 [info ] [MainThread]: 
[0m23:36:39.588725 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/unique_mart_customer_retention_metrics_customer_id.sql
[0m23:36:39.588852 [info ] [MainThread]: 
[0m23:36:39.588990 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m23:36:39.590949 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 8.825759, "process_user_time": 3.555046, "process_kernel_time": 0.361617, "process_mem_max_rss": "205766656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:36:39.591277 [debug] [MainThread]: Command `dbt test` failed at 23:36:39.591226 after 8.83 seconds
[0m23:36:39.591482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10766c200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fa36e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154873fb0>]}
[0m23:36:39.591652 [debug] [MainThread]: Flushing usage events
[0m23:37:14.272145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105264f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f2e40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f2ae0>]}


============================== 23:37:14.274777 | b0ce4613-f747-401c-9438-d9d41a985bcf ==============================
[0m23:37:14.274777 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:37:14.275097 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt test', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:37:15.122464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0ce4613-f747-401c-9438-d9d41a985bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14aca2360>]}
[0m23:37:15.147695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b0ce4613-f747-401c-9438-d9d41a985bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a26f60>]}
[0m23:37:15.148142 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:37:15.169998 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:37:15.266122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:37:15.266618 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:37:15.385418 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:37:15.392130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b0ce4613-f747-401c-9438-d9d41a985bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b6122a0>]}
[0m23:37:15.463170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b0ce4613-f747-401c-9438-d9d41a985bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b9c4fe0>]}
[0m23:37:15.463501 [info ] [MainThread]: Found 7 models, 1 seed, 4 data tests, 3 sources, 855 macros
[0m23:37:15.463684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0ce4613-f747-401c-9438-d9d41a985bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b8702f0>]}
[0m23:37:15.464862 [info ] [MainThread]: 
[0m23:37:15.465210 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:37:15.467188 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:37:15.511703 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:15.940230 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:37:15.940801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:16.382117 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:37:16.384485 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:37:16.848417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0ce4613-f747-401c-9438-d9d41a985bcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a809640>]}
[0m23:37:16.849404 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:37:16.849855 [info ] [MainThread]: 
[0m23:37:16.853492 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:37:16.853828 [info ] [Thread-1 (]: 1 of 4 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:37:16.854126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:37:16.854336 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:37:16.864410 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:37:16.864928 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:37:16.878657 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:37:16.879406 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:16.953054 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:37:17.964952 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:833e031f-f108-41a3-b6d2-365a05def17e&page=queryresults
[0m23:37:18.399651 [info ] [Thread-1 (]: 1 of 4 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.55s]
[0m23:37:18.400197 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:37:18.400461 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:37:18.400656 [info ] [Thread-1 (]: 2 of 4 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:37:18.401003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:37:18.401236 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:37:18.403972 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:37:18.404494 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:37:18.406997 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:37:18.408288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:18.493500 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:37:18.863434 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:685f176f-e9e9-44aa-bf8e-a74b897c1028&page=queryresults
[0m23:37:19.233053 [info ] [Thread-1 (]: 2 of 4 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 0.83s]
[0m23:37:19.234324 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:37:19.234992 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:37:19.235623 [info ] [Thread-1 (]: 3 of 4 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:37:19.236200 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:37:19.236662 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:37:19.248887 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:37:19.249511 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:37:19.251180 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:37:19.251542 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:19.325841 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:37:20.256690 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1aa24130-e6d6-44e9-bcd3-64b60522a1d3&page=queryresults
[0m23:37:20.637291 [info ] [Thread-1 (]: 3 of 4 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.40s]
[0m23:37:20.638739 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:37:20.639455 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:37:20.640076 [info ] [Thread-1 (]: 4 of 4 START test unique_mart_customer_retention_metrics_customer_id ........... [RUN]
[0m23:37:20.640712 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1)
[0m23:37:20.641233 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:37:20.651201 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:37:20.651837 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:37:20.653448 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"
[0m23:37:20.653840 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:37:20.740572 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select customer_id as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
  where customer_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:37:21.307148 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8cb416d5-ee53-4c5e-ba33-5f03fdd9d018&page=queryresults
[0m23:37:21.780120 [error] [Thread-1 (]: 4 of 4 FAIL 362452 unique_mart_customer_retention_metrics_customer_id .......... [[31mFAIL 362452[0m in 1.14s]
[0m23:37:21.781262 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1
[0m23:37:21.782251 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:37:21.782497 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_retention_metrics_customer_id.8adcdb96a1' was properly closed.
[0m23:37:21.782723 [info ] [MainThread]: 
[0m23:37:21.782952 [info ] [MainThread]: Finished running 4 data tests in 0 hours 0 minutes and 6.32 seconds (6.32s).
[0m23:37:21.783665 [debug] [MainThread]: Command end result
[0m23:37:21.812894 [info ] [MainThread]: 
[0m23:37:21.813199 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:37:21.813484 [info ] [MainThread]: 
[0m23:37:21.813804 [error] [MainThread]: [31mFailure in test unique_mart_customer_retention_metrics_customer_id (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:37:21.814054 [error] [MainThread]:   Got 362452 results, configured to fail if != 0
[0m23:37:21.814251 [info ] [MainThread]: 
[0m23:37:21.814501 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/unique_mart_customer_retention_metrics_customer_id.sql
[0m23:37:21.814661 [info ] [MainThread]: 
[0m23:37:21.814812 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m23:37:21.816612 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 7.5762234, "process_user_time": 3.780067, "process_kernel_time": 0.344122, "process_mem_max_rss": "210092032", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:37:21.816904 [debug] [MainThread]: Command `dbt test` failed at 23:37:21.816857 after 7.58 seconds
[0m23:37:21.817110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b860da0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108521520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5c67b0>]}
[0m23:37:21.817287 [debug] [MainThread]: Flushing usage events
[0m23:41:54.185948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114086240>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11422ed50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11422e9f0>]}


============================== 23:41:54.189434 | b589cb59-257c-4842-9c5f-41da93256cc9 ==============================
[0m23:41:54.189434 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:41:54.189812 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:41:55.291236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b589cb59-257c-4842-9c5f-41da93256cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11422c650>]}
[0m23:41:55.319867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b589cb59-257c-4842-9c5f-41da93256cc9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141e3bf0>]}
[0m23:41:55.320326 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:41:55.347260 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:41:55.463000 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m23:41:55.463525 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m23:41:55.463796 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:41:55.464002 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:41:55.660512 [error] [MainThread]: Encountered an error:
Parsing Error
  Invalid test config given in models/marts/mart_customer_retention_metrics.yml:
  	test arguments must be a dict, got <class 'str'> (value SELECT COUNT(*) 
  FROM {{ ref('mart_customer_retention_metrics') }} 
  WHERE to_date < from_date;
  )
  	@: UnparsedModelUpdate(original_file_path='mode...ne)
[0m23:41:55.662961 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.5184023, "process_user_time": 3.039377, "process_kernel_time": 0.360981, "process_mem_max_rss": "204652544", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:41:55.663434 [debug] [MainThread]: Command `dbt test` failed at 23:41:55.663371 after 1.52 seconds
[0m23:41:55.663687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11422eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f9a1b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14efc24b0>]}
[0m23:41:55.663892 [debug] [MainThread]: Flushing usage events
[0m23:42:34.325697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105023cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f2d80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f2a20>]}


============================== 23:42:34.328876 | a8112a1a-7966-473f-866d-296c16194e97 ==============================
[0m23:42:34.328876 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:42:34.329197 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:42:35.199970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8112a1a-7966-473f-866d-296c16194e97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a4b1e50>]}
[0m23:42:35.225317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8112a1a-7966-473f-866d-296c16194e97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10363e840>]}
[0m23:42:35.225740 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:42:35.247458 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:42:35.348442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m23:42:35.348971 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:42:35.349247 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m23:42:35.349449 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:42:35.551003 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:42:35.557639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8112a1a-7966-473f-866d-296c16194e97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b2c3fb0>]}
[0m23:42:35.674276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8112a1a-7966-473f-866d-296c16194e97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4f6330>]}
[0m23:42:35.674569 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m23:42:35.674739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8112a1a-7966-473f-866d-296c16194e97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b4c21e0>]}
[0m23:42:35.675753 [info ] [MainThread]: 
[0m23:42:35.676031 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:42:35.677956 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_mart'
[0m23:42:35.678152 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:42:36.244492 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m23:42:36.247483 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:42:36.730465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m23:42:36.732319 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:42:37.241790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8112a1a-7966-473f-866d-296c16194e97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103845c70>]}
[0m23:42:37.242580 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:42:37.243028 [info ] [MainThread]: 
[0m23:42:37.246152 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640
[0m23:42:37.246730 [info ] [Thread-1 (]: 1 of 7 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU  [RUN]
[0m23:42:37.247279 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640)
[0m23:42:37.247842 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640
[0m23:42:37.255884 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640"
[0m23:42:37.256751 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640
[0m23:42:37.269680 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640"
[0m23:42:37.270334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:37.354159 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU'
)



      
    ) dbt_internal_test
[0m23:42:38.137822 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9892dede-74e4-4f21-9f55-92758af0be71&page=queryresults
[0m23:42:38.643291 [error] [Thread-1 (]: 1 of 7 FAIL 2 accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU  [[31mFAIL 2[0m in 1.40s]
[0m23:42:38.644745 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640
[0m23:42:38.645413 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:42:38.646110 [info ] [Thread-1 (]: 2 of 7 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:42:38.646895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU.261ed16640, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:42:38.647465 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:42:38.653513 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:42:38.654770 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:42:38.656580 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:42:38.657048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:38.742549 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:42:39.158580 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d77fb7f2-03bd-40db-b57f-eeeb9e43100c&page=queryresults
[0m23:42:39.492881 [info ] [Thread-1 (]: 2 of 7 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 0.85s]
[0m23:42:39.495330 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:42:39.496029 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:42:39.496649 [info ] [Thread-1 (]: 3 of 7 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:42:39.497259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:42:39.497728 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:42:39.500876 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:42:39.501923 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:42:39.504880 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:42:39.505780 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:39.590777 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:42:40.315894 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:60db630e-f452-4d4b-9dae-b9ff54ccb381&page=queryresults
[0m23:42:41.436744 [info ] [Thread-1 (]: 3 of 7 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 1.94s]
[0m23:42:41.437318 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:42:41.437582 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:42:41.437897 [info ] [Thread-1 (]: 4 of 7 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:42:41.438306 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:42:41.438590 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:42:41.441760 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:42:41.442350 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:42:41.443965 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:42:41.444387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:41.520037 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:42:42.172533 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:475b6eb9-fac6-46c0-94f1-75e8122768c9&page=queryresults
[0m23:42:42.532752 [info ] [Thread-1 (]: 4 of 7 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.09s]
[0m23:42:42.534148 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:42:42.534958 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:42:42.535599 [info ] [Thread-1 (]: 5 of 7 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m23:42:42.536285 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:42:42.536871 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:42:42.544733 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:42:42.546317 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:42:42.550034 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:42:42.550741 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:42.632700 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:42:43.361741 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2a2b43b1-b724-4132-972f-d6c9dc484fba&page=queryresults
[0m23:42:43.877456 [info ] [Thread-1 (]: 5 of 7 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.34s]
[0m23:42:43.878793 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:42:43.879484 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:42:43.880147 [info ] [Thread-1 (]: 6 of 7 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:42:43.880727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:42:43.881213 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:42:43.885712 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:42:43.887817 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:42:43.890112 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:42:43.890725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:43.967589 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:42:44.402573 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7158010f-9d10-4167-b736-558b4b828a99&page=queryresults
[0m23:42:44.754416 [info ] [Thread-1 (]: 6 of 7 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 0.87s]
[0m23:42:44.754870 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:42:44.755119 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:42:44.755379 [info ] [Thread-1 (]: 7 of 7 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m23:42:44.755686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:42:44.755903 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:42:44.760111 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:42:44.760708 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:42:44.762582 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:42:44.763468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:42:44.845632 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:42:45.546566 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6ec091b0-c56b-4976-a5fd-dda4ce87296f&page=queryresults
[0m23:42:46.112128 [info ] [Thread-1 (]: 7 of 7 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.36s]
[0m23:42:46.113449 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:42:46.114988 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:42:46.115385 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m23:42:46.115879 [info ] [MainThread]: 
[0m23:42:46.116316 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 10.44 seconds (10.44s).
[0m23:42:46.117879 [debug] [MainThread]: Command end result
[0m23:42:46.147050 [info ] [MainThread]: 
[0m23:42:46.147536 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:42:46.147992 [info ] [MainThread]: 
[0m23:42:46.148348 [error] [MainThread]: [31mFailure in test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU (models/marts/mart_customer_retention_metrics.yml)[0m
[0m23:42:46.148667 [error] [MainThread]:   Got 2 results, configured to fail if != 0
[0m23:42:46.148856 [info ] [MainThread]: 
[0m23:42:46.149062 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_retention_metrics.yml/accepted_values_mart_customer__a735a1544fe2142643ff875f2c49ed81.sql
[0m23:42:46.149233 [info ] [MainThread]: 
[0m23:42:46.149399 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m23:42:46.151469 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 11.858876, "process_user_time": 4.208533, "process_kernel_time": 0.384224, "process_mem_max_rss": "215269376", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:42:46.151785 [debug] [MainThread]: Command `dbt test` failed at 23:42:46.151732 after 11.86 seconds
[0m23:42:46.151996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b660350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105023cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105619fa0>]}
[0m23:42:46.152195 [debug] [MainThread]: Flushing usage events
[0m23:47:32.272246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b0e870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a86180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c26d80>]}


============================== 23:47:32.274899 | 73c1b08c-2e05-4811-b6e1-71bff244f594 ==============================
[0m23:47:32.274899 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:47:32.275210 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:47:33.127679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10410a540>]}
[0m23:47:33.151879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058c4e90>]}
[0m23:47:33.152187 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:47:33.174118 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:47:33.271498 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:47:33.271877 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:47:33.383626 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:47:33.391146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b615a60>]}
[0m23:47:33.462682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b318350>]}
[0m23:47:33.463045 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m23:47:33.463258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b782f30>]}
[0m23:47:33.464536 [info ] [MainThread]: 
[0m23:47:33.464933 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:47:33.467293 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m23:47:33.467692 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:34.024941 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:34.525276 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:35.039045 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m23:47:35.039395 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:35.551021 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m23:47:35.551566 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:35.938462 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m23:47:35.939127 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:47:36.453543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b6726f0>]}
[0m23:47:36.453944 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:47:36.454137 [info ] [MainThread]: 
[0m23:47:36.455702 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m23:47:36.456102 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m23:47:36.456381 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m23:47:36.456570 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m23:47:36.515103 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m23:47:36.516964 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m23:47:36.529035 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:36.992918 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m23:47:36.993564 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m23:47:37.503299 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6962838a-9f2f-4dd5-9e3f-d026cea3e389&page=queryresults
[0m23:47:39.610214 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff22810>]}
[0m23:47:39.611049 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.15s]
[0m23:47:39.611404 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m23:47:39.611618 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m23:47:39.611882 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m23:47:39.612110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m23:47:39.612277 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m23:47:39.614151 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m23:47:39.614649 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m23:47:39.616038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:39.994612 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m23:47:39.995202 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m23:47:40.261021 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e2cf354e-d2ff-4ce8-af0e-e02a06b554f1&page=queryresults
[0m23:47:43.140421 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5b4aa0>]}
[0m23:47:43.140880 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 3.53s]
[0m23:47:43.141263 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m23:47:43.141518 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m23:47:43.141855 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m23:47:43.142172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m23:47:43.142406 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m23:47:43.144393 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m23:47:43.144859 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m23:47:43.146339 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:43.565002 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m23:47:43.567303 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m23:47:43.995707 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:53b36670-909c-42ca-baec-1315321a7fd3&page=queryresults
[0m23:47:46.718234 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5c41d0>]}
[0m23:47:46.719317 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.58s]
[0m23:47:46.720244 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m23:47:46.721815 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m23:47:46.723036 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m23:47:46.723786 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m23:47:46.724319 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m23:47:46.732477 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m23:47:46.733610 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m23:47:46.755885 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m23:47:46.757014 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:46.839039 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
    distinct
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        -- Could be fixed with a mapping seed if I had more time :) 
        case 
            when customers.customer_country = "United Kingdom" then "UK"
            when customers.customer_country = "Brazil" then "BR"
        end as customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    
)

-- FINAL CTE
select * from final;


[0m23:47:47.374086 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4eb50ac7-0690-413c-b337-0b00e1d4ced6&page=queryresults
[0m23:47:47.744620 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10473f0e0>]}
[0m23:47:47.745843 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.02s]
[0m23:47:47.747435 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m23:47:47.748575 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:47:47.749402 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m23:47:47.750145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m23:47:47.750704 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:47:47.758424 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:47:47.760652 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:47:47.763850 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:47:48.274972 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:47:48.867418 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:49443ed1-c1c2-40a7-a6cf-c089044e64ab&page=queryresults
[0m23:47:49.069121 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:47:49.435737 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d5786ac4-0a85-4285-8efb-6f5d3b291d8d&page=queryresults
[0m23:47:49.590924 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m23:47:49.592482 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:47:50.812194 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:059a6e91-cb29-486c-a297-aed70d35ac36&page=queryresults
[0m23:48:13.364659 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b7bb290>]}
[0m23:48:13.367561 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 25.61s]
[0m23:48:13.369071 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m23:48:13.369890 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:48:13.370827 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m23:48:13.371643 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m23:48:13.372221 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:48:13.381836 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:48:13.383120 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:48:13.386430 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:48:13.904901 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:48:14.604826 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cc5d9144-a8bd-4b76-a3ca-1018c3b34c15&page=queryresults
[0m23:48:14.739439 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:48:14.980901 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e61e05e5-58fe-412a-a231-92dac0d262b8&page=queryresults
[0m23:48:15.094863 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m23:48:15.097066 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m23:48:15.783118 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9649aa63-59c1-4d00-892a-c00a1e4fd8c6&page=queryresults
[0m23:48:36.361390 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b59cb00>]}
[0m23:48:36.364134 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 22.99s]
[0m23:48:36.365604 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m23:48:36.366415 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:48:36.367302 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m23:48:36.368103 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m23:48:36.368671 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m23:48:36.374118 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:48:36.375420 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m23:48:36.379592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:48:36.911263 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:48:37.573023 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:2b57bb66-f163-4ee3-b478-b33063ad86e9&page=queryresults
[0m23:48:37.692970 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m23:48:38.139944 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ca41eabd-ee86-4f24-84fa-2795a7c3a5c8&page=queryresults
[0m23:48:38.337571 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m23:48:38.341486 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m23:48:38.855171 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:faf09b34-945d-4601-be92-af0910247194&page=queryresults
[0m23:48:59.055166 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '73c1b08c-2e05-4811-b6e1-71bff244f594', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b59d5b0>]}
[0m23:48:59.056990 [info ] [Thread-1 (]: 7 of 7 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (103.3m rows, 88.0 MiB processed)[0m in 22.69s]
[0m23:48:59.057840 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m23:48:59.059403 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:48:59.059856 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m23:48:59.060418 [info ] [MainThread]: 
[0m23:48:59.061354 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 1 minutes and 25.60 seconds (85.60s).
[0m23:48:59.064331 [debug] [MainThread]: Command end result
[0m23:48:59.111530 [info ] [MainThread]: 
[0m23:48:59.111845 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:48:59.112032 [info ] [MainThread]: 
[0m23:48:59.112262 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:48:59.114732 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 86.86706, "process_user_time": 4.670248, "process_kernel_time": 0.425243, "process_mem_max_rss": "208388096", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:48:59.115151 [debug] [MainThread]: Command `dbt run` succeeded at 23:48:59.115082 after 86.87 seconds
[0m23:48:59.115411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf02720>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5c4ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b5c4bc0>]}
[0m23:48:59.115643 [debug] [MainThread]: Flushing usage events
[0m23:49:07.881921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079471a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ac2ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ac2b70>]}


============================== 23:49:07.884418 | 3aeec811-150e-4611-be59-3cf1e5d3d4a8 ==============================
[0m23:49:07.884418 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:49:07.884732 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m23:49:08.431447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3aeec811-150e-4611-be59-3cf1e5d3d4a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079c9730>]}
[0m23:49:08.455631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3aeec811-150e-4611-be59-3cf1e5d3d4a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10811fc80>]}
[0m23:49:08.455930 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:49:08.477156 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:49:08.573007 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:49:08.573454 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m23:49:08.752903 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:49:08.759043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3aeec811-150e-4611-be59-3cf1e5d3d4a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d5b82f0>]}
[0m23:49:08.869602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3aeec811-150e-4611-be59-3cf1e5d3d4a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d4b0980>]}
[0m23:49:08.869890 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m23:49:08.870058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3aeec811-150e-4611-be59-3cf1e5d3d4a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d4c6ea0>]}
[0m23:49:08.871058 [info ] [MainThread]: 
[0m23:49:08.871332 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:49:08.873262 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:49:08.873457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:09.394722 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:49:09.395988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:49:09.789306 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:49:09.792554 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:49:10.181112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3aeec811-150e-4611-be59-3cf1e5d3d4a8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d5babd0>]}
[0m23:49:10.181646 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:49:10.181930 [info ] [MainThread]: 
[0m23:49:10.184684 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:49:10.185253 [info ] [Thread-1 (]: 1 of 7 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:49:10.185655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:49:10.185971 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:49:10.196460 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:49:10.197466 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:49:10.212582 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:49:10.213210 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:10.282930 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:49:11.046730 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:00d4b2ed-60df-460d-98d6-4475cbd5cc72&page=queryresults
[0m23:49:11.926100 [info ] [Thread-1 (]: 1 of 7 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.74s]
[0m23:49:11.928289 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:49:11.928912 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:49:11.929577 [info ] [Thread-1 (]: 2 of 7 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:49:11.930303 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:49:11.930852 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:49:11.941210 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:49:11.943071 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:49:11.946500 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:49:11.947200 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:12.033574 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:49:12.645811 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ecb88b20-e046-422c-874b-a151799ae9a2&page=queryresults
[0m23:49:13.037028 [info ] [Thread-1 (]: 2 of 7 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.11s]
[0m23:49:13.038713 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:49:13.039405 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:49:13.040414 [info ] [Thread-1 (]: 3 of 7 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:49:13.041277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:49:13.041842 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:49:13.049809 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:49:13.052069 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:49:13.055458 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:49:13.056306 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:13.147491 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:49:13.983216 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e169f520-6104-4a3d-9b8e-8ad68e64a362&page=queryresults
[0m23:49:14.507852 [info ] [Thread-1 (]: 3 of 7 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 1.47s]
[0m23:49:14.509761 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:49:14.510519 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:49:14.511211 [info ] [Thread-1 (]: 4 of 7 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:49:14.511862 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:49:14.512421 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:49:14.520650 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:49:14.521432 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:49:14.526708 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:49:14.527594 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:14.618055 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:49:15.310069 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:237f9eec-af7b-4125-a344-1931b2316cca&page=queryresults
[0m23:49:15.809797 [info ] [Thread-1 (]: 4 of 7 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.30s]
[0m23:49:15.811534 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:49:15.812314 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:49:15.813269 [info ] [Thread-1 (]: 5 of 7 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m23:49:15.814561 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:49:15.815255 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:49:15.822220 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:49:15.822937 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:49:15.824702 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:49:15.825114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:15.915583 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:49:16.730918 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a172f717-2a06-4c98-a3ae-ee257882b5a9&page=queryresults
[0m23:49:17.244425 [info ] [Thread-1 (]: 5 of 7 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.43s]
[0m23:49:17.246210 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:49:17.246846 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:49:17.247714 [info ] [Thread-1 (]: 6 of 7 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:49:17.248953 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:49:17.249598 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:49:17.256234 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:49:17.256999 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:49:17.259220 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:49:17.259845 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:17.352122 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:49:18.240039 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bb2310e1-18f7-4d50-891f-529a942e0ed7&page=queryresults
[0m23:49:18.704325 [info ] [Thread-1 (]: 6 of 7 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.45s]
[0m23:49:18.706115 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:49:18.706831 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:49:18.707715 [info ] [Thread-1 (]: 7 of 7 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m23:49:18.708978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:49:18.709577 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:49:18.717526 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:49:18.718261 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:49:18.721884 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:49:18.722383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:49:18.810517 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:49:19.620343 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:dfc41fe1-ad47-45f8-917f-23025c6f08d5&page=queryresults
[0m23:49:19.963031 [info ] [Thread-1 (]: 7 of 7 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.25s]
[0m23:49:19.964391 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:49:19.966268 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:49:19.966762 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m23:49:19.967239 [info ] [MainThread]: 
[0m23:49:19.967687 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 11.10 seconds (11.10s).
[0m23:49:19.969759 [debug] [MainThread]: Command end result
[0m23:49:20.011068 [info ] [MainThread]: 
[0m23:49:20.011504 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:49:20.011777 [info ] [MainThread]: 
[0m23:49:20.012040 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:49:20.014649 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 12.163205, "process_user_time": 4.183102, "process_kernel_time": 0.361666, "process_mem_max_rss": "212385792", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:49:20.015149 [debug] [MainThread]: Command `dbt test` succeeded at 23:49:20.015067 after 12.16 seconds
[0m23:49:20.015445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079471a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a3740>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d585160>]}
[0m23:49:20.015707 [debug] [MainThread]: Flushing usage events
[0m23:53:26.724307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f6b2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084c6f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084c6ba0>]}


============================== 23:53:26.727457 | 1a4e4eda-6257-430f-b99b-db848004278f ==============================
[0m23:53:26.727457 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:53:26.727818 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m23:53:27.673493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a4e4eda-6257-430f-b99b-db848004278f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1468cd730>]}
[0m23:53:27.698062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a4e4eda-6257-430f-b99b-db848004278f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1461eb0e0>]}
[0m23:53:27.698504 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:53:27.723138 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:53:27.835007 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m23:53:27.835481 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m23:53:27.835756 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:53:27.835953 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/prepatory/prep_customer.sql
[0m23:53:28.034785 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:53:28.041757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a4e4eda-6257-430f-b99b-db848004278f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146efb680>]}
[0m23:53:28.155470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a4e4eda-6257-430f-b99b-db848004278f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fb4620>]}
[0m23:53:28.155756 [info ] [MainThread]: Found 7 models, 1 seed, 12 data tests, 3 sources, 855 macros
[0m23:53:28.155927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a4e4eda-6257-430f-b99b-db848004278f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14786d6d0>]}
[0m23:53:28.157044 [info ] [MainThread]: 
[0m23:53:28.157327 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:53:28.159265 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:53:28.159461 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:28.561630 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:53:28.563354 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:53:29.078665 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:53:29.080648 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:53:29.501612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a4e4eda-6257-430f-b99b-db848004278f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fb4590>]}
[0m23:53:29.502171 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:53:29.502451 [info ] [MainThread]: 
[0m23:53:29.505653 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:53:29.506064 [info ] [Thread-1 (]: 1 of 12 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:53:29.506440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:53:29.506742 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:53:29.521257 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:53:29.522384 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:53:29.535803 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:53:29.536335 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:29.608975 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:53:30.362424 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:889dc10f-3bc7-4716-bdc7-7ad04124b9fa&page=queryresults
[0m23:53:30.694208 [info ] [Thread-1 (]: 1 of 12 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.19s]
[0m23:53:30.695242 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:53:30.695774 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b
[0m23:53:30.696324 [info ] [Thread-1 (]: 2 of 12 START test greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0  [RUN]
[0m23:53:30.696940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b)
[0m23:53:30.697397 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b
[0m23:53:30.709326 [debug] [Thread-1 (]: Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:30.709979 [error] [Thread-1 (]: 2 of 12 ERROR greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0  [[31mERROR[0m in 0.01s]
[0m23:53:30.710544 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b
[0m23:53:30.710945 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87
[0m23:53:30.711937 [info ] [Thread-1 (]: 3 of 12 START test greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0  [RUN]
[0m23:53:30.712405 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b, now test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87)
[0m23:53:30.712720 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87
[0m23:53:30.718719 [debug] [Thread-1 (]: Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:30.719245 [error] [Thread-1 (]: 3 of 12 ERROR greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0  [[31mERROR[0m in 0.01s]
[0m23:53:30.719690 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87
[0m23:53:30.720012 [debug] [Thread-1 (]: Began running node test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100.bd7e4c3d96
[0m23:53:30.720381 [info ] [Thread-1 (]: 4 of 12 START test less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100  [RUN]
[0m23:53:30.720771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87, now test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100.bd7e4c3d96)
[0m23:53:30.721073 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100.bd7e4c3d96
[0m23:53:30.728379 [debug] [Thread-1 (]: Compilation Error in test less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100 (models/marts/mart_customer_metrics_monthly.yml)
  'test_less_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:30.728855 [error] [Thread-1 (]: 4 of 12 ERROR less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100  [[31mERROR[0m in 0.01s]
[0m23:53:30.729253 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100.bd7e4c3d96
[0m23:53:30.729543 [debug] [Thread-1 (]: Began running node test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100.fc541ff166
[0m23:53:30.729851 [info ] [Thread-1 (]: 5 of 12 START test less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100  [RUN]
[0m23:53:30.730145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100.bd7e4c3d96, now test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100.fc541ff166)
[0m23:53:30.730396 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100.fc541ff166
[0m23:53:30.735107 [debug] [Thread-1 (]: Compilation Error in test less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100 (models/marts/mart_customer_metrics_monthly.yml)
  'test_less_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:30.735531 [error] [Thread-1 (]: 5 of 12 ERROR less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100  [[31mERROR[0m in 0.01s]
[0m23:53:30.735891 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100.fc541ff166
[0m23:53:30.736150 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:53:30.736433 [info ] [Thread-1 (]: 6 of 12 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month  [RUN]
[0m23:53:30.736709 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100.fc541ff166, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:53:30.736931 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:53:30.741616 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:53:30.742643 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:53:30.744481 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:53:30.745172 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:30.815035 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:53:31.413675 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:15a2d29d-3e5d-4243-bd1e-9fdacaf2c072&page=queryresults
[0m23:53:31.937993 [info ] [Thread-1 (]: 6 of 12 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ...... [[32mPASS[0m in 1.20s]
[0m23:53:31.939178 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:53:31.940321 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:53:31.941157 [info ] [Thread-1 (]: 7 of 12 START test not_null_mart_customer_metrics_monthly_month ................ [RUN]
[0m23:53:31.941969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:53:31.942555 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:53:31.951713 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:53:31.953711 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:53:31.958187 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:53:31.961113 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:32.097495 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:53:33.182393 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7f8df006-9d35-4d56-a23c-ce934eecc89a&page=queryresults
[0m23:53:33.614199 [info ] [Thread-1 (]: 7 of 12 PASS not_null_mart_customer_metrics_monthly_month ...................... [[32mPASS[0m in 1.67s]
[0m23:53:33.614994 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:53:33.615421 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:53:33.615785 [info ] [Thread-1 (]: 8 of 12 START test not_null_mart_customer_retention_metrics_customer_id ........ [RUN]
[0m23:53:33.616374 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:53:33.616704 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:53:33.622256 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:53:33.623107 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:53:33.627691 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:53:33.628744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:33.704884 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:53:34.429394 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ee08f9c5-6539-467c-b87a-1c4f95903ae2&page=queryresults
[0m23:53:34.780663 [info ] [Thread-1 (]: 8 of 12 PASS not_null_mart_customer_retention_metrics_customer_id .............. [[32mPASS[0m in 1.16s]
[0m23:53:34.781503 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:53:34.781964 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:53:34.782460 [info ] [Thread-1 (]: 9 of 12 START test not_null_mart_customer_retention_metrics_from_date .......... [RUN]
[0m23:53:34.783035 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:53:34.783475 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:53:34.789160 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:53:34.790810 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:53:34.793942 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:53:34.794811 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:34.876701 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:53:35.478278 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e0a81054-dfcf-471a-86a7-06f99df22b15&page=queryresults
[0m23:53:35.818811 [info ] [Thread-1 (]: 9 of 12 PASS not_null_mart_customer_retention_metrics_from_date ................ [[32mPASS[0m in 1.03s]
[0m23:53:35.820207 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:53:35.820958 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:53:35.822215 [info ] [Thread-1 (]: 10 of 12 START test not_null_mart_customer_retention_metrics_subscription_id ... [RUN]
[0m23:53:35.823174 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:53:35.823730 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:53:35.831176 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:53:35.831925 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:53:35.834032 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:53:35.834532 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:35.926278 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:53:36.419134 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d50ca9b0-30ee-456b-8817-97f2af4b13e9&page=queryresults
[0m23:53:36.769171 [info ] [Thread-1 (]: 10 of 12 PASS not_null_mart_customer_retention_metrics_subscription_id ......... [[32mPASS[0m in 0.95s]
[0m23:53:36.770649 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:53:36.771621 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:53:36.772348 [info ] [Thread-1 (]: 11 of 12 START test not_null_mart_customer_retention_metrics_to_date ........... [RUN]
[0m23:53:36.773076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:53:36.774122 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:53:36.782024 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:53:36.783529 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:53:36.785511 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:53:36.785964 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:36.876675 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:53:37.383270 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fc0a063e-9072-4415-8287-4e675b74712e&page=queryresults
[0m23:53:37.792880 [info ] [Thread-1 (]: 11 of 12 PASS not_null_mart_customer_retention_metrics_to_date ................. [[32mPASS[0m in 1.02s]
[0m23:53:37.794727 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:53:37.795786 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:53:37.796751 [info ] [Thread-1 (]: 12 of 12 START test unique_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:53:37.797710 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c, now test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856)
[0m23:53:37.798402 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:53:37.808985 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:53:37.809684 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:53:37.811660 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:53:37.812272 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:37.902161 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select month as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
  where month is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:53:38.753756 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:775313bd-3c57-47ab-88a2-9a7d7150ef7f&page=queryresults
[0m23:53:39.090799 [error] [Thread-1 (]: 12 of 12 FAIL 68 unique_mart_customer_metrics_monthly_month .................... [[31mFAIL 68[0m in 1.29s]
[0m23:53:39.091498 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:53:39.092562 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:39.092931 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856' was properly closed.
[0m23:53:39.093223 [info ] [MainThread]: 
[0m23:53:39.093496 [info ] [MainThread]: Finished running 12 data tests in 0 hours 0 minutes and 10.94 seconds (10.94s).
[0m23:53:39.094967 [debug] [MainThread]: Command end result
[0m23:53:39.129042 [info ] [MainThread]: 
[0m23:53:39.129351 [info ] [MainThread]: [31mCompleted with 5 errors and 0 warnings:[0m
[0m23:53:39.129516 [info ] [MainThread]: 
[0m23:53:39.129723 [error] [MainThread]:   Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:39.129871 [info ] [MainThread]: 
[0m23:53:39.130046 [error] [MainThread]:   Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:39.130184 [info ] [MainThread]: 
[0m23:53:39.130356 [error] [MainThread]:   Compilation Error in test less_than_or_equal_to_mart_customer_metrics_monthly_churn_rate__100 (models/marts/mart_customer_metrics_monthly.yml)
  'test_less_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:39.130493 [info ] [MainThread]: 
[0m23:53:39.130662 [error] [MainThread]:   Compilation Error in test less_than_or_equal_to_mart_customer_metrics_monthly_retention_rate__100 (models/marts/mart_customer_metrics_monthly.yml)
  'test_less_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:53:39.130794 [info ] [MainThread]: 
[0m23:53:39.130959 [error] [MainThread]: [31mFailure in test unique_mart_customer_metrics_monthly_month (models/marts/mart_customer_metrics_monthly.yml)[0m
[0m23:53:39.131117 [error] [MainThread]:   Got 68 results, configured to fail if != 0
[0m23:53:39.131238 [info ] [MainThread]: 
[0m23:53:39.131396 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_metrics_monthly.yml/unique_mart_customer_metrics_monthly_month.sql
[0m23:53:39.131531 [info ] [MainThread]: 
[0m23:53:39.131677 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=5 SKIP=0 TOTAL=12
[0m23:53:39.133527 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 12.445707, "process_user_time": 4.491208, "process_kernel_time": 0.411815, "process_mem_max_rss": "213729280", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:53:39.133806 [debug] [MainThread]: Command `dbt test` failed at 23:53:39.133761 after 12.45 seconds
[0m23:53:39.134000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f249e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fd0560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fd0e00>]}
[0m23:53:39.134174 [debug] [MainThread]: Flushing usage events
[0m23:56:12.442108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051cc6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e2f1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e2ee40>]}


============================== 23:56:12.446096 | 6f73e761-c8d9-4b53-af1f-3fb0cacb654d ==============================
[0m23:56:12.446096 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:56:12.446424 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:56:13.299073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f73e761-c8d9-4b53-af1f-3fb0cacb654d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151ad53d0>]}
[0m23:56:13.323216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f73e761-c8d9-4b53-af1f-3fb0cacb654d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10574d4c0>]}
[0m23:56:13.323524 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:56:13.345429 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:56:13.449726 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m23:56:13.450299 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis_monthly.yml
[0m23:56:13.450592 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:56:13.656727 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:56:13.665270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f73e761-c8d9-4b53-af1f-3fb0cacb654d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a8f0cb0>]}
[0m23:56:13.780828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f73e761-c8d9-4b53-af1f-3fb0cacb654d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15a8f0110>]}
[0m23:56:13.781124 [info ] [MainThread]: Found 7 models, 1 seed, 12 data tests, 3 sources, 855 macros
[0m23:56:13.781295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f73e761-c8d9-4b53-af1f-3fb0cacb654d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x156784830>]}
[0m23:56:13.782422 [info ] [MainThread]: 
[0m23:56:13.782690 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:56:13.784594 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:56:13.784795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:56:14.630897 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:56:14.633402 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:56:15.177044 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:56:15.179225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:56:15.670754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f73e761-c8d9-4b53-af1f-3fb0cacb654d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1563fda60>]}
[0m23:56:15.671968 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:56:15.672542 [info ] [MainThread]: 
[0m23:56:15.679358 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:15.680431 [info ] [Thread-1 (]: 1 of 12 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:56:15.681532 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:56:15.682251 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:15.695771 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:56:15.696794 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:15.716470 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:56:15.717312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:15.792763 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:56:16.570470 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5cd4ad68-e827-4913-a226-01b0e0c64238&page=queryresults
[0m23:56:16.970852 [info ] [Thread-1 (]: 1 of 12 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.29s]
[0m23:56:16.971987 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:16.972594 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:56:16.973258 [info ] [Thread-1 (]: 2 of 12 START test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [RUN]
[0m23:56:16.973997 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921)
[0m23:56:16.974574 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:56:16.988661 [debug] [Thread-1 (]: Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:16.989447 [error] [Thread-1 (]: 2 of 12 ERROR greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [[31mERROR[0m in 0.02s]
[0m23:56:16.989992 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:56:16.990380 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b
[0m23:56:16.991426 [info ] [Thread-1 (]: 3 of 12 START test greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0  [RUN]
[0m23:56:16.991943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921, now test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b)
[0m23:56:16.992320 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b
[0m23:56:16.999895 [debug] [Thread-1 (]: Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:17.000533 [error] [Thread-1 (]: 3 of 12 ERROR greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0  [[31mERROR[0m in 0.01s]
[0m23:56:17.001057 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b
[0m23:56:17.001449 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87
[0m23:56:17.001831 [info ] [Thread-1 (]: 4 of 12 START test greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0  [RUN]
[0m23:56:17.002210 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0.29be30fb2b, now test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87)
[0m23:56:17.002504 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87
[0m23:56:17.007782 [debug] [Thread-1 (]: Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:17.008216 [error] [Thread-1 (]: 4 of 12 ERROR greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0  [[31mERROR[0m in 0.01s]
[0m23:56:17.008638 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87
[0m23:56:17.008955 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:17.009306 [info ] [Thread-1 (]: 5 of 12 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month  [RUN]
[0m23:56:17.009677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0.becb271c87, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:56:17.009972 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:17.016170 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:56:17.017215 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:17.021179 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:56:17.021640 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:17.094854 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:56:17.618823 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:27e5d941-659b-4c7a-b96f-8e1227f5a0b1&page=queryresults
[0m23:56:18.009076 [info ] [Thread-1 (]: 5 of 12 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ...... [[32mPASS[0m in 1.00s]
[0m23:56:18.009940 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:18.010435 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:18.010948 [info ] [Thread-1 (]: 6 of 12 START test not_null_mart_customer_metrics_monthly_month ................ [RUN]
[0m23:56:18.011651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:56:18.012060 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:18.018121 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:56:18.019919 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:18.022139 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:56:18.022648 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:18.104243 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:56:18.665285 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7783782a-6886-4903-99cc-b44ca5b7909e&page=queryresults
[0m23:56:19.060563 [info ] [Thread-1 (]: 6 of 12 PASS not_null_mart_customer_metrics_monthly_month ...................... [[32mPASS[0m in 1.05s]
[0m23:56:19.062302 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:19.063201 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:19.063961 [info ] [Thread-1 (]: 7 of 12 START test not_null_mart_customer_retention_metrics_customer_id ........ [RUN]
[0m23:56:19.064689 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:56:19.065201 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:19.072284 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:56:19.072907 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:19.074627 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:56:19.075039 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:19.168509 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:56:19.545135 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9d04f7a8-7a1f-4725-8635-f5d9db6c33a9&page=queryresults
[0m23:56:19.972927 [info ] [Thread-1 (]: 7 of 12 PASS not_null_mart_customer_retention_metrics_customer_id .............. [[32mPASS[0m in 0.89s]
[0m23:56:19.997986 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:19.998397 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:20.000147 [info ] [Thread-1 (]: 8 of 12 START test not_null_mart_customer_retention_metrics_from_date .......... [RUN]
[0m23:56:20.000939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:56:20.001773 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:20.027912 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:56:20.033515 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:20.044403 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:56:20.046710 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:20.124362 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:56:20.759362 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:915fdaab-b802-4875-a6f1-d83d7a05febe&page=queryresults
[0m23:56:21.154204 [info ] [Thread-1 (]: 8 of 12 PASS not_null_mart_customer_retention_metrics_from_date ................ [[32mPASS[0m in 1.15s]
[0m23:56:21.154743 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:21.155038 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:21.155349 [info ] [Thread-1 (]: 9 of 12 START test not_null_mart_customer_retention_metrics_subscription_id .... [RUN]
[0m23:56:21.155715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:56:21.155979 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:21.159520 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:56:21.161042 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:21.163101 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:56:21.163738 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:21.234646 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:56:21.637635 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:38009a6e-9b5f-4712-8382-e283544b7742&page=queryresults
[0m23:56:22.003439 [info ] [Thread-1 (]: 9 of 12 PASS not_null_mart_customer_retention_metrics_subscription_id .......... [[32mPASS[0m in 0.85s]
[0m23:56:22.004018 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:22.004345 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:56:22.004682 [info ] [Thread-1 (]: 10 of 12 START test not_null_mart_customer_retention_metrics_to_date ........... [RUN]
[0m23:56:22.005066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:56:22.005348 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:56:22.009287 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:56:22.009887 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:56:22.012337 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:56:22.013113 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:22.088821 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:56:22.623042 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8b0b3a19-94ef-4a6e-9753-c6624c98d44c&page=queryresults
[0m23:56:23.550474 [info ] [Thread-1 (]: 10 of 12 PASS not_null_mart_customer_retention_metrics_to_date ................. [[32mPASS[0m in 1.54s]
[0m23:56:23.551966 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:56:23.552727 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:56:23.553369 [info ] [Thread-1 (]: 11 of 12 START test unique_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:56:23.554051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c, now test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77)
[0m23:56:23.554555 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:56:23.566309 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77"
[0m23:56:23.567653 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:56:23.571040 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77"
[0m23:56:23.571899 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:23.663019 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select cohort_month as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
  where cohort_month is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:56:24.953851 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c2b70ec5-79ba-4eeb-81d1-76d908e8fcae&page=queryresults
[0m23:56:25.349373 [error] [Thread-1 (]: 11 of 12 FAIL 68 unique_mart_cohort_retention_analysis_monthly_cohort_month .... [[31mFAIL 68[0m in 1.80s]
[0m23:56:25.349767 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:56:25.349983 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:56:25.350210 [info ] [Thread-1 (]: 12 of 12 START test unique_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:56:25.350472 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77, now test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856)
[0m23:56:25.350661 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:56:25.354310 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:56:25.354941 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:56:25.356475 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:56:25.356899 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:25.423505 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select month as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
  where month is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:56:26.712369 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:dad41b20-447d-441a-9612-8da3e5623edc&page=queryresults
[0m23:56:27.154125 [error] [Thread-1 (]: 12 of 12 FAIL 68 unique_mart_customer_metrics_monthly_month .................... [[31mFAIL 68[0m in 1.80s]
[0m23:56:27.154747 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:56:27.155733 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:56:27.155995 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856' was properly closed.
[0m23:56:27.156245 [info ] [MainThread]: 
[0m23:56:27.156489 [info ] [MainThread]: Finished running 12 data tests in 0 hours 0 minutes and 13.37 seconds (13.37s).
[0m23:56:27.158052 [debug] [MainThread]: Command end result
[0m23:56:27.192479 [info ] [MainThread]: 
[0m23:56:27.192758 [info ] [MainThread]: [31mCompleted with 5 errors and 0 warnings:[0m
[0m23:56:27.192914 [info ] [MainThread]: 
[0m23:56:27.193118 [error] [MainThread]:   Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:27.193262 [info ] [MainThread]: 
[0m23:56:27.193440 [error] [MainThread]:   Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_acquired_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:27.193581 [info ] [MainThread]: 
[0m23:56:27.193750 [error] [MainThread]:   Compilation Error in test greater_than_or_equal_to_mart_customer_metrics_monthly_retained_customers__0 (models/marts/mart_customer_metrics_monthly.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:27.193893 [info ] [MainThread]: 
[0m23:56:27.194112 [error] [MainThread]: [31mFailure in test unique_mart_cohort_retention_analysis_monthly_cohort_month (models/marts/mart_cohort_retention_analysis_monthly.yml)[0m
[0m23:56:27.194280 [error] [MainThread]:   Got 68 results, configured to fail if != 0
[0m23:56:27.194410 [info ] [MainThread]: 
[0m23:56:27.194583 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_cohort_retention_analysis_monthly.yml/unique_mart_cohort_retention_analysis_monthly_cohort_month.sql
[0m23:56:27.194736 [info ] [MainThread]: 
[0m23:56:27.194901 [error] [MainThread]: [31mFailure in test unique_mart_customer_metrics_monthly_month (models/marts/mart_customer_metrics_monthly.yml)[0m
[0m23:56:27.195057 [error] [MainThread]:   Got 68 results, configured to fail if != 0
[0m23:56:27.195180 [info ] [MainThread]: 
[0m23:56:27.195334 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_metrics_monthly.yml/unique_mart_customer_metrics_monthly_month.sql
[0m23:56:27.195471 [info ] [MainThread]: 
[0m23:56:27.195622 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=5 SKIP=0 TOTAL=12
[0m23:56:27.198256 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 14.793611, "process_user_time": 4.555138, "process_kernel_time": 0.388785, "process_mem_max_rss": "212271104", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:56:27.198818 [debug] [MainThread]: Command `dbt test` failed at 23:56:27.198732 after 14.79 seconds
[0m23:56:27.199089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105798b00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ddffe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e2f020>]}
[0m23:56:27.199306 [debug] [MainThread]: Flushing usage events
[0m23:56:50.959151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045d6540>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10483ee10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10483ebd0>]}


============================== 23:56:50.961767 | 62d5de69-282b-49bc-b681-685638321b70 ==============================
[0m23:56:50.961767 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:56:50.962080 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:56:51.779262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62d5de69-282b-49bc-b681-685638321b70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103705070>]}
[0m23:56:51.803237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62d5de69-282b-49bc-b681-685638321b70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130bd0740>]}
[0m23:56:51.803557 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:56:51.824243 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:56:51.917539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:56:51.917988 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:56:52.091965 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:56:52.098355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62d5de69-282b-49bc-b681-685638321b70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x130d19b50>]}
[0m23:56:52.211467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62d5de69-282b-49bc-b681-685638321b70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1313cae40>]}
[0m23:56:52.211761 [info ] [MainThread]: Found 7 models, 1 seed, 10 data tests, 3 sources, 855 macros
[0m23:56:52.211928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62d5de69-282b-49bc-b681-685638321b70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131585940>]}
[0m23:56:52.213041 [info ] [MainThread]: 
[0m23:56:52.213321 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:56:52.215228 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:56:52.215424 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:56:52.615489 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:56:52.617883 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:56:52.992465 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:56:52.995574 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:56:53.536634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62d5de69-282b-49bc-b681-685638321b70', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13148cf50>]}
[0m23:56:53.538002 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:56:53.538620 [info ] [MainThread]: 
[0m23:56:53.542874 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:53.543576 [info ] [Thread-1 (]: 1 of 10 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:56:53.544442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:56:53.544993 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:53.569236 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:56:53.570164 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:53.588345 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:56:53.588988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:53.663993 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:56:54.119969 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6bbe8e98-1efd-4abb-8a38-b302419b650c&page=queryresults
[0m23:56:54.588802 [info ] [Thread-1 (]: 1 of 10 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.04s]
[0m23:56:54.589945 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:56:54.590567 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:56:54.591272 [info ] [Thread-1 (]: 2 of 10 START test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [RUN]
[0m23:56:54.591987 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921)
[0m23:56:54.592553 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:56:54.606860 [debug] [Thread-1 (]: Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:56:54.607431 [error] [Thread-1 (]: 2 of 10 ERROR greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [[31mERROR[0m in 0.02s]
[0m23:56:54.608058 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:56:54.608516 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:54.609587 [info ] [Thread-1 (]: 3 of 10 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month  [RUN]
[0m23:56:54.610053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:56:54.610411 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:54.618609 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:56:54.619486 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:54.621842 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:56:54.622384 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:54.702773 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:56:55.365389 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:98f52982-2aa3-4a2e-9565-e5ac21a4cd96&page=queryresults
[0m23:56:55.761160 [info ] [Thread-1 (]: 3 of 10 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ...... [[32mPASS[0m in 1.15s]
[0m23:56:55.762452 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:56:55.763365 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:55.764171 [info ] [Thread-1 (]: 4 of 10 START test not_null_mart_customer_metrics_monthly_month ................ [RUN]
[0m23:56:55.764863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:56:55.765474 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:55.772431 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:56:55.773204 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:55.775198 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:56:55.775947 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:55.870503 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:56:56.413552 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bd2e47e2-8f8f-4228-be1f-33cf98d12b98&page=queryresults
[0m23:56:56.808868 [info ] [Thread-1 (]: 4 of 10 PASS not_null_mart_customer_metrics_monthly_month ...................... [[32mPASS[0m in 1.04s]
[0m23:56:56.810372 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:56:56.811079 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:56.811753 [info ] [Thread-1 (]: 5 of 10 START test not_null_mart_customer_retention_metrics_customer_id ........ [RUN]
[0m23:56:56.812398 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:56:56.813378 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:56.824441 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:56:56.825589 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:56.828697 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:56:56.829426 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:56.920280 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:56:57.273285 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9a5b2f05-69eb-4c22-a368-769c2090a0fe&page=queryresults
[0m23:56:57.677311 [info ] [Thread-1 (]: 5 of 10 PASS not_null_mart_customer_retention_metrics_customer_id .............. [[32mPASS[0m in 0.86s]
[0m23:56:57.679239 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:56:57.680021 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:57.681167 [info ] [Thread-1 (]: 6 of 10 START test not_null_mart_customer_retention_metrics_from_date .......... [RUN]
[0m23:56:57.682260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:56:57.682833 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:57.689130 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:56:57.689718 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:57.691376 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:56:57.691752 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:57.783627 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:56:58.710977 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:323fdcc3-9571-4d33-a965-52cb459ba026&page=queryresults
[0m23:56:59.561494 [info ] [Thread-1 (]: 6 of 10 PASS not_null_mart_customer_retention_metrics_from_date ................ [[32mPASS[0m in 1.88s]
[0m23:56:59.563562 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:56:59.564699 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:59.565434 [info ] [Thread-1 (]: 7 of 10 START test not_null_mart_customer_retention_metrics_subscription_id .... [RUN]
[0m23:56:59.566186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:56:59.567330 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:59.575183 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:56:59.575905 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:56:59.577792 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:56:59.578218 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:56:59.668303 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:57:00.163630 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:11c9dbe8-b805-43ff-a363-2a40968af349&page=queryresults
[0m23:57:00.611455 [info ] [Thread-1 (]: 7 of 10 PASS not_null_mart_customer_retention_metrics_subscription_id .......... [[32mPASS[0m in 1.04s]
[0m23:57:00.613710 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:57:00.614849 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:57:00.615735 [info ] [Thread-1 (]: 8 of 10 START test not_null_mart_customer_retention_metrics_to_date ............ [RUN]
[0m23:57:00.616653 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:57:00.617406 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:57:00.624403 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:57:00.625081 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:57:00.628988 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:57:00.629523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:57:00.723553 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:57:01.134696 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:48cd1648-fcb8-467e-9f4f-346b52e71f28&page=queryresults
[0m23:57:01.457584 [info ] [Thread-1 (]: 8 of 10 PASS not_null_mart_customer_retention_metrics_to_date .................. [[32mPASS[0m in 0.84s]
[0m23:57:01.458149 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:57:01.458475 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:57:01.458820 [info ] [Thread-1 (]: 9 of 10 START test unique_mart_cohort_retention_analysis_monthly_cohort_month .. [RUN]
[0m23:57:01.459194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c, now test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77)
[0m23:57:01.459475 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:57:01.465731 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77"
[0m23:57:01.466484 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:57:01.468418 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77"
[0m23:57:01.468897 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:57:01.540999 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select cohort_month as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
  where cohort_month is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:57:02.184506 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:dad3af9b-ebf6-42fb-8f77-6d8f6d82ae1f&page=queryresults
[0m23:57:02.504746 [error] [Thread-1 (]: 9 of 10 FAIL 68 unique_mart_cohort_retention_analysis_monthly_cohort_month ..... [[31mFAIL 68[0m in 1.04s]
[0m23:57:02.506942 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77
[0m23:57:02.507908 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:57:02.508762 [info ] [Thread-1 (]: 10 of 10 START test unique_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:57:02.509556 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.unique_mart_cohort_retention_analysis_monthly_cohort_month.1e95b5ba77, now test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856)
[0m23:57:02.510212 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:57:02.518123 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:57:02.522912 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:57:02.526948 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:57:02.527888 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:57:02.623415 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select month as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
  where month is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:57:03.101180 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4ea78eb0-16b1-4b34-b8b7-0b635815e26d&page=queryresults
[0m23:57:03.477530 [error] [Thread-1 (]: 10 of 10 FAIL 68 unique_mart_customer_metrics_monthly_month .................... [[31mFAIL 68[0m in 0.97s]
[0m23:57:03.479302 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:57:03.481757 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:57:03.482538 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856' was properly closed.
[0m23:57:03.483009 [info ] [MainThread]: 
[0m23:57:03.483470 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 11.27 seconds (11.27s).
[0m23:57:03.486444 [debug] [MainThread]: Command end result
[0m23:57:03.526521 [info ] [MainThread]: 
[0m23:57:03.526920 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m23:57:03.527147 [info ] [MainThread]: 
[0m23:57:03.527435 [error] [MainThread]:   Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:57:03.527645 [info ] [MainThread]: 
[0m23:57:03.527910 [error] [MainThread]: [31mFailure in test unique_mart_cohort_retention_analysis_monthly_cohort_month (models/marts/mart_cohort_retention_analysis_monthly.yml)[0m
[0m23:57:03.528146 [error] [MainThread]:   Got 68 results, configured to fail if != 0
[0m23:57:03.528323 [info ] [MainThread]: 
[0m23:57:03.528556 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_cohort_retention_analysis_monthly.yml/unique_mart_cohort_retention_analysis_monthly_cohort_month.sql
[0m23:57:03.528741 [info ] [MainThread]: 
[0m23:57:03.528970 [error] [MainThread]: [31mFailure in test unique_mart_customer_metrics_monthly_month (models/marts/mart_customer_metrics_monthly.yml)[0m
[0m23:57:03.529196 [error] [MainThread]:   Got 68 results, configured to fail if != 0
[0m23:57:03.529368 [info ] [MainThread]: 
[0m23:57:03.529587 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_metrics_monthly.yml/unique_mart_customer_metrics_monthly_month.sql
[0m23:57:03.529778 [info ] [MainThread]: 
[0m23:57:03.529985 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=3 SKIP=0 TOTAL=10
[0m23:57:03.532320 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 12.603835, "process_user_time": 4.693299, "process_kernel_time": 0.359883, "process_mem_max_rss": "213450752", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:57:03.532795 [debug] [MainThread]: Command `dbt test` failed at 23:57:03.532718 after 12.60 seconds
[0m23:57:03.533097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131585250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127d16ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10486d790>]}
[0m23:57:03.533360 [debug] [MainThread]: Flushing usage events
[0m23:58:14.415390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a56c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089fee40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089fec00>]}


============================== 23:58:14.418236 | fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36 ==============================
[0m23:58:14.418236 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:58:14.418566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:58:15.275361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f015e50>]}
[0m23:58:15.299091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089fc230>]}
[0m23:58:15.299412 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:58:15.332645 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:58:15.437877 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:58:15.438393 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis_monthly.yml
[0m23:58:15.658431 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:58:15.665154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f79ea20>]}
[0m23:58:15.778472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146014ad0>]}
[0m23:58:15.778772 [info ] [MainThread]: Found 7 models, 1 seed, 9 data tests, 3 sources, 855 macros
[0m23:58:15.778945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1461dda30>]}
[0m23:58:15.780000 [info ] [MainThread]: 
[0m23:58:15.780268 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:58:15.782433 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:58:15.782671 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:16.257500 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m23:58:16.258098 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:58:16.792610 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test_ref)
[0m23:58:16.794745 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:58:17.318412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd70ab9f-c558-4afe-83bd-f5b1aaaa2c36', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f79dee0>]}
[0m23:58:17.318915 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:58:17.319168 [info ] [MainThread]: 
[0m23:58:17.321069 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:17.321412 [info ] [Thread-1 (]: 1 of 9 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:58:17.321737 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:58:17.322002 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:17.335723 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:58:17.336763 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:17.352223 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:58:17.352879 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:17.420253 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:58:17.961927 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1f1fd8ee-0d2c-482c-b593-83fbfcf0fda8&page=queryresults
[0m23:58:18.418843 [info ] [Thread-1 (]: 1 of 9 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.10s]
[0m23:58:18.419375 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:18.419683 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:58:18.420017 [info ] [Thread-1 (]: 2 of 9 START test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [RUN]
[0m23:58:18.420382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921)
[0m23:58:18.420654 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:58:18.429012 [debug] [Thread-1 (]: Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:58:18.429427 [error] [Thread-1 (]: 2 of 9 ERROR greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [[31mERROR[0m in 0.01s]
[0m23:58:18.429786 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:58:18.430028 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:18.430839 [info ] [Thread-1 (]: 3 of 9 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:58:18.431198 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:58:18.431450 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:18.435929 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:58:18.436733 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:18.438362 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:58:18.438836 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:18.508815 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:58:19.253543 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:01978779-c52a-4948-aa02-800f6d2d6ea4&page=queryresults
[0m23:58:19.643530 [info ] [Thread-1 (]: 3 of 9 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.21s]
[0m23:58:19.643983 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:19.644237 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:19.644550 [info ] [Thread-1 (]: 4 of 9 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:58:19.644902 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:58:19.645163 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:19.648739 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:58:19.649658 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:19.651501 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:58:19.652078 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:19.722816 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:58:20.302633 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:44685e59-dc71-431e-80b0-1c62d3426580&page=queryresults
[0m23:58:20.693159 [info ] [Thread-1 (]: 4 of 9 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 1.05s]
[0m23:58:20.693625 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:20.693869 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:20.694163 [info ] [Thread-1 (]: 5 of 9 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:58:20.694516 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:58:20.694790 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:20.699449 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:58:20.701232 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:20.703362 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:58:20.703954 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:20.773415 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:58:21.351511 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b0d91a1d-eb5f-478f-8d6f-de61a817805c&page=queryresults
[0m23:58:22.071947 [info ] [Thread-1 (]: 5 of 9 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.38s]
[0m23:58:22.072944 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:22.073521 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:22.074095 [info ] [Thread-1 (]: 6 of 9 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m23:58:22.074699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:58:22.075147 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:22.081317 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:58:22.082349 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:22.085534 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:58:22.086302 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:22.173060 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:58:22.972670 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f624b071-2249-4ee5-8808-323e79b9b22a&page=queryresults
[0m23:58:23.288828 [info ] [Thread-1 (]: 6 of 9 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.21s]
[0m23:58:23.290681 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:23.291490 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:23.292427 [info ] [Thread-1 (]: 7 of 9 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:58:23.293661 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:58:23.294428 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:23.301639 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:58:23.303320 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:23.307614 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:58:23.308582 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:23.400096 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:58:23.972965 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1fdd1efe-eef6-42d3-aba2-8cc166866811&page=queryresults
[0m23:58:24.301653 [info ] [Thread-1 (]: 7 of 9 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.01s]
[0m23:58:24.303563 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:24.304371 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:24.305034 [info ] [Thread-1 (]: 8 of 9 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m23:58:24.305771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:58:24.306299 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:24.314094 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:58:24.314966 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:24.319374 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:58:24.319981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:24.410837 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:58:25.197676 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cf4b7fee-c641-443c-a877-8ee0e5d278e9&page=queryresults
[0m23:58:25.652866 [info ] [Thread-1 (]: 8 of 9 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.35s]
[0m23:58:25.654216 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:25.654969 [debug] [Thread-1 (]: Began running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:58:25.655715 [info ] [Thread-1 (]: 9 of 9 START test unique_mart_customer_metrics_monthly_month ................... [RUN]
[0m23:58:25.656625 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c, now test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856)
[0m23:58:25.657111 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:58:25.666999 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:58:25.668593 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:58:25.670774 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"
[0m23:58:25.671335 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:25.760545 [debug] [Thread-1 (]: On test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select month as unique_field
  from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
  where month is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m23:58:26.596800 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:79d7bdb7-e4f3-4a7f-98ee-118bf4623707&page=queryresults
[0m23:58:26.988356 [error] [Thread-1 (]: 9 of 9 FAIL 68 unique_mart_customer_metrics_monthly_month ...................... [[31mFAIL 68[0m in 1.33s]
[0m23:58:26.989811 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856
[0m23:58:26.991953 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:26.992698 [debug] [MainThread]: Connection 'test.manual_pasfield.unique_mart_customer_metrics_monthly_month.986b57c856' was properly closed.
[0m23:58:26.993645 [info ] [MainThread]: 
[0m23:58:26.994286 [info ] [MainThread]: Finished running 9 data tests in 0 hours 0 minutes and 11.21 seconds (11.21s).
[0m23:58:26.997031 [debug] [MainThread]: Command end result
[0m23:58:27.042073 [info ] [MainThread]: 
[0m23:58:27.042471 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m23:58:27.042709 [info ] [MainThread]: 
[0m23:58:27.042999 [error] [MainThread]:   Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:58:27.043215 [info ] [MainThread]: 
[0m23:58:27.043469 [error] [MainThread]: [31mFailure in test unique_mart_customer_metrics_monthly_month (models/marts/mart_customer_metrics_monthly.yml)[0m
[0m23:58:27.043705 [error] [MainThread]:   Got 68 results, configured to fail if != 0
[0m23:58:27.043882 [info ] [MainThread]: 
[0m23:58:27.044106 [info ] [MainThread]:   compiled code at target/compiled/manual_pasfield/models/marts/mart_customer_metrics_monthly.yml/unique_mart_customer_metrics_monthly_month.sql
[0m23:58:27.044301 [info ] [MainThread]: 
[0m23:58:27.044509 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=2 SKIP=0 TOTAL=9
[0m23:58:27.046619 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 12.663521, "process_user_time": 4.392042, "process_kernel_time": 0.399874, "process_mem_max_rss": "211779584", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:58:27.046968 [debug] [MainThread]: Command `dbt test` failed at 23:58:27.046911 after 12.66 seconds
[0m23:58:27.047204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f86b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106324a70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14608e4e0>]}
[0m23:58:27.047422 [debug] [MainThread]: Flushing usage events
[0m23:58:31.085855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104438380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104095eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104752d20>]}


============================== 23:58:31.088564 | 90879d58-5062-49eb-a822-2af5718b4448 ==============================
[0m23:58:31.088564 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:58:31.088872 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m23:58:31.721902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '90879d58-5062-49eb-a822-2af5718b4448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ffa7e0>]}
[0m23:58:31.753603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '90879d58-5062-49eb-a822-2af5718b4448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e5d35c0>]}
[0m23:58:31.754056 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:58:31.775637 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:58:31.874637 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:58:31.875176 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_metrics_monthly.yml
[0m23:58:32.057885 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:58:32.065131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '90879d58-5062-49eb-a822-2af5718b4448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ef18560>]}
[0m23:58:32.185035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '90879d58-5062-49eb-a822-2af5718b4448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12efb0830>]}
[0m23:58:32.185349 [info ] [MainThread]: Found 7 models, 1 seed, 8 data tests, 3 sources, 855 macros
[0m23:58:32.185519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90879d58-5062-49eb-a822-2af5718b4448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f1ca990>]}
[0m23:58:32.186558 [info ] [MainThread]: 
[0m23:58:32.186831 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:58:32.188735 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test'
[0m23:58:32.188933 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:58:32.586793 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m23:58:32.588175 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:58:33.119992 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m23:58:33.122004 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:58:33.625990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90879d58-5062-49eb-a822-2af5718b4448', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12efb07a0>]}
[0m23:58:33.627333 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:58:33.627811 [info ] [MainThread]: 
[0m23:58:33.631958 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:33.632649 [info ] [Thread-1 (]: 1 of 8 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:58:33.633391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:58:33.634116 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:33.659979 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:58:33.661043 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:33.680843 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:58:33.681583 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:33.756040 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:58:34.456698 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:17851d1d-1049-4264-868c-72cbf62c0a65&page=queryresults
[0m23:58:34.816921 [info ] [Thread-1 (]: 1 of 8 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.18s]
[0m23:58:34.817641 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:58:34.818035 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:58:34.818449 [info ] [Thread-1 (]: 2 of 8 START test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [RUN]
[0m23:58:34.818914 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921)
[0m23:58:34.819241 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:58:34.829329 [debug] [Thread-1 (]: Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:58:34.829778 [error] [Thread-1 (]: 2 of 8 ERROR greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [[31mERROR[0m in 0.01s]
[0m23:58:34.830167 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:58:34.830461 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:34.830767 [info ] [Thread-1 (]: 3 of 8 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:58:34.831829 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:58:34.832064 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:34.837049 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:58:34.837636 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:34.839489 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:58:34.839905 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:34.910999 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:58:35.507019 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0f06765e-e4fe-4bf5-aac1-e1a08f35bdb2&page=queryresults
[0m23:58:35.871895 [info ] [Thread-1 (]: 3 of 8 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.04s]
[0m23:58:35.873323 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:58:35.874069 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:35.874750 [info ] [Thread-1 (]: 4 of 8 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:58:35.875881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:58:35.876643 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:35.884872 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:58:35.886238 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:35.889847 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:58:35.890572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:35.982982 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:58:36.666700 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d4672836-a307-4daa-b2aa-9e441b97a102&page=queryresults
[0m23:58:37.084541 [info ] [Thread-1 (]: 4 of 8 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 1.21s]
[0m23:58:37.086088 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:58:37.086898 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:37.087550 [info ] [Thread-1 (]: 5 of 8 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:58:37.088213 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:58:37.088756 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:37.096147 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:58:37.097370 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:37.104167 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:58:37.104965 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:37.193339 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:58:37.512235 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:22cf1d5a-b2bd-42bf-b35d-5f1539c30b7c&page=queryresults
[0m23:58:37.902753 [info ] [Thread-1 (]: 5 of 8 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 0.81s]
[0m23:58:37.904006 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:58:37.904742 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:37.905408 [info ] [Thread-1 (]: 6 of 8 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m23:58:37.906017 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:58:37.906523 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:37.914664 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:58:37.916258 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:37.919147 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:58:37.919930 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:38.011646 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:58:38.657696 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:70ec0feb-29a2-44c0-bf76-3710959b28b4&page=queryresults
[0m23:58:39.015624 [info ] [Thread-1 (]: 6 of 8 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.11s]
[0m23:58:39.016247 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:58:39.016598 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:39.016973 [info ] [Thread-1 (]: 7 of 8 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:58:39.017397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:58:39.017728 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:39.021878 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:58:39.022587 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:39.024831 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:58:39.025321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:39.102021 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:58:39.574833 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7ad511a8-10e0-4602-8dfe-e22fa69d921f&page=queryresults
[0m23:58:40.423712 [info ] [Thread-1 (]: 7 of 8 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.41s]
[0m23:58:40.425150 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:58:40.425865 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:40.426496 [info ] [Thread-1 (]: 8 of 8 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m23:58:40.427165 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:58:40.427698 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:40.435769 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:58:40.436984 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:40.440688 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:58:40.441485 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:58:40.534017 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:58:41.275440 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:55319898-c413-4c7d-8bd3-b8da05abae4a&page=queryresults
[0m23:58:41.668883 [info ] [Thread-1 (]: 8 of 8 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.24s]
[0m23:58:41.670834 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:58:41.673477 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:58:41.674442 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m23:58:41.675090 [info ] [MainThread]: 
[0m23:58:41.675636 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 9.49 seconds (9.49s).
[0m23:58:41.677966 [debug] [MainThread]: Command end result
[0m23:58:41.722721 [info ] [MainThread]: 
[0m23:58:41.723104 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:58:41.723340 [info ] [MainThread]: 
[0m23:58:41.723629 [error] [MainThread]:   Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:58:41.723854 [info ] [MainThread]: 
[0m23:58:41.724075 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m23:58:41.725967 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 10.673551, "process_user_time": 4.368568, "process_kernel_time": 0.300269, "process_mem_max_rss": "212828160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:58:41.726379 [debug] [MainThread]: Command `dbt test` failed at 23:58:41.726311 after 10.67 seconds
[0m23:58:41.726658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a52b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ef1bd70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f1cbfb0>]}
[0m23:58:41.726908 [debug] [MainThread]: Flushing usage events
[0m23:59:19.699054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c8a1e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f7b020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f7adb0>]}


============================== 23:59:19.701680 | 943240df-9046-4529-afce-580629d556fb ==============================
[0m23:59:19.701680 [info ] [MainThread]: Running with dbt=1.8.5
[0m23:59:19.701997 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:59:20.527717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '943240df-9046-4529-afce-580629d556fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fa9730>]}
[0m23:59:20.551496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '943240df-9046-4529-afce-580629d556fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054d1550>]}
[0m23:59:20.551802 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m23:59:20.573330 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m23:59:20.664736 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:59:20.664984 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:59:20.667583 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m23:59:20.690622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '943240df-9046-4529-afce-580629d556fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b4ff2c0>]}
[0m23:59:20.756861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '943240df-9046-4529-afce-580629d556fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b51ee10>]}
[0m23:59:20.757154 [info ] [MainThread]: Found 7 models, 1 seed, 8 data tests, 3 sources, 855 macros
[0m23:59:20.757323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '943240df-9046-4529-afce-580629d556fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b4ffd10>]}
[0m23:59:20.758405 [info ] [MainThread]: 
[0m23:59:20.758691 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:59:20.760584 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_ref'
[0m23:59:20.760780 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:59:21.305370 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m23:59:21.305984 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:59:21.827406 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m23:59:21.828101 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:59:22.283436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '943240df-9046-4529-afce-580629d556fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104885b80>]}
[0m23:59:22.283821 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m23:59:22.284007 [info ] [MainThread]: 
[0m23:59:22.285443 [debug] [Thread-1 (]: Began running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:59:22.285686 [info ] [Thread-1 (]: 1 of 8 START test accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m23:59:22.285916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f)
[0m23:59:22.286103 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:59:22.298217 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:59:22.298726 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:59:22.310307 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"
[0m23:59:22.310949 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:22.376517 [debug] [Thread-1 (]: On test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        customer_country as value_field,
        count(*) as n_records

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    group by customer_country

)

select *
from all_values
where value_field not in (
    'US','CA','GB','DE','FR','AU','UK','BR'
)



      
    ) dbt_internal_test
[0m23:59:23.219079 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:17bdf538-1c0b-4cfc-86d1-bb67e9f64a0c&page=queryresults
[0m23:59:23.611375 [info ] [Thread-1 (]: 1 of 8 PASS accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.33s]
[0m23:59:23.611879 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f
[0m23:59:23.612146 [debug] [Thread-1 (]: Began running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:59:23.612412 [info ] [Thread-1 (]: 2 of 8 START test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [RUN]
[0m23:59:23.612698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.accepted_values_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.1fcbdd474f, now test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921)
[0m23:59:23.612910 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:59:23.623404 [debug] [Thread-1 (]: Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:59:23.623780 [error] [Thread-1 (]: 2 of 8 ERROR greater_than_mart_cohort_retention_analysis_monthly_total_customers__0  [[31mERROR[0m in 0.01s]
[0m23:59:23.624056 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921
[0m23:59:23.624256 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:59:23.624760 [info ] [Thread-1 (]: 3 of 8 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m23:59:23.624975 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.greater_than_mart_cohort_retention_analysis_monthly_total_customers__0.b7d3d47921, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m23:59:23.625137 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:59:23.630717 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:59:23.631549 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:59:23.635502 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m23:59:23.636203 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:23.707896 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m23:59:24.269988 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:4887e6f0-28b7-4f28-8b00-aa566b516c89&page=queryresults
[0m23:59:24.987658 [info ] [Thread-1 (]: 3 of 8 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.36s]
[0m23:59:24.988133 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m23:59:24.988383 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:59:24.988642 [info ] [Thread-1 (]: 4 of 8 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m23:59:24.988948 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m23:59:24.989173 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:59:24.992007 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:59:24.992687 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:59:24.994291 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m23:59:24.994817 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:25.103915 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m23:59:25.839752 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:11c9ef79-3087-4d7b-8c0c-83b4621b4620&page=queryresults
[0m23:59:26.166560 [info ] [Thread-1 (]: 4 of 8 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 1.18s]
[0m23:59:26.167455 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m23:59:26.167936 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:59:26.168429 [info ] [Thread-1 (]: 5 of 8 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m23:59:26.169016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m23:59:26.169453 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:59:26.175125 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:59:26.176210 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:59:26.179133 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m23:59:26.179821 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:26.264230 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m23:59:26.759116 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:aab50d3f-8085-47d9-a92b-b49c9d919e08&page=queryresults
[0m23:59:27.107768 [info ] [Thread-1 (]: 5 of 8 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 0.94s]
[0m23:59:27.108800 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m23:59:27.109363 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:59:27.109961 [info ] [Thread-1 (]: 6 of 8 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m23:59:27.110665 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m23:59:27.111194 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:59:27.119354 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:59:27.120517 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:59:27.126218 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m23:59:27.127006 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:27.214974 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m23:59:27.936438 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:cc7893a8-1a32-4c79-935f-ce764b65e4e7&page=queryresults
[0m23:59:28.271530 [info ] [Thread-1 (]: 6 of 8 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.16s]
[0m23:59:28.273477 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m23:59:28.274317 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:59:28.274995 [info ] [Thread-1 (]: 7 of 8 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m23:59:28.275637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m23:59:28.276592 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:59:28.285340 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:59:28.286637 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:59:28.290071 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m23:59:28.290838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:28.382877 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m23:59:28.855469 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c6fa85cb-d7d3-4e44-ad9f-480c521cd4e0&page=queryresults
[0m23:59:29.190573 [info ] [Thread-1 (]: 7 of 8 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 0.91s]
[0m23:59:29.192042 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m23:59:29.193059 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:59:29.193970 [info ] [Thread-1 (]: 8 of 8 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m23:59:29.194971 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m23:59:29.195776 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:59:29.202524 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:59:29.203223 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:59:29.205169 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m23:59:29.205620 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:29.301001 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m23:59:30.038613 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bb887c3a-837b-4484-8c74-85cf6ce266fc&page=queryresults
[0m23:59:30.353024 [info ] [Thread-1 (]: 8 of 8 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.16s]
[0m23:59:30.354595 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m23:59:30.356775 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:59:30.357291 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m23:59:30.357793 [info ] [MainThread]: 
[0m23:59:30.358410 [info ] [MainThread]: Finished running 8 data tests in 0 hours 0 minutes and 9.60 seconds (9.60s).
[0m23:59:30.361490 [debug] [MainThread]: Command end result
[0m23:59:30.406385 [info ] [MainThread]: 
[0m23:59:30.406758 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:59:30.406983 [info ] [MainThread]: 
[0m23:59:30.407263 [error] [MainThread]:   Compilation Error in test greater_than_mart_cohort_retention_analysis_monthly_total_customers__0 (models/marts/mart_cohort_retention_analysis_monthly.yml)
  'test_greater_than' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m23:59:30.407482 [info ] [MainThread]: 
[0m23:59:30.407697 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m23:59:30.409950 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 10.741675, "process_user_time": 3.823873, "process_kernel_time": 0.376615, "process_mem_max_rss": "206815232", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:59:30.410407 [debug] [MainThread]: Command `dbt test` failed at 23:59:30.410333 after 10.74 seconds
[0m23:59:30.410697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10227ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d5aa480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d5abdd0>]}
[0m23:59:30.410949 [debug] [MainThread]: Flushing usage events
[0m00:07:14.955437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10640cc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066fa990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b6ab0>]}


============================== 00:07:14.958051 | 1a2ff203-0297-4ee8-a7f8-b5d31e0f62ec ==============================
[0m00:07:14.958051 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:07:14.958370 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m00:07:15.801185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a2ff203-0297-4ee8-a7f8-b5d31e0f62ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e84d070>]}
[0m00:07:15.825105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a2ff203-0297-4ee8-a7f8-b5d31e0f62ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fb17b90>]}
[0m00:07:15.825417 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:07:15.847117 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:07:15.947263 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m00:07:15.947711 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m00:07:15.947953 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis_monthly.yml
[0m00:07:16.092052 [error] [MainThread]: Encountered an error:
Parsing Error
  Invalid test config given in models/marts/mart_customer_retention_metrics.yml:
  	test definition dictionary must have exactly one key, got [('dbt_expectations.expect_column_values_to_be_in_set', None), ('value_set', ['US', 'CA', 'GB', 'DE', 'FR', 'AU', 'UK', 'BR'])] instead (2 keys)
  	@: UnparsedModelUpdate(original_file_path='mode...ne)
[0m00:07:16.095082 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.1710225, "process_user_time": 2.879664, "process_kernel_time": 0.346086, "process_mem_max_rss": "203866112", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:07:16.095417 [debug] [MainThread]: Command `dbt test` failed at 00:07:16.095363 after 1.17 seconds
[0m00:07:16.095620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102caeae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123cb6870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123bdf020>]}
[0m00:07:16.095791 [debug] [MainThread]: Flushing usage events
[0m00:07:28.415881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10536a960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f76f30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f76c00>]}


============================== 00:07:28.418657 | 7cbadd1d-7834-41a9-a48d-9888105b0428 ==============================
[0m00:07:28.418657 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:07:28.419034 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:07:29.231561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7cbadd1d-7834-41a9-a48d-9888105b0428', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ff4d910>]}
[0m00:07:29.255781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7cbadd1d-7834-41a9-a48d-9888105b0428', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048819d0>]}
[0m00:07:29.256093 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:07:29.278159 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:07:29.383788 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m00:07:29.384274 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_cohort_retention_analysis_monthly.yml
[0m00:07:29.384557 [debug] [MainThread]: Partial parsing: updated file: manual_pasfield://models/marts/mart_customer_retention_metrics.yml
[0m00:07:29.570701 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:07:29.577413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7cbadd1d-7834-41a9-a48d-9888105b0428', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e72dca0>]}
[0m00:07:29.693426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7cbadd1d-7834-41a9-a48d-9888105b0428', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e7a6270>]}
[0m00:07:29.693737 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:07:29.693915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7cbadd1d-7834-41a9-a48d-9888105b0428', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f0e1340>]}
[0m00:07:29.695014 [info ] [MainThread]: 
[0m00:07:29.695311 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:07:29.697360 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_ref'
[0m00:07:29.697587 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:07:30.135041 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m00:07:30.136562 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:07:30.952303 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m00:07:30.954538 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:07:31.546021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7cbadd1d-7834-41a9-a48d-9888105b0428', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104881ca0>]}
[0m00:07:31.547358 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m00:07:31.547961 [info ] [MainThread]: 
[0m00:07:31.552841 [debug] [Thread-1 (]: Began running node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:07:31.553873 [info ] [Thread-1 (]: 1 of 7 START test dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m00:07:31.554864 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668)
[0m00:07:31.555480 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:07:31.572444 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"
[0m00:07:31.573965 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:07:31.594382 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"
[0m00:07:31.595099 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:31.682645 [debug] [Thread-1 (]: On test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with all_values as (

    select
        customer_country as value_field

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    

),
set_values as (

    select
        cast('US' as string) as value_field
    union all
    select
        cast('CA' as string) as value_field
    union all
    select
        cast('GB' as string) as value_field
    union all
    select
        cast('DE' as string) as value_field
    union all
    select
        cast('FR' as string) as value_field
    union all
    select
        cast('AU' as string) as value_field
    union all
    select
        cast('UK' as string) as value_field
    union all
    select
        cast('BR' as string) as value_field
    
    
),
validation_errors as (
    -- values from the model that are not in the set
    select
        v.value_field
    from
        all_values v
        left join
        set_values s on v.value_field = s.value_field
    where
        s.value_field is null

)

select *
from validation_errors


      
    ) dbt_internal_test
[0m00:07:32.681221 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:318cf196-9203-4e05-8662-1bf75b022774&page=queryresults
[0m00:07:33.252165 [info ] [Thread-1 (]: 1 of 7 PASS dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.70s]
[0m00:07:33.253317 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:07:33.253949 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:07:33.254613 [info ] [Thread-1 (]: 2 of 7 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m00:07:33.255372 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m00:07:33.255945 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:07:33.266847 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m00:07:33.269106 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:07:33.272596 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m00:07:33.273423 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:33.359638 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m00:07:33.899044 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e5227d35-1430-4b2c-97a8-c2f15324b416&page=queryresults
[0m00:07:34.426402 [info ] [Thread-1 (]: 2 of 7 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.17s]
[0m00:07:34.428123 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:07:34.428894 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:07:34.429667 [info ] [Thread-1 (]: 3 of 7 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m00:07:34.430330 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m00:07:34.431356 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:07:34.439268 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m00:07:34.441249 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:07:34.443260 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m00:07:34.443728 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:34.534609 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m00:07:34.949411 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:5494ed8c-2138-49b3-a344-808251bf0e59&page=queryresults
[0m00:07:35.344084 [info ] [Thread-1 (]: 3 of 7 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 0.91s]
[0m00:07:35.346232 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:07:35.347068 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:07:35.347880 [info ] [Thread-1 (]: 4 of 7 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m00:07:35.348878 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m00:07:35.349434 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:07:35.358782 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m00:07:35.359577 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:07:35.361980 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m00:07:35.362702 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:35.454338 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m00:07:36.008542 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b2500220-9024-4dbc-822d-9cacab97a22e&page=queryresults
[0m00:07:36.393253 [info ] [Thread-1 (]: 4 of 7 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.04s]
[0m00:07:36.393731 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:07:36.393990 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:07:36.394276 [info ] [Thread-1 (]: 5 of 7 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m00:07:36.394621 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m00:07:36.394861 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:07:36.398048 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m00:07:36.398597 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:07:36.400380 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m00:07:36.400799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:36.470018 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m00:07:37.266373 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0cea86cc-e99d-4820-8594-d9ae3c1cfe33&page=queryresults
[0m00:07:37.678917 [info ] [Thread-1 (]: 5 of 7 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.28s]
[0m00:07:37.680857 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:07:37.681678 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:07:37.682452 [info ] [Thread-1 (]: 6 of 7 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m00:07:37.683886 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m00:07:37.684646 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:07:37.692985 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m00:07:37.694357 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:07:37.697971 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m00:07:37.698753 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:37.790324 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m00:07:38.327885 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0fddc5d3-f5cf-469f-a570-d1853465e943&page=queryresults
[0m00:07:38.774715 [info ] [Thread-1 (]: 6 of 7 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.09s]
[0m00:07:38.776418 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:07:38.777256 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:07:38.778429 [info ] [Thread-1 (]: 7 of 7 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m00:07:38.779437 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m00:07:38.779990 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:07:38.787526 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m00:07:38.789564 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:07:38.793766 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m00:07:38.794468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:07:38.883633 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m00:07:39.864790 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3da18d2a-a813-4498-bed6-36704779f9c6&page=queryresults
[0m00:07:40.316193 [info ] [Thread-1 (]: 7 of 7 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.54s]
[0m00:07:40.317943 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:07:40.320147 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:07:40.320634 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m00:07:40.321063 [info ] [MainThread]: 
[0m00:07:40.321687 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 10.63 seconds (10.63s).
[0m00:07:40.324771 [debug] [MainThread]: Command end result
[0m00:07:40.369668 [info ] [MainThread]: 
[0m00:07:40.370052 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:07:40.370282 [info ] [MainThread]: 
[0m00:07:40.370512 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m00:07:40.372748 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 11.98638, "process_user_time": 4.342177, "process_kernel_time": 0.407316, "process_mem_max_rss": "211599360", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:07:40.373150 [debug] [MainThread]: Command `dbt test` succeeded at 00:07:40.373082 after 11.99 seconds
[0m00:07:40.373417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b74530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102276b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12e40bb60>]}
[0m00:07:40.373675 [debug] [MainThread]: Flushing usage events
[0m00:08:08.919739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101c6b0b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb7020>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb6cc0>]}


============================== 00:08:08.922406 | 561bc3f0-7e75-4b0e-9630-14d1347d3d3a ==============================
[0m00:08:08.922406 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:08:08.922721 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:08:09.778840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '561bc3f0-7e75-4b0e-9630-14d1347d3d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c4af0e0>]}
[0m00:08:09.802872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '561bc3f0-7e75-4b0e-9630-14d1347d3d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c1a5370>]}
[0m00:08:09.803185 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:08:09.825452 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:08:09.925230 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:08:09.925538 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:08:09.928336 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:08:09.951856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '561bc3f0-7e75-4b0e-9630-14d1347d3d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c823350>]}
[0m00:08:09.963113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '561bc3f0-7e75-4b0e-9630-14d1347d3d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ca45850>]}
[0m00:08:09.963619 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:08:09.963790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '561bc3f0-7e75-4b0e-9630-14d1347d3d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c4ae870>]}
[0m00:08:09.964874 [info ] [MainThread]: 
[0m00:08:09.965155 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:08:09.967049 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_mart'
[0m00:08:09.967263 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:08:10.315148 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m00:08:10.318024 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:08:10.856012 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m00:08:10.858012 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:08:11.369934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '561bc3f0-7e75-4b0e-9630-14d1347d3d3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c8fb650>]}
[0m00:08:11.371300 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m00:08:11.371779 [info ] [MainThread]: 
[0m00:08:11.376777 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m00:08:11.377610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now model.manual_pasfield.ref_acq_orders)
[0m00:08:11.378140 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m00:08:11.389566 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m00:08:11.391396 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m00:08:11.391852 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m00:08:11.392073 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m00:08:11.392334 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m00:08:11.392558 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m00:08:11.394270 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m00:08:11.394746 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m00:08:11.395087 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m00:08:11.395280 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m00:08:11.395484 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m00:08:11.395647 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m00:08:11.397549 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m00:08:11.398102 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m00:08:11.398668 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m00:08:11.399026 [debug] [Thread-1 (]: Began running node seed.manual_pasfield.customer_names
[0m00:08:11.399375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now seed.manual_pasfield.customer_names)
[0m00:08:11.399672 [debug] [Thread-1 (]: Began compiling node seed.manual_pasfield.customer_names
[0m00:08:11.401904 [debug] [Thread-1 (]: Began executing node seed.manual_pasfield.customer_names
[0m00:08:11.402463 [debug] [Thread-1 (]: Finished running node seed.manual_pasfield.customer_names
[0m00:08:11.403039 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m00:08:11.403465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.manual_pasfield.customer_names, now model.manual_pasfield.prep_customer)
[0m00:08:11.403801 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m00:08:11.414156 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m00:08:11.414886 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m00:08:11.415461 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m00:08:11.416086 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:08:11.416424 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m00:08:11.416709 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:08:11.421065 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m00:08:11.421858 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:08:11.422339 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:08:11.422611 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:08:11.422895 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m00:08:11.423176 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:08:11.425798 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m00:08:11.426461 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:08:11.426893 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:08:11.427141 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m00:08:11.427462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m00:08:11.427734 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m00:08:11.429837 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m00:08:11.430317 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m00:08:11.430732 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m00:08:11.431004 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:08:11.431270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_retention_metrics, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m00:08:11.431560 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:08:11.439624 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m00:08:11.440139 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:08:11.440551 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:08:11.440790 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:08:11.441029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m00:08:11.441226 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:08:11.443741 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m00:08:11.444099 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:08:11.444435 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:08:11.444648 [debug] [Thread-1 (]: Began running node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:08:11.444855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668)
[0m00:08:11.445044 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:08:11.452799 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"
[0m00:08:11.453187 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:08:11.453520 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:08:11.453721 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:08:11.453929 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m00:08:11.454123 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:08:11.457230 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m00:08:11.457581 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:08:11.457903 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:08:11.458101 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:08:11.458294 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m00:08:11.458463 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:08:11.460664 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m00:08:11.460970 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:08:11.461259 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:08:11.461437 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:08:11.461610 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m00:08:11.461768 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:08:11.463759 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m00:08:11.464060 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:08:11.464352 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:08:11.464534 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:08:11.464711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m00:08:11.464865 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:08:11.466900 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m00:08:11.467204 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:08:11.467491 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:08:11.467900 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:08:11.468039 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m00:08:11.469049 [debug] [MainThread]: Command end result
[0m00:08:11.526774 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m00:08:11.526991 [info ] [MainThread]: Building catalog
[0m00:08:11.529570 [debug] [ThreadPool]: Acquiring new bigquery connection 'manual-pasfield.information_schema'
[0m00:08:11.579868 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:08:11.644967 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_ref`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_activity')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_acq_orders')
                            ) or (
                                upper(table_schema) = upper('manual_test_ref')
                            and upper(table_name) = upper('ref_customers')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_ref`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m00:08:12.175176 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:49fe3859-e74a-40e4-a263-f5ddc057181c&page=queryresults
[0m00:08:13.549532 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:08:13.647734 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test_mart`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_cohort_retention_analysis_monthly')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_metrics_monthly')
                            ) or (
                                upper(table_schema) = upper('manual_test_mart')
                            and upper(table_name) = upper('mart_customer_retention_metrics')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test_mart`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m00:08:14.142418 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b246b121-689d-42cb-9c5c-5559d1efca47&page=queryresults
[0m00:08:16.048491 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:08:16.140900 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual`.__TABLES__ tables
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('customers')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('activity')
                            ) or (
                                upper(table_schema) = upper('manual')
                            and upper(table_name) = upper('acq_orders')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m00:08:16.895305 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b3c95a8c-122c-4b6c-83bf-9672076d5b3d&page=queryresults
[0m00:08:18.342814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:08:18.442578 [debug] [ThreadPool]: On manual-pasfield.information_schema: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "connection_name": "manual-pasfield.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `manual-pasfield`.`manual_test`.__TABLES__ tables
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('manual_test')
                            and upper(table_name) = upper('customer_names')
                            ) or (
                                upper(table_schema) = upper('manual_test')
                            and upper(table_name) = upper('prep_customer')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMNS columns
    join `manual-pasfield`.`manual_test`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m00:08:18.990085 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:c0b75a8d-8d7e-488c-a6dc-1c20da9da1b1&page=queryresults
[0m00:08:20.506978 [info ] [MainThread]: Catalog written to /Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/target/catalog.json
[0m00:08:20.509227 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 11.62133, "process_user_time": 3.917587, "process_kernel_time": 0.357198, "process_mem_max_rss": "203948032", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:08:20.509611 [debug] [MainThread]: Command `dbt docs generate` succeeded at 00:08:20.509555 after 11.62 seconds
[0m00:08:20.509794 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m00:08:20.509937 [debug] [MainThread]: Connection 'manual-pasfield.information_schema' was properly closed.
[0m00:08:20.510105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046d78f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bfbbef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c2060c0>]}
[0m00:08:20.510294 [debug] [MainThread]: Flushing usage events
[0m00:08:28.354304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104400a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107126f00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107126cc0>]}


============================== 00:08:28.356788 | 827fc3b0-e3a9-49e3-a40c-3571fa302225 ==============================
[0m00:08:28.356788 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:08:28.357105 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/Analytics Engineering/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt docs serve --port 8080', 'send_anonymous_usage_stats': 'True'}
[0m00:08:28.907612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '827fc3b0-e3a9-49e3-a40c-3571fa302225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144242480>]}
[0m00:08:28.932021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '827fc3b0-e3a9-49e3-a40c-3571fa302225', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1438e50d0>]}
[0m00:15:02.758118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041b6b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041fef90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041fed20>]}


============================== 00:15:02.760849 | b50e59f6-32ea-4706-96f8-745ff8f5ab55 ==============================
[0m00:15:02.760849 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:15:02.761225 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/MANUAL - AE Test/manual-pasfield', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/Edward/Documents/ManualTest/MANUAL - AE Test/manual-pasfield/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:15:03.635663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b50e59f6-32ea-4706-96f8-745ff8f5ab55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041e1910>]}
[0m00:15:03.659758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b50e59f6-32ea-4706-96f8-745ff8f5ab55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c2859d0>]}
[0m00:15:03.660076 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:15:03.680795 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:15:03.779356 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:15:03.779597 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:15:03.782161 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:15:03.805290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b50e59f6-32ea-4706-96f8-745ff8f5ab55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c2e1dc0>]}
[0m00:15:03.867306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b50e59f6-32ea-4706-96f8-745ff8f5ab55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c4b19a0>]}
[0m00:15:03.867612 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:15:03.867776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b50e59f6-32ea-4706-96f8-745ff8f5ab55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c7134a0>]}
[0m00:15:03.868761 [info ] [MainThread]: 
[0m00:15:03.869059 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:15:03.870942 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m00:15:03.871152 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:03.871371 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/ManualTest/Analytics Engineering/sa.json''
[0m00:15:03.871604 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:15:03.871814 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/ManualTest/Analytics Engineering/sa.json''
[0m00:15:03.872088 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:15:03.872243 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/ManualTest/Analytics Engineering/sa.json''
[0m00:15:03.872557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:03.872672 [debug] [MainThread]: Connection 'list_manual-pasfield' was properly closed.
[0m00:15:03.872791 [info ] [MainThread]: 
[0m00:15:03.872930 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.00 seconds (0.00s).
[0m00:15:03.873983 [error] [MainThread]: Encountered an error:
Database Error
  [Errno 2] No such file or directory: '/Users/Edward/Documents/ManualTest/Analytics Engineering/sa.json'
[0m00:15:03.876105 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.1495874, "process_user_time": 2.5074, "process_kernel_time": 0.498299, "process_mem_max_rss": "199000064", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:15:03.876511 [debug] [MainThread]: Command `dbt run` failed at 00:15:03.876459 after 1.15 seconds
[0m00:15:03.876711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041b6b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c713a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c061e50>]}
[0m00:15:03.876880 [debug] [MainThread]: Flushing usage events
[0m00:15:41.460694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072d6870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076eaff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076eadb0>]}


============================== 00:15:41.463566 | bb9b3e54-8693-409e-bdfe-a1eb6c73f961 ==============================
[0m00:15:41.463566 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:15:41.463921 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/ManualTest/MANUAL - AE Test/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/ManualTest/MANUAL - AE Test/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:15:42.256989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb9b3e54-8693-409e-bdfe-a1eb6c73f961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f4280b0>]}
[0m00:15:42.281123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb9b3e54-8693-409e-bdfe-a1eb6c73f961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f2430b0>]}
[0m00:15:42.281433 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:15:42.303533 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:15:42.400335 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:15:42.400594 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:15:42.403343 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:15:42.426753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb9b3e54-8693-409e-bdfe-a1eb6c73f961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f8598b0>]}
[0m00:15:42.487541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb9b3e54-8693-409e-bdfe-a1eb6c73f961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f940ec0>]}
[0m00:15:42.487833 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:15:42.487999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb9b3e54-8693-409e-bdfe-a1eb6c73f961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f7e4d40>]}
[0m00:15:42.488996 [info ] [MainThread]: 
[0m00:15:42.489295 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:15:42.491216 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m00:15:42.491476 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:15:42.491745 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL - AE TEST/Analytics Engineering/sa.json''
[0m00:15:42.492001 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:15:42.492182 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL - AE TEST/Analytics Engineering/sa.json''
[0m00:15:42.492399 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:15:42.492543 [debug] [ThreadPool]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL - AE TEST/Analytics Engineering/sa.json''
[0m00:15:42.492852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:15:42.493000 [debug] [MainThread]: Connection 'list_manual-pasfield' was properly closed.
[0m00:15:42.493130 [info ] [MainThread]: 
[0m00:15:42.493277 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.00 seconds (0.00s).
[0m00:15:42.494277 [error] [MainThread]: Encountered an error:
Database Error
  [Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL - AE TEST/Analytics Engineering/sa.json'
[0m00:15:42.496394 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.0688816, "process_user_time": 2.850049, "process_kernel_time": 0.318274, "process_mem_max_rss": "198213632", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:15:42.496791 [debug] [MainThread]: Command `dbt run` failed at 00:15:42.496740 after 1.07 seconds
[0m00:15:42.497006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076eadb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f2f9ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f7cbf50>]}
[0m00:15:42.497185 [debug] [MainThread]: Flushing usage events
[0m00:16:07.912030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050827b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068dede0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068dea80>]}


============================== 00:16:07.914542 | 997e44d2-be14-4f68-b14b-7f5f1004760d ==============================
[0m00:16:07.914542 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:16:07.914848 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/ManualTest/MANUAL - AE Test/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/ManualTest/MANUAL - AE Test/manual-pasfield/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m00:16:08.654163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126ea5e50>]}
[0m00:16:08.678563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ca7aa0>]}
[0m00:16:08.678862 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:16:08.701344 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:16:08.793784 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:16:08.794028 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:16:08.796620 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:16:08.819387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127acb3b0>]}
[0m00:16:08.878824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c38e60>]}
[0m00:16:08.879110 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:16:08.879275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127ea4830>]}
[0m00:16:08.880291 [info ] [MainThread]: 
[0m00:16:08.880571 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:16:08.882495 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m00:16:08.882714 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:16:09.254494 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:16:09.574196 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:16:09.931017 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m00:16:09.932246 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:16:10.288216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m00:16:10.290096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:16:10.625451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m00:16:10.626678 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:16:10.985067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127e8ede0>]}
[0m00:16:10.986389 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m00:16:10.987119 [info ] [MainThread]: 
[0m00:16:10.992359 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m00:16:10.993370 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m00:16:10.994271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m00:16:10.994815 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m00:16:11.004824 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m00:16:11.005919 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m00:16:11.017418 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:11.360642 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m00:16:11.361351 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m00:16:11.757348 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:b467799e-c970-4932-a5ec-5cf7fd197df5&page=queryresults
[0m00:16:14.425047 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1268a3080>]}
[0m00:16:14.425919 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 3.43s]
[0m00:16:14.426642 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m00:16:14.427117 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m00:16:14.427732 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m00:16:14.428302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m00:16:14.428726 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m00:16:14.432129 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m00:16:14.433024 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m00:16:14.435989 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:14.749873 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m00:16:14.752133 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m00:16:15.025410 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:658e92cf-e27e-4675-b006-5a5819d660f6&page=queryresults
[0m00:16:19.136042 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1268a3080>]}
[0m00:16:19.137623 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.71s]
[0m00:16:19.138678 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m00:16:19.139262 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m00:16:19.140023 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m00:16:19.140789 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m00:16:19.141305 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m00:16:19.146345 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m00:16:19.147646 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m00:16:19.151679 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:19.499840 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m00:16:19.502290 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m00:16:19.911670 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:10fbd019-376f-4cce-ae2c-d02d0bf0b3c1&page=queryresults
[0m00:16:23.421790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127fcfd10>]}
[0m00:16:23.422734 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 4.28s]
[0m00:16:23.423559 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m00:16:23.424563 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m00:16:23.425445 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m00:16:23.426163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m00:16:23.426755 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m00:16:23.440417 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m00:16:23.441114 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m00:16:23.457163 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m00:16:23.457909 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:23.535188 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
    distinct
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        -- Could be fixed with a mapping seed if I had more time :) 
        -- Little bit of data cleansing
        case 
            when customers.customer_country = "United Kingdom" then "UK"
            when customers.customer_country = "Brazil" then "BR"
        end as customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    
)

-- FINAL CTE
select * from final;


[0m00:16:24.037714 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:06864265-6765-45d7-8e53-72f6532dba40&page=queryresults
[0m00:16:24.223732 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127fd6600>]}
[0m00:16:24.225674 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 0.80s]
[0m00:16:24.227243 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m00:16:24.228490 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:16:24.229246 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m00:16:24.229947 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m00:16:24.230468 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:16:24.236046 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m00:16:24.238077 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:16:24.240323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:24.605169 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:16:25.779989 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:fb3ed0dc-9103-4eee-a4f2-101614441583&page=queryresults
[0m00:16:25.929382 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:16:26.284283 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:bd5ba13d-2f96-43eb-8f51-b9c1c71b2cbc&page=queryresults
[0m00:16:26.447723 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m00:16:26.449162 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m00:16:26.874904 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:19b6bbbb-e75e-4bb4-80a9-60c000b043af&page=queryresults
[0m00:16:56.606845 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x140106c00>]}
[0m00:16:56.607502 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 32.38s]
[0m00:16:56.608453 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:16:56.608742 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:16:56.609049 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m00:16:56.609314 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m00:16:56.609507 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:16:56.664875 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m00:16:56.665579 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:16:56.667125 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:16:57.000750 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:16:57.725840 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:207be3c8-648f-46ae-b6f4-8d0a38f9df04&page=queryresults
[0m00:16:57.870181 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:16:58.242736 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:717dc27d-4b61-45eb-a945-7379d0a309ea&page=queryresults
[0m00:16:58.359038 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m00:16:58.360745 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m00:16:58.851955 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:6f2ff5d4-6d2f-4f6e-a2dd-474bfdd78fa3&page=queryresults
[0m00:17:29.591934 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127f27e60>]}
[0m00:17:29.594713 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 32.98s]
[0m00:17:29.596160 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:17:29.596790 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m00:17:29.597597 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m00:17:29.598386 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m00:17:29.598913 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m00:17:29.604531 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m00:17:29.605939 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m00:17:29.609633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:17:29.941967 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:17:30.494670 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:7529dd46-2861-4808-a03d-7a341add5ae5&page=queryresults
[0m00:17:30.608702 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:17:30.979146 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:11208e9f-5508-4e63-9b5d-517d3235d720&page=queryresults
[0m00:17:31.095936 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m00:17:31.098731 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m00:17:31.827616 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:27b38f24-97d7-4b3f-9ebc-909ecdce56e2&page=queryresults
[0m00:18:00.601317 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '997e44d2-be14-4f68-b14b-7f5f1004760d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127fb93d0>]}
[0m00:18:00.604066 [info ] [Thread-1 (]: 7 of 7 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (103.3m rows, 88.0 MiB processed)[0m in 31.00s]
[0m00:18:00.605289 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m00:18:00.606831 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:18:00.607255 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m00:18:00.607738 [info ] [MainThread]: 
[0m00:18:00.608161 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 1 minutes and 51.73 seconds (111.73s).
[0m00:18:00.610404 [debug] [MainThread]: Command end result
[0m00:18:00.657810 [info ] [MainThread]: 
[0m00:18:00.658164 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:18:00.658379 [info ] [MainThread]: 
[0m00:18:00.658593 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m00:18:00.660863 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 112.77773, "process_user_time": 4.717708, "process_kernel_time": 0.422176, "process_mem_max_rss": "204406784", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:18:00.661283 [debug] [MainThread]: Command `dbt run` succeeded at 00:18:00.661213 after 112.78 seconds
[0m00:18:00.661541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069fc950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127c11430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12799d460>]}
[0m00:18:00.661771 [debug] [MainThread]: Flushing usage events
[0m00:27:51.162443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ea0ce0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106916d20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069169c0>]}


============================== 00:27:51.165714 | 9c8bc3ea-bce2-4bcf-afe8-61e2df52c597 ==============================
[0m00:27:51.165714 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:27:51.166089 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:27:51.175395 [info ] [MainThread]: dbt version: 1.8.5
[0m00:27:51.175654 [info ] [MainThread]: python version: 3.12.5
[0m00:27:51.175795 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m00:27:51.175922 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m00:27:52.017689 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/MANUAL-AE/manual-pasfield
[0m00:27:52.017993 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/profiles.yml
[0m00:27:52.018213 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/dbt_project.yml
[0m00:27:52.018382 [info ] [MainThread]: adapter type: bigquery
[0m00:27:52.018546 [info ] [MainThread]: adapter version: 1.8.2
[0m00:27:52.063960 [info ] [MainThread]: Configuration:
[0m00:27:52.064228 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:27:52.064374 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:27:52.064503 [info ] [MainThread]: Required dependencies:
[0m00:27:52.064698 [debug] [MainThread]: Executing "git --help"
[0m00:27:52.091156 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:27:52.091722 [debug] [MainThread]: STDERR: "b''"
[0m00:27:52.091948 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:27:52.092170 [info ] [MainThread]: Connection:
[0m00:27:52.092412 [info ] [MainThread]:   method: service-account
[0m00:27:52.092582 [info ] [MainThread]:   database: manual-pasfield
[0m00:27:52.092707 [info ] [MainThread]:   execution_project: manual-pasfield
[0m00:27:52.092819 [info ] [MainThread]:   schema: manual_test
[0m00:27:52.092933 [info ] [MainThread]:   location: EU
[0m00:27:52.093044 [info ] [MainThread]:   priority: None
[0m00:27:52.093158 [info ] [MainThread]:   maximum_bytes_billed: None
[0m00:27:52.093271 [info ] [MainThread]:   impersonate_service_account: None
[0m00:27:52.093380 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m00:27:52.093494 [info ] [MainThread]:   job_retries: 1
[0m00:27:52.093605 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m00:27:52.093718 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m00:27:52.093827 [info ] [MainThread]:   timeout_seconds: None
[0m00:27:52.093939 [info ] [MainThread]:   client_id: None
[0m00:27:52.094048 [info ] [MainThread]:   token_uri: None
[0m00:27:52.094158 [info ] [MainThread]:   dataproc_region: None
[0m00:27:52.094266 [info ] [MainThread]:   dataproc_cluster_name: None
[0m00:27:52.094373 [info ] [MainThread]:   gcs_bucket: None
[0m00:27:52.094482 [info ] [MainThread]:   dataproc_batch: None
[0m00:27:52.094956 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:27:52.100136 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m00:27:52.101046 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:27:52.102102 [debug] [MainThread]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/ManualTest/MANUAL-AE/sa.json''
[0m00:27:52.102413 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m00:27:52.102605 [info ] [MainThread]: [31m1 check failed:[0m
[0m00:27:52.102745 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  [Errno 2] No such file or directory: '/Users/Edward/Documents/ManualTest/MANUAL-AE/sa.json'

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m00:27:52.105333 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.9794354, "process_user_time": 2.711774, "process_kernel_time": 0.299954, "process_mem_max_rss": "193167360", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:27:52.105999 [debug] [MainThread]: Command `dbt debug` failed at 00:27:52.105862 after 0.98 seconds
[0m00:27:52.107202 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:27:52.108079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078ecb30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069dca70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f102bd0>]}
[0m00:27:52.109216 [debug] [MainThread]: Flushing usage events
[0m00:28:09.258796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10659b470>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a06b40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a067e0>]}


============================== 00:28:09.261431 | 7427be1c-ee37-49d2-b73d-047642328f58 ==============================
[0m00:28:09.261431 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:28:09.261740 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m00:28:09.267827 [info ] [MainThread]: dbt version: 1.8.5
[0m00:28:09.268013 [info ] [MainThread]: python version: 3.12.5
[0m00:28:09.268310 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m00:28:09.268492 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m00:28:10.022554 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/MANUAL-AE/manual-pasfield
[0m00:28:10.022830 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/profiles.yml
[0m00:28:10.022985 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/dbt_project.yml
[0m00:28:10.023122 [info ] [MainThread]: adapter type: bigquery
[0m00:28:10.023245 [info ] [MainThread]: adapter version: 1.8.2
[0m00:28:10.065992 [info ] [MainThread]: Configuration:
[0m00:28:10.066271 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:28:10.066420 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:28:10.066552 [info ] [MainThread]: Required dependencies:
[0m00:28:10.066755 [debug] [MainThread]: Executing "git --help"
[0m00:28:10.082730 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:28:10.083289 [debug] [MainThread]: STDERR: "b''"
[0m00:28:10.083479 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:28:10.083671 [info ] [MainThread]: Connection:
[0m00:28:10.083898 [info ] [MainThread]:   method: service-account
[0m00:28:10.084026 [info ] [MainThread]:   database: manual-pasfield
[0m00:28:10.084146 [info ] [MainThread]:   execution_project: manual-pasfield
[0m00:28:10.084264 [info ] [MainThread]:   schema: manual_test
[0m00:28:10.084381 [info ] [MainThread]:   location: EU
[0m00:28:10.084497 [info ] [MainThread]:   priority: None
[0m00:28:10.084613 [info ] [MainThread]:   maximum_bytes_billed: None
[0m00:28:10.084725 [info ] [MainThread]:   impersonate_service_account: None
[0m00:28:10.084838 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m00:28:10.084946 [info ] [MainThread]:   job_retries: 1
[0m00:28:10.085058 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m00:28:10.085170 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m00:28:10.085277 [info ] [MainThread]:   timeout_seconds: None
[0m00:28:10.085387 [info ] [MainThread]:   client_id: None
[0m00:28:10.085497 [info ] [MainThread]:   token_uri: None
[0m00:28:10.085608 [info ] [MainThread]:   dataproc_region: None
[0m00:28:10.085713 [info ] [MainThread]:   dataproc_cluster_name: None
[0m00:28:10.085824 [info ] [MainThread]:   gcs_bucket: None
[0m00:28:10.085930 [info ] [MainThread]:   dataproc_batch: None
[0m00:28:10.086278 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:28:10.091438 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m00:28:10.092356 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:28:10.092865 [debug] [MainThread]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL-AE/sa.json''
[0m00:28:10.093132 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m00:28:10.093427 [info ] [MainThread]: [31m1 check failed:[0m
[0m00:28:10.093638 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  [Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL-AE/sa.json'

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m00:28:10.096143 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.8664833, "process_user_time": 2.676518, "process_kernel_time": 0.303487, "process_mem_max_rss": "191709184", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:28:10.096600 [debug] [MainThread]: Command `dbt debug` failed at 00:28:10.096532 after 0.87 seconds
[0m00:28:10.096841 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:28:10.097039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e5eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed2fc20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079e33b0>]}
[0m00:28:10.097275 [debug] [MainThread]: Flushing usage events
[0m00:29:08.491244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c51010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1246eaba0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1246ea840>]}


============================== 00:29:08.493865 | ab936def-867f-4637-9713-673be73a746b ==============================
[0m00:29:08.493865 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:29:08.494175 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:29:08.501940 [info ] [MainThread]: dbt version: 1.8.5
[0m00:29:08.502205 [info ] [MainThread]: python version: 3.12.5
[0m00:29:08.502356 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m00:29:08.502489 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m00:29:09.281446 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/MANUAL-AE/manual-pasfield
[0m00:29:09.281724 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/profiles.yml
[0m00:29:09.281946 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/dbt_project.yml
[0m00:29:09.282112 [info ] [MainThread]: adapter type: bigquery
[0m00:29:09.282250 [info ] [MainThread]: adapter version: 1.8.2
[0m00:29:09.325611 [info ] [MainThread]: Configuration:
[0m00:29:09.325883 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:29:09.326028 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:29:09.326156 [info ] [MainThread]: Required dependencies:
[0m00:29:09.326358 [debug] [MainThread]: Executing "git --help"
[0m00:29:09.332667 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:29:09.333425 [debug] [MainThread]: STDERR: "b''"
[0m00:29:09.333646 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:29:09.333811 [info ] [MainThread]: Connection:
[0m00:29:09.334018 [info ] [MainThread]:   method: service-account
[0m00:29:09.334148 [info ] [MainThread]:   database: manual-pasfield
[0m00:29:09.334266 [info ] [MainThread]:   execution_project: manual-pasfield
[0m00:29:09.334385 [info ] [MainThread]:   schema: manual_test
[0m00:29:09.334500 [info ] [MainThread]:   location: EU
[0m00:29:09.334621 [info ] [MainThread]:   priority: None
[0m00:29:09.334741 [info ] [MainThread]:   maximum_bytes_billed: None
[0m00:29:09.334855 [info ] [MainThread]:   impersonate_service_account: None
[0m00:29:09.334967 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m00:29:09.335080 [info ] [MainThread]:   job_retries: 1
[0m00:29:09.335191 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m00:29:09.335334 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m00:29:09.335552 [info ] [MainThread]:   timeout_seconds: None
[0m00:29:09.335669 [info ] [MainThread]:   client_id: None
[0m00:29:09.335781 [info ] [MainThread]:   token_uri: None
[0m00:29:09.335927 [info ] [MainThread]:   dataproc_region: None
[0m00:29:09.336120 [info ] [MainThread]:   dataproc_cluster_name: None
[0m00:29:09.336237 [info ] [MainThread]:   gcs_bucket: None
[0m00:29:09.336356 [info ] [MainThread]:   dataproc_batch: None
[0m00:29:09.337036 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:29:09.342888 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m00:29:09.344016 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:29:09.348478 [debug] [MainThread]: BigQuery adapter: Got an error when attempting to create a bigquery client: '[Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL-AE/sa.json''
[0m00:29:09.349826 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m00:29:09.351183 [info ] [MainThread]: [31m1 check failed:[0m
[0m00:29:09.351397 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  [Errno 2] No such file or directory: '/Users/Edward/Documents/MANUAL-AE/sa.json'

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m00:29:09.355600 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.89388835, "process_user_time": 2.676298, "process_kernel_time": 0.317631, "process_mem_max_rss": "192348160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:29:09.356255 [debug] [MainThread]: Command `dbt debug` failed at 00:29:09.356161 after 0.89 seconds
[0m00:29:09.356650 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:29:09.356882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e69d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c51010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c51520>]}
[0m00:29:09.357175 [debug] [MainThread]: Flushing usage events
[0m00:29:19.666275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066ac0e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feac90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107feaa50>]}


============================== 00:29:19.668772 | 2f5903d7-3db2-4975-bad7-4ad6f9f0391f ==============================
[0m00:29:19.668772 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:29:19.669078 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:29:19.674792 [info ] [MainThread]: dbt version: 1.8.5
[0m00:29:19.674967 [info ] [MainThread]: python version: 3.12.5
[0m00:29:19.675338 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.12/bin/python3.12
[0m00:29:19.675523 [info ] [MainThread]: os info: macOS-13.0-arm64-arm-64bit
[0m00:29:20.309677 [info ] [MainThread]: Using profiles dir at /Users/Edward/Documents/MANUAL-AE/manual-pasfield
[0m00:29:20.309953 [info ] [MainThread]: Using profiles.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/profiles.yml
[0m00:29:20.310107 [info ] [MainThread]: Using dbt_project.yml file at /Users/Edward/Documents/MANUAL-AE/manual-pasfield/dbt_project.yml
[0m00:29:20.310243 [info ] [MainThread]: adapter type: bigquery
[0m00:29:20.310372 [info ] [MainThread]: adapter version: 1.8.2
[0m00:29:20.379435 [info ] [MainThread]: Configuration:
[0m00:29:20.379720 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m00:29:20.379866 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m00:29:20.379991 [info ] [MainThread]: Required dependencies:
[0m00:29:20.380206 [debug] [MainThread]: Executing "git --help"
[0m00:29:20.386101 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m00:29:20.386919 [debug] [MainThread]: STDERR: "b''"
[0m00:29:20.387208 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m00:29:20.387394 [info ] [MainThread]: Connection:
[0m00:29:20.387723 [info ] [MainThread]:   method: service-account
[0m00:29:20.387869 [info ] [MainThread]:   database: manual-pasfield
[0m00:29:20.388059 [info ] [MainThread]:   execution_project: manual-pasfield
[0m00:29:20.388268 [info ] [MainThread]:   schema: manual_test
[0m00:29:20.388411 [info ] [MainThread]:   location: EU
[0m00:29:20.388547 [info ] [MainThread]:   priority: None
[0m00:29:20.388673 [info ] [MainThread]:   maximum_bytes_billed: None
[0m00:29:20.388795 [info ] [MainThread]:   impersonate_service_account: None
[0m00:29:20.389103 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m00:29:20.389401 [info ] [MainThread]:   job_retries: 1
[0m00:29:20.389529 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m00:29:20.389762 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m00:29:20.389903 [info ] [MainThread]:   timeout_seconds: None
[0m00:29:20.390025 [info ] [MainThread]:   client_id: None
[0m00:29:20.390148 [info ] [MainThread]:   token_uri: None
[0m00:29:20.390258 [info ] [MainThread]:   dataproc_region: None
[0m00:29:20.390371 [info ] [MainThread]:   dataproc_cluster_name: None
[0m00:29:20.390480 [info ] [MainThread]:   gcs_bucket: None
[0m00:29:20.390590 [info ] [MainThread]:   dataproc_batch: None
[0m00:29:20.390990 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:29:20.396596 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m00:29:20.397442 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:29:20.473495 [debug] [MainThread]: On debug: select 1 as id
[0m00:29:20.943945 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9522ff58-f0fe-44d3-b9d5-166bb05cb7b9&page=queryresults
[0m00:29:21.202152 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m00:29:21.202963 [info ] [MainThread]: [32mAll checks passed![0m
[0m00:29:21.208507 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.571111, "process_user_time": 2.310462, "process_kernel_time": 0.215949, "process_mem_max_rss": "195379200", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:29:21.210092 [debug] [MainThread]: Command `dbt debug` succeeded at 00:29:21.209869 after 1.57 seconds
[0m00:29:21.211076 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m00:29:21.211861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795b830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144b99370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x144e54cb0>]}
[0m00:29:21.212570 [debug] [MainThread]: Flushing usage events
[0m00:29:27.777693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1038f6d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050eb080>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050ead20>]}


============================== 00:29:27.779801 | f091eaa2-9fc4-4f87-a33f-9fff04e70b47 ==============================
[0m00:29:27.779801 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:29:27.780123 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt seed', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:29:28.377584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126f02d50>]}
[0m00:29:28.404152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125caaea0>]}
[0m00:29:28.404609 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:29:28.432820 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:29:28.532032 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:29:28.532280 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:29:28.534931 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:29:28.558997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126fcf5f0>]}
[0m00:29:28.619786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14aadb5c0>]}
[0m00:29:28.620070 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:29:28.620234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14aca4170>]}
[0m00:29:28.621167 [info ] [MainThread]: 
[0m00:29:28.621461 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:29:28.621874 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m00:29:28.622057 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:29:28.971399 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test_ref)
[0m00:29:28.971912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:29.308899 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test)
[0m00:29:29.311451 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:29.641030 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_mart)
[0m00:29:29.644258 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:29.983955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14a8ff560>]}
[0m00:29:29.985085 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m00:29:29.985630 [info ] [MainThread]: 
[0m00:29:29.989509 [debug] [Thread-1 (]: Began running node seed.manual_pasfield.customer_names
[0m00:29:29.990302 [info ] [Thread-1 (]: 1 of 1 START seed file manual_test.customer_names .............................. [RUN]
[0m00:29:29.991172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now seed.manual_pasfield.customer_names)
[0m00:29:29.991841 [debug] [Thread-1 (]: Began compiling node seed.manual_pasfield.customer_names
[0m00:29:29.992324 [debug] [Thread-1 (]: Began executing node seed.manual_pasfield.customer_names
[0m00:29:30.021248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:29:33.209650 [debug] [Thread-1 (]: On seed.manual_pasfield.customer_names: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "seed.manual_pasfield.customer_names"} */

    alter table `manual-pasfield`.`manual_test`.`customer_names` set OPTIONS()
  
[0m00:29:33.536425 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:10788a2a-c1b5-4986-907e-63b5c724b3c3&page=queryresults
[0m00:29:33.742168 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.manual_pasfield.customer_names"
[0m00:29:33.762915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f091eaa2-9fc4-4f87-a33f-9fff04e70b47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031e1a00>]}
[0m00:29:33.763532 [info ] [Thread-1 (]: 1 of 1 OK loaded seed file manual_test.customer_names .......................... [[32mINSERT 52[0m in 3.77s]
[0m00:29:33.764139 [debug] [Thread-1 (]: Finished running node seed.manual_pasfield.customer_names
[0m00:29:33.765359 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:29:33.765700 [debug] [MainThread]: Connection 'seed.manual_pasfield.customer_names' was properly closed.
[0m00:29:33.765997 [info ] [MainThread]: 
[0m00:29:33.766303 [info ] [MainThread]: Finished running 1 seed in 0 hours 0 minutes and 5.14 seconds (5.14s).
[0m00:29:33.766945 [debug] [MainThread]: Command end result
[0m00:29:33.801960 [info ] [MainThread]: 
[0m00:29:33.802289 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:29:33.802478 [info ] [MainThread]: 
[0m00:29:33.802667 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m00:29:33.804865 [debug] [MainThread]: Resource report: {"command_name": "seed", "command_success": true, "command_wall_clock_time": 6.056462, "process_user_time": 3.28269, "process_kernel_time": 0.651695, "process_mem_max_rss": "206618624", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:29:33.805270 [debug] [MainThread]: Command `dbt seed` succeeded at 00:29:33.805212 after 6.06 seconds
[0m00:29:33.805493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10440baa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050a62d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1007eab10>]}
[0m00:29:33.805690 [debug] [MainThread]: Flushing usage events
[0m00:29:37.067356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045120c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10480afc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10480ac60>]}


============================== 00:29:37.070558 | b0a99144-375e-4f8f-99a9-c58152a43665 ==============================
[0m00:29:37.070558 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:29:37.070908 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'version_check': 'True', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:29:37.631749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d4a1e50>]}
[0m00:29:37.656149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf10f80>]}
[0m00:29:37.656502 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:29:37.675299 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:29:37.767199 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:29:37.767442 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:29:37.770082 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:29:37.793125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f751730>]}
[0m00:29:37.852123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103204b60>]}
[0m00:29:37.852405 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:29:37.852574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b674800>]}
[0m00:29:37.853576 [info ] [MainThread]: 
[0m00:29:37.853871 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:29:37.855797 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield'
[0m00:29:37.856021 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:29:38.166766 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:38.511077 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:38.870589 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield, now list_manual-pasfield_manual_test)
[0m00:29:38.871964 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:39.218003 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m00:29:39.223759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:39.558292 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now list_manual-pasfield_manual_test_mart)
[0m00:29:39.559225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:29:39.874100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f71ede0>]}
[0m00:29:39.874545 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m00:29:39.874792 [info ] [MainThread]: 
[0m00:29:39.877582 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_acq_orders
[0m00:29:39.877951 [info ] [Thread-1 (]: 1 of 7 START sql table model manual_test_ref.ref_acq_orders .................... [RUN]
[0m00:29:39.878231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now model.manual_pasfield.ref_acq_orders)
[0m00:29:39.878406 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_acq_orders
[0m00:29:39.884146 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_acq_orders"
[0m00:29:39.884769 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_acq_orders
[0m00:29:39.896572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:29:40.298097 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_acq_orders"
[0m00:29:40.298825 [debug] [Thread-1 (]: On model.manual_pasfield.ref_acq_orders: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_acq_orders"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`acq_orders`
    );
  
[0m00:29:40.602359 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:af6f5eb1-a5b7-439c-a91f-33a3198fbe9f&page=queryresults
[0m00:29:44.730518 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb22a80>]}
[0m00:29:44.731360 [info ] [Thread-1 (]: 1 of 7 OK created sql table model manual_test_ref.ref_acq_orders ............... [[32mCREATE TABLE (508.7k rows, 11.7 MiB processed)[0m in 4.85s]
[0m00:29:44.731808 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_acq_orders
[0m00:29:44.732091 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_activity
[0m00:29:44.732457 [info ] [Thread-1 (]: 2 of 7 START sql table model manual_test_ref.ref_activity ...................... [RUN]
[0m00:29:44.732801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_acq_orders, now model.manual_pasfield.ref_activity)
[0m00:29:44.733030 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_activity
[0m00:29:44.735049 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_activity"
[0m00:29:44.735563 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_activity
[0m00:29:44.737105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:29:45.065790 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_activity"
[0m00:29:45.066365 [debug] [Thread-1 (]: On model.manual_pasfield.ref_activity: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_activity"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_activity`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`activity`
    );
  
[0m00:29:45.455107 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d98a8ec2-bebb-4f51-88e7-85f024057efb&page=queryresults
[0m00:29:49.310093 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b2b0b90>]}
[0m00:29:49.310797 [info ] [Thread-1 (]: 2 of 7 OK created sql table model manual_test_ref.ref_activity ................. [[32mCREATE TABLE (2.2m rows, 66.4 MiB processed)[0m in 4.58s]
[0m00:29:49.311314 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_activity
[0m00:29:49.311657 [debug] [Thread-1 (]: Began running node model.manual_pasfield.ref_customers
[0m00:29:49.312113 [info ] [Thread-1 (]: 3 of 7 START sql table model manual_test_ref.ref_customers ..................... [RUN]
[0m00:29:49.312552 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_activity, now model.manual_pasfield.ref_customers)
[0m00:29:49.312875 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.ref_customers
[0m00:29:49.315898 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.ref_customers"
[0m00:29:49.317962 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.ref_customers
[0m00:29:49.320389 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:29:49.627529 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.ref_customers"
[0m00:29:49.628829 [debug] [Thread-1 (]: On model.manual_pasfield.ref_customers: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.ref_customers"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_ref`.`ref_customers`
      
    
    

    OPTIONS()
    as (
      select
    *
from `manual-pasfield`.`manual`.`customers`
    );
  
[0m00:29:50.121481 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:94612cf4-7076-4858-b8f7-94705af80b7c&page=queryresults
[0m00:29:52.677546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b47e3c0>]}
[0m00:29:52.679056 [info ] [Thread-1 (]: 3 of 7 OK created sql table model manual_test_ref.ref_customers ................ [[32mCREATE TABLE (532.8k rows, 9.9 MiB processed)[0m in 3.36s]
[0m00:29:52.680313 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.ref_customers
[0m00:29:52.681214 [debug] [Thread-1 (]: Began running node model.manual_pasfield.prep_customer
[0m00:29:52.682023 [info ] [Thread-1 (]: 4 of 7 START sql view model manual_test.prep_customer .......................... [RUN]
[0m00:29:52.682754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.ref_customers, now model.manual_pasfield.prep_customer)
[0m00:29:52.683371 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.prep_customer
[0m00:29:52.701661 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.prep_customer"
[0m00:29:52.702659 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.prep_customer
[0m00:29:52.721888 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.prep_customer"
[0m00:29:52.722624 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:29:52.799615 [debug] [Thread-1 (]: On model.manual_pasfield.prep_customer: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.prep_customer"} */


  create or replace view `manual-pasfield`.`manual_test`.`prep_customer`
  OPTIONS()
  as -- IMPORT CTES
with customers as 
(
select 
    *
from `manual-pasfield`.`manual_test_ref`.`ref_customers`
),

acq_orders as (
select
    *
from `manual-pasfield`.`manual_test_ref`.`ref_acq_orders`
),

activity as (
    select
        *
    from `manual-pasfield`.`manual_test_ref`.`ref_activity`
),

random_names_and_numbers as (
    -- Just showing the use of seeds and macros. 
    select
        customer_id,
        first_value(first_name) over (partition by customer_id order by rand()) as first_name,
        first_value(last_name) over (partition by customer_id order by rand()) as last_name,
        
    -- Generates a random UK mobile phone number in the format 07XXX XXXXXX

    concat(
        '07',
        cast(floor(100 + rand() * 900) as string),    -- 3-digit prefix (100-999)
        ' ',
        cast(floor(100000 + rand() * 900000) as string) -- 6-digit number (100000-999999)
    )
 as mobile_number
    from customers
    join `manual-pasfield`.`manual_test`.`customer_names` on true
),

-- LOGICAL CTE

final as (
    select
    distinct
        cast(customers.customer_id as string) as customer_id,
        random_names_and_numbers.first_name,
        random_names_and_numbers.last_name,
        random_names_and_numbers.mobile_number,
        -- Could be fixed with a mapping seed if I had more time :) 
        -- Little bit of data cleansing
        case 
            when customers.customer_country = "United Kingdom" then "UK"
            when customers.customer_country = "Brazil" then "BR"
        end as customer_country,
        acq_orders.taxonomy_business_category_group,
        cast(activity.subscription_id as string) as subscription_id,
        activity.from_date,
        activity.to_date,
        case when activity.to_date > cast(timestamp(datetime(current_timestamp(), 'UTC')) as date) then true else false end as has_active_subscripton,
    from customers
    inner join acq_orders on customers.customer_id = acq_orders.customer_id
    inner join activity on customers.customer_id = activity.customer_id
    left join random_names_and_numbers on customers.customer_id = random_names_and_numbers.customer_id
    
)

-- FINAL CTE
select * from final;


[0m00:29:53.406718 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:0fc48685-4b4d-4a9b-bf90-5c85e45006f4&page=queryresults
[0m00:29:53.684621 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b56b9b0>]}
[0m00:29:53.686078 [info ] [Thread-1 (]: 4 of 7 OK created sql view model manual_test.prep_customer ..................... [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m00:29:53.688611 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.prep_customer
[0m00:29:53.690984 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:29:53.691865 [info ] [Thread-1 (]: 5 of 7 START sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [RUN]
[0m00:29:53.693788 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.prep_customer, now model.manual_pasfield.mart_cohort_retention_analysis_monthly)
[0m00:29:53.694448 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:29:53.699548 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m00:29:53.700202 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:29:53.701856 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:29:54.051860 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:29:54.534900 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:e81a3048-7adb-4e9e-9e4d-cfaacd915bc4&page=queryresults
[0m00:29:54.686321 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: select * from (
        select
    
      
    cast(null as date)
 as cohort_month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as total_customers, 
      
    cast(null as int64)
 as retained_1_month, 
      
    cast(null as float64)
 as retention_rate_1_month, 
      
    cast(null as int64)
 as retained_3_months, 
      
    cast(null as float64)
 as retention_rate_3_months, 
      
    cast(null as int64)
 as retained_6_months, 
      
    cast(null as float64)
 as retention_rate_6_months
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:29:54.902711 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:9ec2f393-83af-43a5-9970-b290b3b88d03&page=queryresults
[0m00:29:55.049063 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_cohort_retention_analysis_monthly"
[0m00:29:55.050414 [debug] [Thread-1 (]: On model.manual_pasfield.mart_cohort_retention_analysis_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_cohort_retention_analysis_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
        
  (
    cohort_month date,
    customer_country string,
    taxonomy_business_category_group string,
    total_customers int64,
    retained_1_month int64,
    retention_rate_1_month float64,
    retained_3_months int64,
    retention_rate_3_months float64,
    retained_6_months int64,
    retention_rate_6_months float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select cohort_month, customer_country, taxonomy_business_category_group, total_customers, retained_1_month, retention_rate_1_month, retained_3_months, retention_rate_3_months, retained_6_months, retention_rate_6_months
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

-- LOGICAL CTEs
cohort_data as (
    select
        customer_id,
        date_trunc(from_date, month) as cohort_month,
        from_date,
        to_date,
        customer_country,
        taxonomy_business_category_group,
        date_diff(to_date, from_date, day) as subscription_length_days  -- length in days
    from customers
),

cohort_intervals as (
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        count(distinct customer_id) as total_customers,
        -- customers still active at 1,3,6 months
        count(distinct case when date_diff(to_date, from_date, day) >= 30 then customer_id end) as retained_1_month,
        count(distinct case when date_diff(to_date, from_date, day) >= 90 then customer_id end) as retained_3_months,
        count(distinct case when date_diff(to_date, from_date, day) >= 180 then customer_id end) as retained_6_months
    from cohort_data
    group by cohort_month, customer_country, taxonomy_business_category_group
),

cohort_retention_rates as (
    -- retention rates for each cohort at 1, 3, and 6 months
    select
        cohort_month,
        customer_country,
        taxonomy_business_category_group,
        total_customers,
        retained_1_month,
        retained_3_months,
        retained_6_months,
        --  retention rates as percentages
        round((safe_divide(retained_1_month, total_customers) * 100), 2) as retention_rate_1_month,
        round((safe_divide(retained_3_months, total_customers) * 100), 2) as retention_rate_3_months,
        round((safe_divide(retained_6_months, total_customers) * 100), 2) as retention_rate_6_months
    from cohort_intervals
)

-- FINAL CTE
select *
from cohort_retention_rates
order by cohort_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m00:29:55.553298 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:8d5ffd6a-c606-481a-a1ff-41e8585f7467&page=queryresults
[0m00:30:27.119015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b731970>]}
[0m00:30:27.122148 [info ] [Thread-1 (]: 5 of 7 OK created sql table model manual_test_mart.mart_cohort_retention_analysis_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 33.43s]
[0m00:30:27.123572 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_cohort_retention_analysis_monthly
[0m00:30:27.124277 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:30:27.125082 [info ] [Thread-1 (]: 6 of 7 START sql table model manual_test_mart.mart_customer_metrics_monthly .... [RUN]
[0m00:30:27.125840 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_cohort_retention_analysis_monthly, now model.manual_pasfield.mart_customer_metrics_monthly)
[0m00:30:27.126377 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:30:27.195259 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m00:30:27.196739 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:30:27.198380 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:30:27.532770 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:30:28.116692 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:82b73677-a68a-4e51-a919-5a9785a35a0b&page=queryresults
[0m00:30:28.242596 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: select * from (
        select
    
      
    cast(null as date)
 as month, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as acquired_customers, 
      
    cast(null as int64)
 as retained_customers, 
      
    cast(null as int64)
 as churned_customers, 
      
    cast(null as FLOAT64)
 as retention_rate, 
      
    cast(null as float64)
 as churn_rate
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:30:28.469861 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:ae16656a-54a6-4bf3-ba58-0a8509a543a1&page=queryresults
[0m00:30:28.579919 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_metrics_monthly"
[0m00:30:28.580600 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_metrics_monthly: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_metrics_monthly"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
        
  (
    month date,
    customer_country string,
    taxonomy_business_category_group string,
    acquired_customers int64,
    retained_customers int64,
    churned_customers int64,
    retention_rate FLOAT64,
    churn_rate float64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select month, customer_country, taxonomy_business_category_group, acquired_customers, retained_customers, churned_customers, retention_rate, churn_rate
    from (
        -- IMPORT CTEs
with customers as (
    select 
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

--LOGICAL CTEs

cohort_base as (
    -- customer's acquisition date, active period, churn date
    select
        customer_id,
        date_trunc(from_date, month) as acquisition_month,
        date_trunc(to_date, month) as churn_month,
        customer_country,
        taxonomy_business_category_group,
        ifnull(to_date, current_date()) as last_activity_date
    from customers
),

monthly_cohorts as (
    --  monthly cohorts for acquisition, retention, and churn
    select
        acquisition_month,
        count(distinct customer_id) as acquired_customers,
        customer_country,
        taxonomy_business_category_group
    from cohort_base
    group by acquisition_month, customer_country, taxonomy_business_category_group
),

churn_data as (
    -- monthly churn based on churn month
    select
        churn_month,
        count(distinct customer_id) as churned_customers
    from cohort_base
    where churn_month is not null
    group by churn_month
),

active_data as (
    -- retention by counting customers who remain active each month
    select
        date_trunc(monthly_date, month) as month,
        count(distinct customer_id) as retained_customers
    from customers,
    unnest(generate_date_array(date_trunc(from_date, month), date_trunc(to_date, month), interval 1 month)) as monthly_date
    group by month
)

-- FINAL
select
    acquisition_month as month,
    customer_country,
    taxonomy_business_category_group,
    acquired_customers,
    coalesce(retained_customers, 0) as retained_customers,
    coalesce(churned_customers, 0) as churned_customers,
    round(safe_divide(coalesce(retained_customers, 0), acquired_customers) * 100) as retention_rate,
    safe_divide(coalesce(churned_customers, 0), acquired_customers) * 100 as churn_rate
from monthly_cohorts
left join churn_data on acquisition_month = churn_month
left join active_data on acquisition_month = month
order by acquisition_month, customer_country, taxonomy_business_category_group
    ) as model_subq
    );
  
[0m00:30:29.139304 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:41a72a68-9a27-47c1-a6e2-c7dcdb707f41&page=queryresults
[0m00:31:05.329081 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a60f020>]}
[0m00:31:05.331732 [info ] [Thread-1 (]: 6 of 7 OK created sql table model manual_test_mart.mart_customer_metrics_monthly  [[32mCREATE TABLE (423.0 rows, 88.0 MiB processed)[0m in 38.20s]
[0m00:31:05.333181 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_metrics_monthly
[0m00:31:05.334036 [debug] [Thread-1 (]: Began running node model.manual_pasfield.mart_customer_retention_metrics
[0m00:31:05.334873 [info ] [Thread-1 (]: 7 of 7 START sql table model manual_test_mart.mart_customer_retention_metrics .. [RUN]
[0m00:31:05.335691 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.manual_pasfield.mart_customer_metrics_monthly, now model.manual_pasfield.mart_customer_retention_metrics)
[0m00:31:05.336249 [debug] [Thread-1 (]: Began compiling node model.manual_pasfield.mart_customer_retention_metrics
[0m00:31:05.342672 [debug] [Thread-1 (]: Writing injected SQL for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m00:31:05.343936 [debug] [Thread-1 (]: Began executing node model.manual_pasfield.mart_customer_retention_metrics
[0m00:31:05.347380 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:31:05.675131 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:31:06.414655 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f303dd7a-f282-4bf3-8a8a-6bd5cc7469b6&page=queryresults
[0m00:31:06.527219 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: select * from (
        select
    
      
    cast(null as string)
 as customer_id, 
      
    cast(null as string)
 as subscription_id, 
      
    cast(null as date)
 as from_date, 
      
    cast(null as date)
 as to_date, 
      
    cast(null as string)
 as customer_country, 
      
    cast(null as string)
 as taxonomy_business_category_group, 
      
    cast(null as int64)
 as subscription_length_days, 
      
    cast(null as int64)
 as time_since_last_activity_days
    ) as __dbt_sbq
    where false and current_timestamp() = current_timestamp()
    limit 0

[0m00:31:06.823130 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:d19bcf4a-30c8-4ebb-afd7-8400453b3b8a&page=queryresults
[0m00:31:06.937992 [debug] [Thread-1 (]: Writing runtime sql for node "model.manual_pasfield.mart_customer_retention_metrics"
[0m00:31:06.939653 [debug] [Thread-1 (]: On model.manual_pasfield.mart_customer_retention_metrics: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "model.manual_pasfield.mart_customer_retention_metrics"} */

  
    

    create or replace table `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
        
  (
    customer_id string,
    subscription_id string,
    from_date date,
    to_date date,
    customer_country string,
    taxonomy_business_category_group string,
    subscription_length_days int64,
    time_since_last_activity_days int64
    
    )

      
    
    

    OPTIONS()
    as (
      
    select customer_id, subscription_id, from_date, to_date, customer_country, taxonomy_business_category_group, subscription_length_days, time_since_last_activity_days
    from (
        with prep_customer as(
    select
        *
    from `manual-pasfield`.`manual_test`.`prep_customer`
),

merged_data as (
    -- some basic customer retention metrics just because this table will probably be usseful in the future
    select
        pc.customer_id,
        pc.subscription_id,
        pc.from_date,
        pc.to_date,
        pc.customer_country,
        pc.taxonomy_business_category_group,
        -- subscription length in days
        date_diff(pc.to_date, pc.from_date, day) as subscription_length_days,
        -- time since last activity in days
        date_diff(current_date(), pc.to_date, day) as time_since_last_activity_days
    from prep_customer pc
)

-- FINAL CTE
select *
from merged_data
    ) as model_subq
    );
  
[0m00:31:07.643632 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:65e2d1c9-dd22-4aa2-b7ce-a4cfda3ce35a&page=queryresults
[0m00:31:43.427713 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b0a99144-375e-4f8f-99a9-c58152a43665', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b7250a0>]}
[0m00:31:43.428435 [info ] [Thread-1 (]: 7 of 7 OK created sql table model manual_test_mart.mart_customer_retention_metrics  [[32mCREATE TABLE (103.3m rows, 88.0 MiB processed)[0m in 38.09s]
[0m00:31:43.428917 [debug] [Thread-1 (]: Finished running node model.manual_pasfield.mart_customer_retention_metrics
[0m00:31:43.430119 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:31:43.430383 [debug] [MainThread]: Connection 'model.manual_pasfield.mart_customer_retention_metrics' was properly closed.
[0m00:31:43.430692 [info ] [MainThread]: 
[0m00:31:43.430926 [info ] [MainThread]: Finished running 6 table models, 1 view model in 0 hours 2 minutes and 5.58 seconds (125.58s).
[0m00:31:43.431859 [debug] [MainThread]: Command end result
[0m00:31:43.466068 [info ] [MainThread]: 
[0m00:31:43.466342 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:31:43.466500 [info ] [MainThread]: 
[0m00:31:43.466655 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m00:31:43.469298 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 126.43533, "process_user_time": 4.604221, "process_kernel_time": 0.320515, "process_mem_max_rss": "204996608", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:31:43.469830 [debug] [MainThread]: Command `dbt run` succeeded at 00:31:43.469773 after 126.44 seconds
[0m00:31:43.470060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e678c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cdba3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b468740>]}
[0m00:31:43.470251 [debug] [MainThread]: Flushing usage events
[0m00:32:02.860578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10886fc80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e56ea0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e56c60>]}


============================== 00:32:02.863792 | 64215873-a7bc-40e0-8d9d-c7e13e898d1d ==============================
[0m00:32:02.863792 [info ] [MainThread]: Running with dbt=1.8.5
[0m00:32:02.864147 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield/logs', 'debug': 'False', 'profiles_dir': '/Users/Edward/Documents/MANUAL-AE/manual-pasfield', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt test', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:32:03.798761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64215873-a7bc-40e0-8d9d-c7e13e898d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f520ad0>]}
[0m00:32:03.823705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64215873-a7bc-40e0-8d9d-c7e13e898d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f6e12e0>]}
[0m00:32:03.824100 [info ] [MainThread]: Registered adapter: bigquery=1.8.2
[0m00:32:03.845565 [debug] [MainThread]: checksum: 643640a45b16e0d012867be4ac17daaa0c3ce97300faec3ce9a6de300b5e1c09, vars: {}, profile: , target: , version: 1.8.5
[0m00:32:03.942151 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:32:03.942406 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:32:03.945343 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.manual_pasfield.preparatory
[0m00:32:03.970840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64215873-a7bc-40e0-8d9d-c7e13e898d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec50920>]}
[0m00:32:04.054430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64215873-a7bc-40e0-8d9d-c7e13e898d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12efd74d0>]}
[0m00:32:04.054862 [info ] [MainThread]: Found 7 models, 1 seed, 7 data tests, 3 sources, 855 macros
[0m00:32:04.055156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64215873-a7bc-40e0-8d9d-c7e13e898d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cdfec90>]}
[0m00:32:04.056451 [info ] [MainThread]: 
[0m00:32:04.056969 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:32:04.059746 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_manual-pasfield_manual_test_mart'
[0m00:32:04.060030 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:32:04.378014 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_mart, now list_manual-pasfield_manual_test)
[0m00:32:04.378837 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:32:04.691872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test, now list_manual-pasfield_manual_test_ref)
[0m00:32:04.692506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:32:05.007365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64215873-a7bc-40e0-8d9d-c7e13e898d1d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ec232c0>]}
[0m00:32:05.007835 [info ] [MainThread]: Concurrency: 1 threads (target='prod')
[0m00:32:05.008050 [info ] [MainThread]: 
[0m00:32:05.010366 [debug] [Thread-1 (]: Began running node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:32:05.010651 [info ] [Thread-1 (]: 1 of 7 START test dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [RUN]
[0m00:32:05.011031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_manual-pasfield_manual_test_ref, now test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668)
[0m00:32:05.011276 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:32:05.026151 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"
[0m00:32:05.026717 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:32:05.038572 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"
[0m00:32:05.039653 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:05.108191 [debug] [Thread-1 (]: On test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      

with all_values as (

    select
        customer_country as value_field

    from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
    

),
set_values as (

    select
        cast('US' as string) as value_field
    union all
    select
        cast('CA' as string) as value_field
    union all
    select
        cast('GB' as string) as value_field
    union all
    select
        cast('DE' as string) as value_field
    union all
    select
        cast('FR' as string) as value_field
    union all
    select
        cast('AU' as string) as value_field
    union all
    select
        cast('UK' as string) as value_field
    union all
    select
        cast('BR' as string) as value_field
    
    
),
validation_errors as (
    -- values from the model that are not in the set
    select
        v.value_field
    from
        all_values v
        left join
        set_values s on v.value_field = s.value_field
    where
        s.value_field is null

)

select *
from validation_errors


      
    ) dbt_internal_test
[0m00:32:06.010695 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:f04aba55-d681-4033-aeaf-0aaea133ae99&page=queryresults
[0m00:32:06.338991 [info ] [Thread-1 (]: 1 of 7 PASS dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR  [[32mPASS[0m in 1.33s]
[0m00:32:06.339785 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668
[0m00:32:06.340106 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:32:06.340362 [info ] [Thread-1 (]: 2 of 7 START test not_null_mart_cohort_retention_analysis_monthly_cohort_month . [RUN]
[0m00:32:06.340843 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.dbt_expectations_expect_column_values_to_be_in_set_mart_customer_retention_metrics_customer_country__US__CA__GB__DE__FR__AU__UK__BR.8b430f6668, now test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546)
[0m00:32:06.341107 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:32:06.346385 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m00:32:06.347027 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:32:06.349954 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"
[0m00:32:06.350480 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:06.420414 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select cohort_month
from `manual-pasfield`.`manual_test_mart`.`mart_cohort_retention_analysis_monthly`
where cohort_month is null



      
    ) dbt_internal_test
[0m00:32:07.035094 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:1312e85e-be8e-4b50-b959-eb5ad5126c55&page=queryresults
[0m00:32:07.361319 [info ] [Thread-1 (]: 2 of 7 PASS not_null_mart_cohort_retention_analysis_monthly_cohort_month ....... [[32mPASS[0m in 1.02s]
[0m00:32:07.362770 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546
[0m00:32:07.363465 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:32:07.364346 [info ] [Thread-1 (]: 3 of 7 START test not_null_mart_customer_metrics_monthly_month ................. [RUN]
[0m00:32:07.365260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_cohort_retention_analysis_monthly_cohort_month.131daa5546, now test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb)
[0m00:32:07.365874 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:32:07.372816 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m00:32:07.374087 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:32:07.377939 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"
[0m00:32:07.378899 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:07.470838 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select month
from `manual-pasfield`.`manual_test_mart`.`mart_customer_metrics_monthly`
where month is null



      
    ) dbt_internal_test
[0m00:32:07.956583 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:774b1d3f-122e-4369-8d2b-bb0454bc90ba&page=queryresults
[0m00:32:08.291170 [info ] [Thread-1 (]: 3 of 7 PASS not_null_mart_customer_metrics_monthly_month ....................... [[32mPASS[0m in 0.93s]
[0m00:32:08.291599 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb
[0m00:32:08.291876 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:32:08.292060 [info ] [Thread-1 (]: 4 of 7 START test not_null_mart_customer_retention_metrics_customer_id ......... [RUN]
[0m00:32:08.292364 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_metrics_monthly_month.3f6dfca7eb, now test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389)
[0m00:32:08.292622 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:32:08.295503 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m00:32:08.296023 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:32:08.297589 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"
[0m00:32:08.298065 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:08.366085 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select customer_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where customer_id is null



      
    ) dbt_internal_test
[0m00:32:09.100678 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:a0616c34-b94f-443c-bc4e-8446f1f5d03c&page=queryresults
[0m00:32:09.440480 [info ] [Thread-1 (]: 4 of 7 PASS not_null_mart_customer_retention_metrics_customer_id ............... [[32mPASS[0m in 1.15s]
[0m00:32:09.441038 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389
[0m00:32:09.441281 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:32:09.441521 [info ] [Thread-1 (]: 5 of 7 START test not_null_mart_customer_retention_metrics_from_date ........... [RUN]
[0m00:32:09.441791 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_customer_id.14d750f389, now test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6)
[0m00:32:09.441995 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:32:09.444491 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m00:32:09.444934 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:32:09.446380 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"
[0m00:32:09.446702 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:09.514004 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select from_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where from_date is null



      
    ) dbt_internal_test
[0m00:32:10.280342 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:3520c82f-627c-4d91-9119-8bb73b9c9e0a&page=queryresults
[0m00:32:10.616031 [info ] [Thread-1 (]: 5 of 7 PASS not_null_mart_customer_retention_metrics_from_date ................. [[32mPASS[0m in 1.17s]
[0m00:32:10.616710 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6
[0m00:32:10.617064 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:32:10.617442 [info ] [Thread-1 (]: 6 of 7 START test not_null_mart_customer_retention_metrics_subscription_id ..... [RUN]
[0m00:32:10.617916 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_from_date.f7008476c6, now test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122)
[0m00:32:10.618239 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:32:10.676685 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m00:32:10.677322 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:32:10.678924 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"
[0m00:32:10.679387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:10.744936 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select subscription_id
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where subscription_id is null



      
    ) dbt_internal_test
[0m00:32:11.390199 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:05a053db-d0b1-4e8a-8471-17ad0e1cb2d6&page=queryresults
[0m00:32:11.709338 [info ] [Thread-1 (]: 6 of 7 PASS not_null_mart_customer_retention_metrics_subscription_id ........... [[32mPASS[0m in 1.09s]
[0m00:32:11.710686 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122
[0m00:32:11.711252 [debug] [Thread-1 (]: Began running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:32:11.711803 [info ] [Thread-1 (]: 7 of 7 START test not_null_mart_customer_retention_metrics_to_date ............. [RUN]
[0m00:32:11.712853 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.manual_pasfield.not_null_mart_customer_retention_metrics_subscription_id.c030ef7122, now test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c)
[0m00:32:11.713587 [debug] [Thread-1 (]: Began compiling node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:32:11.721204 [debug] [Thread-1 (]: Writing injected SQL for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m00:32:11.722373 [debug] [Thread-1 (]: Began executing node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:32:11.725945 [debug] [Thread-1 (]: Writing runtime sql for node "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"
[0m00:32:11.727107 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:32:11.819234 [debug] [Thread-1 (]: On test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c: /* {"app": "dbt", "dbt_version": "1.8.5", "profile_name": "manual-test-platform", "target_name": "prod", "node_id": "test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select to_date
from `manual-pasfield`.`manual_test_mart`.`mart_customer_retention_metrics`
where to_date is null



      
    ) dbt_internal_test
[0m00:32:12.464694 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=manual-pasfield&j=bq:EU:028a0026-f9ac-4955-abfb-bdb26fa9eade&page=queryresults
[0m00:32:12.796020 [info ] [Thread-1 (]: 7 of 7 PASS not_null_mart_customer_retention_metrics_to_date ................... [[32mPASS[0m in 1.08s]
[0m00:32:12.796847 [debug] [Thread-1 (]: Finished running node test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c
[0m00:32:12.798169 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:32:12.798579 [debug] [MainThread]: Connection 'test.manual_pasfield.not_null_mart_customer_retention_metrics_to_date.09ca38943c' was properly closed.
[0m00:32:12.798938 [info ] [MainThread]: 
[0m00:32:12.799284 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 8.74 seconds (8.74s).
[0m00:32:12.800817 [debug] [MainThread]: Command end result
[0m00:32:12.840739 [info ] [MainThread]: 
[0m00:32:12.841058 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:32:12.841246 [info ] [MainThread]: 
[0m00:32:12.841429 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m00:32:12.843373 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 10.018716, "process_user_time": 3.989231, "process_kernel_time": 0.412521, "process_mem_max_rss": "206422016", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m00:32:12.843740 [debug] [MainThread]: Command `dbt test` succeeded at 00:32:12.843680 after 10.02 seconds
[0m00:32:12.843978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105156b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c9077a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f240920>]}
[0m00:32:12.844191 [debug] [MainThread]: Flushing usage events
